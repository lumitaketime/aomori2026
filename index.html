<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>L'VOYAGE | ÂáΩÈ§®-ÈùíÊ£Æ ÊûóÊ™é‰πãÊóÖ</title>
    <meta name="theme-color" content="#1C2541">
    
    <!-- PWA: Add manifest link for standalone mode -->
    <link rel="manifest" href="manifest.json">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=Noto+Serif+TC:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Palette: Luxury Winter (Original) */
            --bg-body: #F9F8F4;
            --bg-card: #FFFFFF;
            --text-primary: #1A1A1A;
            --text-secondary: #666666;
            --accent-main: #1C2541; /* ÂçàÂ§úËóç */
            --accent-gold: #B49B67; /* È¶ôÊ™≥Èáë */
            --accent-red: #D9333F; /* ÈùíÊ£ÆÁ¥Ö */
            --line-light: #E0E0E0;
            --shadow-soft: 0 12px 45px -10px rgba(0,0,0,0.1); 
            --font-serif: 'Cormorant Garamond', 'Noto Serif TC', serif;
            --font-sans: 'Noto Sans TC', sans-serif;
            --safe-bottom: env(safe-area-inset-bottom);

            /* --- Receipt Printer Variables (Optimized) --- */
            --receipt-bg-body: #EAE8E0; 
            --machine-bg: #2C3550; 
            --machine-dark: #1a2033;
            --receipt-gold: #C5A870;
            --input-bg: #151b2b;
            --receipt-paper: #FDFDFD;
            
            /* Dynamic Width Logic: Clamp between 320px and 420px based on viewport */
            --machine-width: clamp(320px, 92vw, 420px);
            --paper-width: calc(100% - 40px); /* Paper is always slightly narrower than machine */
            
            --apple-red: #FF3B30;
            --status-green: #00FF94;
            --status-red: #FF453A;
            --status-orange: #FFaa00;
            --paper-texture: url("data:image/svg+xml,%3Csvg width='4' height='4' viewBox='0 0 4 4' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 3h1v1H1V3zm2-2h1v1H3V1z' fill='%23000000' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; padding: 0;
            background-color: var(--bg-body);
            color: var(--text-primary);
            font-family: var(--font-sans);
            padding-bottom: calc(90px + var(--safe-bottom)); /* Â∫ïÈÉ®Á©∫Èñì */
            overflow-x: hidden;
            overscroll-behavior-x: none; 
            overscroll-behavior-y: auto;
        }

        h1, h2, h3, .serif { font-family: var(--font-serif); }
        .hidden { display: none !important; }
        
        /* Link Styles in Description */
        #m-desc a {
            color: var(--accent-main);
            text-decoration: underline;
            text-decoration-color: var(--accent-gold);
            text-underline-offset: 3px;
        }
        
        /* Utility styles for detail info */
        .info-group { padding: 15px 0; border-top: 1px solid #EEE; border-bottom: 1px solid #EEE; }
        .info-item { display: flex; justify-content: space-between; margin-bottom: 10px; align-items: center; }
        .info-label { font-size: 0.85rem; color: #888; display: flex; align-items: center; }
        .info-label i { margin-right: 8px; color: var(--accent-gold); }
        .info-value { font-size: 0.95rem; font-weight: 500; color: var(--accent-main); text-align: right; }

        /* --- NON-BLOCKING MESSAGE (TOAST) --- */
        #app-message {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
            background: var(--accent-main); color: white;
            padding: 10px 20px; border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 2200; opacity: 0; pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            font-size: 0.9rem;
            min-width: 200px; text-align: center;
        }
        #app-message.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        /* --- INTRO SCREEN REDESIGN (UX/UI Optimized) --- */
        #intro-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background: linear-gradient(180deg, #1C2541 0%, #151b30 100%); /* Ê∑±ÈÇÉÂçàÂ§úÊº∏Â±§ */
            color: white;
            z-index: 9999; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            transition: transform 1s cubic-bezier(0.77, 0, 0.175, 1);
            padding: 0 30px;
            overflow: hidden; /* Èò≤Ê≠¢Èõ™Ëä±Ë∂ÖÂá∫ */
        }

        /* ËÉåÊôØÈ£ÑÈõ™ÂÆπÂô® */
        #snow-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 1;
        }

        .snowflake {
            position: absolute;
            color: #FFF;
            opacity: 0.8;
            top: -20px;
            animation: fall linear infinite; /* Modified: Changed forwards to infinite */
            font-size: 1rem;
            text-shadow: 0 0 5px rgba(255,255,255,0.8);
        }

        @keyframes fall {
            to { transform: translateY(105vh); }
        }

        /* ÂÖßÂÆπÂ±§Á¥ö */
        .intro-text {
            position: relative; z-index: 10;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 400px;
        }

        /* 1. ‰∏≠Â§ÆÊµÆÂãïÈõ™Ëä±ÂúñÊ®ô - Modified for elegance */
        .intro-main-icon {
            font-size: 2.2rem; /* Modified: Smaller size for elegance */
            color: var(--accent-gold);
            margin-bottom: 20px;
            filter: drop-shadow(0 0 10px rgba(180, 155, 103, 0.3));
            animation: floatIcon 6s ease-in-out infinite;
            opacity: 0;
            animation: floatIcon 6s ease-in-out infinite, fadeIn 1.5s ease forwards 0.2s;
        }

        @keyframes floatIcon {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-8px) rotate(5deg); } /* Modified: More subtle float */
        }

        .intro-countdown-block { 
            margin-bottom: 40px; 
            opacity: 0; 
            animation: fadeIn 1.5s ease forwards 0.5s; 
            text-align: center; 
            position: relative;
        }

        /* Êï∏Â≠óÊ®£ÂºèÂÑ™Âåñ */
        .countdown-value { 
            font-size: 6.5rem; 
            line-height: 1; 
            font-weight: 300; 
            color: var(--accent-gold); 
            font-family: var(--font-serif);
            margin-bottom: 10px;
            text-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .countdown-label {
            font-size: 0.75rem;
            letter-spacing: 6px; /* Â¢ûÂä†Â≠óË∑ùÁáüÈÄ†È´òÁ¥öÊÑü */
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
            font-weight: 400;
            margin-top: -5px;
        }

        .intro-title {
            font-family: var(--font-serif);
            font-size: 1.8rem;
            letter-spacing: 2px;
            margin-bottom: 5px;
            font-weight: 500;
            opacity: 0;
            animation: fadeIn 1.5s ease forwards 0.8s;
        }

        .intro-subtitle {
            font-family: var(--font-serif);
            font-size: 0.9rem;
            color: rgba(255,255,255,0.5);
            letter-spacing: 1px;
            margin-bottom: 20px;
            opacity: 0;
            animation: fadeIn 1.5s ease forwards 0.8s;
        }

        #dynamic-intro-text {
            font-family: var(--font-sans);
            font-size: 0.95rem; 
            margin-top: 10px; 
            color: rgba(255,255,255,0.9); 
            max-width: 320px; 
            text-align: center; 
            line-height: 1.6; 
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            animation: fadeIn 1.5s ease forwards 1s;
            padding: 5px 0;
            letter-spacing: 1px;
            font-weight: 300;
        }

        .intro-btn {
            margin-top: 40px; 
            padding: 14px 50px; 
            border: 1px solid rgba(255,255,255,0.4);
            border-radius: 50px; /* ÊîπÁÇ∫ÂúìËßíËÜ†ÂõäÁãÄ */
            background: rgba(255,255,255,0.05); 
            backdrop-filter: blur(5px);
            color: white; 
            font-family: var(--font-serif);
            font-size: 1.1rem; 
            letter-spacing: 3px; 
            cursor: pointer; 
            transition: all 0.4s ease;
            opacity: 0; 
            animation: fadeIn 1.5s ease forwards 1.2s;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .intro-btn:hover { background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.8); transform: translateY(-2px); }
        .intro-btn:active { transform: translateY(1px); }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* --- END INTRO STYLES --- */


        /* --- HEADER (Updated for backdrop blur) --- */
        .elegant-header {
            padding: 40px 20px 20px;
            /* Enhanced background for scrolling readability */
            background: linear-gradient(to bottom, #F9F8F4 85%, rgba(249,248,244,0.8) 95%, rgba(249,248,244,0));
            position: sticky; top: 0; z-index: 100;
            transition: background 0.3s;
        }
        /* Specific header style for Wallet View to reduce interference */
        .wallet-mode .elegant-header {
            background: rgba(234, 232, 224, 0.95); /* Matches receipt-bg-body with opacity */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .top-meta { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px; }
        .brand { font-family: var(--font-serif); font-size: 1.4rem; font-weight: 700; letter-spacing: 1px; color: var(--accent-main); }
        
        .status-value { font-family: var(--font-serif); font-size: 2rem; line-height: 1; color: var(--accent-gold); text-align: right; }
        .status-label { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 2px; color: var(--text-secondary); text-align: right; margin-top: 5px; }

        /* DATE SCROLLER */
        .date-scroller { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; scroll-behavior: smooth; }
        .date-scroller::-webkit-scrollbar { display: none; }
        .d-item { 
            min-width: 60px; text-align: center; opacity: 0.4; transition: 0.4s; cursor: pointer; 
            display: flex; flex-direction: column; align-items: center;
            user-select: none;
            flex-shrink: 0; 
        }
        .d-item.active { opacity: 1; transform: scale(1.1); }
        .d-week { font-size: 0.7rem; letter-spacing: 1px; margin-bottom: 5px; text-transform: uppercase; }
        .d-num { font-family: var(--font-serif); font-size: 1.5rem; position: relative; line-height: 1;}
        .d-item.active .d-num::after {
            content: ''; position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; background: var(--accent-gold); border-radius: 50%;
        }
        .d-weather { font-size: 0.6rem; margin-top: 8px; color: var(--text-secondary); display: flex; flex-direction: column; align-items: center; gap: 2px; min-height: 25px; }
        .d-weather i { font-size: 0.8rem; margin-bottom: 2px; }
        .d-item.active .d-weather { color: var(--accent-main); font-weight: 600; }

        /* --- TRIP VIEW & GESTURES --- */
        .view-section {
            width: 100%;
        }

        #view-trip {
            overflow-x: hidden; 
            min-height: 80vh; 
            touch-action: pan-y; 
        }

        .container { 
            padding: 0 20px; 
            max-width: 600px; 
            margin: 0 auto; 
            transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.35s ease; 
            will-change: transform, opacity;
        }

        /* Animation Classes */
        .slide-out-left { transform: translateX(-50px); opacity: 0; }
        .slide-out-right { transform: translateX(50px); opacity: 0; }
        .slide-in-from-right { animation: slideInRight 0.35s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
        .slide-in-from-left { animation: slideInLeft 0.35s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }

        @keyframes slideInRight {
            from { transform: translateX(50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideInLeft {
            from { transform: translateX(-50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .hero-card {
            position: relative; height: 280px; border-radius: 4px; overflow: hidden; margin-bottom: 20px;
            box-shadow: var(--shadow-soft);
        }
        .hero-img { width: 100%; height: 100%; object-fit: cover; transition: transform 10s ease; }
        .hero-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%; padding: 25px;
            background: linear-gradient(to top, rgba(28,37,65,0.9), transparent); color: white;
        }
        .hero-title { font-size: 1.6rem; margin: 0; line-height: 1.3; font-weight: 500; color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }

        .timeline-block { position: relative; padding-left: 20px; border-left: 1px solid var(--line-light); margin-left: 10px; }
        .event-node { position: relative; opacity: 0; transform: translateY(20px); transition: 0.6s ease; margin-bottom: 35px; }
        .event-node.visible { opacity: 1; transform: translateY(0); }
        
        .time-dot { 
            position: absolute; left: -25px; top: 0; width: 9px; height: 9px; 
            background: var(--bg-body); border: 2px solid var(--accent-main); border-radius: 50%; 
        }
        .event-card {
            background: var(--bg-card); padding: 20px; border-radius: 4px;
            box-shadow: var(--shadow-soft); cursor: pointer; transition: 0.3s;
            border-bottom: 2px solid transparent;
        }
        .event-card:active { transform: scale(0.98); }
        .event-tag { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 2px; color: var(--text-secondary); margin-bottom: 8px; display: block; }
        .event-title { font-family: var(--font-serif); font-size: 1.25rem; margin-bottom: 6px; color: var(--accent-main); font-weight: 700; }
        
        .transport-card {
            background: #F0F4F8;
            border-left: 3px solid #4A5672;
            position: relative;
            box-shadow: 0 4px 15px -5px rgba(0,0,0,0.1); 
            padding: 20px 30px;
            margin-left: 10px; /* Á∏ÆÊéíÊïàÊûú */
        }
        .transport-card::before, .transport-card::after {
            content: ''; position: absolute; top: 50%;
            width: 24px; height: 24px; background: var(--bg-body);
            border-radius: 50%; transform: translateY(-50%); z-index: 2; 
            box-shadow: var(--shadow-soft);
        }
        .transport-card::before { left: -12px; }
        .transport-card::after { right: -12px; }

        .alert-banner {
            background: rgba(217, 51, 63, 0.08); border-left: 3px solid var(--accent-red);
            padding: 15px; margin-bottom: 20px; border-radius: 0 4px 4px 0;
            display: flex; gap: 12px; align-items: flex-start;
        }
        .alert-highlight { color: var(--accent-red); font-weight: 700; display: block; margin-top: 4px; font-size: 0.85rem;}

        /* --- ACTIVE EVENT GLOW EFFECT --- */
        @keyframes breathing {
            0% { box-shadow: 0 0 5px rgba(180, 155, 103, 0.2); border-color: rgba(180, 155, 103, 0.4); }
            50% { box-shadow: 0 0 20px rgba(180, 155, 103, 0.6); border-color: rgba(180, 155, 103, 1); }
            100% { box-shadow: 0 0 5px rgba(180, 155, 103, 0.2); border-color: rgba(180, 155, 103, 0.4); }
        }
        .active-event .event-card {
            border: 1px solid var(--accent-gold);
            animation: breathing 3s infinite ease-in-out;
            background: rgba(255, 255, 255, 0.95);
            transform: scale(1.02);
        }
        .active-event .time-dot {
            background: var(--accent-gold);
            border-color: var(--accent-gold);
            box-shadow: 0 0 10px var(--accent-gold);
        }
        .active-label {
            display: inline-block; background: var(--accent-gold); color: white;
            font-size: 0.6rem; padding: 2px 6px; border-radius: 4px; margin-left: 8px;
            vertical-align: middle; letter-spacing: 1px;
        }

        /* --- TRANSLATE VIEW (Card Based) --- */
        #view-trans {
            padding-top: 20px;
        }
        
        .trans-card {
            background: var(--bg-card);
            border-radius: 8px;
            box-shadow: var(--shadow-soft);
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #EEE;
        }

        .trans-input {
            width: 100%;
            border: 1px solid #E0E0E0;
            border-radius: 4px;
            padding: 15px;
            font-family: var(--font-sans);
            font-size: 1rem;
            resize: none;
            background: #FAFAFA;
            outline: none;
            transition: border 0.3s;
        }
        .trans-input:focus { border-color: var(--accent-gold); background: #FFF; }

        .trans-action-btn {
            width: 100%;
            margin-top: 15px;
            padding: 12px;
            background: var(--accent-main);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .trans-action-btn:active { transform: translateY(1px); }

        .ps-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
        }
        .ps-card {
            background: var(--bg-card);
            padding: 20px 10px;
            border-radius: 8px;
            box-shadow: var(--shadow-soft);
            text-align: center;
            border: 1px solid #F0F0F0;
            cursor: pointer;
            transition: 0.2s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .ps-card:active { transform: scale(0.98); background: #FAFAFA; }
        .ps-icon { font-size: 1.8rem; margin-bottom: 10px; display: block; color: var(--accent-main); }
        .ps-title { font-size: 0.9rem; color: #555; }
        
        /* FS Modal Controls */
        #fs-controls {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            justify-content: center;
            width: 100%;
        }
        .fs-ctrl-btn {
            background: transparent;
            border: 1px solid #DDD;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            color: #555;
            cursor: pointer;
            transition: 0.2s;
        }
        .fs-ctrl-btn.active {
            background: var(--accent-gold);
            color: white;
            border-color: var(--accent-gold);
        }
        .fs-qty-ctrl {
            display: flex; align-items: center; gap: 20px;
            background: #F5F5F5;
            padding: 10px 20px;
            border-radius: 50px;
        }
        .fs-qty-btn {
            width: 40px; height: 40px;
            border-radius: 50%;
            border: none;
            background: white;
            color: var(--accent-main);
            font-size: 1.2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        .fs-qty-val { font-size: 1.5rem; font-weight: 700; width: 40px; text-align: center; }

        .info-card { background: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow-soft); margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; }
        .info-icon { width: 40px; height: 40px; border-radius: 50%; background: #F5F5F5; display: flex; justify-content: center; align-items: center; color: var(--accent-main); margin-right: 15px; }
        .map-overview-card { background: white; padding: 15px; border-radius: 8px; box-shadow: var(--shadow-soft); margin-bottom: 30px; }
        .map-iframe { width: 100%; height: 350px; border: none; border-radius: 4px; }
        
        /* --- NAV BAR --- */
        .glass-nav {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: auto; min-width: 280px;
            background: rgba(28, 37, 65, 0.95); backdrop-filter: blur(10px);
            border-radius: 50px; padding: 10px 30px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1000; gap: 25px;
        }
        .nav-btn { color: rgba(255,255,255,0.4); font-size: 1.4rem; cursor: pointer; transition: 0.3s; position: relative; padding: 10px; display: flex; justify-content: center; align-items: center; }
        .nav-btn.active { color: var(--accent-gold); transform: translateY(-2px); }
        .nav-btn.active::after { content: ''; position: absolute; bottom: 0; width: 4px; height: 4px; background: var(--accent-gold); border-radius: 50%; }

        /* --- MODALS --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1900; opacity: 0; pointer-events: none; transition: 0.3s; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-full {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 90vh;
            background: var(--bg-body); z-index: 2000; border-radius: 20px 20px 0 0;
            transform: translateY(100%); transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            overflow-y: auto; padding-bottom: 40px;
        }
        .modal-full.active { transform: translateY(0); }
        .modal-header-img { height: 250px; width: 100%; object-fit: cover; }
        .modal-content { padding: 0 20px; }
        
        .note-edit-area { width: 100%; padding: 10px; border: 1px solid var(--accent-gold); border-radius: 4px; font-family: var(--font-sans); margin-bottom: 10px; font-size: 1rem; line-height: 1.5; }
        .note-save-btn { background: var(--accent-gold); color: white; border: none; padding: 8px 20px; border-radius: 4px; cursor: pointer; font-size: 0.9rem; }
        .snowflake-icon { color: #B49B67; font-size: 1.1rem; cursor: pointer; margin-left: 10px; transition: transform 0.3s; display: inline-block; }
        .snowflake-icon:hover { transform: rotate(45deg); }

        #fs-text-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 2100; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 40px; text-align: center; transform: scale(0.9); opacity: 0; pointer-events: none; transition: 0.3s; }
        #fs-text-modal.active { transform: scale(1); opacity: 1; pointer-events: auto; }
        .fs-jp { font-size: 2.5rem; font-weight: 700; margin-bottom: 20px; line-height: 1.4; color: var(--text-primary); }
        .fs-cn { font-size: 1.2rem; color: #666; background: #F5F5F5; padding: 10px 20px; border-radius: 20px; }

        /* --- RECEIPT PRINTER CSS OVERRIDES --- */
        #view-wallet {
            background-color: var(--receipt-bg-body);
            min-height: 100vh;
            /* Update: More bottom padding to clear the floating nav completely */
            padding: 110px 15px 160px; 
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- Á∏ΩÊàêÁµêÊßã --- */
        .printer-assembly {
            position: relative;
            /* Update: Dynamic width using clamp for responsiveness */
            width: var(--machine-width);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 100;
            margin-top: 10px;
            margin-bottom: 50px;
            /* Update: Ensure centering explicitly */
            margin-left: auto;
            margin-right: auto;
        }

        /* --- LAYER 1: ‰∏äÊñπÈÄ≤Á¥ô --- */
        .paper-input-feed {
            position: absolute;
            width: var(--paper-width);
            /* Center the paper relative to the machine */
            left: 50%;
            transform: translateX(-50%);
            top: -95px; 
            height: 125px; 
            background: var(--receipt-paper);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            z-index: 10; 
            background-image: var(--paper-texture);
            mask-image: linear-gradient(to bottom, transparent, black 15%);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 15%);
            overflow: hidden; 
            cursor: pointer;
            transition: transform 0.3s, top 0.3s;
        }
        
        .paper-input-feed:hover {
            /* Modified transform to preserve X centering */
            transform: translateX(-50%) translateY(-2px);
        }

        .paper-input-feed.expanded .feed-scroll-wrapper {
            transform: translate3d(0, -125px, 0); 
        }

        .feed-scroll-wrapper {
            width: 100%;
            height: 250px; 
            display: flex;
            flex-direction: column;
            transform: translate3d(0, 0, 0);
            transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1);
        }

        .feed-section {
            width: 100%;
            height: 125px; 
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end; 
            padding-bottom: 40px; 
        }

        .input-header-content { text-align: center; color: #AAA; width: 80%; }
        .feed-total-view { text-align: center; width: 100%; }

        .input-brand {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem; 
            font-weight: 600; 
            letter-spacing: 1px; 
            color: #777; 
            margin-bottom: 4px;
            text-transform: uppercase;
        }
        .input-date {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.7rem;
            color: #BBB;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        .input-dash { width: 100%; height: 1px; border-bottom: 1px dashed #DDD; }

        .feed-total-label {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.65rem; color: #999; letter-spacing: 2px; margin-bottom: 4px; text-transform: uppercase;
        }
        .feed-total-amount {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2rem; font-weight: 700; color: var(--machine-bg); line-height: 1; margin-bottom: 2px;
        }
        .feed-total-sub {
            font-family: 'Share Tech Mono', monospace; font-size: 0.7rem; color: #BBB;
        }

        /* --- LAYER 3: Ê©üÂô®Êú¨È´î --- */
        .machine-body {
            width: 100%; 
            background: var(--machine-bg);
            border-radius: 20px 20px 0 0; 
            padding: 25px 25px 35px 25px; 
            box-shadow: 
                0 5px 20px rgba(0,0,0,0.2), 
                inset 0 1px 0 rgba(255,255,255,0.1),
                0 0 0 1px rgba(0,0,0,0.2);
            position: relative;
            z-index: 50; 
        }

        /* --- LAYER 1: ÈªëËâ≤Âá∫Á¥ôÂè£ --- */
        .machine-bottom-lip {
            width: 100%; 
            height: 25px; 
            background: #0a0a0a; 
            border-radius: 0 0 20px 20px; 
            position: relative;
            z-index: 30; 
            margin-top: 0; 
            box-shadow: 
                inset 0 2px 10px rgba(0,0,0,0.9), 
                0 20px 40px -10px rgba(0,0,0,0.6); 
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .lip-line { width: 80%; height: 2px; background: #222; border-radius: 2px; opacity: 0.5; }

        /* --- LAYER 2: Êî∂ÊìöÁ¥ôÂºµ --- */
        .continuous-receipt-container {
            position: relative;
            width: var(--paper-width);
            margin-top: -40px; 
            z-index: 40; 
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.1));
            /* Ensure centering logic applies if width changes */
            margin-left: auto;
            margin-right: auto;
        }

        .receipt-strip {
            background: var(--receipt-paper);
            background-image: var(--paper-texture);
            min-height: 120px;
            display: flex;
            flex-direction: column;
            padding-top: 30px; 
            position: relative;
        }

        .receipt-strip::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 30px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.3), transparent); z-index: 2; pointer-events: none;
        }
        .receipt-strip::after {
            content: ""; position: absolute; bottom: -10px; left: 0; width: 100%; height: 10px;
            background: linear-gradient(45deg, transparent 33.333%, var(--receipt-paper) 33.333%, var(--receipt-paper) 66.667%, transparent 66.667%), 
                         linear-gradient(-45deg, transparent 33.333%, var(--receipt-paper) 33.333%, var(--receipt-paper) 66.667%, transparent 66.667%);
            background-size: 10px 20px; background-position: 0 -10px; 
        }

        /* --- Ê©üÂô®‰ªãÈù¢ --- */
        .machine-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .brand-plate { 
            background: rgba(0,0,0,0.3); padding: 4px 10px; border-radius: 4px; 
            border: 1px solid rgba(197, 168, 112, 0.2); display: flex; align-items: center;
        }
        .machine-label { 
            font-family: 'Share Tech Mono', monospace; color: var(--receipt-gold); 
            font-size: 0.65rem; letter-spacing: 2px; text-transform: uppercase; 
        }
        .header-right-group { display: flex; align-items: center; gap: 12px; }
        
        .rate-display { 
            font-family: 'Share Tech Mono', monospace; color: rgba(197, 168, 112, 0.5); 
            font-size: 0.65rem; letter-spacing: 1px; 
        }
        .rate-label-default {
            font-size: 0.5em; /* Smaller font for DEFAULT tag */
            opacity: 0.7;
            margin-left: 4px;
            background: rgba(255,69,58,0.2);
            padding: 1px 3px;
            border-radius: 2px;
            color: #FF453A;
        }

        /* Status Light Variations */
        .status-light { 
            width: 6px; height: 6px; border-radius: 50%; 
            transition: background-color 0.3s, box-shadow 0.3s; 
        }
        
        .status-light.online { background-color: var(--status-green); box-shadow: 0 0 8px var(--status-green); }
        .status-light.offline { background-color: var(--status-red); box-shadow: 0 0 8px var(--status-red); }
        .status-light.processing { background-color: var(--status-orange); box-shadow: 0 0 10px var(--status-orange); }

        /* Inputs */
        .input-deck { display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px;}
        .skeuo-slot { background: var(--input-bg); border-radius: 8px; box-shadow: inset 0 2px 5px rgba(0,0,0,0.5), 0 1px 0 rgba(255,255,255,0.05); padding: 2px; border: 1px solid rgba(0,0,0,0.3); position: relative; }
        
        .machine-input { 
            width: 100%; background: transparent; border: none; color: #E0E0E0; 
            padding: 12px 15px; 
            font-family: 'Noto Serif TC', serif;
            font-size: 0.95rem; outline: none; letter-spacing: 0.5px; position: relative; z-index: 5;
        }
        .machine-input::placeholder { font-family: 'Noto Serif TC', serif; color: rgba(255,255,255,0.15); font-style: normal; }
        
        .price-wrapper { display: flex; align-items: center; padding-left: 10px; height: 100%; }
        .currency-switch { font-family: 'Share Tech Mono', monospace; color: var(--receipt-gold); font-size: 0.9rem; margin-right: 5px; cursor: pointer; padding: 0 8px; display: flex; align-items: center; gap: 4px;}
        .price-input-container { flex: 1; position: relative; display: flex; align-items: center; }
        
        .price-input-container .machine-input { 
            padding-right: 110px; font-size: 1.5rem; font-family: 'Cormorant Garamond', serif; font-weight: 600; color: var(--receipt-gold); padding-top: 12px; padding-bottom: 12px;
        }
        .input-subtext { position: absolute; right: 15px; font-family: 'Share Tech Mono', monospace; font-size: 0.75rem; color: rgba(180, 155, 103, 0.5); pointer-events: none; }

        /* --- Control Panel --- */
        .control-panel { display: flex; justify-content: space-between; gap: 15px; }
        
        .user-toggles-compact { 
            flex: 1; display: flex; 
            background: #0f1420; border-radius: 6px; padding: 4px; 
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5); 
            border: 1px solid rgba(0,0,0,0.3); 
            gap: 2px;
        }
        
        .u-btn { 
            flex: 1; background: transparent; border: none; color: rgba(255,255,255,0.2); 
            padding: 0; border-radius: 4px; font-size: 0.9rem; font-weight: 600; 
            cursor: pointer; transition: 0.2s; font-family: 'Noto Serif TC', serif; 
        }
        .u-btn.active { background: var(--receipt-gold); color: var(--machine-dark); box-shadow: 0 2px 5px rgba(0,0,0,0.3); font-weight: bold; }

        .print-btn { 
            width: 100px; height: 45px; 
            background: linear-gradient(to bottom, #C5A870, #967d4d); 
            border: none; color: #2b2b2b; 
            font-family: 'Share Tech Mono', monospace; font-size: 0.8rem; 
            border-radius: 4px; cursor: pointer; 
            box-shadow: 0 5px 0 #5e4d2b; font-weight: 700; position: relative; letter-spacing: 1px; overflow: hidden;
            transition: all 0.1s;
        }
        .print-btn:active { transform: translateY(4px); box-shadow: 0 1px 0 #5e4d2b; }
        .print-btn.processing { opacity: 0.8; cursor: wait; pointer-events: none; color: rgba(43,43,43, 0.6); }

        /* --- OPTIMIZED LIST ITEMS --- */
        .receipt-entry {
            position: relative; overflow: hidden; background: transparent;
            transition: max-height 0.4s ease-out, margin 0.4s ease-out, padding 0.4s ease-out, opacity 0.3s;
            max-height: 120px; 
            transform: translate3d(0,0,0);
        }

        .receipt-content {
            position: relative;
            background: var(--receipt-paper);
            background-image: var(--paper-texture);
            padding: 12px 20px;
            z-index: 5;
            border-bottom: 1px dashed #DDD;
            transition: transform 0.25s cubic-bezier(0.2, 0.8, 0.2, 1);
            cursor: pointer; 
            width: 100%;
        }

        .delete-underlay {
            position: absolute; top: 0; bottom: 0; right: 0; width: 100%; 
            background-color: var(--apple-red);
            display: flex; align-items: center; justify-content: flex-end; 
            padding-right: 25px; z-index: 1; color: white; font-size: 1.2rem;
            opacity: 0; 
            transition: opacity 0.2s;
        }

        .receipt-entry.reveal-delete .delete-underlay { opacity: 1; }
        .receipt-entry.reveal-delete .receipt-content { transform: translate3d(-80px, 0, 0); }
        .receipt-entry.new-item { animation: printSlideOut 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }

        .receipt-entry.tearing .receipt-content {
            transition: transform 0.4s ease-in, opacity 0.3s ease-in;
            transform: translate3d(-120%, 0, 0) rotate(-10deg);
            opacity: 0;
        }
        .receipt-entry.tearing { max-height: 0; margin: 0; padding: 0; opacity: 0; }
        .receipt-entry.dimmed .receipt-content { opacity: 0.4; filter: grayscale(1); }

        @keyframes printSlideOut {
            from { opacity: 0; max-height: 0; padding-top: 0; padding-bottom: 0; transform: translateY(-10px); }
            to { opacity: 1; max-height: 120px; padding-top: 12px; padding-bottom: 12px; transform: translateY(0); }
        }

        .re-header { display: flex; justify-content: space-between; font-family: 'Share Tech Mono', monospace; font-size: 0.6rem; color: #999; margin-bottom: 4px; pointer-events: none;}
        .re-body { display: flex; justify-content: space-between; align-items: flex-end; pointer-events: none;}
        .re-item { font-family: 'Noto Serif TC', serif; font-weight: 700; color: #333; font-size: 1rem; }
        .re-user { display: inline-block; background: #333; color: #fff; font-size: 0.6rem; padding: 1px 5px; border-radius: 4px; margin-right: 5px; vertical-align: middle; min-width: 20px; text-align: center;}
        .receipt-entry:not(.dimmed) .re-user { background: var(--receipt-gold); color: var(--machine-dark); }
        .re-cost { text-align: right; }
        .re-price { font-family: 'Cormorant Garamond', serif; font-weight: 700; font-size: 1.2rem; color: var(--machine-bg); line-height: 1; }
        .re-sub { font-family: 'Share Tech Mono'; font-size: 0.65rem; color: #999; margin-top: 2px; }

        .receipt-total-section {
            margin-top: auto; padding: 20px 20px 20px;
            border-top: 2px solid #333; border-bottom: 4px double #333;
            margin-bottom: 10px; background: rgba(0,0,0,0.02); 
        }
        .total-row { display: flex; justify-content: space-between; align-items: baseline; }
        .total-label { font-family: 'Cormorant Garamond', serif; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; font-size: 1rem; color: #333;}
        .total-amount { font-family: 'Cormorant Garamond', serif; font-weight: 700; font-size: 1.6rem; color: #333; }
        .trip-total-row {
            display: flex; justify-content: space-between; align-items: center;
            margin-top: 8px; padding-top: 8px; border-top: 1px dashed #DDD;
            color: #999; font-size: 0.7rem; font-family: 'Share Tech Mono';
        }
        .receipt-empty { text-align: center; color: #CCC; font-family: 'Share Tech Mono'; font-size: 0.7rem; padding: 40px 20px; letter-spacing: 1px; }

    </style>
</head>
<body>

    <!-- Intro -->
    <div id="intro-screen">
        <!-- Èõ™Ëä±ËÉåÊôØÂÆπÂô® (JS ÁîüÊàê) -->
        <div id="snow-container"></div>

        <div class="intro-text">
            <!-- 1. ‰∏≠Â§ÆÊµÆÂãïÁöÑÈõ™Ëä±ÂúñÊ®ô -->
            <i class="fa-solid fa-snowflake intro-main-icon"></i>
            
            <!-- 2. ÂÄíÊï∏ÂçÄÂüü -->
            <div class="intro-countdown-block">
                <div class="countdown-value" id="days-left">--</div>
                <div class="countdown-label">DAYS TO DEPARTURE</div>
            </div>

            <div class="intro-title">ÊûóÊ™éËàáÁôΩÈõ™‰πãÊóÖ</div>
            <div class="intro-subtitle">Hokkaido & Aomori Winter Adventure</div>
            
            <div id="dynamic-intro-text"></div> 
            <button class="intro-btn" onclick="window.enterApp()">ÈñãÂßãÊóÖÁ®ã</button>
        </div>
    </div>

    <!-- Main App -->
    <div id="app-container">
        
        <div class="elegant-header" id="app-header">
            <div class="top-meta">
                <div class="brand">L'VOYAGE</div>
                <div style="text-align: right;">
                    <div class="status-value" id="header-days">--</div>
                    <div class="status-label">DAYS TO GO</div>
                </div>
            </div>
            <div class="date-scroller" id="date-nav">
                <!-- JS Generated -->
            </div>
        </div>

        <!-- 1. TRIP VIEW -->
        <div id="view-trip" class="view-section">
            <div class="container" id="timeline-container">
                <!-- JS Generated -->
            </div>
        </div>

        <!-- 2. WALLET VIEW (REPLACED CONTENT) -->
        <div id="view-wallet" class="view-section hidden" style="position:relative;">
            <div class="printer-assembly">
                <div class="paper-input-feed" onclick="window.toggleTopFeed()">
                    <div class="feed-scroll-wrapper">
                        <div class="feed-section header-view">
                            <div class="input-header-content">
                                <div class="input-brand">L'VOYAGE</div>
                                <div class="input-date" id="header-date">--</div>
                                <div class="input-dash"></div>
                            </div>
                        </div>
                        <div class="feed-section total-view">
                            <div class="feed-total-view">
                                <div class="feed-total-label" id="top-total-label">TRIP TOTAL</div>
                                <div class="feed-total-amount" id="top-total-amount">¬•0</div>
                                <div class="feed-total-sub" id="top-total-sub">‚âà TWD 0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="machine-body">
                    <div class="machine-header">
                        <div class="brand-plate">
                            <div class="machine-label">L'VOYAGE RECORDER</div>
                        </div>
                        <div class="header-right-group">
                            <div class="rate-display">RATE: <span id="rate-value">0.22</span></div>
                            <div class="status-light online" id="status-light"></div> <!-- Default online styling -->
                        </div>
                    </div>

                    <div class="input-deck">
                        <div class="skeuo-slot">
                            <input type="text" id="input-item" class="machine-input" placeholder="ITEM NAME" autocomplete="off">
                        </div>
                        <div class="skeuo-slot">
                            <div class="price-wrapper">
                                <div class="currency-switch" onclick="window.toggleCurrency(event)">
                                    <span id="curr-label">JPY</span> <i class="fa-solid fa-caret-down"></i>
                                </div>
                                <div class="price-input-container">
                                    <input type="tel" id="input-price" class="machine-input" placeholder="0" oninput="window.calculateConversion(this.value)">
                                    <div class="input-subtext" id="embedded-preview">‚âà TWD 0</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="control-panel">
                        <div class="user-toggles-compact" id="user-toggles">
                            <button class="u-btn active" onclick="window.selectUser(this, 'Â•é')">Â•é</button>
                            <button class="u-btn" onclick="window.selectUser(this, 'ÊÑâ')">ÊÑâ</button>
                            <button class="u-btn" onclick="window.selectUser(this, 'Ëàú')">Ëàú</button>
                        </div>
                        <button class="print-btn" onclick="window.printReceipt()" id="print-btn">
                            <span>PRINT</span>
                        </button>
                    </div>
                </div>

                <div class="machine-bottom-lip">
                    <div class="lip-line"></div>
                </div>

                <div class="continuous-receipt-container">
                    <div class="receipt-strip" id="receipt-strip">
                        <!-- Event Delegation Container -->
                        <div id="receipt-items-anchor"></div>
                        
                        <div class="receipt-empty" id="receipt-empty">READY TO PRINT...</div>
                        <div class="receipt-total-section">
                            <div class="total-row">
                                <span class="total-label" id="total-label">TOTAL (Â•é)</span>
                                <span class="total-amount" id="personal-total">¬•0</span>
                            </div>
                            <div class="trip-total-row">
                                <span>TRIP TOTAL</span>
                                <span id="trip-total">¬•0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. TRANSLATE VIEW (Card Design Restored) -->
        <div id="view-trans" class="view-section hidden">
            <div class="container">
                <div class="trans-card">
                    <h3 class="serif" style="margin-top:0; margin-bottom: 20px; color: var(--accent-main); text-align: center;">Âç≥ÊôÇÁøªË≠Ø (Powered by Gemini)</h3>
                    <textarea id="trans-input" class="trans-input" rows="3" placeholder="Ëº∏ÂÖ•‰∏≠Êñá... (‰æãÂ¶ÇÔºöË´ãÂïèÈÄôÂÄãÂ§öÂ∞ëÈå¢Ôºü)"></textarea>
                    <button class="trans-action-btn" onclick="window.translateNow()">
                        <i class="fa-solid fa-language"></i> ÁøªË≠ØÊàêÊó•Êñá
                    </button>
                    
                    <div id="trans-output-box" class="hidden" style="margin-top: 25px; padding: 15px; border-radius: 4px; background: #F8F8F8; border-left: 4px solid var(--accent-gold);">
                        <div style="font-size: 0.75rem; color: #888;">‰∏≠ÊñáÂéüÊñá: <span id="trans-zh"></span></div>
                        <div class="serif" style="font-size: 1.4rem; color: var(--accent-main); margin-top: 5px; font-weight: 600;" id="trans-jp-result"></div>
                        <button onclick="window.showFs(document.getElementById('trans-jp-result').innerText, document.getElementById('trans-zh').innerText)" style="background: transparent; border: 1px solid #CCC; color: #666; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; margin-top: 10px; cursor: pointer; display: block; margin-left: auto;">
                            <i class="fa-solid fa-expand"></i> ÂÖ®Ëû¢Âπï
                        </button>
                    </div>
                </div>

                <h3 class="serif" style="margin: 30px 0 15px; text-align: center; color: #888;">ÊåáÂ∑ÆÁ¢∫Ë™ç</h3>
                <div class="ps-grid">
                    <div class="ps-card" onclick="window.showFs('ÁßÅ„ÅØÁâõËÇâ„Å®Ë±öËÇâ„Å®ÁæäËÇâ„ÅåÈ£ü„Åπ„Çâ„Çå„Åæ„Åõ„Çì„ÄÇ', 'Êàë‰∏çÂêÉÁâõ„ÄÅË±¨„ÄÅÁæäËÇâ')">
                        <span class="ps-icon">ü•©</span>
                        <div class="ps-title">‰∏çÂêÉÁ¥ÖËÇâ</div>
                    </div>
                    <div class="ps-card" onclick="window.showFs('ÂÖçÁ®é„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ', 'ÊàëÊÉ≥ÈÄÄÁ®Ö')">
                        <span class="ps-icon">üí∞</span>
                        <div class="ps-title">ÊàëË¶ÅÈÄÄÁ®Ö</div>
                    </div>
                    <!-- Checkout with options -->
                    <div class="ps-card" onclick="window.showFs('„Åä‰ºöË®à„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ', 'È∫ªÁÖ©ÁµêÂ∏≥', 'checkout')">
                        <span class="ps-icon">üí≥</span>
                        <div class="ps-title">ÁµêÂ∏≥</div>
                    </div>
                    <!-- Quantity Selector -->
                    <div class="ps-card" onclick="window.showFs('„Åì„Çå„Çí 1 ÂÄã„Åè„Å†„Åï„ÅÑ„ÄÇ', 'ÊàëË¶ÅÈÄôÂÄã', 'quantity')">
                        <span class="ps-icon">üëâ</span>
                        <div class="ps-title">ÊàëË¶ÅÈÄôÂÄã</div>
                    </div>
                    <div class="ps-card" onclick="window.showFs('„ÅäÊâãÊ¥ó„ÅÑ„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü', 'Ë´ãÂïèÂªÅÊâÄÂú®Âì™Ë£°Ôºü')">
                        <span class="ps-icon">üöª</span>
                        <div class="ps-title">ÊâæÂªÅÊâÄ</div>
                    </div>
                    <div class="ps-card" onclick="window.showFs('Âä©„Åë„Å¶„Åè„Å†„Åï„ÅÑÔºÅ', 'ÊïëÂëΩÔºÅ')" style="border-color: #FFCDD2;">
                        <span class="ps-icon" style="color: var(--accent-red);">üÜò</span>
                        <div class="ps-title" style="color: var(--accent-red);">Á∑äÊÄ•Ê±ÇÊïë</div>
                    </div>
                    <div class="ps-card" onclick="window.showFs('„É¨„ÇÆ„É•„É©„ÉºÊ∫Ä„Çø„É≥„Åß„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ', '‰Ω†Â•ΩÊàëÊÉ≥Ë¶Å95Âä†ÊªøÊ≤π')">
                        <span class="ps-icon">‚õΩ</span>
                        <div class="ps-title">Âä†Ê≤π</div>
                    </div>
                    <div class="ps-card" onclick="window.showFs('ÂÖçÁ®é„Ç´„Ç¶„É≥„Çø„Éº„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü', 'Ë´ãÂïèÂì™ÈÇäÂèØ‰ª•ÈÄÄÁ®Ö')">
                        <span class="ps-icon">üìç</span>
                        <div class="ps-title">Ë©¢ÂïèÈÄÄÁ®ÖÈªû</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. INFO VIEW -->
        <div id="view-info" class="view-section hidden">
            <div class="container">
                
                <div class="map-overview-card" style="margin-top: 20px;">
                    <h2 class="serif" style="margin-top: 0; color: var(--accent-main); font-size: 1.3rem;">ÊóÖË°åÁ∏ΩË¶ΩÂú∞Âúñ</h2>
                    <p style="color: #666; font-size: 0.9rem; margin-bottom: 10px;">ÁØÑÂúçÔºöÂÖ´Êà∂„ÄÅÈùíÊ£Æ„ÄÅÂáΩÈ§®„ÄÅÂºòÂâç</p>
                    <iframe id="trip-map-overview-iframe" 
                                class="map-iframe"
                                allowfullscreen="" 
                                loading="lazy" 
                                referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>

                <div class="wallet-card">
                    <h2 class="serif" style="margin-top: 0; color: var(--accent-main);">ÈáçË¶ÅË≥áË®äÂΩôÊï¥</h2>
                    <p style="color: #666; font-size: 0.9rem;">Á∑äÊÄ•ÊôÇÂàªËàáÈÄöÈóúÂøÖÂÇô</p>
                </div>

                <div class="info-card" onclick="window.open('https://vjw-lp.digital.go.jp/zh-hant/', '_blank')">
                    <div style="display:flex; align-items:center;">
                        <div class="info-icon" style="background: #FFF3E0; color: #E65100;"><i class="fa-solid fa-passport"></i></div>
                        <div class="info-text">
                            <h3>Visit Japan Web</h3>
                            <p>ÂÖ•Â¢ÉÂØ©Êü• & Êµ∑ÈóúÁî≥Â†± QR Code</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-chevron-right" style="color:#CCC;"></i>
                </div>

                <div class="info-card" onclick="window.location.href='tel:110'">
                    <div style="display:flex; align-items:center;">
                        <div class="info-icon" style="background: #FFEBEE; color: #D32F2F;"><i class="fa-solid fa-shield-halved"></i></div>
                        <div class="info-text">
                            <h3>Êó•Êú¨Â†±Ë≠¶ 110</h3>
                            <p>ÈÅáÂà∞‰∫ãÊïÖÊàñÁäØÁΩ™ÊôÇ</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-phone" style="color:var(--accent-red);"></i>
                </div>

                <div class="info-card" onclick="window.location.href='tel:119'">
                    <div style="display:flex; align-items:center;">
                        <div class="info-icon" style="background: #FFEBEE; color: #D32F2F;"><i class="fa-solid fa-truck-medical"></i></div>
                        <div class="info-text">
                            <h3>ÁÅ´Ë≠¶/ÊïëË≠∑Ëªä 119¬†</h3>
                            <p>ÊÄ•ÁóÖÊàñÂèóÂÇ∑ÊôÇ</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-phone" style="color:var(--accent-red);"></i>
                </div>

                <div class="info-card" onclick="window.location.href='tel:+81-11-222-2930'">
                    <div style="display:flex; align-items:center;">
                        <div class="info-icon" style="background: #E3F2FD; color: #1565C0;"><i class="fa-solid fa-building-flag"></i></div>
                        <div class="info-text">
                            <h3>ÈßêÊó•‰ª£Ë°®Ëôï (Êú≠ÂπåÂàÜËôï)</h3>
                            <p>ÂåóÊµ∑ÈÅì/ÈùíÊ£ÆÁ∑äÊÄ•ËÅØÁµ°: +81-11-222-2930</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-phone" style="color:#1565C0);"></i>
                </div>
            </div>
        </div>

    </div>

    <!-- Nav Bar -->
    <div class="glass-nav">
        <div class="nav-btn active" onclick="window.switchView('trip', this)">
            <i class="fa-solid fa-map-location-dot"></i>
        </div>
        <div class="nav-btn" onclick="window.switchView('wallet', this)">
            <i class="fa-solid fa-wallet"></i>
        </div>
        <div class="nav-btn" onclick="window.switchView('trans', this)">
            <i class="fa-solid fa-comments"></i>
        </div>
        <div class="nav-btn" onclick="window.switchView('info', this)">
            <i class="fa-solid fa-circle-info"></i>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal-overlay" onclick="window.closeModal()"></div>
    <div class="modal-full" id="detail-modal">
        <div style="position: sticky; top: 0; padding: 10px; text-align: right; z-index: 10;">
            <button onclick="window.closeModal()" style="background: white; border: none; width: 36px; height: 36px; border-radius: 50%; box-shadow: 0 2px 10px rgba(0,0,0,0.1); color: #333;"><i class="fa-solid fa-times"></i></button>
        </div>
        <img src="" id="m-img" class="modal-header-img" onerror="this.onerror=null; this.src='https://placehold.co/800x600?text=No+Image';">
        <div class="modal-content">
            <span id="m-tag" style="font-size: 0.7rem; letter-spacing: 2px; color: var(--accent-gold); text-transform: uppercase;">TAG</span>
            <h2 id="m-title" class="serif" style="font-size: 1.8rem; margin: 5px 0 20px 0; line-height: 1.2;">Title</h2>
            
            <div id="m-map-section" style="background: #F0F4F8; padding: 15px; border-radius: 8px; margin-top: 20px; display: flex; justify-content: space-between; align-items: center;" class="hidden">
                <div>
                    <div style="font-size: 0.7rem; color: #666; letter-spacing: 1px;">NAVIGATE (MAPCODE)</div>
                    <div id="m-mapcode" style="font-family: monospace; font-size: 1.2rem; font-weight: 700; color: var(--accent-main);">--</div>
                </div>
                <button onclick="window.copyMapCode()" style="background: var(--accent-main); color: white; border: none; padding: 8px 15px; border-radius: 4px;">Ë§áË£Ω</button>
            </div>
            
            <div id="m-gmap-preview" class="hidden" style="margin-top: 20px; text-align: center;">
                <iframe id="m-gmap-iframe" class="map-iframe" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                <div style="display: flex; gap: 10px; justify-content: center; margin-top: 10px;">
                    <button onclick="window.openExternalMap()" style="background: #333; color: white; padding: 8px 15px; border-radius: 4px; border: none; cursor: pointer;">
                        <i class="fa-solid fa-map-location-dot"></i> Google Âú∞ÂúñÈñãÂïü
                    </button>
                    <button id="btn-navigate" class="hidden" onclick="window.openNavigation()" style="background: #4285F4; color: white; padding: 8px 15px; border-radius: 4px; border: none; cursor: pointer;">
                        <i class="fa-solid fa-diamond-turn-right"></i> ÈñãÂßãÂ∞éËà™
                    </button>
                </div>
            </div>

            <div id="m-detail-info" class="hidden info-group">
                <h3 class="serif" style="font-size: 1.2rem; margin-bottom: 15px; color: var(--accent-main);">È†êË®Ç / ‰∫§ÈÄöË≥áË®ä</h3>
            </div>

            <!-- Â∞éÈÅäÁ≠ÜË®òÂçÄÂ°ä -->
            <div style="margin-top: 25px;">
                <div style="display:flex; align-items:center; margin-bottom: 10px; border-bottom: 1px solid #EEE; padding-bottom: 5px;">
                    <h3 class="serif" style="font-size: 1.2rem; margin: 0; color: var(--accent-main);">Â∞éÈÅäÁ≠ÜË®ò / Local Insight</h3>
                    <!-- Èõ™Ëä±Á∑®ËºØÊåâÈàï -->
                    <i class="fa-regular fa-snowflake snowflake-icon" onclick="window.toggleEditNote()"></i>
                </div>
                
                <!-- È°ØÁ§∫ÂçÄÂüü (Updated to allow HTML) -->
                <div id="m-desc" style="font-size: 1rem; line-height: 1.8; color: #555; white-space: pre-wrap; display: block;">Description</div>
                
                <!-- Á∑®ËºØÂçÄÂüü (È†êË®≠Èö±Ëóè) -->
                <div id="m-note-edit" class="hidden">
                    <textarea id="m-note-input" class="note-edit-area" rows="6"></textarea>
                    <div style="text-align: right;">
                        <button class="note-save-btn" onclick="window.saveNote()">ÂÑ≤Â≠òÁ≠ÜË®ò</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Full Screen Text Modal (Interactive) -->
    <div id="fs-text-modal" onclick="if(event.target === this) window.closeFs()">
        <div class="fs-jp" id="fs-jp">--</div>
        <div class="fs-cn" id="fs-cn">--</div>
        
        <!-- Interactive Controls Container -->
        <div id="fs-controls"></div>

        <div class="fs-close" style="position: absolute; bottom: 50px; color: #999; font-size: 0.9rem;">ÈªûÊìäËÉåÊôØÈóúÈñâ</div>
    </div>
    
    <!-- Non-blocking Message Toast -->
    <div id="app-message">Ë®äÊÅØ</div>

    <script>
        const GOOGLE_MAPS_API_KEY = "AIzaSyAX9nvh4bJpiM6-oTm8FoUSZeSBpxZBc1E"; 
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, query, onSnapshot, addDoc, serverTimestamp, setDoc, doc, deleteDoc, updateDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Set log level to debug for firebase errors
        setLogLevel('debug');

        // Gemini API Configuration
        const API_MODEL = 'gemini-2.5-flash-preview-09-2025';
        const apiKey = ""; // Canvas runtime provides this
        const TRANSLATE_URL = `https://generativelanguage.googleapis.com/v1beta/models/${API_MODEL}:generateContent?key=${apiKey}`;

        // --- DATA & MESSAGES ---
        const tripData = [
            {
                day: 1, date: "02.02", week: "MON",
                heroTitle: "ÂáΩÈ§®ÔºöÁôæÂÖÉÁôºÁÜ±Ë°£ËàáÁôæËê¨Â§úÊôØ",
                heroImg: "https://i.imgur.com/RTJNqwv.jpg", 
                fallbackImg: "https://images.unsplash.com/photo-1542640244-7e67286feb8f?q=80&w=800&auto=format&fit=crop",
                weather: { icon: "fa-spinner fa-spin", temp: "Loading..." },
                events: [
                    { 
                        time: "11:10", title: "ÊäµÈÅî ÂáΩÈ§®Ê©üÂ†¥ (HKD)", tag: "Arrival", 
                        desc: "ÂÖ•Â¢ÉËàáÊ∫ñÂÇô„ÄÇ", 
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂáΩÈ§®Ê©üÂ†¥ÈõñÂ∞èÔºå‰ΩÜÂÜ¨Â≠£ÈÅã‰ΩúÈùûÂ∏∏ÊúâÁß©Â∫è„ÄÇ‰∏ãÊ©üÂæåÁöÑÈ´îÊÑüÊ∫´Â∑ÆÊúÉËÆìÊÇ®Áû¨ÈñìÊ∏ÖÈÜí„ÄÇÂÖ•Â¢ÉÂØ©Êü•ÈÄöÂ∏∏ÂæàÂø´ÔºåÂá∫ÈóúÂæåÔºåÂà•ÊÄ•ËëóÈõ¢ÈñãÔºåÊ∑±ÂëºÂê∏‰∏ÄÂè£ÂåóÂúãÂÜ∑ÂÜΩÁöÑÁ©∫Ê∞£ÔºåÈÄôÂ∞±ÊòØÂåóÊµ∑ÈÅìÁöÑÂë≥ÈÅì„ÄÇ", 
                        to: "JR ÂáΩÈ§®Á´ô", 
                        location: "Hakodate Airport, Japan"
                    },
                    { 
                        time: "12:00", title: "Ê©üÂ†¥Â∑¥Â£´ (ÂæÄ JR ÂáΩÈ§®Á´ô)", tag: "Transport", 
                        desc: "ÁßªÂãïËá≥Â∏ÇÂçÄ„ÄÇ", 
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„Äë‰∏äËªäÊôÇË´ãÊ≥®ÊÑèÔºåÊó•Êú¨Â∑¥Â£´ÊòØ„ÄåÂæåÈñÄ‰∏äËªä„ÄÅÂâçÈñÄ‰∏ãËªä„Äç„ÄÇÊ≤øÈÄîÊÇ®ÊúÉÁúãÂà∞ËëóÂêçÁöÑ„ÄåÊπØ‰πãÂ∑ùÊ∫´Ê≥â„ÄçÂçÄÔºåËã•ÁúãÂà∞Êµ∑ÈÇäÊúâÂÜíÁÖôÁöÑÊôØË±°ÔºåÈÇ£Â∞±ÊòØÊ∫´Ê≥âÊµÅÈÄ≤Êµ∑Ë£°ÁöÑË≠âÊòé„ÄÇ",
                        navLink: "https://maps.app.goo.gl/SgEccLta3MTxhD4d9?g_st=ac",
                        from: "Hakodate Airport",
                        to: "JR Inn Hakodate", 
                        transport_info: {type: "Ê©üÂ†¥Â∑¥Â£´", departure: "12:00"} 
                    },
                    { 
                        time: "12:30", title: "JR Inn Hakodate (ÂØÑÊîæ)", tag: "Hotel", 
                        desc: "ÂØÑÊîæË°åÊùé„ÄÇ", 
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈÅ∏ÊìáÈÄôÈñìÈ£ØÂ∫óÊòØÁµïÂ∞çÊ≠£Á¢∫ÁöÑÊà∞Áï•ÔºÅÂÆÉËàáËªäÁ´ôÁõ¥ÁµêÔºå‰∏çÁî®ÊãñËëóË°åÊùéÂú®Èõ™Âú∞Ë£°ÊéôÊâé„ÄÇÂØÑÊîæË°åÊùéÊôÇÔºåË´ãÈ†Ü‰æøÁ¢∫Ë™ç‰∏Ä‰∏ãÂ§ßÂª≥Êèê‰æõÁöÑ„ÄåÊûïÈ†≠ÊåëÈÅ∏ÂçÄ„ÄçÔºåÊôö‰∏ä‰∏ãÊâãÂ§™ÊÖ¢Â∞±Ë¢´Êê∂ÂÖâ‰∫Ü„ÄÇ", 
                        location: "JR Inn Hakodate",
                        navLink: "https://maps.app.goo.gl/SgEccLta3MTxhD4d9?g_st=ac",
                        to: "JR Inn Hakodate" 
                    },
                    { 
                        time: "12:50", title: "Ë®àÁ®ãËªä (Ë∂ïÊôÇÈñìÈ¶ñÈÅ∏)", tag: "Transport", 
                        desc: "ÂâçÂæÄ UNIQLO„ÄÇ", 
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÁÇ∫‰∫ÜÁúÅ‰∏ãÂØ∂Ë≤¥ÁöÑ 30-40 ÂàÜÈêòÔºåÈÄô 2,500 Êó•ÂúìÁöÑËªäË≥áÁµïÂ∞çÂÄºÂæó„ÄÇÂéª UNIQLO Êò≠ÂíåÂ∫óÁöÑÂ∑¥Â£´Áè≠Ê¨°Âú®Èõ¢Â≥∞ÊôÇÈñìÂæàÁ®ÄÁñè„ÄÇ",
                        navLink: "https://maps.app.goo.gl/s85bmZtawnf7EQY26?g_st=ac",
                        from: "JR Inn Hakodate",
                        to: "UNIQLO ÂáΩÈ§®Êò≠ÂíåÂ∫ó",
                        transport_info: { type: "Ë®àÁ®ãËªä", note: "Á¥Ñ2500Êó•Âúì" } 
                    },
                    { 
                        time: "13:15", title: "‰ªªÂãô 1ÔºöUNIQLO Êò≠ÂíåÂ∫ó", tag: "Shopping", 
                        desc: "Êé°Ë≥ºÁôºÁÜ±Ë°£„ÄÇ", 
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈÄôÊòØÂåóÊµ∑ÈÅìÁöÑÂ§ßÂûãË∑ØÈù¢Â∫óÔºåÂ∫´Â≠òÈÄöÂ∏∏ÊØîÂ∏ÇÂçÄÁôæË≤®Â∫óÈΩäÂÖ®„ÄÇÂãôÂøÖÂÖ•Êâã„ÄåË∂ÖÊ•µÊöñ (Ultra Warm)„ÄçÁ≥ªÂàóÁöÑÁôºÁÜ±Ë°£ËàáÁôºÁÜ±Ë§≤ÔºåÈÄôÊòØÁÇ∫‰∫ÜÂÖ®‰∏ñÁïåÈôçÈõ™ÈáèÊúÄÂ§ßÁöÑÈùíÊ£ÆÂÅöÂÅöÁöÑÂøÖË¶ÅÊ∫ñÂÇô„ÄÇ", 
                        navLink: "https://maps.app.goo.gl/sDqtgs3kxsz7nGKU9",
                        location: "UNIQLO Hakodate Showa"
                    },
                    {
                        time: "14:45", title: "Ë®àÁ®ãËªä (ËøîÂõûÈ£ØÂ∫óÂç∏Ë≤®)", tag: "Transport",
                        desc: "Âõû JR Inn„ÄÇ",
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÊó¢ÁÑ∂Ë≤∑‰∫ÜÂæàÂ§öÔºåÊàëÂÄëÁõ¥Êé•Êê≠ËªäÂõû JR Inn„ÄÇÊääÊà∞Âà©ÂìÅ‰∏üÂõûÊàøÈñìÔºàÊàñÊ´ÉÂè∞ÔºâÔºå‰∏ÄË∫´Ëºï‰æøÂÜçÂá∫ÈñÄ„ÄÇÈ£ØÂ∫óÈñÄÂè£ÊéíÁè≠Ë®àÁ®ãËªäÂ§öÔºåÂ∞çÊé•‰∏ã‰æÜÁöÑË°åÁ®ãÊõ¥Êñπ‰æø„ÄÇ",
                        transport_info: { type: "Ë®àÁ®ãËªä", note: "ËøîÂõûÈ£ØÂ∫ó" },
                        from: "UNIQLO ÂáΩÈ§®Êò≠ÂíåÂ∫ó",
                        to: "JR Inn Hakodate"
                    },
                    {
                        time: "15:15", title: "È£ØÂ∫óÂç∏Ë≤® & Á®ç‰ΩúÊï¥Ë£ù", tag: "Hotel",
                        desc: "Âø´ÈÄüÊï¥Ë£ù„ÄÇ",
                        detail: "„ÄêÂ∞éÈÅäÊèêÈÜí„ÄëÂãï‰ΩúË¶ÅÂø´ÔºåÊîæÂ•ΩÊù±Ë•ø„ÄÅ‰∏äÂÄãÂªÅÊâÄÔºå15:30 Ê∫ñÊôÇÂá∫ÁôºÔºåÊâçË∂ïÂæó‰∏äÂ§úÊôØÁöÑÊúÄ‰Ω≥Âç°‰ΩçÊôÇÈñì„ÄÇ",
                        location: "JR Inn Hakodate"
                    },
                    {
                        time: "15:30", title: "Ë®àÁ®ãËªä (ÂâçÂæÄÁ∫úËªäÁ´ô)", tag: "Transport",
                        desc: "JR ÂáΩÈ§®Á´ô -> Á∫úËªäÂ±±È∫ìÁ´ô„ÄÇ",
                        detail: "„ÄêË°åÁ®ã„ÄëÁ¥Ñ 10-15 ÂàÜÈêòËªäÁ®ã„ÄÇ",
                        transport_info: { type: "Ë®àÁ®ãËªä", note: "ÂæÄÁ∫úËªäÁ´ô" },
                        from: "JR Inn Hakodate",
                        to: "Hakodate Ropeway"
                    },
                    { 
                        time: "16:00", title: "ÂáΩÈ§®Â±±ÁôæËê¨Â§úÊôØ", tag: "Sightseeing", 
                        desc: "Êó•ËêΩ Blue Hour„ÄÇ", 
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂÜ¨Â§©ÁöÑÊó•ËêΩÁ¥ÑÂú® 16:50„ÄÇ‰∏ÄÂÆöË¶ÅÂæÖÂà∞Êó•ËêΩÂæå 20-30 ÂàÜÈêòÔºåÈÄôÊôÇÂ§©Á©∫ÂëàÁèæÊ∑±ËóçËâ≤ (Blue Hour)„ÄÇË®òÂæóÂ∏∂ÊöñÊöñÂåÖË≤ºÂú®ÊâãÊ©üËÉåÈù¢„ÄÇ<br><br>„ÄêËÄÅÈ≥•Ë™™ÊïÖ‰∫ã„Äë<br>ÂáΩÈ§®Â§úÊôØË¢´Á®±ÁÇ∫„ÄåÁôæËê¨Â§úÊôØ„ÄçÁöÑÈóúÈçµÂú®ÊñºÁµïÁÑ°ÂÉÖÊúâÁöÑ„ÄåÂú∞ÁêÜÂ•áËπü„Äç„ÄÇÂ∑¶ÈÇäÊòØ„ÄåÊ¥•ËºïÊµ∑Â≥Ω„ÄçÔºåÂè≥ÈÇäÊòØ„ÄåÂáΩÈ§®ÁÅ£„ÄçÔºåÈÄôÂÖ©ÁâáÊºÜÈªëÁöÑÂ§ßÊµ∑Â∞áÁôºÂÖâÁöÑÂüéÂ∏ÇÂ§æÂú®‰∏≠ÈñìÔºåÂΩ¢Êàê‰∫Ü‰∏ÄÂÄãÂÉèÊòØÂ•≥ÊÄßÁ∫ñÁ¥∞ËÖ∞Ë∫´ÁöÑÂΩ¢ÁãÄÔºàÊâáÂΩ¢Êµ∑Â≥ΩÔºâ„ÄÇÂÜ¨Â§©ÁöÑÂ§úÊôØÂõ†ÁÇ∫Èõ™Âú∞ÂèçÂ∞ÑÔºå‰∫ÆÂ∫¶ÊèêÂçá‰∫Ü 30% ‰ª•‰∏ä„ÄÇ", 
                        navLink: "https://maps.app.goo.gl/qcq17CBzd3miW9rM6",
                        location: "Mt. Hakodate Observation Deck",
                        nav: { mapcode: "86 041 028*25" } 
                    },
                    { 
                        time: "17:30", title: "Á∫úËªä‰∏ãÂ±± -> ÂâçÂæÄÈáëÊ£ÆÂÄâÂ∫´", tag: "Transport", 
                        desc: "Ê≠•Ë°åÊàñË®àÁ®ãËªä„ÄÇ", 
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„Äë‰∏ãÂ±±ÊôÇ‰∫∫ÊΩÆÊúÉÁû¨ÈñìÁàÜÁôº„ÄÇÂ¶ÇÊûúÁ∫úËªäÊéíÈöäË∂ÖÈÅé 30 ÂàÜÈêòÔºå‰∏îÊà∂Â§ñÈ¢®Èõ™‰∏çÂ§ßÔºåÂÖ∂ÂØ¶ÂèØ‰ª•ËÄÉÊÖÆÊê≠‰πòÂ∑¥Â£´‰∏ãÂ±±„ÄÇ‰∏ãÂ±±ÂæåÔºåÈáëÊ£ÆÂÄâÂ∫´Â∞±Âú®Â±±ËÖ≥‰∏ã‰∏çÈÅ†Ëôï„ÄÇ", 
                        transport_info: { type: "Á∫úËªä/Ê≠•Ë°å" },
                        to: "Kanemori Red Brick Warehouse"
                    },
                    { 
                        time: "18:00", title: "ÈáëÊ£ÆÁ¥ÖÁ£öÂÄâÂ∫´Áæ§", tag: "Sightseeing", 
                        desc: "ÊôöÈ§êÔºöÂπ∏ÈÅãÂ∞è‰∏ëÊº¢Â†°„ÄÇ", 
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈÄôË£°ÁöÑÁ¥ÖÁ£öÂú®ÁôΩÈõ™Ë¶ÜËìã‰∏ãÔºåÊúâ‰∏ÄÁ®ÆÊ≠êÊ¥≤ËÅñË™ïÂ∏ÇÈõÜÁöÑÊ∞õÂúç„ÄÇËëóÂêçÁöÑ„ÄåÂπ∏ÈÅãÂ∞è‰∏ëÊº¢Â†°„ÄçÁ¢ºÈ†≠Êú´Âª£Â∫óÔºåÂ∫ß‰ΩçÊï∏Â§ö‰∏îÊúâÁÑ°ÊïµÊµ∑ÊôØ„ÄÇÂº∑ÁÉàÂª∫Ë≠∞ÁèæÂú®Â∞±ÂêÉÔºÅÈªû‰∫∫Ê∞£ No.1 ÁöÑ„Äå‰∏≠ËèØÈõûËÖøÊº¢Â†°„Äç„ÄÇ", 
                        navLink: "https://maps.app.goo.gl/psd5nq2yRDC5zD3W6",
                        location: "Kanemori Red Brick Warehouse" 
                    },
                    { 
                        time: "18:15", title: "Pastry Snaffle's", tag: "Food", 
                        desc: "ÈáëÊ£ÆÊ¥ãÁâ©È§®Â∫ó„ÄÇ", 
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÊäµÈÅîÂÄâÂ∫´ÂæåË´ãÂÖàË°ùÈÄôË£°ÔºÅË≤∑‰∏ÄÈ°Ü„ÄåCatch Cake (Ëµ∑Âè∏Ê≠êÂßÜËïæ)„ÄçÔºåÈÄô‰∏çÊòØÊôÆÈÄöËµ∑Âè∏ËõãÁ≥ïÔºåÂè£ÊÑüÂÉèËàíËäôËïæËà¨ÂÖ•Âè£Âç≥Âåñ„ÄÇ‰∏çË¶ÅË≤∑Êï¥ÁõíÔºåÁõ¥Êé•Âú®Ê´ÉÂè∞Ë≤∑ÂñÆÈ°ÜÁ´ôËëóÁèæÂêÉÔºåÈÄôÊòØÂáΩÈ§®ÈôêÂÆöÁöÑ„ÄåÈªÉÈáë‰∏ÄÂè£„Äç„ÄÇ", 
                        location: "Pastry Snaffle's Kanemori"
                    },
                    { 
                        time: "19:30", title: "ËøîÂõûÈ£ØÂ∫ó", tag: "Transport", 
                        desc: "Êï£Ê≠•ÊàñË®àÁ®ãËªä„ÄÇ", 
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂêÉÈ£ΩÂæåÔºåÊ≤øËëóÊµ∑ÈÇäÊàñÊê≠ËªäÂõûÈ£ØÂ∫ó„ÄÇ", 
                        transport_info: { type: "Ë®àÁ®ãËªä/Êï£Ê≠•" },
                        to: "JR Inn Hakodate"
                    },
                    { 
                        time: "20:00", title: "‰ºëÊÅØËàáÂ§ßÊµ¥Â†¥", tag: "Hotel", 
                        desc: "JR Inn Hakodate„ÄÇ",
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÁ∂ìÈÅéÂØíÈ¢®ÂêπÊãÇÔºåÁèæÂú®ÊúÄÈúÄË¶ÅÁöÑÊòØÁÜ±È£üËàáÁÜ±Ê∞¥„ÄÇÁõ¥Â•îÈ†ÇÊ®ìÂ§ßÊµ¥Â†¥ÔºåÈÇ£Ë£°ÁöÑ‰ºëÊÅØÂÆ§Êúâ‰∏ÄÊï¥Èù¢ÁöÑËêΩÂú∞Á™óÂèØ‰ª•ÁúãÂà∞ÂàóËªäÈÄ≤Âá∫Á´ôÁöÑËªåÈÅìÂ§úÊôØÔºåÈÖç‰∏ä‰∏ÄÊîØÂÜ∞ÁâõÂ•∂ÔºåÈÄôÊâçÊòØÂÆåÁæéÁöÑ Ending„ÄÇ", 
                        location: "JR Inn Hakodate" 
                    }
                ]
            },
            {
                day: 2, date: "02.03", week: "TUE",
                heroTitle: "Êñ∞ÂππÁ∑öË∑®Êµ∑ÔºåÊãúË®™Â•àËâØÁæéÊô∫",
                heroImg: "https://i.imgur.com/iqO53uS.jpg", 
                fallbackImg: "https://images.unsplash.com/photo-1532236395709-7d70320fec2d?q=80&w=800",
                weather: { icon: "fa-spinner fa-spin", temp: "Loading..." },
                events: [
                    { time: "07:30", title: "ÂáΩÈ§®ÊúùÂ∏Ç Êó©È§ê", tag: "Food", desc: "Èá£ÁÉèË≥äÈ´îÈ©ó„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈõñÁÑ∂Ë™™ÊòØËßÄÂÖâÂÆ¢ËÅñÂú∞Ôºå‰ΩÜ„ÄåÈá£ÁÉèË≥ä„ÄçÈ´îÈ©óÁúüÁöÑÂæàÊúâË∂£ÔºåÁèæÈá£ÁèæÊÆ∫ÁöÑÁÉèË≥äËÇâÊòØÈÄèÊòé‰∏îÁàΩËÑÜÁöÑÔºåÂÆåÂÖ®Ê≤íÊúâËÖ•Âë≥„ÄÇ", location: "Hakodate Morning Market" },
                    { time: "09:30", title: "Ê≠•Ë°åÂõûÈ£ØÂ∫óÂèñË°åÊùé", tag: "Transport", desc: "ÂâçÂæÄËªäÁ´ô„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂêÉÈ£ΩÂñùË∂≥Êï£Ê≠•ÂõûÈ£ØÂ∫óÊãøË°åÊùé„ÄÇ", from: "Hakodate Morning Market", to: "JR Hakodate Station", transport_info: { type: "Ê≠•Ë°å" } },
                    { 
                        time: "10:00", title: "Ë∑®Êµ∑ÁßªÂãïÔºöÂáΩÈ§® -> ÈùíÊ£Æ", tag: "Transport", 
                        desc: "‰∏âÊÆµÂºèÊé•Âäõ„ÄÇ", 
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈÄôÊòØ‰ªäÂ§©ÁöÑÈáçÈ†≠Êà≤ÔºÅ<br>1. ÂáΩÈ§® LinerÔºöÊôÆÈÄöÈõªËªäÔºåÊê∂Á™óÈÇä‰ΩçÁΩÆÁúãÊúÄÂæåÈ¢®ÊôØ„ÄÇ<br>2. Êñ∞ÂππÁ∑öÈöºËôüÔºöÂÖ®ËªäÊåáÂÆöÂ∏≠ÔºÅÈëΩÈÄ≤„ÄåÈùíÂáΩÈößÈÅì„ÄçÊôÇÊúÉÊúâÂª£Êí≠ÔºåÈÄôÊôÇÊÇ®Ê≠£‰ΩçÊñºÊ∑±Êµ∑‰πã‰∏ã„ÄÇ<br>3. Â•ßÁæΩÊú¨Á∑öÔºöÊäµÈÅîÊñ∞ÈùíÊ£ÆÂæåËΩâ‰πòÂú®‰æÜÁ∑öÔºå6ÂàÜÈêòÂà∞Â∏ÇÂçÄ„ÄÇ", 
                        transport_info: { type: "JR/Êñ∞ÂππÁ∑ö", departure: "10:00", note: "ÈùíÂáΩÈößÈÅì" }, 
                        from: "JR Hakodate Station", 
                        to: "JR Aomori Station" 
                    },
                    { time: "12:15", title: "ÂçàÈ§êÔºöÈùíÊ£ÆÁ´ôÂë®ÈÇä", tag: "Food", desc: "Osanai È£üÂ†Ç„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„Äë„ÄåOsanai („Åä„Åï„Å™„ÅÑ)„ÄçÊòØÈÄôË£°ÁöÑÂÇ≥Â•áÈ£üÂ†ÇÔºåÂøÖÈªû„ÄåÂ∏ÜÁ´ãË≤ùÂë≥ÂôåÁáí„Äç„ÄÇ", location: "Osanai Aomori" },
                    { time: "13:30", title: "Ë®àÁ®ãËªä (Áõ¥Â•îÁæéË°ìÈ§®)", tag: "Transport", desc: "ÂâçÂæÄÁæéË°ìÈ§®„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„Äë‰∏çÂª∫Ë≠∞Êê≠Â∑¥Â£´ÔºåÁè≠Ë∑ùÈï∑„ÄÇË®àÁ®ãËªäË≤ªÁ¥Ñ 2000 Â§öÊó•Âúì„ÄÇ", transport_info: { type: "Ë®àÁ®ãËªä" }, from: "JR Aomori Station", to: "Aomori Museum of Art" },
                    { 
                        time: "14:00", title: "ÈùíÊ£ÆÁ∏£Á´ãÁæéË°ìÈ§®", tag: "Sightseeing", 
                        desc: "Â•àËâØÁæéÊô∫ËàáÈùíÊ£ÆÁä¨„ÄÇ", 
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈÄôÂ∫ßÁæéË°ìÈ§®Êú¨Ë∫´Â∞±ÊòØ‰∏Ä‰ª∂ËóùË°ìÂìÅ„ÄÇ‰∏ÄÂÆöË¶ÅÂéªÁúãÂ•àËâØÁæéÊô∫ÁöÑ„ÄåÈùíÊ£ÆÁä¨„ÄçÔºåÂÜ¨Â§©ÊôÇÂ∑•‰Ωú‰∫∫Âì°ÊúÉÂπ´Â§ßÁãóÊà¥‰∏ä‰∏ÄÈ†Ç„ÄåÈõ™Â∏Ω„ÄçÔºÅ<br><br>„ÄêËÄÅÈ≥•Ë™™ÊïÖ‰∫ã„Äë<br>ÁæéË°ìÈ§®ÁöÑË®≠Ë®àÁêÜÂøµÈùûÂ∏∏Ê∑±Â•ßÔºåÂÆÉÊòØÁî±Áü•ÂêçÂª∫ÁØâÂ∏´ÈùíÊú®Ê∑≥ÊâÄË®≠Ë®àÁöÑ„ÄÇÊï¥Â∫ßÁæéË°ìÈ§®‰∏¶‰∏çÊòØ„ÄåËìãÂú®Âú∞‰∏ä„ÄçÔºåËÄåÊòØ„ÄåÂüãÂú®ÂúüË£°„ÄçÁöÑÔºàÈùàÊÑü‰æÜËá™‰∏âÂÖß‰∏∏Â±±ÈÅ∫Ë∑°ÁöÑÂ£ïÊ∫ù TrenchÔºâ„ÄÇÂú®È§®ÂÖßË°åËµ∞ÂÉèÊòØÂú®Êé¢Èö™„ÄÇÈÇ£ÈöªÂ∑®Â§ßÁöÑ„ÄåÈùíÊ£ÆÁä¨„Äç‰ΩéËëóÈ†≠ÔºåÂú®Èõ™Âú∞‰∏≠È°ØÂæóÁâπÂà•Â≠§Áç®ÂçªÂèàÁôÇÁôí„ÄÇ", 
                        location: "Aomori Museum of Art" 
                    },
                    { time: "16:00", title: "Ë®àÁ®ãËªä (ÂâçÂæÄ A-FACTORY)", tag: "Transport", desc: "ÂâçÂæÄÊ∏ØÈÇä„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÁõ¥Êé•Ë´ãÁæéË°ìÈ§®Ê´ÉÊ™ØÂè´ËªäÂâçÂæÄÈùíÊ£ÆËªäÁ´ôÊóÅÁöÑ A-FACTORY„ÄÇ", transport_info: { type: "Ë®àÁ®ãËªä" }, from: "Aomori Museum of Art", to: "A-FACTORY" },
                    { 
                        time: "16:30", title: "A-FACTORY (ËòãÊûúÂ∑•Âª†)", tag: "Shopping", 
                        desc: "Cidre Ë©¶Âñù„ÄÇ", 
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂÇçÊôöÈªûÁáàÂæåÁöÑÊ∞£Ê∞õÊ•µ‰Ω≥„ÄÇÈÄôË£°ÂèØ‰ª•ÊÖ¢ÊÖ¢Ë©¶Âñù‰∏çÂêåÊøÉÂ∫¶ÁöÑ Cidre (ËòãÊûúÈÖí)„ÄÇ<br><br>„ÄêËÄÅÈ≥•Ë™™ÊïÖ‰∫ã„Äë<br>A-FACTORY ÊòØÈùíÊ£ÆËòãÊûúÁöÑ„ÄåÊñáËóùÂæ©Ëàà„Äç„ÄÇÈÄôÊ£üÂú®Êµ∑ÈÇäÁôºÂÖâÁöÑÊàøÂ≠êÔºå‰ª£Ë°®ÈùíÊ£ÆÂæûÂñÆÁ¥îÁöÑ„ÄåËæ≤Ê•≠Â§ßÁ∏£„ÄçËèØÈ∫óËΩâË∫´ÁÇ∫„ÄåÊôÇÂ∞öÂìÅÁâå„Äç„ÄÇÁï∂ÊÇ®Âñù‰∏ãÈÇ£ÊùØËòãÊûúÈÖíÔºåÊÇ®Âñù‰∏ãÁöÑ‰∏çÂè™ÊòØÈÖíÔºåËÄåÊòØÈùíÊ£Æ‰∫∫ÁÇ∫‰∫ÜÁîüÂ≠òËàáÊ¶ÆËÄÄÔºåÂú®ÂÇ≥Áµ±‰∏≠Ê∑¨ÈçäÂá∫ÁöÑÊñ∞ÊªãÂë≥„ÄÇ", 
                        location: "A-FACTORY" 
                    },
                    { time: "17:00", title: "„É©„Ç∞„Éé„Ç™ (Raguenau)", tag: "Food", desc: "Polo Chocolat„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂ∞±Âú® A-FACTORY Ë≥£Â†¥Ë£°„ÄÇÈõñÁÑ∂Âà∞ËôïÈÉΩÊúâË≥£Ôºå‰ΩÜÂÆÉÊòØÈùíÊ£ÆÂú®Âú∞Âª†ÂïÜÂÅöÁöÑÔºåÂè£ÊÑüÁ¥ÆÂØ¶ÊøÉÈÉÅÔºåCP ÂÄºÊ•µÈ´ò„ÄÇ", location: "A-FACTORY" },
                    { time: "17:30", title: "ÂèñË°åÊùé -> Ë®àÁ®ãËªä", tag: "Transport", desc: "ÂâçÂæÄÈ£ØÂ∫ó„ÄÇ", transport_info: { type: "Ë®àÁ®ãËªä" }, to: "Dormy Inn Aomori" },
                    { time: "18:00", title: "ÂÖ•‰Ωè Dormy Inn Aomori", tag: "Hotel", desc: "Êèõ‰∏äÈ§®ÂÖßÊúç„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈÄ≤ÊàøÂæåÂÖàÊèõ‰∏ä‰ªñÂÄëÊèê‰æõÁöÑËàíÈÅ©È§®ÂÖßÊúç (Samue)ÔºåÈÄôÂ•óË°£ÊúçÂèØ‰ª•Á©øËëóÂéªÂêÉÊó©È§ê„ÄÅÊ≥°Ê∫´Ê≥âÁîöËá≥ÂêÉÂÆµÂ§ú„ÄÇ", location: "Dormy Inn Aomori" },
                    { time: "19:00", title: "ÊôöÈ§êÔºöÈùíÊ£ÆÂ∏ÇÂçÄ", tag: "Food", desc: "Ê¥•Ëºï‰∏âÂë≥Á∑öÊºîÂ•è„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÊôöÈ§êÊé®Ëñ¶ÂéªÈ´îÈ©ó„ÄåÊ¥•Ëºï‰∏âÂë≥Á∑ö„ÄçÁöÑÁèæÂ†¥ÊºîÂ•è„ÄÇÂ±ÖÈÖíÂ±ã„ÄåÂä©ÂÖ≠„ÄçÊàñ„ÄåWasshoi„ÄçÊ∞£Ê∞õÈÉΩÂæàÁÜ±È¨ß„ÄÇ", location: "Aomori City Center" },
                    { time: "21:30", title: "È£ØÂ∫óÂÆµÂ§ú", tag: "Food", desc: "Â§úÈ≥¥ÊãâÈ∫µ„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÁµïÂ∞ç‰∏çËÉΩÈåØÈÅéÁöÑ„ÄåÂ§úÈ≥¥ÊãâÈ∫µ„ÄçÔºÅ", location: "Dormy Inn Aomori" }
                ]
            },
            {
                day: 3, date: "02.04", week: "WED",
                heroTitle: "Èõ™Âú∞ÈßïÈßõÂàùÈ´îÈ©óÔºåÊöñÁàêÂàóËªäËàáËòãÊûúÊ¥æ",
                heroImg: "https://i.imgur.com/M2AVCI5.jpg", 
                fallbackImg: "https://images.unsplash.com/photo-1549643276-fbc2bd5f4038?q=80&w=800&auto=format&fit=crop",
                weather: { icon: "fa-spinner fa-spin", temp: "Loading..." },
                events: [
                    { time: "08:30", title: "Ê≠•Ë°åËá≥ÁßüËªäÈªû", tag: "Transport", desc: "Â∞èÂøÉÈªëÂÜ∞„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÊó©‰∏äË∑ØÈù¢ÂèØËÉΩÊúÉÊúâ„ÄåÈªëÂÜ∞ (Black Ice)„ÄçÔºåÁúãËµ∑‰æÜÂÉèÊøïÊΩ§ÁöÑË∑ØÈù¢ÂÖ∂ÂØ¶ÊòØËñÑÂÜ∞ÔºåËµ∞Ë∑ØÂçÉËê¨Ë¶ÅÂ∞èÂøÉ„ÄÇ", transport_info: { type: "Ê≠•Ë°å" }, to: "Aomori Station Rental Car" },
                    { time: "09:00", title: "ÁßüËªäÔºöÈùíÊ£ÆÁ´ôÂâç", tag: "Transport", desc: "Ëá™ÈßïÈñãÂßã„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂèñËªäÈóúÈçµÂãï‰ΩúÔºö1. Á¢∫Ë™çÈõ®Âà∑Á´ãËµ∑„ÄÇ2. Ê™¢Êü•Èõ™ËÉé„ÄÇ3. Ë©¢ÂïèÊ≤πÁÆ±Ëìã‰ΩçÁΩÆ„ÄÇÈõ™Âú∞ÈßïÈßõÂøÉÊ≥ïÔºöÊÄ•ÁÖûËªä„ÄÅÊÄ•Âä†ÈÄü„ÄÅÊÄ•ËΩâÂΩéÊòØÁµïÂ∞çÁ¶ÅÊ≠¢ÁöÑ„ÄÇ", transport_info: { type: "Ëá™Èßï", car_type: "Èõ™Âú∞Ë£ùÂÇôÁ¢∫Ë™ç" }, from: "Aomori Rental Car", to: "Goshogawara" },
                    { time: "10:00", title: "ÁßªÂãïÔºöÂæÄ‰∫îÊâÄÂ∑ùÂéü", tag: "Drive", desc: "ÈÅ©ÊáâÈõ™Âú∞ÈßïÈßõ„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂâõ‰∏äË∑ØÁöÑÂâç 20 ÂàÜÈêòÊúÄÁ∑äÂºµÔºåË´ãÊÖ¢ÊÖ¢ÈñãÔºåÁøíÊÖ£Èõ™Âú∞Ëº™ËÉéÁöÑÊäìÂú∞Âäõ„ÄÇ", transport_info: { type: "Ëá™Èßï" } },
                    { time: "10:30", title: "Ë∂ÖÂïÜË£úÁµ¶", tag: "Food", desc: "ÁÇ∏Âπ≤Ë≤ùÁæé‰πÉÊªãÈ£ØÁ≥∞„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂú®ÈñãËªäÈÄî‰∏≠Ëã•Á∂ìÈÅé Lawson Êàñ FamilyMartÔºåÈÄ≤ÂéªÊó©È§êÂçÄÊâæÊâæÁúã„ÄÇÈùíÊ£ÆÈôêÂÆöÁöÑÈ£ØÁ≥∞Â∏∏ÊúÉË±™ÈÇÅÂú∞ÂåÖÂÖ•„ÄåÊï¥È°ÜÂ∏ÜÁ´ãË≤ù„ÄçÊãåÁæé‰πÉÊªã„ÄÇ", location: "Convenience Store" },
                    { time: "11:00", title: "‰ªªÂãô 2ÔºöELM Ë≥ºÁâ©‰∏≠ÂøÉ", tag: "Shopping", desc: "3COINS+plus„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÁõ¥Â•î 3COINS+plusÔºåÈÄôË£°ÊúâÂæàÂ§ö‰æøÂÆúÂèàÂ•ΩÁî®ÁöÑÈõ™Âú∞Â∞èÁâ©„ÄÇ", nav: { mapcode: "168 649 346*52" }, location: "ELM Shopping Center" },
                    { time: "11:45", title: "ÊäµÈÅî Ê¥•Ëºï‰∫îÊâÄÂ∑ùÂéüÁ´ô", tag: "Drive", desc: "ÂÅúËªäÁ¶ÆÂÑÄ„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂÅúÂ•ΩËªäÂæåÔºåË®òÂæóÊääÈõ®Âà∑Á´ãËµ∑‰æÜÔºåÈÄôÊòØÈõ™ÂúãÁ¶ÆÂÑÄ„ÄÇ", location: "Tsugaru Goshogawara Station" },
                    { 
                        time: "12:00", title: "‰ªªÂãô 3ÔºöÊ¥•ËºïÈêµÈÅì„ÄåÊöñÁàêÂàóËªä„Äç", tag: "Experience", 
                        desc: "ÁÉ§È≠∑È≠öËàáÊò≠ÂíåÊÑü„ÄÇ", 
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈÄôÊòØÊò≠ÂíåÊôÇ‰ª£ÁöÑÊ¥ªÂè§Ëë£ÔºÅËªäÂªÇÂÖßÊòØÁúüÁöÑÁáíÁÖ§ÁÇ≠ÁöÑÊöñÁàê„ÄÇ‰∏äËªäÂæå‰∏ÄÂÆöË¶ÅË≤∑ÁÉ§È≠∑È≠öÔºåÂàóËªäÈï∑ÊúÉÂπ´‰Ω†Âú®ÊöñÁàê‰∏äÁèæÁÉ§„ÄÇ<br><br>„ÄêËÄÅÈ≥•Ë™™ÊïÖ‰∫ã„Äë<br>ÈÄôÂàóÁÅ´ËªäÊòØ‰∏ÄÂè∞Ë°åÈßõÂú®Èõ™Âéü‰∏äÁöÑ„ÄåÊôÇÂÖâÊ©ü„Äç„ÄÇÂ§ñÈ†≠ÊòØÈõ∂‰∏ãÂπæÂ∫¶ÁöÑÊö¥È¢®Èõ™ÔºåËªäÂÖßÂçªÂõ†ÁÇ∫ÈÇ£ÂÄãÁáíËëóÁ¥ÖÈÄöÈÄöÁÖ§ÁÇ≠ÁöÑ„ÄåÈÅîÊë©ÁÅ´Áàê„ÄçËÄåÊ∫´ÊöñÂ¶ÇÊò•„ÄÇÊñáË±™„ÄåÂ§™ÂÆ∞Ê≤ª„ÄçÁîüÂâç‰πüÊê≠ÈÅé„ÄÇÁï∂ÂàóËªäÈï∑Êää‰πæÈ≠∑È≠öÊîæÂú®ÁÅ´ÁàêÈ†ÇËìã‰∏ä„ÄåÊªãÔΩû„ÄçÁöÑ‰∏ÄËÅ≤ÔºåÈÖç‰∏ä‰∏ÄÊùØÊ∏ÖÈÖíÔºåÈÇ£Á®Æ„ÄåËµ§Ë£∏Ë£∏ÁöÑÊò≠ÂíåÊÑü„ÄçÊúÉËÆìÊÇ®ÊÑüÂãï„ÄÇ", 
                        location: "Tsugaru Railway" 
                    },
                    { time: "13:30", title: "ÁßªÂãïÔºöÂæÄÂºòÂâç", tag: "Drive", desc: "Ê¥•ËºïÂØåÂ£´„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂâçÂæÄÂºòÂâçÁöÑË∑Ø‰∏äÔºåËã•Â§©Ê∞£Êô¥ÊúóÔºåÂ∑¶ÊâãÈÇäÊúÉÂá∫ÁèæÂ£ØÈ∫óÁöÑ„ÄåÂ≤©Êú®Â±±„ÄçÔºåË¢´Á®±ÁÇ∫Ê¥•ËºïÂØåÂ£´„ÄÇ", transport_info: { type: "Ëá™Èßï" }, to: "Hirosaki" },
                    { time: "14:30", title: "‰ªªÂãô 4ÔºöËó§Áî∞Á¥ÄÂøµÂ∫≠Âúí", tag: "Food", desc: "Â§ßÊ≠£Êµ™Êº´Âñ´Ëå∂ÂÆ§„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈÄôË£°ÂéüÊú¨ÊòØÂØåË±™ÁöÑÂà•Â¢ÖÔºåÊ¥ãÈ§®Âª∫ÁØâÈùûÂ∏∏ÊúâÊ∞£Ê∞õ„ÄÇ‰∏ÄÂÆöË¶ÅÊê∂Á™óÈÇäÁöÑ‰ΩçÁΩÆÔºåÁúãËëóÈõ™Ë¶ÜËìãÁöÑÊó•ÂºèÂ∫≠ÂúíÂêÉÁîúÈªû„ÄÇ", nav: { mapcode: "71 071 513*78" }, location: "Fujita Memorial Garden" },
                    { time: "14:45", title: "ÊòüÂ∑¥ÂÖã ÂºòÂâçÂÖ¨ÂúíÂâçÂ∫ó", tag: "Sightseeing", desc: "ÊúÄÁæéÊòüÂ∑¥ÂÖã‰πã‰∏Ä„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂ¶ÇÊûúÂñ´Ëå∂ÂÆ§Â§ßÊéíÈï∑ÈæçÔºåÈÄôË£°ÊòØÊúÄÂº∑ÂÇôÊ°à„ÄÇÂÆÉÊòØÂà©Áî®„ÄåËàäÁ¨¨ÂÖ´Â∏´ÂúòÈï∑ÂÆòËàç„ÄçÊîπÂª∫ÁöÑÔºå‰øùÁïô‰∫ÜÂ§ßÊ≠£ÊôÇ‰ª£ÁöÑÊ¥ãÈ¢®Âª∫ÁØâÁâπËâ≤„ÄÇ", location: "Starbucks Hirosaki Park" },
                    { time: "15:45", title: "ÂºòÂâçÂüé (ÂºòÂâçÂÖ¨Âúí)", tag: "Sightseeing", desc: "Èõ™ÁáàÁ±†„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂÜ¨Â§©ÁöÑÂºòÂâçÂüéÈõñÁÑ∂Â§©ÂÆàÈñ£ÂèØËÉΩÊúÉÁßªÂãïÔºå‰ΩÜÈáçÈªûÊòØ„ÄåÈõ™ÁáàÁ±†„Äç„ÄÇ", location: "Hirosaki Castle" },
                    { time: "16:30", title: "ÁßªÂãïÔºöËøîÂõûÈùíÊ£ÆÂ∏Ç", tag: "Drive", desc: "ÂúãÈÅì 7 Ëôü„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂºòÂâçÂà∞ÈùíÊ£ÆÁöÑÂúãÈÅì 7 ËôüÈùûÂ∏∏ÂÆπÊòìÂ°ûËªäÔºåË´ãÈ†êÁïôÂÖÖË£ïÊôÇÈñì„ÄÇ", transport_info: { type: "Ëá™Èßï" }, to: "Aomori City" },
                    { time: "18:00", title: "ÊôöÈ§êÔºöÈùíÊ£ÆÂ∏ÇÂçÄ", tag: "Food", desc: "Âë≥ÂôåÂíñÂì©ÁâõÂ•∂ÊãâÈ∫µ„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„Äë‰ªäÊôöÊé®Ëñ¶ÂòóË©¶ÈùíÊ£ÆÂ∏ÇÁöÑÈùàÈ≠ÇÁæéÈ£ü„ÄåÂë≥ÂôåÂíñÂì©ÁâõÂ•∂ÊãâÈ∫µ„Äç„ÄÇ", location: "Aomori City Center" }
                ]
            },
            {
                day: 4, date: "02.05", week: "THU",
                heroTitle: "ÂãáÈóñÂÖ´Áî≤Áî∞ÔºåÂÖ•‰ΩèÊòüÈáéÈùíÊ£ÆÂ±ã",
                heroImg: "https://i.imgur.com/xOsZDUG.jpg", 
                fallbackImg: "https://images.unsplash.com/photo-1487667258413-5a089052b658?q=80&w=800",
                alert: "‚ö†Ô∏è Èõ™Âú∞ÈßïÈßõË≠¶Á§∫ÔºöÂÖ´Áî≤Áî∞Â±±Ë∑ØÊÆµÁ©çÈõ™Ê•µÊ∑±ÔºåË´ãÊ≥®ÊÑèË∑ØÈù¢‰∏äÊñπÁ¥ÖÁÆ≠È†≠ÊåáÊ®ôÔºÅ",
                weather: { icon: "fa-spinner fa-spin", temp: "Loading..." },
                events: [
                    { time: "08:00", title: "ÈùíÊ£ÆÈ≠öËèú‰∏≠ÂøÉ (Âè§Â∑ùÂ∏ÇÂ†¥)", tag: "Food", desc: "Ëá™Ë£ΩÊµ∑ÈÆÆ‰∏º„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈÄôÊòØÊúÄÊúâË∂£ÁöÑÊó©È§êÈ´îÈ©óÔºÅÊãøËëóÁ¢óÂéªÂêÑÊî§‰Ωç„ÄåÈÅ∏Â¶É„Äç„ÄÇ‰∏ÄÂÆöË¶ÅË©¶Ë©¶ÁúãÈùíÊ£ÆÁâπÁî¢„ÄåÊâáË≤ù„Äç„ÄÇ", location: "Furukawa Market" },
                    { time: "09:30", title: "ÈñãËªä‰∏äÂ±±ÔºöÂæÄÂÖ´Áî≤Áî∞", tag: "Drive", desc: "Èõ™ÁâÜË∑ØÊÆµ„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂÖ®Ë°åÁ®ãÊúÄÂç±Èö™Ë∑ØÊÆµÔºÅÈö®ËëóÊµ∑ÊãîÂçáÈ´òÔºåË∑ØÊóÅÁ©çÈõ™ÊúÉËÆäÊàêÂÖ©‰∏âÂÖ¨Â∞∫È´òÁöÑÈõ™ÁâÜ„ÄÇË´ãÂãôÂøÖÊ≥®ÊÑèË∑ØÈù¢‰∏äÊñπÁöÑ„ÄåÁ¥ÖÁÆ≠È†≠„ÄçÊåáÊ®ô„ÄÇ", transport_info: { type: "Ëá™Èßï" }, from: "Aomori City", to: "Hakkoda Ropeway" },
                    { 
                        time: "10:30", title: "ÂÖ´Áî≤Áî∞Â±±Ê®πÂÜ∞ (Á∫úËªä)", tag: "Nature", 
                        desc: "Èõ™ÊÄ™ (Ice Monsters)„ÄÇ", 
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈÄôË£°ÁöÑÊ®πÂÜ∞ÊØîËóèÁéãÊõ¥ÂéüÂßã„ÄÅÊõ¥ÁãÇÈáé„ÄÇÊê≠Á∫úËªäÂà∞Â±±È†ÇÂæåÔºåÊÇ®ÊúÉÁΩÆË∫´ÊñºÂÜ∞Â∞Å‰∏ñÁïå„ÄÇ<br><br>„ÄêËÄÅÈ≥•Ë™™ÊïÖ‰∫ã„Äë<br>ÊÇ®Âç≥Â∞áË¶ãÂà∞ÁöÑ‰∏çÂè™ÊòØÊ®πÂíåÈõ™ÔºåËÄåÊòØÂ§ßËá™ÁÑ∂ÈõïÂ°ëÂá∫ÁöÑ„ÄåÈõ™ÊÄ™„Äç„ÄÇÊ®πÂÜ∞ÂΩ¢ÊàêÈúÄË¶Å‰∏âÂÄãÂ•áËπüÔºö1. Â§ßÈáèÁöÑ„ÄåÈùíÊ£ÆÂÜ∑Êùâ„ÄçÔºõ2. ‰æÜËá™Ë•ø‰ºØÂà©‰∫ûÁöÑÂ≠£È¢®ËàáÈÅéÂÜ∑Ê∞¥Êª¥Ôºõ3. Ê∞£Ê∫´ÊåÅÁ∫å‰ΩéÊñºÈõ∂‰∏ã 5 Â∫¶„ÄÇÂÖ´Áî≤Áî∞Â±±ÁöÑÊ®πÂÜ∞Ë¶èÊ®°ÂÆèÂ§ßÔºåÁúãËëóÊàêÂçÉ‰∏äËê¨Èöª„ÄåÈõ™ÊÄ™„ÄçÊ≤øËëóÂ±±Âù°ÊéíÂ±±ÂÄíÊµ∑ËÄå‰æÜÔºåÈÇ£Á®ÆÈúáÊáæÊÑüËàáÊï¨ÁïèÂøÉÊ≤πÁÑ∂ËÄåÁîü„ÄÇ", 
                        location: "Hakkoda Ropeway" 
                    },
                    { time: "12:00", title: "ÂçàÈ§êÔºöÁ∫úËªäÁ´ôÈ£üÂ†Ç", tag: "Food", desc: "ËïéÈ∫•È∫µÊàñÂíñÂì©„ÄÇ", location: "Hakkoda Ropeway Station" },
                    { time: "12:45", title: "ÈÖ∏ÊπØÊ∫´Ê≥â (Sukayu Onsen)", tag: "Sightseeing", desc: "ÂçÉ‰∫∫È¢®ÂëÇÂ§ñËßÄ„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂç≥‰Ωø‰∏çÈÄ≤ÂéªÊ≥°ÔºåÂÖâÊòØÊääËªäÂÅú‰∏ã‰æÜÔºåÁúãÈÇ£Ê£üÂÖ®Ê™úÊú®Âª∫ÈÄ†ÁöÑÂè§ËÄÅÂª∫ÁØâÔºå‰ª•ÂèäÂ±ãÈ†Ç‰∏äÂéöÈÅî 3-4 ÂÖ¨Â∞∫ÁöÑÈ©ö‰∫∫Á©çÈõ™ÔºåÂ∞±ÈùûÂ∏∏ÂÄºÂæó„ÄÇ", location: "Sukayu Onsen" },
                    { time: "13:00", title: "ÁßªÂãïÔºöÂâçÂæÄÊòüÈáéÈùíÊ£ÆÂ±ã", tag: "Drive", desc: "Â∞éËà™Ë®≠ÂÆöÊ≥®ÊÑè„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂ∞éËà™Èô∑Èò±Ë≠¶ÂëäÔºÅË´ãÂãôÂøÖË®≠ÂÆöÁ∂ìÁî±„ÄåÈô∏Â•ßÊî∂Ë≤ªÈÅìË∑Ø„ÄçÂæÄ‰∏âÊæ§ÊñπÂêë„ÄÇ", transport_info: { type: "Ëá™Èßï", time_estimate: "2Â∞èÊôÇ" }, to: "Hoshino Resorts Aomoriya" },
                    { time: "15:30", title: "ÂÖ•‰ΩèÔºöÊòüÈáéÈõÜÂúò ÈùíÊ£ÆÂ±ã", tag: "Hotel", desc: "Á•≠ÂÖ∏‰∏ªÈ°åÊ®ÇÂúí„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÊ≠°Ëøé‰æÜÂà∞Á•≠ÂÖ∏ÁöÑ‰∏ªÈ°åÊ®ÇÂúíÔºÅ‰∏ÄÈÄ≤ÈñÄÂ∞±ÊúÉÊúâÊúçÂãôÂì°ÈÅû‰∏äËøéË≥ìËòãÊûúÊ±Å„ÄÇ", nav: { mapcode: "84 583 002*44" }, reservation_info: { type: "Resort", number: "HOS-AOM-1234", name: "YK", check_in: "15:30" }, location: "Hoshino Resorts Aomoriya" },
                    { time: "17:00", title: "ÊôöÈ§êÔºöNore Sore È£üÂ†Ç", tag: "Food", desc: "Â™ΩÂ™ΩÁöÑÂë≥ÈÅì„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„Äë‰∏ÄÂÆöË¶ÅÈÄ≤Êîª„ÄåÁèæÁÖéÁâõÊéí„ÄçÂíå„ÄåÁÇ∏ÊâáË≤ù„Äç„ÄÇ", location: "Nore Sore Dining" },
                    { time: "19:00", title: "Ê∫´Ê≥âÔºöÊµÆÊπØ", tag: "Relax", desc: "Èú≤Â§©Ê∫´Ê≥â„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈÄôË£°ÁöÑÈú≤Â§©Ê∫´Ê≥âË®≠Ë®àÂæóÂÉèÊºÇÊµÆÂú®Ê∞¥Ê±†‰∏ä„ÄÇÊ≥°Âú®ÁÜ±ÊπØË£°ÔºåÁúãËëóÁáàÂÖâÊò†ÁÖßÂú®Èõ™Âú∞‰∏äÔºåÂ§¢ÂπªÊåáÊï∏Á†¥Ë°®„ÄÇ", location: "Aomoriya Onsen" }
                ]
            },
            {
                day: 5, date: "02.06", week: "FRI",
                heroTitle: "È¶¨ËªäÂ∑°ÈÅäËàáËºïÈ¨ÜÊªëÈõ™",
                heroImg: "https://i.imgur.com/ViOh2sW.jpg", 
                fallbackImg: "https://images.unsplash.com/photo-1548777123-e213912bc571?q=80&w=800",
                weather: { icon: "fa-spinner fa-spin", temp: "Loading..." },
                events: [
                    { time: "07:30", title: "Nore Sore È£üÂ†Ç Êó©È§ê", tag: "Food", desc: "Ëá™Ë£ΩÊµ∑ÈÆÆ‰∏º„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÊó©È§êÁöÑ‰∫ÆÈªûÊòØ„ÄåÂ∏ÜÁ´ãË≤ùÂë≥ÂôåÁáí„ÄçÂíå„ÄåËá™Ë£ΩÊµ∑ÈÆÆ‰∏º„Äç„ÄÇ", location: "Nore Sore Dining" },
                    { time: "09:00", title: "ÊöñÁàêÈ¶¨Ëªä (ÈúÄÈ†êÁ¥Ñ)", tag: "Experience", desc: "Ê¥•ËºïÊñπË®ÄÂ∞éË¶Ω„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂùêÂú®ÊúâÊöñÁàêÁöÑÈ¶¨ËªäË£°ÔºåÈ¶¨Â§´ÊúÉ‰∏ÄÈÇäË∂ïÈ¶¨‰∏ÄÈÇäÁî®Ê¥•ËºïÊñπË®ÄËÅäÂ§©„ÄÇ", location: "Aomoriya Park" },
                    { time: "11:00", title: "ÁßªÂãïÔºöÂâçÂæÄÊªëÈõ™Â†¥", tag: "Drive", desc: "Ëé´Ëò≠‰πãÊ£Æ„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈôÑËøëÁöÑ„ÄåËé´Ëò≠‰πãÊ£Æ (Komaki Onsen Ski Area)„ÄçÊòØÂÄãÂ∞èËÄåÁæéÁöÑÊªëÈõ™Â†¥Ôºå‰∫∫ÈÄöÂ∏∏‰∏çÂ§ö„ÄÇ", transport_info: { type: "Ëá™Èßï" }, to: "Komaki Onsen Ski Area" },
                    { time: "11:30", title: "ÊªëÈõ™È´îÈ©ó", tag: "Activity", desc: "Á≤âÈõ™È´îÈ©ó„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÂç≥‰Ωø‰∏çÊªëÈõ™ÔºåÁßüÂÄãÈõ™ÁõÜ (Sled) ‰æÜÁé©‰πüË∂ÖÈñãÂøÉÔºÅÈÄôË£°ÁöÑÈõ™Ë≥™ÊòØÁ≤âÈõ™ (Powder Snow)„ÄÇ", location: "Komaki Onsen Ski Area" },
                    { time: "15:30", title: "ÁßªÂãïÔºöËøîÂõûÈ£ØÂ∫ó", tag: "Drive", desc: "ÂõûÊ∫´„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÁé©Èõ™ÂæåË∫´È´îÊúÉÊøïÂÜ∑ÔºåÂõûÂà∞È£ØÂ∫óÁ¨¨‰∏Ä‰ª∂‰∫ãÂ∞±ÊòØÁõ¥Â•î„ÄåÂÖÉÊπØ„ÄçÊàñÂÜçÊ¨°Âéª„ÄåÊµÆÊπØ„ÄçÂõûÊ∫´„ÄÇ", transport_info: { type: "Ëá™Èßï" }, to: "Hoshino Resorts Aomoriya" },
                    { time: "16:00", title: "Ê≠°È®∞Âª£Â†¥", tag: "Relax", desc: "Jawamegu Hiroba„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„Äë‰ΩçÊñºÈ£ØÂ∫óÂú∞‰∏ãÊ®ìÂ±§ÁöÑÂª£Â†¥ÔºåÊ∞∏ÈÅ†ÈÉΩÂú®ÈÅéÁØÄ„ÄÇ", location: "Jawamegu Hiroba" },
                    { time: "18:00", title: "ÊôöÈ§ê", tag: "Food", desc: "È£ØÂ∫óÂÖß„ÄÇ", location: "Hoshino Resorts Aomoriya" },
                    { 
                        time: "20:00", title: "Èô∏Â•ßÁ•≠ÂÖ∏Â±ã", tag: "Culture", 
                        desc: "Áù°È≠îÁ•≠Ë°®Êºî„ÄÇ", 
                        detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÁµïÂ∞çÂøÖÁúãÔºÅÂ¶ÇÊûúÈÄôË∂üÊóÖÁ®ãÂè™ËÉΩÈÅ∏‰∏ÄÂÄãË°®ÊºîÔºåÂ∞±ÊòØÈÄôÂÄã„ÄÇ<br><br>„ÄêËÄÅÈ≥•Ë™™ÊïÖ‰∫ã„Äë<br>ÁÇ∫‰ªÄÈ∫ºÈùíÊ£Æ‰∫∫Â∞ç„ÄåÁ•≠ÂÖ∏„ÄçÈÄôÈ∫ºÁòãÁãÇÔºüÂõ†ÁÇ∫ÈÄôË£°ÁöÑÂÜ¨Â§©Â§™Èï∑„ÄÅÂ§™ÂÜ∑„ÄÅÂ§™Èªë‰∫Ü„ÄÇÁù°È≠îÁ•≠ (Nebuta) ÁöÑÂéüÊÑèÊòØË∂ïËµ∞Â§èÊó•Ëæ≤ÂøôÊôÇÊúüÁöÑÁù°È≠îËàáÁÅΩÂéÑÔºå‰ΩÜÊàëË™çÁÇ∫ÔºåÈÄôÊõ¥ÊòØÂñöÈÜí‰∫∫ÂÄëÈùàÈ≠ÇÁöÑÂÑÄÂºè„ÄÇÂú®Èô∏Â•ßÁ•≠ÂÖ∏Â±ãÔºåÊÇ®Â∞áËÅΩÂà∞ÊíºÂãïÂøÉËáüÁöÑÂ§™ÈºìËÅ≤ÔºåËàá„ÄåRassera!„ÄçÁöÑÂê∂Âñä„ÄÇÈÄô‰∏çÂè™ÊòØ‰∏ÄÂ†¥ÁßÄÔºåÈÄôÊòØÈùíÊ£Æ‰∫∫Âú®ÂÆ£ÂëäÔºö„ÄåÊàëÂÄëÁÜ¨ÈÅé‰∫ÜÂÜ¨Â§©ÔºåÊàëÂÄëÈÇÑÊ¥ªËëóÔºÅ„Äç", 
                        location: "Michinoku Matsuriya" 
                    }
                ]
            },
            {
                day: 6, date: "02.07", week: "SAT",
                heroTitle: "Ë∏èËëóÈõ™Ëä±ÊªøËºâËÄåÊ≠∏",
                heroImg: "https://i.imgur.com/edlDbD7.jpg", 
                fallbackImg: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=800",
                weather: { icon: "fa-spinner fa-spin", temp: "Loading..." },
                events: [
                    { time: "08:00", title: "ÊúÄÂæå‰∫´ÂèóÔºöÊó©È§ê/Ê∫´Ê≥â", tag: "Relax", desc: "Êé®Ëñ¶ÂÖÉÊπØ„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈõ¢Âà•ÂâçÁöÑÊúÄÂæå‰∏ÄÊ≥°„ÄÇÊé®Ëñ¶ÂéªÈ£ØÂ∫óÂúíÂçÄÂÖ•Âè£ËôïÁöÑ„ÄåÂÖÉÊπØ„Äç„ÄÇ", location: "Aomoriya Motoyu" },
                    { time: "10:00", title: "ÁßªÂãïÔºöÂâçÂæÄÈùíÊ£ÆÊ©üÂ†¥", tag: "Drive", desc: "Ê∫ñÊôÇÂá∫Áôº„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÊúÄÂæå‰∏ÄÊ¨°ÊèêÈÜíÔºöÂÜ¨Â≠£Ë∂ïÈ£õÊ©üÔºåÂØßÂèØÊó©Âà∞‰∏âÂ∞èÊôÇÔºå‰∏çÂèØÊôöÂà∞‰∏ÄÂàÜÈêò„ÄÇ", transport_info: { type: "Ëá™Èßï", time_estimate: "2.5Â∞èÊôÇ" }, from: "Hoshino Resorts Aomoriya", to: "Aomori Airport" },
                    { time: "12:00", title: "Ê©üÂ†¥Âë®ÈÇäÔºöÂçàÈ§ê/Âä†Ê≤π", tag: "Food", desc: "Âä†ÊªøÊ≤π„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈÄ≤Ê©üÂ†¥ÂâçÊúÄÂæå‰∏ÄÈ†Ö‰ªªÂãôÔºöÂä†ÊªøÊ≤π„ÄÇ", location: "Aomori Airport Area" },
                    { time: "12:30", title: "ÈùíÊ£ÆÊ©üÂ†¥ÈÇÑËªä", tag: "Transport", desc: "Ê™¢Êü•ËªäÊ≥Å„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈÇÑËªäÊôÇÔºåÂ∑•‰Ωú‰∫∫Âì°ÊúÉÊ™¢Êü•Â§ñËßÄ„ÄÇ", location: "Aomori Airport Car Rental" },
                    { time: "13:00", title: "Ê©üÂ†¥Â†±Âà∞ (AOJ)", tag: "Transport", desc: "Ëæ¶ÁêÜÁôªÊ©ü„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈùíÊ£ÆÊ©üÂ†¥Â∞èËÄåÁæé„ÄÇ", location: "Aomori Airport" },
                    { time: "13:30", title: "ÊúÄÂæåÊé°Ë≤∑", tag: "Shopping", desc: "Ê©üÂ†¥ 2F ÂÖçÁ®ÖÂ∫ó„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈÄôË£°ÊòØÊúÄÂæåË°ùÂà∫ÂçÄÔºÅÂøÖË≤∑Êï¥È°ÜËòãÊûú„ÄÅPatissier's ËòãÊûúÊ¥æ„ÄÅÊ∫êÂûÇÁáíËÇâÈÜ¨„ÄÇ", location: "Aomori Airport Duty Free" },
                    { time: "15:30", title: "Êê≠Ê©üËøîÂè∞", tag: "Flight", desc: "BR 121„ÄÇ", detail: "„ÄêÂ∞éÈÅäÁ≠ÜË®ò„ÄëÈ£õÊ©üËµ∑È£õÊôÇÔºåË´ãÂæÄ‰∏ãÁúãÔºåÈÇ£ÁâáÁôΩÈõ™Ë¶ÜËìãÁöÑÂ§ßÂú∞„ÄÅÂÖ´Áî≤Áî∞Â±±ÁöÑËº™Âªì„ÄÅÈô∏Â•ßÁÅ£ÁöÑÊ∑±ËóçÔºåÂ∞áÊòØÊÇ®ÈÄôË∂üÊóÖÁ®ãÊúÄÁæéÁöÑÂè•Èªû„ÄÇËæõËã¶‰∫ÜÔºÅ", reservation_info: { type: "Flight", number: "BR121", departure: "15:30" }, location: "Aomori Airport" }
                ]
            }
        ];

        const timeSensitiveMessages = {
            work: [
                "ÊØèÂ§©ÈÉΩÂú®ËôïÁêÜÁ™ÅÁôºÁãÄÊ≥ÅÔºåÈÄôÊ¨°ÂîØ‰∏ÄÁöÑÁ™ÅÁôºÁãÄÊ≥ÅÔºåÂè™Êúâ„ÄåÈ£üÁâ©Â§™Â•ΩÂêÉ„Äç„ÄÇ",
                "ÈÇ£‰∫õË°®Ê†º„ÄÅÂ†±Âëä„ÄÅSOP ÈÉΩÁïôÂú®Âè∞ÁÅ£ÔºåË°åÊùéÁÆ±Âè™Ë£ùÂæó‰∏ãÊúüÂæÖ„ÄÇ",
                "Á∏ΩÊòØÁÇ∫‰∫ÜÂà•‰∫∫ÂøôÂæóÂúòÂúòËΩâÔºåDay 5 ÁöÑÊöñÁàêÈ¶¨ËªäÊòØÂ∞àÈñÄÁÇ∫‰Ω†ÂÄëÊÖ¢‰∏ã‰æÜÁöÑ„ÄÇ",
                "‰∏çÁÆ°ÊòØÈà¥ËÅ≤„ÄÅÂëºÂè´Âô®ÈÇÑÊòØÈõªË©±ËÅ≤ÔºåÈÉΩÊØî‰∏ç‰∏äÂºòÂâçÈõ™Âú∞Ë£°ÁöÑÂØÇÈùúÂ•ΩËÅΩ„ÄÇ",
                "ÊØèÂ§©ÈÉΩË¶Å„Äå‰øùÊåÅÂÜ∑Èùú„ÄçÔºå‰ΩÜÂú®ÈùíÊ£ÆÁöÑËòãÊûúÊ¥æÈù¢ÂâçÔºåÂÖÅË®±‰Ω†ÊøÄÂãï‰∏ÄÈªû„ÄÇ",
                "ÈÄôÊ¨°ÊóÖË°åÊ≤íÊúâ„ÄåÈï∑ÂÆò„Äç‰πüÊ≤íÊúâ„ÄåÂÆ∂Â±¨/ÂÆ∂Èï∑„ÄçÔºåÂè™ÊúâÈÄôÁæ§ÊáÇ‰Ω†ÁöÑÊóÖ‰º¥„ÄÇ",
                "Êää„ÄåËß£Ê±∫ÂïèÈ°å„ÄçÁöÑËÉΩÂäõÂÖàÈóúÊéâÔºåÊàëÂÄëÂéªÂè§Â∑ùÂ∏ÇÂ†¥Âè™Ë≤†Ë≤¨„ÄåËß£Ê±∫Êµ∑ÈÆÆ‰∏º„Äç„ÄÇ",
                "ÊØèÂ§©ÈÉΩÂú®Ë∑üÊôÇÈñìË≥ΩË∑ëÔºå‰ΩÜÂú®ÊöñÁàêÂàóËªä‰∏äÔºåÊôÇÈñìÊòØË¢´ÁÇ≠ÁÅ´ÊÖ¢ÊÖ¢ÁÉ§ÁÜ±ÁöÑ„ÄÇ",
                "ËæõËã¶‰∫ÜÔºåÈÄôË∂üÊóÖË°åÂ∞±ÊòØ‰Ω†ÂÄëÊúÄÂ•ΩÁöÑÁ∏æÊïàÁçéÈáë„ÄÇ",
                "ÈÇ£‰∫õËÆì‰Ω†ÁêÜÊô∫Êñ∑Á∑öÁöÑÁû¨ÈñìÈÉΩÈÅéÂéª‰∫ÜÔºåÁèæÂú®ÈÄ£Á∑öÁöÑÊòØÈùíÊ£ÆÁöÑ WiFi„ÄÇ",
                "ÊØèÂ§©ÈÉΩË¶ÅÊ≠¶Ë£ùËá™Â∑±ÔºåÈÄôÊ¨°Âéª UNIQLO Ë≤∑‰ª∂ÊØõËå∏Ëå∏ÁöÑÂ§ñÂ•óÔºåÊääËá™Â∑±Ë£πÂæóËªüËªüÁöÑÂêß„ÄÇ",
                "Êö´ÊôÇÊää„ÄåË≤¨‰ªªÊÑü„ÄçË™øÊàêÈ£õËà™Ê®°ÂºèÔºåÊ∫ñÂÇôÂá∫ÁôºÔºü",
                "ÈÄÉÈõ¢ÈÇ£‰∫õ‰∏çË¨õÁêÜÁöÑ‰∫∫‰∫ãÁâ©ÔºåÂéªË¶ãË¶ãÂè™ÊúÉÈªûÈ†≠ÂêÉËçâÁöÑÈ¶¨ÂÖíÂêß„ÄÇ",
                "Âú®ËÅ∑Â†¥‰∏äÁúã‰∫ÜÂ§™Â§öÁÑ°Â•àÔºåÂéªÁúãÁúãÂ•àËâØÁæéÊô∫ÁöÑ‰ΩúÂìÅÔºåÊâæÂõûÁ¥îÁúüÁöÑÁúºÁ•û„ÄÇ",
                "‰∏äÁè≠ÁöÑÁ©∫Ê∞£Â§™ÊÇ∂‰∫ÜÔºåÂ•ΩÊÉ≥Âø´ÈªûËÅûÂà∞ÁÉ§È≠∑È≠öÁöÑÈ¶ôÊ∞£„ÄÇ",
                "ËÆìÂºòÂâçÂüéÁöÑÁôΩËâ≤Èõ™ÊôØÔºåË¶ÜËìãÊéâËÖ¶‰∏≠ÈÇ£‰∫õÈõú‰∫ÇÁöÑÂæÖËæ¶‰∫ãÈ†Ö„ÄÇ",
                "Áï∂‰Ω†Ë¶∫ÂæóÈÄôÈÄ±ÂæàÊº´Èï∑ÊôÇÔºåÊÉ≥ÊÉ≥ÂáΩÈ§®ÊúùÂ∏ÇÁöÑÊµ∑ËÜΩÊ≠£Âú®ÊÖ¢ÊÖ¢ËÆäÁîú„ÄÇ",
                "ÂíñÂï°Â∑≤Á∂ìÊèê‰∏ç‰∫ÜÁ•û‰∫ÜÂóéÔºüÈÇ£‰Ω†ÈúÄË¶ÅÁöÑÊòØÂ•ßÂÖ•ÁÄ®Ê∫™ÊµÅÁöÑÂÜ∑ÂÜΩÁ©∫Ê∞£„ÄÇ",
                "ÈÇ£‰∫õÈõ£ÊêûÁöÑÂÖ¨‰∫ãÔºå‰∏üÈÄ≤Ê¥•ËºïÊµ∑Â≥ΩË£°ÊáâË©≤ÊúÉÊ≤â‰∏ãÂéªÂêßÔºü",
                "ÊääÈÅéÂ∫¶‰ΩøÁî®ÁöÑËÖ¶ÂÆπÈáèÊ∏ÖÁ©∫ÔºåÁïôÁµ¶Ëó§Áî∞Á¥ÄÂøµÂ∫≠ÂúíÁöÑÁæéÊôØ„ÄÇ",
                "Âç≥‰Ωø‰ªäÂ§©ÈÅáÂà∞È≥•‰∫ãÔºåÊÉ≥Ëëó„ÄåÊàëË¶ÅÂéªÈùíÊ£Æ‰∫Ü„ÄçÔºåÂøÉÊÉÖ‰πüÊúÉËÆäÂ•Ω„ÄÇ",
                "‰ªäÂ§©ÁöÑÂä™ÂäõÔºåÈÉΩÊòØÁÇ∫‰∫ÜÈÇ£Â§©Âú®Èõ™Âú∞Ë£°ËÉΩÁÑ°ÊÜÇÁÑ°ÊÖÆÂú∞Êº´Ê≠•„ÄÇ",
                "Â¢®Èè°Ê∫ñÂÇôÂ•Ω‰∫ÜÂóéÔºüÊàëÂÄëË¶ÅÂéªÈù¢Â∞çÊØîÁèæÂØ¶Êõ¥Âà∫Áúº„ÄÅÊõ¥Áá¶ÁàõÁöÑÈõ™ÁôΩ„ÄÇ",
                "Á∏ΩÊòØÊìîÂøÉÈÄôÂÄã„ÄÅÊìîÂøÉÈÇ£ÂÄãÔºåÈÄôÊ¨°ÂîØ‰∏ÄË¶ÅÊìîÂøÉÁöÑÊòØ„Äå‰∏çÊÉ≥ÂõûÂéªÊÄéÈ∫ºËæ¶„Äç„ÄÇ",
                "Ë∑ùÈõ¢Âá∫ÁôºÂèàËøë‰∫Ü‰∏ÄÂ§©Ôºå‰Ω†ÁöÑÂøÉÊòØ‰∏çÊòØÂ∑≤Á∂ìÂÅ∑ÂÅ∑Ê∫úÂéªÊ©üÂ†¥‰∫ÜÔºü",
                "ÂÜçÊíê‰∏Ä‰∏ãÔºåÈÇ£‰∫õÁÖ©‰∫∫ÁöÑ‰∫ãÔºåÈÅéÂπæÂ§©ÈÉΩÊúÉËÆäÊàêÈÅôÈÅ†ÁöÑÊïÖ‰∫ã„ÄÇ"
            ],
            evening: [
                "ÊØèÂ§©ÈÉΩÂú®Ë¨õË©±ÂÆâÊí´Âà•‰∫∫ÔºåÂéªÈáëÊ£ÆÁ¥ÖÁ£öÂÄâÂ∫´ÊôÇÔºåÊàëÂÄëË©¶ËëóÂÆâÈùúÂú∞ÁúãËëóÂ§ïÈôΩÂ∞±Â•Ω„ÄÇ",
                "‰Ω†ÁöÑËÄêÂøÉÈ§òÈ°çÂ∑≤‰∏çË∂≥ÔºüÊ≤íÈóú‰øÇÔºåÂáΩÈ§®ÁöÑÁôæËê¨Â§úÊôØÊúÉÂπ´‰Ω†ÂÖÖÂÄº„ÄÇ",
                "Á∏ΩÊòØÊääÂà•‰∫∫ÁöÑÈúÄÊ±ÇÊì∫Á¨¨‰∏ÄÔºåÈÄôÊ¨°ÔºåË´ãÊää„ÄåÊàëÊÉ≥ÂêÉÈÄôÂÄã„ÄçÂ§ßËÅ≤Ë™™Âá∫‰æÜ„ÄÇ",
                "ÊÉ≥ÂÉè‰∏Ä‰∏ãÔºåÂπ∏ÈÅãÂ∞è‰∏ëÊº¢Â†°ÁöÑÈÜ¨Ê±ÅÊª¥‰∏ã‰æÜÁöÑÁÜ±Â∫¶ÔºåÊòØ‰∏çÊòØÈ§ì‰∫ÜÔºü",
                "ÊâãÊåáÊï≤ÈçµÁõ§/ÂØ´Â≠óÂ§™‰πÖ‰∫ÜÔºåÂÆÉÂÄëÁèæÂú®Âè™ÊÉ≥Êè°ËëóÊöñÊöñÁöÑÊ∏ÖÈÖíÊùØ„ÄÇ",
                "‰Ω†ÁöÑÁúºÁùõÁúãÂ§™Â§öËû¢Âπï‰∫ÜÔºåÂáΩÈ§®ÁöÑÂ§úÊôØÊòØÊúÄÂ•ΩÁöÑÁúºËó•Ê∞¥„ÄÇ",
                "Âú® Dormy Inn ÁöÑÂ§úÈ≥¥ÊãâÈ∫µÈù¢ÂâçÔºåÊ∏õËÇ•‰ªÄÈ∫ºÁöÑÈÉΩÊòéÂ§©ÂÜçË™™„ÄÇ",
                "‰Ω†ÁöÑËÉÉÊòØ‰∏çÊòØÂú®ÊäóË≠∞ÈÉΩ‰∫ÇÂêÉÔºüÊ∫ñÂÇôÂ•ΩÁî®ÈÑâÂúüÊñôÁêÜ‰æÜÂÆâÊí´ÂÆÉ„ÄÇ",
                "ÊúüÂæÖ‰∏Ä‰∏ãÔºåÂú®ÂîêÂêâË®∂Âæ∑Ëø∑Ë∑ØÊôÇÔºåÈÇ£Á®ÆË¢´ÂïÜÂìÅÂåÖÂúçÁöÑÁÑ°ËÖ¶Âø´Ê®Ç„ÄÇ",
                "È§ì‰∫ÜÂóéÔºüÂè§Â∑ùÂ∏ÇÂ†¥ÁöÑ„ÄåNokke Don„ÄçÔºåÊÉ≥Â•ΩË¶ÅËìãÂπæÂ±§ÁîüÈ≠öÁâá‰∫ÜÂóéÔºü",
                "ËÆìÈô∏Â•ßÁ•≠ÂÖ∏Â±ãÁöÑÈºìËÅ≤ÔºåÈúáÁ¢é‰Ω†ÂøÉË£°ÁöÑÁÖ©ÊÇ∂„ÄÇ",
                "Âú®ÂáΩÈ§®Â±±ÁúãÂ§úÊôØÊôÇÔºåË®±ÂÄãÈ°òÂêßÔºåÈóúÊñºËá™Â∑±Ôºå‰∏çÊòØÈóúÊñºÂ∑•‰Ωú„ÄÇ",
                "ÊØèÂ§©Êôö‰∏äÂõûÂà∞È£ØÂ∫óÔºåÈÉΩË¶ÅÂñù‰∏ÄÊùØÔºåÊÖ∂Á•ùÊàëÂÄëÂèàÂæÅÊúç‰∫Ü‰∏ÄÂ§©„ÄÇ",
                "ÈÅáÂà∞Â•ΩÂêÉÁöÑ‰∏ÄÂÆöË¶ÅÂàÜ‰∏ÄÂè£ÔºåÈÅáÂà∞Èõ∑ÁöÑ‰πüË¶Å‰∏Ä‰∫∫‰∏ÄÂè£ÔºàÊúâÈõ£ÂêåÁï∂Ôºâ„ÄÇ",
                "ÂòøÔºå‰ªäÂ§©ÈÅéÂæóÈÇÑÂ•ΩÂóéÔºüÂáΩÈ§®ÁöÑÈ¢®Âú®Á≠â‰Ω†„ÄÇ",
                "Â¶ÇÊûúÂú®ÂîêÂêâË®∂Âæ∑Â§±ÂøÉÁòãÔºåË®òÂæóÊèêÈÜíÂ∞çÊñπÔºö„ÄåË°åÊùéÁÆ±ÈÇÑÂ°ûÂæó‰∏ãÂóéÔºü„Äç",
                "ÁÇ∫‰∫ÜÈÇ£‰∏ÄÂè£ËòãÊûúÊ¥æÁöÑÈÖ•ËÑÜÔºå‰ªäÂ§©ÁöÑÂçàÈ§êÈö®‰æøÂêÉ‰πüÊ≤íÈóú‰øÇ„ÄÇ",
                "Ë≤∑‰º¥ÊâãÁ¶ÆÁöÑÊôÇÂÄôÔºåË®òÂæóÂÖàË≤∑Áµ¶Ëá™Â∑±ÔºåÂÜçË≤∑Áµ¶Âà•‰∫∫„ÄÇ"
            ],
            rest: [
                "Á∏ΩÊòØËÅΩÂà•‰∫∫ÁöÑÁÖ©ÊÉ±ÔºåÈÄôÊ¨°ÊèõËÅΩËÅΩÊ¥•ËºïÊµ∑Â≥ΩÁöÑÊµ∑Êµ™ËÅ≤Âêß„ÄÇ",
                "Áü•ÈÅì‰Ω†ËÇ©ËÜÄÂæàÈáçÔºåÊâÄ‰ª•ÊàëÂÄëÂÆâÊéí‰∫ÜÊ∫´Ê≥âÔºåÊääÈÇ£‰∫õË≤¨‰ªªÈÉΩÊ¥óÊéâ„ÄÇ",
                "Âπ≥Â∏∏ÁÖßÈ°ßÂ§ßÂÆ∂ÔºåÈÄôÊ¨°ËÆìÊòüÈáéÈõÜÂúòÁöÑÊúçÂãô‰∫∫Âì°‰æÜÂØµÂ£û‰Ω†„ÄÇ",
                "ËÑ´‰∏ãÂà∂ÊúçÁöÑ‰Ω†ÔºåÈÉΩÂè™ÊòØÊ∏¥ÊúõË¢´Â§ßËá™ÁÑ∂ÊìÅÊä±ÁöÑÂ≠©Â≠ê„ÄÇ",
                "‰ªäÂ§©Â¶ÇÊûúË¶∫ÂæóÂæàÁ¥ØÔºåÊÉ≥Ëëó ÊòüÈáéÈùíÊ£ÆÂ±ãÔºåÊ∑±ÂëºÂê∏‰∏ÄÊ¨°„ÄÇ",
                "Èñâ‰∏äÁúºÁùõÔºåÊÉ≥ÂÉè‰∏Ä‰∏ãÈõ∂‰∏ã‰∫îÂ∫¶ÁöÑÁ©∫Ê∞£Âê∏ÈÄ≤ËÇ∫Ë£°ÔºåÈÇ£Á®Æ‰πæÊ∑®ÁöÑÊÑüË¶∫„ÄÇ",
                "ËÅΩË™™Ê¥•ËºïÈêµÈÅìÁöÑÊöñÁàêÂæàÊ∫´ÊöñÔºåÂ∞±ÂÉèÊàëÂÄëËÅöÂú®‰∏ÄËµ∑ÁöÑÊ∫´Â∫¶„ÄÇ",
                "ÊÉ≥ÂÉèËÖ≥Ë∏©Âú®ÂéöÂéöÁöÑÊñ∞Èõ™‰∏äÔºå„ÄåÂôóÊªã„Äç‰∏ÄËÅ≤ÔºåÈÇ£ÊòØÁôÇÁôíÁöÑËÅ≤Èü≥„ÄÇ",
                "ÈùíÊ£ÆËòãÊûúÂí¨‰∏ãÂéªÊ∏ÖËÑÜÁöÑËÅ≤Èü≥ÔºåÊúÉËÆì‰Ω†ÂøòË®òÊâÄÊúâÁöÑÂô™Èü≥„ÄÇ",
                "ËÆìÊòüÈáéÈùíÊ£ÆÂ±ãÁöÑÈú≤Â§©Ê∫´Ê≥âÔºåËí∏ÁôºÊéâ‰Ω†Á¥ØÁ©ç‰∏ÄÊï¥Âπ¥ÁöÑÁñ≤ÊÜä„ÄÇ",
                "ÊÉ≥ÂÉèÂ§ßÊ≠£Êµ™Êº´Âñ´Ëå∂ÂÆ§ÁöÑÈôΩÂÖâÁÅëÂú®Ëáâ‰∏äÔºåÈÇ£Â§©‰∏ãÂçàÊàëÂÄë‰ªÄÈ∫ºÈÉΩ‰∏çÂÅö„ÄÇ",
                "Áï∂Êñ∞ÂππÁ∑öÁ©øÈÅéÈößÈÅìÔºåÁúºÂâçË±ÅÁÑ∂ÈñãÊúóÁöÑÈÇ£‰∏ÄÂàªÔºåÂøÉÊÉÖ‰πüÊúÉË∑üËëóÊâìÈñã„ÄÇ",
                "ËÆìÂºòÂâçÁöÑÁ≤âÈõ™ÔºåËºïËºïËêΩÂú®‰Ω†ÁöÑÁù´ÊØõ‰∏äÔºåÈÇ£ÊòØÂÜ¨Â§©ÁöÑË¶™Âêª„ÄÇ",
                "ÊÉ≥ÂÉè‰∏Ä‰∏ãÔºåËá™ÈßïÂú®Èõ™ÁâÜ‰∏≠ÈñìÔºåÂÖ®‰∏ñÁïåÂè™Ââ©‰∏ãÊàëÂÄëÈÄôÂè∞Ëªä„ÄÇ",
                "ÊúÄÂæå‰∏ÄÂ§©Âú®Ê©üÂ†¥ÁöÑÈúúÊ∑áÊ∑ãÔºåÊòØÈÄôË∂üÊóÖÁ®ãÊúÄÁîúÁæéÁöÑÂè•Èªû„ÄÇ",
                "ÈõñÁÑ∂Â§ßÂÆ∂ÈÉΩÂæàÊúÉÁÖßÈ°ß‰∫∫Ôºå‰ΩÜÈÄôÊ¨°ÊàëÂÄëË¶Å‰∫íÁõ∏ÁÖßÈ°ßÔºåÊàñËÄÖ‰∏ÄËµ∑Êì∫Áàõ„ÄÇ",
                "Â¶ÇÊûúË™∞Âú®ÂºòÂâçÂüéÊªëÂÄí‰∫ÜÔºåÂÖàÊãçÁÖßÂÜçÊâ∂Ëµ∑‰æÜ„ÄÇ",
                "ÈÄôÊ¨°ÁßüÁöÑËªäÂ∞±ÊòØÊàëÂÄëÁöÑÁßªÂãïÂüéÂ†°ÔºåË£°Èù¢Âè™Ë£ùÁ¨ëËÅ≤„ÄÇ",
                "ÂõûÁ®ãÊôÇÔºå‰∏çÂáÜÂì≠Âñ™ËëóËáâÔºåË¶ÅÁ¨ëËëóË™™„Äå‰∏ãÊ¨°ÂÜçÂéªÂì™Ë£°„Äç„ÄÇ",
                "Á¥ÑÂ•Ω‰∫ÜÔºåË¶ÅÊääÈÄôÂπæÂ§©ÁöÑÂø´Ê®ÇÔºåÂÑ≤Â≠òÊàêÂõûÂè∞ÁÅ£ÂæåÁöÑËÉΩÈáèÂåÖ„ÄÇ",
                "Â∞±ÁÆóËø∑Ë∑Ø‰∫ÜÔºåÂè™Ë¶Å‰∏âÂÄã‰∫∫Âú®‰∏ÄËµ∑ÔºåÈÇ£Ë£°Â∞±ÊòØÊôØÈªû„ÄÇ",
                "‰Ω†ÁöÑÈõ™Èù¥Ê∫ñÂÇôÂ•Ω‰∫ÜÂóéÔºüÂÆÉËø´‰∏çÂèäÂæÖË¶ÅÂú®ÈùíÊ£ÆÁïô‰∏ãËÖ≥Âç∞„ÄÇ",
                "ÁîüÊ¥ªÂÅ∂ÁàæÈúÄË¶ÅÊö´ÂÅúÔºåÊàëÂÄëÊ≠£Âú®ÂâçÂæÄÊåâÊö´ÂÅúÈçµÁöÑË∑Ø‰∏ä„ÄÇ",
                "Ê™¢Êü•‰∏Ä‰∏ãÔºåÂ•ΩÂ•áÂøÉÂ∏∂‰∫ÜÂóéÔºüÈÇ£ÊòØÊØîË≠∑ÁÖßÊõ¥ÈáçË¶ÅÁöÑÊù±Ë•ø„ÄÇ",
                "Ë≠∑ÁÖßÊ™¢Êü•ÈÅé‰∫ÜÂóéÔºüÈÇ£ÊòØÈÄöÂæÄËá™Áî±ÁöÑÂÖ•Â†¥Âà∏„ÄÇ",
                "ÊÉ≥ÂÉè‰∏Ä‰∏ãÔºåÊ≠§ÂàªÁöÑÂºòÂâçÂüéÔºåÈõ™Ê≠£ÈùúÈùúÂú∞ËêΩ‰∏ãÔºåÁ≠âÂæÖËëó‰Ω†ÁöÑÂà∞‰æÜ„ÄÇ",
                "Ë°åÊùéÁÆ±ÊãøÂá∫‰æÜ‰∫ÜÂóéÔºüÊääÂÆÉÊî§ÈñãÂú®Âú∞‰∏äÔºåÂ∞±ÊòØ‰∏ÄÁ®ÆÂÑÄÂºèÊÑü„ÄÇ",
                "Êó•Âπ£ÊèõÂ•Ω‰∫ÜÂóéÔºüÈÇ£‰∫õÁ°¨Âπ£Âà∞ÊôÇÂÄôÈÉΩÊúÉËÆäÊàêÊâ≠ËõãÂíåÈ£≤Êñô„ÄÇ",
                "‰øùÊöñÂÅöÂ•Ω‰∫ÜÂóéÔºüÂøÉÂæàÁÜ±Ôºå‰ΩÜË∫´È´îÈÇÑÊòØË¶ÅÈ°ßÂñî„ÄÇ",
                "ÊâãÊ©üË®òÊÜ∂È´îÊ∏ÖÁ©∫‰∫ÜÂóéÔºüÂà•ËÆìÂÆπÈáèÈôêÂà∂‰∫Ü‰Ω†ÁöÑÂõûÊÜ∂„ÄÇ",
                "ÈßïÁÖßË≠ØÊú¨Âú®ÁöÆÂ§æË£°‰∫ÜÂóéÔºüÈÇ£ÊòØÊàëÂÄëÈ¶≥È®ÅÈùíÊ£ÆÁöÑÈë∞Âåô„ÄÇ",
                "Ê≠åÂñÆÊï¥ÁêÜÂ•Ω‰∫ÜÂóéÔºüÈÇ£ÊòØÂÖ¨Ë∑ØÊóÖË°åÁöÑÈùàÈ≠Ç„ÄÇ",
                "ÊØèÂ§©ÁúãËëóÂÄíÊï∏Êï∏Â≠óËÆäÂ∞ëÔºåÂò¥ËßíÊòØ‰∏çÊòØÊúÉ‰∏çËá™Ë¶∫‰∏äÊèöÔºü",
                "ËÆìÊúüÂæÖÊÑüÂÉèÈõ™ÁêÉ‰∏ÄÊ®£ÔºåË∂äÊªæË∂äÂ§ßÂêß„ÄÇ",
                "Ë®òÂæóÂ∏∂‰∏äÈù¢ËÜú/‰øùÊøïÂìÅÔºåÂú®È£ØÂ∫óÊï∑ËáâËÅäÂ§©ÁöÑÊôÇÂÖâÂæàÁèçË≤¥„ÄÇ",
                "ÂÄíÊï∏Ë®àÊôÇ‰∏≠...Ê∑±ÂëºÂê∏ÔºåËÅûÂà∞Êó•Êú¨Á©∫Ê∞£ÁöÑÂë≥ÈÅì‰∫ÜÂóéÔºü",
                "ÊâÄÊúâÁöÑÁ≠âÂæÖÔºåÈÉΩÊòØÁÇ∫‰∫ÜÁõ∏ÈÅáÊôÇÁöÑÈÇ£‰∏ÄÂàªÁæéÂ•Ω„ÄÇ",
                "ÊääÂøÉÊ∏ÖÁ©∫ÔºåÊ∫ñÂÇôË£ùÊªøÈùíÊ£ÆÁöÑËóçÂ§©ËàáÁôΩÈõ™„ÄÇ",
                "Ê∫ñÂÇôÂ•Ω‰∫ÜÂóéÔºüÂéªÊìÅÊä±ÈÇ£ÂÄã„ÄåÂè™Â±¨Êñº‰Ω†Ëá™Â∑±„ÄçÁöÑÂÅáÊúü„ÄÇ"
            ]
        };

        let db;
        let auth;
        let expensesRef;
        let notesRef; 
        // Variables for Trip View
        let currentRate = 0.22;
        let currentIdx = 0;
        let localNotes = {}; 
        let currentEventId = null; 
        let currentNavLink = null;
        let isAnimating = false;
        let currentQuantity = 1;
        
        // --- RECEIPT PRINTER VARIABLES ---
        let currentCurrency = 'JPY'; 
        let rate = 0.22; // Default for printer
        let isOnline = false; // Connection status for printer
        let receiptCount = 1; 
        let receiptsData = []; 
        let currentUser = 'Â•é'; 
        let isTopFeedExpanded = false;

        // --- DOM Elements for Printer (Lazily fetched) ---
        const getPrinterDom = () => ({
            headerDate: document.getElementById('header-date'),
            inputItem: document.getElementById('input-item'),
            inputPrice: document.getElementById('input-price'),
            previewEmbed: document.getElementById('embedded-preview'),
            printBtn: document.getElementById('print-btn'),
            statusLight: document.getElementById('status-light'),
            feed: document.querySelector('.paper-input-feed'),
            listAnchor: document.getElementById('receipt-items-anchor'),
            listEmpty: document.getElementById('receipt-empty'),
            totalLabel: document.getElementById('total-label'),
            totalPersonal: document.getElementById('personal-total'),
            totalTrip: document.getElementById('trip-total'),
            topTotalAmt: document.getElementById('top-total-amount'),
            topTotalSub: document.getElementById('top-total-sub'),
            rateValue: document.getElementById('rate-value')
        });
        
        // --- UTILITY FUNCTIONS ---

        /** Shows a non-blocking toast message. */
        function showToast(message) {
            const toast = document.getElementById('app-message');
            toast.innerText = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        /**
         * Generic fetch wrapper with exponential backoff for API calls.
         * @param {string} url The API endpoint URL.
         * @param {object} options Fetch options (method, headers, body).
         * @param {number} retries Max number of retries.
         */
        async function fetchWithRetry(url, options, retries = 3) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429) { // Rate limit
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                        console.warn(`Rate limit hit. Retrying in ${delay / 1000}s...`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }
                    if (!response.ok) {
                        const errorBody = await response.text();
                        throw new Error(`API call failed with status ${response.status}: ${errorBody}`);
                    }
                    return response;
                } catch (error) {
                    if (i === retries - 1) throw error; 
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    console.error(`Attempt ${i + 1} failed: ${error.message}. Retrying...`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        // --- SNOW ANIMATION LOGIC ---
        function createSnow() {
            const container = document.getElementById('snow-container');
            const snowflakeCount = 40; // Â¢ûÂä†Èõ™Ëä±Êï∏Èáè
            
            for (let i = 0; i < snowflakeCount; i++) {
                const snowflake = document.createElement('div');
                snowflake.classList.add('snowflake');
                snowflake.innerHTML = '‚ùÑ';
                
                // Èö®Ê©ü‰ΩçÁΩÆ„ÄÅÂ§ßÂ∞èÂíåÂãïÁï´ÊåÅÁ∫åÊôÇÈñì
                const startLeft = Math.random() * 100;
                const animDuration = Math.random() * 5 + 5; // 5-10s
                const animDelay = Math.random() * 5;
                const size = Math.random() * 0.4 + 0.2; // Modified: Smaller snowflakes (0.2-0.6rem)
                const opacity = Math.random() * 0.6 + 0.2;

                snowflake.style.left = startLeft + '%';
                snowflake.style.animationDuration = animDuration + 's';
                snowflake.style.animationDelay = animDelay + 's';
                snowflake.style.fontSize = size + 'rem';
                snowflake.style.opacity = opacity;

                container.appendChild(snowflake);
            }
        }

        // --- FIRESTORE SUBSCRIPTION FUNCTIONS ---
        const subscribeToExpenses = () => {
            if (!expensesRef) return;
            const q = query(expensesRef);
            
            onSnapshot(q, (snapshot) => {
                // Check if this update comes from a local write (for animation)
                let isNewLocalWrite = false;
                snapshot.docChanges().forEach(change => {
                    if (change.type === "added" && snapshot.metadata.hasPendingWrites) {
                        isNewLocalWrite = true;
                    }
                });

                const newData = snapshot.docs.map(doc => {
                    const data = doc.data();
                    let dateStr = getFormattedTime();
                    if (data.timestamp) {
                        const d = data.timestamp.toDate();
                        const month = String(d.getMonth() + 1).padStart(2, '0');
                        const day = String(d.getDate()).padStart(2, '0');
                        const hours = String(d.getHours()).padStart(2, '0');
                        const minutes = String(d.getMinutes()).padStart(2, '0');
                        dateStr = `${d.getFullYear()}.${month}.${day} ${hours}:${minutes}`;
                    }
                    
                    return {
                        id: doc.id,
                        user: data.user || 'Unknown',
                        item: data.item || 'Item',
                        jpy: data.jpy || 0,
                        twd: data.twd || 0,
                        timestamp: data.timestamp,
                        date: dateStr,
                        no: "000" // calculated below
                    };
                });
                
                // Sort descending by time
                newData.sort((a, b) => (b.timestamp?.toMillis() || 0) - (a.timestamp?.toMillis() || 0));
                
                // Assign Receipt Numbers (Oldest = 001)
                const total = newData.length;
                newData.sort((a, b) => (a.timestamp?.toMillis() || 0) - (b.timestamp?.toMillis() || 0)); // Sort ascending for numbering
                newData.forEach((item, index) => {
                    item.no = String(index + 1).padStart(3, '0');
                });
                newData.reverse(); // Back to descending for display

                receiptsData = newData;
                receiptCount = total + 1; // Prepare next count for local ref
                renderReceiptList(isNewLocalWrite);
            }, (error) => {
                console.error("Error subscribing to expenses:", error);
            });
        };

        const subscribeToNotes = () => {
            if (!notesRef) return;
            const q = query(notesRef);
            onSnapshot(q, (snapshot) => {
                snapshot.docs.forEach(doc => { localNotes[doc.id] = doc.data().text; });
                
                // Re-render modal content if it is currently open and corresponds to a modified note
                if(currentEventId) {
                    const descEl = document.getElementById('m-desc');
                    const noteInModal = localNotes[currentEventId];
                    if(descEl && noteInModal) {
                        descEl.innerHTML = noteInModal; 
                    } else if (descEl) {
                        // Fallback to original data if note was deleted/empty
                        const day = tripData[currentIdx];
                        const event = day.events.find((_, i) => `d${currentIdx}_e${i}` === currentEventId);
                        if(event) descEl.innerHTML = event.detail || event.desc;
                    }
                }
            }, (error) => {
                console.error("Error subscribing to notes:", error);
            });
        };

        // --- RECEIPT PRINTER LOGIC ---
        async function fetchExchangeRate() {
            const dom = getPrinterDom();
            try {
                // Using a fallback external API for demonstration if Canvas doesn't provide a currency tool
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/JPY');
                const data = await response.json();
                
                if (data && data.rates && data.rates.TWD) {
                    rate = data.rates.TWD;
                    isOnline = true;
                    // Êõ¥Êñ∞ UI
                    if(dom.rateValue) dom.rateValue.innerHTML = rate.toFixed(3);
                    updateStatusLight(); 
                    
                    // ÈáçÊñ∞Ë®àÁÆó
                    if (dom.inputPrice && dom.inputPrice.value) {
                        calculateConversion(dom.inputPrice.value);
                    }
                }
            } catch (e) {
                console.log("Offline mode: Using default rate 0.22");
                rate = 0.22;
                isOnline = false;
                // Êñ∑Á∂≤È°ØÁ§∫
                if(dom.rateValue) dom.rateValue.innerHTML = `0.22<span class="rate-label-default">DEFAULT</span>`;
                updateStatusLight();
            }
        }

        function updateStatusLight() {
            const dom = getPrinterDom();
            if(!dom.statusLight) return;
            // Ê∏ÖÈô§ÊâÄÊúâÁãÄÊÖã
            dom.statusLight.className = 'status-light';
            
            if (dom.printBtn.classList.contains('processing')) {
                dom.statusLight.classList.add('processing');
            } else if (isOnline) {
                dom.statusLight.classList.add('online');
            } else {
                dom.statusLight.classList.add('offline');
            }
        }

        function getFormattedTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            return `${year}.${month}.${day} ${hours}:${minutes}`;
        }

        function updateHeaderTime() {
            const dom = getPrinterDom();
            if(dom.headerDate) dom.headerDate.innerText = getFormattedTime();
        }

        function toggleTopFeed() {
            const dom = getPrinterDom();
            isTopFeedExpanded = !isTopFeedExpanded;
            isTopFeedExpanded ? dom.feed.classList.add('expanded') : dom.feed.classList.remove('expanded');
        }

        function selectUser(btn, user) {
            document.querySelectorAll('.u-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentUser = user;
            renderReceiptList();
        }

        function toggleCurrency(e) {
            if(e) e.stopPropagation(); 
            const label = document.getElementById('curr-label');
            const dom = getPrinterDom();
            
            if (currentCurrency === 'JPY') {
                currentCurrency = 'TWD';
                label.innerText = 'TWD';
            } else {
                currentCurrency = 'JPY';
                label.innerText = 'JPY';
            }
            calculateConversion(dom.inputPrice.value);
        }

        function calculateConversion(val) {
            const dom = getPrinterDom();
            const num = parseFloat(val);
            if (isNaN(num) || num === 0) {
                dom.previewEmbed.innerText = (currentCurrency === 'JPY') ? '‚âà TWD 0' : '‚âà JPY 0';
                return;
            }
            if (currentCurrency === 'JPY') {
                const twd = Math.round(num * rate);
                dom.previewEmbed.innerText = `‚âà TWD ${twd.toLocaleString()}`;
            } else {
                const jpy = Math.round(num / rate);
                dom.previewEmbed.innerText = `‚âà JPY ${jpy.toLocaleString()}`;
            }
        }

        function printReceipt() {
            const dom = getPrinterDom();
            const itemVal = dom.inputItem.value || "Item " + receiptCount; 
            const inputVal = parseFloat(dom.inputPrice.value);

            if (isNaN(inputVal) || inputVal <= 0) {
                dom.inputPrice.focus();
                showToast("Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑÈáëÈ°ç (Price > 0)");
                return;
            }
            
            let finalJpy, finalTwd;
            if (currentCurrency === 'JPY') {
                finalJpy = inputVal;
                finalTwd = Math.round(inputVal * rate);
            } else {
                finalTwd = inputVal;
                finalJpy = Math.round(inputVal / rate);
            }

            if (dom.printBtn.classList.contains('processing')) return; 
            if (!expensesRef) return; // Guard for no firebase

            // Animation Start
            dom.printBtn.classList.add('processing');
            updateStatusLight(); // Update light to orange
            updateHeaderTime();

            // Simulate Print Delay then Add to Firestore
            setTimeout(() => {
                const newReceipt = {
                    user: currentUser, 
                    item: itemVal,
                    jpy: finalJpy,
                    twd: finalTwd,
                    timestamp: serverTimestamp()
                };
                
                addDoc(expensesRef, newReceipt).then(() => {
                    // Success handling
                    dom.inputItem.value = '';
                    dom.inputPrice.value = '';
                    calculateConversion(0); 

                    showToast(`‚úÖ Â∑≤Ë®òÈåÑ: ${newReceipt.item} (${currentCurrency === 'JPY' ? '¬•' + finalJpy : 'TWD' + finalTwd})`);

                    // Auto-Peek Logic
                    if (!isTopFeedExpanded) {
                        dom.feed.classList.add('expanded');
                        setTimeout(() => {
                            if (!isTopFeedExpanded) dom.feed.classList.remove('expanded');
                        }, 2500);
                    }

                    // Restore state
                    dom.printBtn.classList.remove('processing');
                    updateStatusLight(); 
                }).catch(err => {
                    console.error("Error adding doc:", err);
                    showToast("‚ùå Ë®òÈåÑÂ§±ÊïóÔºåË´ãÊ™¢Êü•ÈÄ£Á∑öÊàñÊ¨äÈôê„ÄÇ");
                    dom.printBtn.classList.remove('processing');
                    updateStatusLight();
                });

            }, 400); 
        }

        function initListInteractions() {
            const dom = getPrinterDom();
            const container = dom.listAnchor;
            if(!container) return;

            let startX = 0;
            let currentX = 0;
            let isDragging = false;
            let activeSwipeEl = null;

            container.addEventListener('click', (e) => {
                const entry = e.target.closest('.receipt-entry');
                if (e.target.closest('.delete-underlay i')) {
                    const id = entry.id.split('-')[1];
                    confirmDelete(id);
                    return;
                }
                
                if (entry && e.target.closest('.receipt-content')) {
                    document.querySelectorAll('.receipt-entry.reveal-delete').forEach(el => {
                        if (el !== entry) el.classList.remove('reveal-delete');
                    });
                    entry.classList.toggle('reveal-delete');
                }
            });

            container.addEventListener('touchstart', (e) => {
                const entry = e.target.closest('.receipt-entry');
                if (!entry) return;
                startX = e.touches[0].clientX;
                activeSwipeEl = entry;
                isDragging = true;
            }, {passive: true});

            container.addEventListener('touchmove', (e) => {
                if (!isDragging || !activeSwipeEl) return;
                const touchX = e.touches[0].clientX;
                currentX = touchX - startX;
                
                if (currentX < 0 && currentX > -100) {
                    const content = activeSwipeEl.querySelector('.receipt-content');
                    if(content) content.style.transform = `translate3d(${currentX}px, 0, 0)`;
                }
            }, {passive: true});

            container.addEventListener('touchend', (e) => {
                if (!activeSwipeEl) return;
                const content = activeSwipeEl.querySelector('.receipt-content');
                if (content) content.style.transform = ''; 

                if (currentX < -60) { 
                    document.querySelectorAll('.receipt-entry').forEach(el => el.classList.remove('reveal-delete'));
                    activeSwipeEl.classList.add('reveal-delete');
                } else if (currentX > 10) {
                    activeSwipeEl.classList.remove('reveal-delete');
                } else {
                    activeSwipeEl.classList.remove('reveal-delete');
                }
                isDragging = false;
                activeSwipeEl = null;
                currentX = 0;
            });
        }

        function confirmDelete(id) {
            const el = document.getElementById(`entry-${id}`);
            if(!el) return;
            el.classList.add('tearing');
            
            if (expensesRef) {
                setTimeout(() => {
                    deleteDoc(doc(expensesRef, id))
                        .then(() => showToast("üóëÔ∏è Á¥ÄÈåÑÂ∑≤ÊíïÊØÄ (Âà™Èô§)"))
                        .catch(err => {
                            console.error("Error removing doc:", err);
                            showToast("‚ùå Âà™Èô§Â§±Êïó");
                        });
                }, 400); 
            }
        }

        function renderReceiptList(animateNew = false) {
            const dom = getPrinterDom();
            updateTotalDisplay(receiptsData);

            if (receiptsData.length === 0) {
                dom.listEmpty.style.display = 'block';
                dom.listAnchor.innerHTML = '';
                return;
            } else {
                dom.listEmpty.style.display = 'none';
            }

            let html = '';
            receiptsData.forEach((r, index) => {
                const isFocused = (r.user === currentUser);
                const dimClass = isFocused ? '' : 'dimmed';
                
                // Add new-item class only to the first element if animateNew is true
                const animationClass = (index === 0 && animateNew) ? 'new-item' : '';

                html += `
                    <div class="receipt-entry ${dimClass} ${animationClass}" id="entry-${r.id}">
                        <div class="delete-underlay">
                            <i class="fa-solid fa-trash-can"></i>
                        </div>
                        <div class="receipt-content">
                            <div class="re-header">
                                <span>${r.date}</span>
                                <span>NO.${r.no}</span>
                            </div>
                            <div class="re-body">
                                <div>
                                    <span class="re-user">${r.user}</span>
                                    <span class="re-item">${r.item}</span>
                                </div>
                                <div class="re-cost">
                                    <div class="re-price">¬•${r.jpy.toLocaleString()}</div>
                                    <div class="re-sub">‚âà ${r.twd.toLocaleString()}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            dom.listAnchor.innerHTML = html;
        }

        function updateTotalDisplay(data) {
            const dom = getPrinterDom();
            const personalData = data.filter(r => r.user === currentUser);
            const personalJpy = personalData.reduce((sum, item) => sum + item.jpy, 0);
            const tripJpy = data.reduce((sum, item) => sum + item.jpy, 0);
            const tripTwd = data.reduce((sum, item) => sum + item.twd, 0);
            
            dom.totalLabel.innerText = `TOTAL (${currentUser})`;
            dom.totalPersonal.innerText = `¬•${personalJpy.toLocaleString()}`;
            dom.totalTrip.innerText = `¬•${tripJpy.toLocaleString()}`;

            dom.topTotalAmt.innerText = `¬•${tripJpy.toLocaleString()}`;
            dom.topTotalSub.innerText = `‚âà TWD ${tripTwd.toLocaleString()}`;
        }

        // --- CORE LOGIC FUNCTIONS (TRIP VIEW) ---
        function getMapUrl(data) {
             const base = `https://www.google.com/maps/embed/v1/`;
             if (data.location) return `${base}search?key=${GOOGLE_MAPS_API_KEY}&q=${encodeURIComponent(data.location)}`;
             if (data.from && data.to) return `${base}directions?key=${GOOGLE_MAPS_API_KEY}&origin=${encodeURIComponent(data.from)}&destination=${encodeURIComponent(data.to)}&mode=driving`;
             if (data.title) return `${base}search?key=${GOOGLE_MAPS_API_KEY}&q=${encodeURIComponent(data.title)}`;
             return null;
        }

        function createInfoItem(icon, label, value) {
            if (!value) return '';
            return `<div class="info-item"><div class="info-label"><i class="fa-solid ${icon}"></i><span>${label}</span></div><div class="info-value">${value}</div></div>`;
        }

        function centerDateNav(idx) {
            const nav = document.getElementById('date-nav');
            const activeEl = nav.children[idx];
            if (activeEl) {
                const navWidth = nav.clientWidth;
                const elLeft = activeEl.offsetLeft;
                const elWidth = activeEl.clientWidth;
                const targetLeft = elLeft - (navWidth / 2) + (elWidth / 2);
                nav.scrollTo({ left: targetLeft, behavior: 'smooth' });
            }
        }

        function renderTrip(direction = 0) {
            const nav = document.getElementById('date-nav');
            nav.innerHTML = tripData.map((d, i) => `<div class="d-item ${i === currentIdx ? 'active' : ''}" onclick="window.switchDay(${i})">
                        <div class="d-week">${d.week}</div>
                        <div class="d-num">${d.date.split('.')[1]}</div>
                        <div class="d-weather">
                            <i class="fa-solid ${d.weather.icon}"></i>
                            <span>${d.weather.temp}</span>
                        </div>
                    </div>
            `).join('');

            setTimeout(() => centerDateNav(currentIdx), 100);

            const day = tripData[currentIdx];
            const container = document.getElementById('timeline-container');
            
            let alertHtml = '';
            if (day.alert) {
                alertHtml = `<div class="alert-banner"><i class="fa-solid fa-triangle-exclamation" style="color:#D9333F; margin-top:3px;"></i><div style="margin-left:10px;"><div style="color:var(--accent-main); font-weight:500;">Êú¨Êó•ÂÆâÂÖ®Ë≠¶Á§∫</div><span class="alert-highlight">${day.alert}</span></div></div>`;
            }

            const imgUrl = day.heroImg || day.fallbackImg;
            const dailyLocations = day.events.filter(e => e.location).map(e => e.location);
            let dailyMapUrl = '';
            if (dailyLocations.length > 0) {
                if (dailyLocations.length === 1) {
                    dailyMapUrl = `https://www.google.com/maps/embed/v1/search?key=${GOOGLE_MAPS_API_KEY}&q=${encodeURIComponent(dailyLocations[0])}`;
                } else {
                    const origin = encodeURIComponent(dailyLocations[0]);
                    const destination = encodeURIComponent(dailyLocations[dailyLocations.length - 1]);
                    const waypoints = dailyLocations.slice(1, -1).map(l => encodeURIComponent(l)).join('|');
                    dailyMapUrl = `https://www.google.com/maps/embed/v1/directions?key=${GOOGLE_MAPS_API_KEY}&origin=${origin}&destination=${destination}&waypoints=${waypoints}&mode=driving`;
                }
            }

            const safeStringify = (obj) => {
                // Ensure double quotes are used for JSON
                return encodeURIComponent(JSON.stringify(obj)).replace(/'/g, "%27");
            };

            let html = `
                <div class="hero-card">
                    <img src="${imgUrl}" class="hero-img" onerror="this.onerror=null;this.src='${day.fallbackImg}';">
                    <div class="hero-overlay">
                        <div class="hero-title">${day.heroTitle}</div>
                    </div>
                </div>
                ${alertHtml}
            `;

            if (dailyMapUrl) {
                html += `
                    <div class="map-overview-card" style="margin-bottom: 30px;">
                        <div style="font-size: 0.8rem; color: #888; margin-bottom: 10px; display:flex; align-items:center; gap:6px;">
                            <i class="fa-solid fa-route" style="color:var(--accent-gold);"></i>
                            <span>Êú¨Êó•Ë∑ØÁ∑öÈ†êË¶Ω Route Preview</span>
                        </div>
                        <iframe class="map-iframe" style="height: 200px;" src="${dailyMapUrl}" allowfullscreen loading="lazy"></iframe>
                    </div>
                `;
            }

            html += `<div class="timeline-block">`;

            html += day.events.map((ev, i) => {
                const data = safeStringify(ev); 
                const delay = i * 0.1;
                let icon = 'fa-circle';
                if (ev.tag === 'Transport' || ev.tag === 'Drive' || ev.tag === 'Flight') icon = 'fa-car-side';
                if (ev.tag === 'Hotel') icon = 'fa-bed';
                if (ev.tag === 'Shopping') icon = 'fa-bag-shopping';
                if (ev.tag === 'Food') icon = 'fa-utensils';
                if (ev.tag.match(/Sightseeing|Nature|Art|Experience|ÊôØÈªû/)) icon = 'fa-map-pin';
                if (ev.tag.match(/Activity|Relax|Culture|È´îÈ©ó/)) icon = 'fa-person-skiing';
                if (ev.tag === 'Flight') icon = 'fa-plane';
                if (ev.tag === 'Arrival') icon = 'fa-plane-arrival'; 
                
                const cardClass = (ev.tag === 'Transport' || ev.tag === 'Drive' || ev.tag === 'Flight') ? 'transport-card' : '';

                return `<div class="event-node visible" style="transition-delay: ${delay}s">
                            <div class="time-dot"></div>
                            <div class="event-card ${cardClass}" onclick="window.openDetail('${data}', ${currentIdx}, ${i})">
                                <div style="display:flex; justify-content:space-between; align-items:center;">
                                    <span class="event-tag">${ev.tag}</span>
                                    <span style="font-family: var(--font-serif); font-weight: 700; color: var(--accent-red); font-size: 1.1rem;">${ev.time}</span>
                                </div>
                                <div class="event-title">${ev.title}</div>
                                <div style="font-size:0.7rem; color:#888; margin-top:5px; display:flex; align-items:center; gap:8px;">
                                    <i class="fa-solid ${icon}"></i> 
                                    <span>${ev.desc}</span>
                                </div>
                            </div>
                        </div>
                `;
            }).join('');
            html += `</div>`;

            // Spring Animation Logic
            container.className = "container";
            if (direction === 0) {
                container.innerHTML = html;
            } else {
                container.innerHTML = html;
                if (direction === 1) container.classList.add('slide-in-from-left');
                else if (direction === -1) container.classList.add('slide-in-from-right');
            }
        }

        function checkActiveEvent() {
            const now = new Date();
            let activeDayIndex = -1;
            tripData.forEach((day, idx) => {
                const year = now.getFullYear();
                // Assumes trip dates are in the current year, or uses 2026 as placeholder
                const tripDate = new Date(`${year}-${day.date.replace('.', '-')}`); 
                const currentDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                if (tripDate.toDateString() === currentDate.toDateString()) activeDayIndex = idx;
            });
            
            if (activeDayIndex === -1) return;

            const currentDayEvents = tripData[activeDayIndex].events;
            const currentHour = now.getHours();
            const currentMin = now.getMinutes();
            const currentTimeVal = currentHour * 60 + currentMin;

            document.querySelectorAll('.active-event').forEach(el => el.classList.remove('active-event'));
            document.querySelectorAll('.active-label').forEach(el => el.remove());

            if (currentIdx === activeDayIndex) {
                 currentDayEvents.forEach((ev, idx) => {
                    const [h, m] = ev.time.split(':').map(Number);
                    const eventTimeVal = h * 60 + m;
                    let nextEventTimeVal = 9999;
                    if (idx < currentDayEvents.length - 1) {
                        const [nh, nm] = currentDayEvents[idx+1].time.split(':').map(Number);
                        nextEventTimeVal = nh * 60 + nm;
                    } else nextEventTimeVal = eventTimeVal + 90;

                    if (currentTimeVal >= eventTimeVal && currentTimeVal < nextEventTimeVal) {
                        const card = document.querySelectorAll('.event-node')[idx];
                        if(card) {
                            card.classList.add('active-event');
                            const tag = card.querySelector('.event-tag');
                            if(tag && !card.querySelector('.active-label')) tag.innerHTML += `<span class="active-label">LIVE</span>`;
                            if (!window.hasScrolledToLive) {
                                card.scrollIntoView({behavior: "smooth", block: "center"});
                                window.hasScrolledToLive = true;
                            }
                        }
                    }
                 });
            }
        }

        function switchView(view, btn) {
            document.querySelectorAll('.view-section').forEach(el => {
                el.classList.add('hidden');
                el.style.display = 'none';
            });

            const target = document.getElementById('view-' + view);
            if(target) {
                target.classList.remove('hidden');
                target.style.display = 'block';
            }

            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            if(btn) {
                btn.classList.add('active');
            } else {
                const map = {'trip':0, 'wallet':1, 'trans':2, 'info':3};
                const navs = document.querySelectorAll('.nav-btn');
                if(navs[map[view]]) navs[map[view]].classList.add('active');
            }
            
            // Toggle Header Style
            const header = document.getElementById('app-header');
            if(view === 'wallet') { 
                document.getElementById('view-wallet').classList.add('wallet-mode'); // For header scoping via CSS
                header.classList.add('wallet-mode-header'); // Simpler toggle if needed
                
                // Initialize Printer Logic
                updateHeaderTime();
                if(isOnline) fetchExchangeRate();
            } else {
                header.classList.remove('wallet-mode-header');
            }
            
            if(view === 'info') {
                renderFullTripMap();
            }
            
            window.scrollTo(0,0);
        }

        function switchDay(i) {
            if (isAnimating) return;
            const tripView = document.getElementById('view-trip');
            const isHidden = tripView.classList.contains('hidden') || tripView.style.display === 'none';
            if(i === currentIdx && !isHidden) return;
            const direction = i > currentIdx ? -1 : 1;
            currentIdx = i;
            if (isHidden) {
                switchView('trip'); 
                renderTrip(0); 
                checkActiveEvent();
            } else {
                isAnimating = true;
                renderTrip(direction);
                checkActiveEvent();
                setTimeout(() => { isAnimating = false; }, 350); 
            }
        }

        // --- GESTURE SETUP ---
        function setupGestures() {
            const tripView = document.getElementById('view-trip');
            let startX = 0;
            let startY = 0;
            let currentTranslate = 0;
            let isDragging = false;
            let isHorizontalDrag = false;

            tripView.addEventListener('touchstart', (e) => {
                if (isAnimating) return; 
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
                isDragging = true;
                isHorizontalDrag = false;
                const container = document.getElementById('timeline-container');
                container.style.transition = 'none';
            }, { passive: true });

            tripView.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                const currentX = e.touches[0].clientX;
                const currentY = e.touches[0].clientY;
                const diffX = currentX - startX;
                const diffY = currentY - startY;

                if (!isHorizontalDrag) {
                    if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 10) isHorizontalDrag = true;
                    else if (Math.abs(diffY) > Math.abs(diffX) && Math.abs(diffY) > 10) { isDragging = false; return; }
                }

                if (isHorizontalDrag) {
                    if ((currentIdx === 0 && diffX > 0) || (currentIdx === tripData.length - 1 && diffX < 0)) currentTranslate = diffX * 0.3;
                    else currentTranslate = diffX;
                    const container = document.getElementById('timeline-container');
                    container.style.transform = `translateX(${currentTranslate}px)`;
                }
            }, { passive: true });

            tripView.addEventListener('touchend', (e) => {
                if (!isDragging || !isHorizontalDrag) {
                    document.getElementById('timeline-container').style.transition = '';
                    return;
                }
                isDragging = false;
                const container = document.getElementById('timeline-container');
                container.style.transition = 'transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.35s ease';
                const threshold = window.innerWidth * 0.25; 
                if (Math.abs(currentTranslate) > threshold) {
                    if (currentTranslate > 0 && currentIdx > 0) switchDay(currentIdx - 1);
                    else if (currentTranslate < 0 && currentIdx < tripData.length - 1) switchDay(currentIdx + 1);
                    else container.style.transform = 'translateX(0)';
                } else container.style.transform = 'translateX(0)';
                currentTranslate = 0;
            });
        }

        function renderFullTripMap() {
            const mapIframe = document.getElementById('trip-map-overview-iframe');
            if(mapIframe) {
                const centerLat = 40.7;
                const centerLng = 140.7;
                const zoom = 8;
                const viewUrl = `https://www.google.com/maps/embed/v1/view?key=${GOOGLE_MAPS_API_KEY}&center=${centerLat},${centerLng}&zoom=${zoom}`;
                mapIframe.src = viewUrl;
            }
        }

        async function setupFirebase() { 
            try {
                // Use runtime provided config/token structure reliably
                const envConfig = typeof __firebase_config !== 'undefined' ? __firebase_config : '{}';
                let configToUse;
                try {
                    configToUse = JSON.parse(envConfig);
                } catch (e) {
                    console.error("Failed to parse firebase config:", e);
                    configToUse = {};
                }

                if (!configToUse.apiKey) {
                    console.warn("Firebase config missing. Running in offline/demo mode.");
                    renderTrip();
                    setupGestures();
                    return;
                }

                const app = initializeApp(configToUse);
                db = getFirestore(app);
                auth = getAuth(app);
                
                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

                if (initialAuthToken) {
                    try { await signInWithCustomToken(auth, initialAuthToken); } 
                    catch (e) { await signInAnonymously(auth); }
                } else await signInAnonymously(auth);

                const userId = auth.currentUser?.uid || crypto.randomUUID(); 
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

                notesRef = collection(db, `artifacts/${appId}/public/data/notes`);
                expensesRef = collection(db, `artifacts/${appId}/public/data/expenses`);
                
                subscribeToExpenses();
                subscribeToNotes();

            } catch (error) {
                console.error("Firebase Initialization Error:", error);
                renderTrip();
                setupGestures();
            }
        }

        function startDynamicText() {
            const textElement = document.getElementById('dynamic-intro-text');
            const hour = new Date().getHours();
            let key = 'rest'; 
            if (hour >= 8 && hour <= 17) key = 'work';
            else if (hour >= 18 && hour <= 23) key = 'evening';
            const messages = timeSensitiveMessages[key];
            const msg = messages[Math.floor(Math.random() * messages.length)];
            textElement.innerText = msg;
            textElement.style.opacity = 1;
        }

        function getIconClass(wmoCode) {
            if (wmoCode === 0) return "fa-sun";
            if (wmoCode >= 1 && wmoCode <= 3) return "fa-cloud-sun";
            if (wmoCode === 45 || wmoCode === 48) return "fa-smog";
            if (wmoCode >= 51 && wmoCode <= 55) return "fa-cloud-rain";
            if (wmoCode >= 61 && wmoCode <= 65) return "fa-cloud-showers-heavy";
            if (wmoCode >= 71 && wmoCode <= 77) return "fa-snowflake";
            if (wmoCode >= 80 && wmoCode <= 82) return "fa-cloud-rain";
            if (wmoCode >= 95 && wmoCode <= 99) return "fa-bolt";
            return "fa-cloud";
        }

        function getMonday(d) {
            d = new Date(d);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); 
            return new Date(d.setDate(diff));
        }

        async function fetchWeather() {
            // Updated Weather Logic: 
            // If today is before trip start, fetch current week's weather for preview.
            // If trip has started or is past, fetch for trip dates.
            try {
                const tripStart = new Date("2026-02-02");
                const tripEnd = new Date("2026-02-07");
                const today = new Date();
                
                let fetchStart, fetchEnd;
                let isPreview = false;

                if (today < tripStart) {
                    // Preview mode: Fetch from today for next 6 days
                    fetchStart = today;
                    fetchEnd = new Date(today);
                    fetchEnd.setDate(today.getDate() + 5);
                    isPreview = true;
                } else {
                    // Trip mode
                    fetchStart = tripStart;
                    fetchEnd = tripEnd;
                }
                
                const formatDate = (date) => date.toISOString().split('T')[0];
                const startStr = formatDate(fetchStart);
                const endStr = formatDate(fetchEnd);

                const urlHakodate = `https://api.open-meteo.com/v1/forecast?latitude=41.7687&longitude=140.7290&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo&start_date=${startStr}&end_date=${endStr}`;
                const urlAomori = `https://api.open-meteo.com/v1/forecast?latitude=40.8244&longitude=140.7400&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo&start_date=${startStr}&end_date=${endStr}`;

                const [resHak, resAom] = await Promise.all([
                    fetch(urlHakodate).then(r => r.json()),
                    fetch(urlAomori).then(r => r.json())
                ]);

                if (!resHak.daily || !resAom.daily) throw new Error("Weather API data incomplete");

                tripData.forEach((day, index) => {
                    let source = (index === 0) ? resHak : resAom;
                    if(index >= 2) source = resAom; 
                    
                    let i = index; 
                    // If preview mode, just map sequential days from API response to trip days for display
                    if (isPreview) {
                        // Just map 0..5 from API result to Day 1..6
                        if (i >= source.daily.time.length) i = source.daily.time.length - 1; 
                    }

                    if(source.daily.temperature_2m_max[i] !== undefined) {
                        const max = Math.round(source.daily.temperature_2m_max[i]);
                        const min = Math.round(source.daily.temperature_2m_min[i]);
                        const code = source.daily.weather_code[i];
                        day.weather = { icon: getIconClass(code), temp: `${min}¬∞ / ${max}¬∞` };
                    }
                });

                if(currentIdx !== -1) renderTrip();
                
            } catch (e) { 
                console.error("Weather Fetch Error:", e); 
                tripData.forEach(day => {
                    if(day.weather.icon.includes('spin')) day.weather = { icon: "fa-cloud-meatball", temp: "N/A" };
                });
                renderTrip();
            }
        }

        function enterApp() {
            document.getElementById('intro-screen').style.transform = 'translateY(-100%)';
            renderTrip();
            setupGestures(); 
            fetchWeather(); 
            renderFullTripMap();
            // Init Printer Logic
            fetchExchangeRate();
            updateHeaderTime();
            initListInteractions();
            window.hasScrolledToLive = false;
            checkActiveEvent();
            setInterval(checkActiveEvent, 60000); 
        }

        function toggleEditNote() {
            const descEl = document.getElementById('m-desc');
            const editEl = document.getElementById('m-note-edit');
            const inputEl = document.getElementById('m-note-input');
            if (editEl.classList.contains('hidden')) {
                inputEl.value = descEl.innerText.trim();
                descEl.classList.add('hidden');
                editEl.classList.remove('hidden');
            } else {
                editEl.classList.add('hidden');
                descEl.classList.remove('hidden');
            }
        }

        function saveNote() {
            const newText = document.getElementById('m-note-input').value;
            if (!currentEventId || !notesRef) return;
            const descEl = document.getElementById('m-desc');
            
            if(descEl) descEl.innerHTML = newText.replace(/\n/g, '<br>'); 
            document.getElementById('m-note-edit').classList.add('hidden');
            if(descEl) descEl.classList.remove('hidden');
            
            showToast("üìù Á≠ÜË®òÂ∑≤ÂÑ≤Â≠ò");

            try { setDoc(doc(notesRef, currentEventId), { text: newText.replace(/\n/g, '<br>'), updatedAt: serverTimestamp() }); } catch (error) { console.error("Error saving note:", error); }
        }

        async function translateNow() {
            const input = document.getElementById('trans-input').value.trim();
            const outputBox = document.getElementById('trans-output-box');
            const resultEl = document.getElementById('trans-jp-result');

            if (!input) return;

            document.getElementById('trans-zh').innerText = input;
            resultEl.innerHTML = "<i class='fa-solid fa-spinner fa-spin'></i> Ê≠£Âú®ÁøªË≠Ø...";
            outputBox.classList.remove('hidden');

            const systemPrompt = "You are a professional travel translator. Translate the Chinese text into natural, formal Japanese (polite form, using „Åß„Åô/„Åæ„Åô). Respond only with the translated Japanese text. Do not include any explanations or formatting.";
            const userQuery = `Translate the following Chinese text to Japanese: "${input}"`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            try {
                const response = await fetchWithRetry(TRANSLATE_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const translatedText = result.candidates?.[0]?.content?.parts?.[0]?.text || "ÁøªË≠ØÂ§±ÊïóÔºåË´ãÊ™¢Êü•Ëº∏ÂÖ•ÊàñÁ∂≤Ë∑ØÈÄ£Á∑ö„ÄÇ";
                
                resultEl.innerText = translatedText;
                showToast("ÁøªË≠ØÂÆåÊàêÔºÅË´ãÈªûÊìäÂ≠óÂç°„ÄÇ");

            } catch (error) {
                console.error("Gemini Translation Error:", error);
                resultEl.innerText = "ÈÄ£Á∑öÂ§±ÊïóÔºåË´ãÊ™¢Êü•Á∂≤Ë∑Ø„ÄÇË´ãÊö´ÊôÇ‰ΩøÁî®‰∏ãÊñπÂ∏∏Áî®Â≠óÂç°„ÄÇ";
                showToast("‚ùå ÁøªË≠ØÈÄ£Á∑öÂ§±Êïó");
            }
        }
        
        function openExternalMap() {
            const mTitle = document.getElementById('m-title');
            const currentTitle = mTitle ? mTitle.innerText : '';
            if(currentTitle) window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(currentTitle)}`, '_blank');
        }

        function openNavigation() {
            if(currentNavLink) window.open(currentNavLink, '_blank');
        }
        
        function copyMapCode() {
            const mcEl = document.getElementById('m-mapcode');
            const code = mcEl ? mcEl.innerText : '';
            if (!code) return;
            const textArea = document.createElement('textarea');
            textArea.value = code;
            document.body.appendChild(textArea);
            textArea.select();
            try { 
                document.execCommand('copy'); 
                showToast("üìã MapCode Â∑≤Ë§áË£Ω!");
            } catch (err) { 
                console.error('Failed to copy MapCode:', err); 
            }
            document.body.removeChild(textArea);
        }

        // --- ENHANCED FULL SCREEN MODAL LOGIC ---
        function showFs(jp, cn, type) {
            document.getElementById('fs-jp').innerText = jp;
            document.getElementById('fs-cn').innerText = cn;
            
            const ctrlContainer = document.getElementById('fs-controls');
            ctrlContainer.innerHTML = ''; // Clear previous controls

            // --- Logic for Checkout Type ---
            if (type === 'checkout') {
                const btnTogether = document.createElement('button');
                btnTogether.className = 'fs-ctrl-btn active';
                btnTogether.innerText = '‰∏ÄËµ∑‰ªò';
                
                const btnSeparate = document.createElement('button');
                btnSeparate.className = 'fs-ctrl-btn';
                btnSeparate.innerText = 'ÂàÜÈñã‰ªò';

                const updateText = (mode) => {
                    if (mode === 'together') {
                        document.getElementById('fs-jp').innerText = '„Åä‰ºöË®à„ÅØ‰∏ÄÁ∑í„Åß„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ';
                        document.getElementById('fs-cn').innerText = 'Ë´ãÂπ´Êàë‰∏ÄËµ∑ÁµêÂ∏≥';
                        btnTogether.classList.add('active');
                        btnSeparate.classList.remove('active');
                    } else {
                        document.getElementById('fs-jp').innerText = '„Åä‰ºöË®à„ÅØÂà•„ÄÖ„Åß„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ';
                        document.getElementById('fs-cn').innerText = 'Ë´ãÂπ´ÊàëÂàÜÈñãÁµêÂ∏≥';
                        btnSeparate.classList.add('active');
                        btnTogether.classList.remove('active');
                    }
                };

                btnTogether.onclick = (e) => { e.stopPropagation(); updateText('together'); };
                btnSeparate.onclick = (e) => { e.stopPropagation(); updateText('separate'); };

                ctrlContainer.appendChild(btnTogether);
                ctrlContainer.appendChild(btnSeparate);
            }

            // --- Logic for Quantity Type ---
            if (type === 'quantity') {
                currentQuantity = 1;
                
                const wrapper = document.createElement('div');
                wrapper.className = 'fs-qty-ctrl';
                
                const btnMinus = document.createElement('button');
                btnMinus.className = 'fs-qty-btn';
                btnMinus.innerText = '-';
                
                const valDisplay = document.createElement('div');
                valDisplay.className = 'fs-qty-val';
                valDisplay.innerText = '1';
                
                const btnPlus = document.createElement('button');
                btnPlus.className = 'fs-qty-btn';
                btnPlus.innerText = '+';

                const updateQty = (delta) => {
                    let newQ = currentQuantity + delta;
                    if (newQ < 1) newQ = 1;
                    if (newQ > 20) newQ = 20;
                    currentQuantity = newQ;
                    valDisplay.innerText = newQ;
                    document.getElementById('fs-jp').innerText = `„Åì„Çå„Çí ${newQ} ÂÄã„Åè„Å†„Åï„ÅÑ„ÄÇ`;
                    document.getElementById('fs-cn').innerText = `ÊàëË¶Å ${newQ} ÂÄãÈÄôÂÄã`;
                };

                btnMinus.onclick = (e) => { e.stopPropagation(); updateQty(-1); };
                btnPlus.onclick = (e) => { e.stopPropagation(); updateQty(1); };
                
                // Prevent modal close on click
                wrapper.onclick = (e) => e.stopPropagation();

                wrapper.appendChild(btnMinus);
                wrapper.appendChild(valDisplay);
                wrapper.appendChild(btnPlus);
                ctrlContainer.appendChild(wrapper);
            }

            document.getElementById('fs-text-modal').classList.add('active');
        }

        function closeFs() {
            document.getElementById('fs-text-modal').classList.remove('active');
        }

        function closeModal() {
            document.getElementById('detail-modal').classList.remove('active');
            document.querySelector('.modal-overlay').classList.remove('active');
            currentEventId = null;
        }

        function openDetail(dataStr, dayIdx, eventIdx) {
            const data = JSON.parse(decodeURIComponent(dataStr));
            currentEventId = `d${dayIdx}_e${eventIdx}`;
            
            const mTitle = document.getElementById('m-title');
            if(mTitle) mTitle.innerText = data.title;
            
            let displayNote = data.detail || data.desc;
            if(localNotes[currentEventId]) displayNote = localNotes[currentEventId];
            
            const mDesc = document.getElementById('m-desc');
            if(mDesc) mDesc.innerHTML = displayNote; 
            
            const mNoteEdit = document.getElementById('m-note-edit');
            if(mNoteEdit) mNoteEdit.classList.add('hidden');
            if(mDesc) mDesc.classList.remove('hidden');

            const mTag = document.getElementById('m-tag');
            if(mTag) mTag.innerText = data.tag;
            
            const mImg = document.getElementById('m-img');
            if(mImg) {
                mImg.src = data.img || tripData[dayIdx].heroImg || tripData[dayIdx].fallbackImg || 'https://placehold.co/800x600?text=No+Preview';
                if(!data.img && !tripData[dayIdx].heroImg) mImg.style.display = 'none';
                else mImg.style.display = 'block';
            }

            const infoGroup = document.getElementById('m-detail-info');
            let infoHtml = '';
            const headerHtml = `<h3 class="serif" style="font-size: 1.2rem; margin-bottom: 15px; color: var(--accent-main);">È†êË®Ç / ‰∫§ÈÄöË≥áË®ä</h3>`;

            if (data.reservation_info) {
                const res = data.reservation_info;
                infoGroup.classList.remove('hidden');
                infoHtml += createInfoItem('fa-hashtag', 'È†êË®ÇÁ∑®Ëôü', res.number);
                infoHtml += createInfoItem('fa-user', 'È†êË®Ç‰∫∫', res.name);
                infoHtml += createInfoItem('fa-calendar-check', 'ÂÖ•‰Ωè/ÊôÇÈñì', res.check_in || res.departure);
                infoHtml += createInfoItem('fa-users', '‰∫∫Êï∏', res.guests);
            } 
            
            if (data.transport_info) {
                const trans = data.transport_info;
                infoGroup.classList.remove('hidden');
                infoHtml += createInfoItem('fa-train-subway', 'È°ûÂûã', trans.type);
                infoHtml += createInfoItem('fa-clock', 'Âá∫Áôº', trans.departure);
                infoHtml += createInfoItem('fa-clock-rotate-left', 'È†êË®àÊôÇÈï∑', trans.time_estimate);
                infoHtml += createInfoItem('fa-road', 'ÂÇôË®ª', trans.note);
            } 
            
            if (!data.reservation_info && !data.transport_info) infoGroup.classList.add('hidden');
            infoGroup.innerHTML = headerHtml + infoHtml;

            const mapSec = document.getElementById('m-map-section');
            if (data.nav && data.nav.mapcode) {
                mapSec.classList.remove('hidden');
                const mcEl = document.getElementById('m-mapcode');
                if(mcEl) mcEl.innerText = data.nav.mapcode;
            } else mapSec.classList.add('hidden');
            
            currentNavLink = data.navLink;
            const btnNavigate = document.getElementById('btn-navigate');
            if(currentNavLink) btnNavigate.classList.remove('hidden');
            else btnNavigate.classList.add('hidden');

            const gmapPreview = document.getElementById('m-gmap-preview');
            const gmapIframe = document.getElementById('m-gmap-iframe');
            const mapUrl = getMapUrl(data);
            
            if (mapUrl) {
                gmapPreview.classList.remove('hidden');
                gmapIframe.src = mapUrl;
            } else gmapPreview.classList.add('hidden');

            document.getElementById('detail-modal').classList.add('active');
            document.querySelector('.modal-overlay').classList.add('active');
        }

        // Export Functions
        window.enterApp = enterApp;
        window.switchView = switchView;
        window.switchDay = switchDay;
        window.translateNow = translateNow;
        window.showFs = showFs;
        window.closeFs = closeFs;
        window.toggleEditNote = toggleEditNote;
        window.saveNote = saveNote;
        window.openDetail = openDetail;
        window.openExternalMap = openExternalMap;
        window.openNavigation = openNavigation;
        window.copyMapCode = copyMapCode;
        window.closeModal = closeModal;
        window.renderTrip = renderTrip; 
        window.checkActiveEvent = checkActiveEvent; 
        
        // Export Receipt Printer Functions
        window.toggleTopFeed = toggleTopFeed;
        window.selectUser = selectUser;
        window.toggleCurrency = toggleCurrency;
        window.calculateConversion = calculateConversion;
        window.printReceipt = printReceipt;

        window.onload = function() {
            createSnow(); 
            setupFirebase();
            const start = new Date("2026-02-02").getTime();
            const now = new Date().getTime();
            const days = Math.ceil((start - now) / (1000 * 60 * 60 * 24));
            
            const daysLeftEl = document.getElementById('days-left');
            if(daysLeftEl) daysLeftEl.innerText = days > 0 ? days : 0;
            
            const headerDaysEl = document.getElementById('header-days');
            if(headerDaysEl) headerDaysEl.innerText = days > 0 ? days : 0;
            
            const tripView = document.getElementById('view-trip');
            if(tripView) tripView.style.display = 'block'; 
            
            // Init Printer
            updateHeaderTime();
            initListInteractions();
            fetchExchangeRate();

            setTimeout(startDynamicText, 1000);
        };
        
    </script>
</body>
</html>
