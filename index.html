<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>L'VOYAGE | é’æ£®å‡½é¤¨ è˜‹æœä¹‹æ—…</title>
    <meta name="theme-color" content="#1C2541">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Noto+Serif+TC:wght@300;500;700&family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Palette: Luxury Winter */
            --bg-body: #F9F8F4;
            --bg-card: #FFFFFF;
            --text-primary: #1A1A1A;
            --text-secondary: #666666;
            --accent-main: #1C2541; /* åˆå¤œè— */
            --accent-gold: #B49B67; /* é¦™æª³é‡‘ */
            --accent-red: #D9333F; /* é’æ£®ç´… */
            --line-light: #E0E0E0;
            --shadow-soft: 0 10px 40px -10px rgba(0,0,0,0.08);
            --font-serif: 'Cormorant Garamond', 'Noto Serif TC', serif;
            --font-sans: 'Noto Sans TC', sans-serif;
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; padding: 0;
            background-color: var(--bg-body);
            color: var(--text-primary);
            font-family: var(--font-sans);
            padding-bottom: calc(100px + var(--safe-bottom)); /* å¢åŠ åº•éƒ¨ç©ºé–“çµ¦å››å€‹æŒ‰éˆ• */
            overflow-x: hidden;
        }

        h1, h2, h3, .serif { font-family: var(--font-serif); }
        .hidden { display: none !important; }

        /* --- INTRO --- */
        #intro-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background: var(--accent-main); color: white;
            z-index: 9999; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            transition: transform 1s cubic-bezier(0.77, 0, 0.175, 1);
        }
        .intro-countdown-block { margin-bottom: 40px; opacity: 0; animation: fadeIn 1.5s ease forwards 0.3s; text-align: center; }
        .countdown-value { font-size: 5rem; line-height: 1; font-weight: 300; color: var(--accent-gold); font-family: var(--font-serif); }
        .intro-btn {
            margin-top: 50px; padding: 15px 40px; border: 1px solid rgba(255,255,255,0.3);
            background: transparent; color: white; font-family: var(--font-serif);
            font-size: 1.1rem; letter-spacing: 2px; cursor: pointer; transition: 0.3s;
            opacity: 0; animation: fadeIn 1.5s ease forwards 1s;
        }
        @keyframes fadeIn { to { opacity: 1; } }

        /* --- HEADER --- */
        .elegant-header {
            padding: 40px 20px 20px;
            background: linear-gradient(to bottom, #F9F8F4 90%, rgba(249,248,244,0));
            position: sticky; top: 0; z-index: 100;
        }
        .top-meta { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px; }
        .brand { font-family: var(--font-serif); font-size: 1.4rem; font-weight: 700; letter-spacing: 1px; color: var(--accent-main); }
        
        .status-value { font-family: var(--font-serif); font-size: 2rem; line-height: 1; color: var(--accent-gold); text-align: right; }
        .status-label { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 2px; color: var(--text-secondary); text-align: right; margin-top: 5px; }

        /* DATE SCROLLER */
        .date-scroller { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
        .date-scroller::-webkit-scrollbar { display: none; }
        .d-item { 
            min-width: 60px; text-align: center; opacity: 0.4; transition: 0.4s; cursor: pointer; 
            display: flex; flex-direction: column; align-items: center;
        }
        .d-item.active { opacity: 1; transform: scale(1.1); }
        .d-week { font-size: 0.7rem; letter-spacing: 1px; margin-bottom: 5px; text-transform: uppercase; }
        .d-num { font-family: var(--font-serif); font-size: 1.5rem; position: relative; }
        .d-item.active .d-num::after {
            content: ''; position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; background: var(--accent-gold); border-radius: 50%;
        }

        /* --- TRIP VIEW --- */
        .container { padding: 0 20px; max-width: 600px; margin: 0 auto; }
        
        .hero-card {
            position: relative; height: 280px; border-radius: 4px; overflow: hidden; margin-bottom: 30px;
            box-shadow: var(--shadow-soft);
        }
        .hero-img { width: 100%; height: 100%; object-fit: cover; transition: transform 10s ease; }
        .hero-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%; padding: 25px;
            background: linear-gradient(to top, rgba(28,37,65,0.9), transparent); color: white;
        }
        .hero-title { font-size: 1.6rem; margin: 0; line-height: 1.3; font-weight: 500; color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }

        .timeline-block { position: relative; padding-left: 20px; border-left: 1px solid var(--line-light); margin-left: 10px; }
        .event-node { margin-bottom: 35px; position: relative; opacity: 0; transform: translateY(20px); transition: 0.6s ease; }
        .event-node.visible { opacity: 1; transform: translateY(0); }
        
        .time-dot { 
            position: absolute; left: -25px; top: 0; width: 9px; height: 9px; 
            background: var(--bg-body); border: 2px solid var(--accent-main); border-radius: 50%; 
        }
        .event-card {
            background: var(--bg-card); padding: 20px; border-radius: 4px;
            box-shadow: var(--shadow-soft); cursor: pointer; transition: 0.3s;
            border-bottom: 2px solid transparent;
        }
        .event-card:active { transform: scale(0.98); }
        .event-tag { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 2px; color: var(--text-secondary); margin-bottom: 8px; display: block; }
        .event-title { font-family: var(--font-serif); font-size: 1.25rem; margin-bottom: 6px; color: var(--accent-main); font-weight: 700; }
        
        .alert-banner {
            background: rgba(217, 51, 63, 0.08); border-left: 3px solid var(--accent-red);
            padding: 15px; margin-bottom: 30px; border-radius: 0 4px 4px 0;
            display: flex; gap: 12px; align-items: flex-start;
        }
        .alert-highlight { color: var(--accent-red); font-weight: 700; display: block; margin-top: 4px; font-size: 0.85rem;}

        /* --- WALLET VIEW --- */
        .wallet-card { background: white; padding: 25px; border-radius: 8px; box-shadow: var(--shadow-soft); margin-bottom: 20px; }
        .rate-badge {
            background: #E8F5E9; color: #2E7D32; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; 
            display: inline-block; margin-bottom: 10px; font-weight: bold;
        }
        .input-group { margin-bottom: 20px; }
        .input-elegant { 
            width: 100%; border: none; border-bottom: 1px solid var(--line-light); 
            padding: 15px 0; font-size: 1.1rem; background: transparent; outline: none; border-radius: 0;
        }
        .twd-preview { font-size: 0.9rem; color: var(--accent-gold); margin-top: 5px; text-align: right; font-weight: 500;}
        
        .user-selector { display: flex; gap: 10px; margin-bottom: 20px; }
        .user-btn {
            flex: 1; padding: 10px; border: 1px solid var(--line-light); border-radius: 4px;
            background: transparent; color: var(--text-secondary); cursor: pointer; transition: 0.2s;
            font-family: var(--font-serif); font-size: 1rem;
        }
        .user-btn.active { background: var(--accent-main); color: white; border-color: var(--accent-main); }
        
        .expense-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #EEE; align-items: center; }
        .exp-user { 
            width: 30px; height: 30px; border-radius: 50%; background: var(--accent-main); color: white;
            display: flex; justify-content: center; align-items: center; font-size: 0.7rem; margin-right: 10px;
        }
        .exp-meta { display: flex; align-items: center; }
        .exp-time { font-size: 0.7rem; color: #999; margin-left: 8px; }

        /* --- TRANSLATE VIEW --- */
        .trans-input-area { background: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow-soft); margin-bottom: 30px; }
        .trans-btn { width: 100%; padding: 15px; background: var(--accent-main); color: white; border: none; margin-top: 15px; cursor: pointer; border-radius: 4px; }
        .ps-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .ps-card {
            background: white; padding: 20px 15px; border-radius: 8px; box-shadow: var(--shadow-soft);
            text-align: center; border: 1px solid #EEE; cursor: pointer; transition: 0.2s;
        }
        .ps-card:active { transform: scale(0.98); border-color: var(--accent-gold); }
        .ps-icon { font-size: 1.8rem; margin-bottom: 10px; display: block; }
        .ps-title { font-size: 0.9rem; font-weight: 600; }

        /* --- INFO VIEW --- */
        .info-card { background: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow-soft); margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; }
        .info-icon { width: 40px; height: 40px; border-radius: 50%; background: #F5F5F5; display: flex; justify-content: center; align-items: center; color: var(--accent-main); margin-right: 15px; }
        .info-text h3 { margin: 0; font-size: 1rem; color: var(--text-primary); }
        .info-text p { margin: 5px 0 0; font-size: 0.8rem; color: var(--text-secondary); }
        
        /* Map Overview Style */
        .map-overview-card {
            background: white; padding: 15px; border-radius: 8px; box-shadow: var(--shadow-soft); margin-bottom: 20px;
        }
        .map-overview-img { width: 100%; height: 200px; object-fit: cover; border-radius: 4px; cursor: pointer; }


        /* --- NAV BAR --- */
        .glass-nav {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 95%; max-width: 400px;
            background: rgba(28, 37, 65, 0.95); backdrop-filter: blur(10px);
            border-radius: 40px; padding: 12px 20px;
            display: flex; justify-content: space-around; align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1000;
        }
        .nav-btn { color: rgba(255,255,255,0.4); font-size: 1.2rem; cursor: pointer; transition: 0.3s; position: relative; padding: 10px; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .nav-btn span { font-size: 0.6rem; font-family: var(--font-sans); letter-spacing: 1px; }
        .nav-btn.active { color: var(--accent-gold); transform: translateY(-2px); }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 1900;
            opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-full {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 90vh;
            background: var(--bg-body); z-index: 2000; border-radius: 20px 20px 0 0;
            transform: translateY(100%); transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            overflow-y: auto; padding-bottom: 40px;
        }
        .modal-full.active { transform: translateY(0); }
        .modal-header-img { height: 250px; width: 100%; object-fit: cover; }
        .modal-content { padding: 30px 25px; }

        /* Full Screen Text */
        #fs-text-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 2100; display: flex; flex-direction: column;
            justify-content: center; align-items: center; padding: 40px;
            text-align: center; transform: scale(0.9); opacity: 0; pointer-events: none; transition: 0.3s;
        }
        #fs-text-modal.active { transform: scale(1); opacity: 1; pointer-events: auto; }
        .fs-jp { font-size: 2.5rem; font-weight: 700; margin-bottom: 20px; line-height: 1.4; color: var(--text-primary); }
        .fs-cn { font-size: 1.2rem; color: #666; background: #F5F5F5; padding: 10px 20px; border-radius: 20px; }

    </style>
</head>
<body>

    <!-- Intro -->
    <div id="intro-screen">
        <div class="intro-text">
            <div class="intro-countdown-block">
                <div class="countdown-value" id="days-left">--</div>
                <div style="font-size: 0.9rem; letter-spacing: 3px; color: rgba(255,255,255,0.8);">DAYS LEFT</div>
            </div>
            <div class="intro-title" style="letter-spacing: 3px;">AOMORI TRIP</div>
            <button class="intro-btn" onclick="enterApp()">é–‹å•Ÿæ—…ç¨‹</button>
        </div>
    </div>

    <!-- Main App -->
    <div id="app-container">
        
        <div class="elegant-header">
            <div class="top-meta">
                <div class="brand">L'VOYAGE</div>
                <div style="text-align: right;">
                    <div class="status-value" id="header-days">--</div>
                    <div class="status-label">DAYS TO GO</div>
                </div>
            </div>
            <div class="date-scroller" id="date-nav">
                <!-- JS Generated -->
            </div>
        </div>

        <!-- 1. TRIP VIEW -->
        <div id="view-trip" class="view-section">
            <div class="container" id="timeline-container">
                <!-- JS Generated -->
            </div>
        </div>

        <!-- 2. WALLET VIEW -->
        <div id="view-wallet" class="view-section hidden">
            <div class="container">
                <div class="wallet-card" style="text-align: center; background: #1C2541; color: white;">
                    <div style="font-size: 0.8rem; color: #AAA; letter-spacing: 1px; margin-bottom: 5px;">ESTIMATED TOTAL</div>
                    <div class="serif" style="font-size: 2.5rem; color: #B49B67;" id="total-jpy">Â¥0</div>
                    <div style="color: #EEE; font-size: 0.9rem;">â‰ˆ TWD <span id="total-twd">0</span></div>
                </div>

                <div class="wallet-card">
                    <div class="rate-badge">å³æ™‚åŒ¯ç‡: <span id="current-rate">Loading...</span></div>
                    
                    <div class="user-selector">
                        <button class="user-btn active" onclick="selectUser('YK', this)">YK</button>
                        <button class="user-btn" onclick="selectUser('YY', this)">YY</button>
                        <button class="user-btn" onclick="selectUser('YS', this)">YS</button>
                    </div>

                    <div class="input-group">
                        <input type="text" id="ex-item" class="input-elegant" placeholder="é …ç›® (ä¾‹å¦‚ï¼šè˜‹æœæ´¾)">
                    </div>
                    <div class="input-group">
                        <input type="tel" id="ex-price" class="input-elegant" placeholder="é‡‘é¡ (æ—¥å¹£)" oninput="calculatePreview(this.value)">
                        <div class="twd-preview" id="preview-twd">â‰ˆ TWD 0</div>
                    </div>
                    
                    <button class="intro-btn" style="width: 100%; margin-top: 10px; border-color: #1C2541; color: #1C2541;" onclick="addExpense()">è¨˜éŒ„æ”¯å‡º</button>
                </div>
                
                <h3 class="serif" style="padding-left: 10px; margin-bottom: 15px;">è¿‘æœŸæ”¯å‡º History</h3>
                <div id="expense-list"></div>
            </div>
        </div>

        <!-- 3. TRANSLATE VIEW -->
        <div id="view-trans" class="view-section hidden">
            <div class="container">
                
                <!-- Realtime Input -->
                <div class="trans-input-area">
                    <h3 class="serif" style="margin-top:0;">å³æ™‚ç¿»è­¯</h3>
                    <textarea id="trans-input" class="input-elegant" rows="3" placeholder="è¼¸å…¥ä¸­æ–‡... (ä¾‹å¦‚ï¼šè«‹å•é€™å€‹å¤šå°‘éŒ¢ï¼Ÿ)" style="border: 1px solid #EEE; padding: 10px;"></textarea>
                    <button class="trans-btn" onclick="translateNow()">
                        <i class="fa-solid fa-language"></i> ç¿»è­¯æˆæ—¥æ–‡
                    </button>
                </div>

                <!-- Point & Speak Cards -->
                <h3 class="serif" style="margin: 30px 0 15px;">æŒ‡å·®ç¢ºèª (é»æ“Šæ”¾å¤§)</h3>
                <div class="ps-grid">
                    <div class="ps-card warning" onclick="showFs('ç§ã¯ç‰›è‚‰ã¨è±šè‚‰ã¨ç¾Šè‚‰ãŒé£Ÿã¹ã‚‰ã‚Œã¾ã›ã‚“ã€‚', 'æˆ‘ä¸åƒç‰›ã€è±¬ã€ç¾Šè‚‰')">
                        <span class="ps-icon">ğŸ¥©</span>
                        <div class="ps-title">ä¸åƒç´…è‚‰</div>
                    </div>
                    <div class="ps-card" onclick="showFs('ã‚¹ãƒ¼ãƒ—ã«ç‰›ã‚„è±šã®ã‚¨ã‚­ã‚¹ã¯å…¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ', 'æ¹¯é ­å«è‚‰å—ï¼Ÿ')">
                        <span class="ps-icon">ğŸœ</span>
                        <div class="ps-title">æ¹¯é ­ç¢ºèª</div>
                    </div>
                    <div class="ps-card" onclick="showFs('ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚', 'éº»ç…©çµå¸³')">
                        <span class="ps-icon">ğŸ’³</span>
                        <div class="ps-title">çµå¸³</div>
                    </div>
                    <div class="ps-card" onclick="showFs('ã“ã‚Œã‚’ãã ã•ã„ã€‚', 'æˆ‘è¦é€™å€‹')">
                        <span class="ps-icon">ğŸ‘‰</span>
                        <div class="ps-title">æˆ‘è¦é€™å€‹</div>
                    </div>
                    <div class="ps-card" onclick="showFs('ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', 'å»æ‰€åœ¨å“ªï¼Ÿ')">
                        <span class="ps-icon">ğŸš»</span>
                        <div class="ps-title">æ‰¾å»æ‰€</div>
                    </div>
                    <div class="ps-card danger" onclick="showFs('åŠ©ã‘ã¦ãã ã•ã„ï¼', 'æ•‘å‘½ï¼')">
                        <span class="ps-icon">ğŸ†˜</span>
                        <div class="ps-title">ç·Šæ€¥æ±‚æ•‘</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. INFO VIEW -->
        <div id="view-info" class="view-section hidden">
            <div class="container">
                
                <!-- NEW: Map Overview -->
                <div class="map-overview-card" style="margin-top: 20px;">
                    <h2 class="serif" style="margin-top: 0; color: var(--accent-main); font-size: 1.3rem;">æ—…è¡Œç¸½è¦½åœ°åœ–</h2>
                    <p style="color: #666; font-size: 0.9rem; margin-bottom: 10px;">é»æ“ŠæŸ¥çœ‹ Google Maps å®Œæ•´è·¯ç·š</p>
                    <img id="trip-map-overview" 
                         src="https://maps.googleapis.com/maps/api/staticmap?center=40.7831,140.7431&zoom=8&size=600x400&maptype=roadmap&markers=color:0x1C2541|label:H|41.7687,140.8239&markers=color:0xD9333F|label:A|40.8242,140.7369&markers=color:0xD9333F|label:B|40.6062,140.4608&markers=color:0xD9333F|label:C|40.6384,140.8037&markers=color:0xB49B67|label:S|40.6865,141.2584&key=YOUR_API_KEY" 
                         onclick="openFullTripMap()"
                         class="map-overview-img" 
                         alt="é’æ£®å‡½é¤¨æ•´é«”è·¯ç·šåœ–">
                </div>

                <div class="wallet-card">
                    <h2 class="serif" style="margin-top: 0; color: var(--accent-main);">é‡è¦è³‡è¨Šå½™æ•´</h2>
                    <p style="color: #666; font-size: 0.9rem;">ç·Šæ€¥æ™‚åˆ»èˆ‡é€šé—œå¿…å‚™</p>
                </div>

                <div class="info-card" onclick="window.open('https://vjw-lp.digital.go.jp/zh-hant/', '_blank')">
                    <div style="display:flex; align-items:center;">
                        <div class="info-icon" style="background: #FFF3E0; color: #E65100;"><i class="fa-solid fa-passport"></i></div>
                        <div class="info-text">
                            <h3>Visit Japan Web</h3>
                            <p>å…¥å¢ƒå¯©æŸ¥ & æµ·é—œç”³å ± QR Code</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-chevron-right" style="color:#CCC;"></i>
                </div>

                <div class="info-card" onclick="window.location.href='tel:110'">
                    <div style="display:flex; align-items:center;">
                        <div class="info-icon" style="background: #FFEBEE; color: #D32F2F;"><i class="fa-solid fa-shield-halved"></i></div>
                        <div class="info-text">
                            <h3>æ—¥æœ¬å ±è­¦ 110</h3>
                            <p>é‡åˆ°äº‹æ•…æˆ–çŠ¯ç½ªæ™‚</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-phone" style="color:var(--accent-red);"></i>
                </div>

                <div class="info-card" onclick="window.location.href='tel:119'">
                    <div style="display:flex; align-items:center;">
                        <div class="info-icon" style="background: #FFEBEE; color: #D32F2F;"><i class="fa-solid fa-truck-medical"></i></div>
                        <div class="info-text">
                            <h3>ç«è­¦/æ•‘è­·è»Š 119</h3>
                            <p>æ€¥ç—…æˆ–å—å‚·æ™‚</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-phone" style="color:var(--accent-red);"></i>
                </div>

                <div class="info-card" onclick="window.location.href='tel:+81-11-222-2930'">
                    <div style="display:flex; align-items:center;">
                        <div class="info-icon" style="background: #E3F2FD; color: #1565C0;"><i class="fa-solid fa-building-flag"></i></div>
                        <div class="info-text">
                            <h3>é§æ—¥ä»£è¡¨è™• (æœ­å¹Œåˆ†è™•)</h3>
                            <p>åŒ—æµ·é“/é’æ£®ç·Šæ€¥è¯çµ¡: +81-11-222-2930</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-phone" style="color:#1565C0;"></i>
                </div>
            </div>
        </div>

    </div>

    <!-- 4-Button Navigation -->
    <div class="glass-nav">
        <div class="nav-btn active" onclick="switchView('trip', this)">
            <i class="fa-solid fa-map-location-dot"></i>
            <span>è¡Œç¨‹</span>
        </div>
        <div class="nav-btn" onclick="switchView('wallet', this)">
            <i class="fa-solid fa-wallet"></i>
            <span>è¨˜å¸³</span>
        </div>
        <div class="nav-btn" onclick="switchView('trans', this)">
            <i class="fa-solid fa-comments"></i>
            <span>ç¿»è­¯</span>
        </div>
        <div class="nav-btn" onclick="switchView('info', this)">
            <i class="fa-solid fa-circle-info"></i>
            <span>è³‡è¨Š</span>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal-overlay" onclick="closeModal()"></div>
    <div class="modal-full" id="detail-modal">
        <div style="position: sticky; top: 0; padding: 10px; text-align: right; z-index: 10;">
            <button onclick="closeModal()" style="background: white; border: none; width: 36px; height: 36px; border-radius: 50%; box-shadow: 0 2px 10px rgba(0,0,0,0.1); color: #333;"><i class="fa-solid fa-times"></i></button>
        </div>
        <img src="" id="m-img" class="modal-header-img" onerror="this.onerror=null; this.src='https://placehold.co/800x600?text=No+Image';">
        <div class="modal-content">
            <span id="m-tag" style="font-size: 0.7rem; letter-spacing: 2px; color: var(--accent-gold); text-transform: uppercase;">TAG</span>
            <h2 id="m-title" class="serif" style="font-size: 1.8rem; margin: 5px 0 20px 0; line-height: 1.2;">Title</h2>
            
            <!-- Map Section -->
            <div id="m-map-section" style="background: #F0F4F8; padding: 15px; border-radius: 8px; margin-top: 20px; display: flex; justify-content: space-between; align-items: center;" class="hidden">
                <div>
                    <div style="font-size: 0.7rem; color: #666; letter-spacing: 1px;">NAVIGATE (MAPCODE)</div>
                    <div id="m-mapcode" style="font-family: monospace; font-size: 1.2rem; font-weight: 700; color: var(--accent-main);">--</div>
                </div>
                <button onclick="copyMapCode()" style="background: var(--accent-main); color: white; border: none; padding: 8px 15px; border-radius: 4px;">è¤‡è£½</button>
            </div>
            
            <!-- Google Maps Preview (new) -->
            <div id="m-gmap-preview" class="hidden" style="margin-top: 20px; text-align: center;">
                <img id="m-gmap-img" style="width: 100%; height: auto; border-radius: 4px; cursor: pointer;" onclick="openGoogleMap(document.getElementById('m-title').innerText)" alt="Google Map é è¦½è·¯ç·š">
                <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">é»æ“Šåœ–ç‰‡å‰å¾€ Google Map å°èˆª</p>
            </div>


            <p id="m-desc" style="font-size: 1rem; line-height: 1.8; color: #555; margin-top: 25px;">Description</p>
        </div>
    </div>

    <!-- Full Screen Text Modal -->
    <div id="fs-text-modal" onclick="closeFs()">
        <div class="fs-jp" id="fs-jp">--</div>
        <div class="fs-cn" id="fs-cn">--</div>
        <div class="fs-close" style="position: absolute; bottom: 50px; color: #999; font-size: 0.9rem;">é»æ“Šä»»æ„è™•é—œé–‰</div>
    </div>

    <script>
        // --- DATA WITH FIXED IMAGES AND DETAILED DESCRIPTIONS ---
        const tripData = [
            {
                day: 1, date: "02.02", week: "MON",
                heroTitle: "å‡½é¤¨ï¼šåŒ—åœ‹çš„èµ·é»",
                heroImg: "https://images.unsplash.com/photo-1542640244-7e67286feb8f?q=80&w=800&auto=format&fit=crop", /* Hakodate View */
                events: [
                    { time: "11:10", title: "æŠµé”å‡½é¤¨æ©Ÿå ´", tag: "Transport", desc: "å…¥å¢ƒæ‰‹çºŒã€‚æ©Ÿå ´äº¤é€šä¸»è¦ä¾é å·´å£«ï¼Œå‹™å¿…é å…ˆç¢ºèªæ™‚åˆ»è¡¨ã€‚", detail: "å‡½é¤¨æ©Ÿå ´ä¸å¤§ï¼Œå…¥é—œæ‰‹çºŒé€šå¸¸å¿«é€Ÿã€‚æ©Ÿå ´å·´å£«ç›´é”JRå‡½é¤¨ç«™ï¼Œæ˜¯æœ€æ–¹ä¾¿çš„æ–¹å¼ã€‚", img: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=800&auto=format&fit=crop", to: "JRå‡½é¤¨ç«™" },
                    { time: "12:30", title: "ç§»å‹•è‡³é£¯åº— (JRå‡½é¤¨ç«™)", tag: "Transport", desc: "æ­ä¹˜æ©Ÿå ´å·´å£«ã€‚å…¥ä½ JR Inn Hakodate ä¸¦æ”¾ä¸‹è¡Œæã€‚", detail: "æ©Ÿå ´å·´å£«è»Šç¨‹ç´„ 20 åˆ†é˜ã€‚JR Inn Hakodate å°±åœ¨å‡½é¤¨ç«™æ—ï¼Œæ–¹ä¾¿ Day 2 ç§»å‹•ã€‚", from: "å‡½é¤¨æ©Ÿå ´", to: "JRå‡½é¤¨ç«™" },
                    { time: "13:35", title: "UNIQLO å‡½é¤¨æ˜­å’Œåº—", tag: "Shopping", desc: "ã€è³¼ç‰©ä»»å‹™ã€‘æ¡è²·æ¥µæš–ç™¼ç†±è¡£ã€‚æ­è¨ˆç¨‹è»Šå‰å¾€æœ€å¿«ã€‚", nav: { mapcode: "86 254 073*65" }, detail: "æ­¤åº—ä½æ–¼éƒŠå€è³¼ç‰©ä¸­å¿ƒï¼Œå“é …é½Šå…¨ã€‚é‡é»æ˜¯è£œè¶³ç¦¦å¯’è£å‚™ï¼Œé›ªåœ°é«”æ„Ÿæº«åº¦æ¥µä½ã€‚", img: "https://images.unsplash.com/photo-1441986300917-64674bd600d8?q=80&w=800&auto=format&fit=crop", to: "é‡‘æ£®ç´…ç£šå€‰åº«" },
                    { time: "15:45", title: "é‡‘æ£®ç´…ç£šå€‰åº«", tag: "Sightseeing", desc: "æ­ä¹˜å¸‚é›»/è·¯é¢é›»è»Šã€‚æ„Ÿå—æ¸¯é‚Šé¢¨æƒ…ã€‚", detail: "é€™æ˜¯å‡½é¤¨æœ€å…·ä»£è¡¨æ€§çš„æ¸¯ç£æ­·å²å»ºç¯‰ç¾¤ï¼Œç¾ç‚ºè³¼ç‰©åŠç¾é£Ÿå€ã€‚æ‹ç…§éå¸¸æ¼‚äº®ï¼Œç‰¹åˆ¥æ˜¯åœ¨é›ªä¸­ã€‚", img: "https://images.unsplash.com/photo-1616790933557-4180d5663702?q=80&w=800&auto=format&fit=crop", to: "å‡½é¤¨å±±" },
                    { time: "17:00", title: "å‡½é¤¨å±±ç™¾è¬å¤œæ™¯", tag: "Sightseeing", desc: "æ­çºœè»Šä¸Šå±±ã€‚æ—¥è½æ™‚é–“ç´„ 16:50ï¼Œå±±ä¸Šé¢¨å¤§è«‹ä¿æš–ã€‚", nav: { mapcode: "86 041 028*25" }, detail: "ä¸–ç•Œä¸‰å¤§å¤œæ™¯ä¹‹ä¸€ï¼Œç¨ç‰¹çš„æ²™é ¸å²¬åœ°å½¢å½¢æˆçµ•ç¾æ›²ç·šã€‚å‹™å¿…ææ—©æ’éšŠï¼Œä¸¦æ³¨æ„çºœè»Šæ˜¯å¦å› å¼·é¢¨åœé§›ã€‚", img: "https://images.unsplash.com/photo-1535392460594-553655519f93?q=80&w=800&auto=format&fit=crop", to: "å¹¸é‹å°ä¸‘æ¼¢å ¡" },
                    { time: "19:00", title: "å¹¸é‹å°ä¸‘æ¼¢å ¡ (å‡½é¤¨ç«™å‰åº—)", tag: "Food", desc: "å¿…é»ï¼šä¸­è¯é›è…¿å ¡ (Chinese Chicken Burger)ã€‚", detail: "å‡½é¤¨é™å®šçš„é€£é–æ¼¢å ¡åº—ï¼Œè¢«è­½ç‚ºæœ€ç¾å‘³çš„åœ¨åœ°æ¼¢å ¡ã€‚éºµåŒ…å’Œç‚¸é›è…¿éƒ½å……æ»¿ç‰¹è‰²ï¼Œåƒ¹æ ¼å¯¦æƒ ã€‚", img: "https://images.unsplash.com/photo-1594212699903-ec8a3eca50f5?q=80&w=800&auto=format&fit=crop" }
                ]
            },
            {
                day: 2, date: "02.03", week: "TUE",
                heroTitle: "è·¨è¶Šæ´¥è¼•æµ·å³½",
                heroImg: "https://images.unsplash.com/photo-1532236395709-7d70320fec2d?q=80&w=800&auto=format&fit=crop",
                events: [
                    { time: "08:00", title: "å‡½é¤¨æœå¸‚æ—©é¤", tag: "Food", desc: "äº«ç”¨æµ·é®®ä¸¼ã€‚æ­¥è¡Œå‰å¾€ã€‚", detail: "å……æ»¿æ´»åŠ›çš„æ¼å¸‚å ´ï¼Œå¯ä»¥è¦ªè‡ªæŒ‘é¸æµ·é®®è£½ä½œæµ·é®®ä¸¼ã€‚è«‹å‹™å¿…é¸æ“‡ä¸€é–“å£ç¢‘å¥½çš„åº—é¢ï¼Œé¿å…è¸©é›·ã€‚", img: "https://images.unsplash.com/photo-1574765798950-c8f7734a36f7?q=80&w=800&auto=format&fit=crop", to: "JRå‡½é¤¨ç«™" },
                    { time: "10:00", title: "ç§»å‹•è‡³é’æ£® (æ–°å¹¹ç·š)", tag: "Transport", desc: "æ­ä¹˜æ–°å¹¹ç·šç©¿è¶Šæ´¥è¼•æµ·å³½ã€‚13:45 æŠµé”é’æ£®ç«™ã€‚", detail: "å¾å‡½é¤¨ç«™å…ˆæ­ä¹˜ JR è‡³æ–°å‡½é¤¨åŒ—æ–—ç«™è½‰ä¹˜æ–°å¹¹ç·šã€‚æ–°å¹¹ç·šèˆ’é©å¿«é€Ÿï¼Œé©åˆä¼‘æ¯è£œçœ ã€‚", from: "JRå‡½é¤¨ç«™", to: "é’æ£®ç«™" },
                    { time: "14:15", title: "Dormy Inn Aomori Check-in", tag: "Hotel", desc: "æ­è¨ˆç¨‹è»Šæ”¾è¡Œæã€‚", detail: "Dormy Inn ä»¥æº«æ³‰å’Œå…è²»å¤œé³´æ‹‰éºµèåï¼Œæ˜¯å†¬å¤©ä½å®¿çš„å¥½é¸æ“‡ã€‚è«‹å…ˆå¯„æ”¾è¡Œæï¼Œè¼•è£å‡ºç™¼ã€‚", img: "https://images.unsplash.com/photo-1550889218-c21e6498701a?q=80&w=800&auto=format&fit=crop", to: "é’æ£®ç¸£ç«‹ç¾è¡“é¤¨" },
                    { time: "14:40", title: "é’æ£®ç¸£ç«‹ç¾è¡“é¤¨", tag: "Art", desc: "æ­è¨ˆç¨‹è»Šå‰å¾€ã€‚å¿…çœ‹å¥ˆè‰¯ç¾æ™ºã€Œé’æ£®çŠ¬ã€ã€‚", nav: { mapcode: "99 489 495*20" }, detail: "å»ºç¯‰æœ¬èº«ç”±é’æœ¨æ·³è¨­è¨ˆï¼Œèˆ‡é„°è¿‘çš„ä¸‰å…§ä¸¸å±±éºè·¡ç›¸å‘¼æ‡‰ã€‚å¥ˆè‰¯ç¾æ™ºçš„å·¨å‹ã€é’æ£®çŠ¬ã€éå¸¸æœ‰åã€‚", img: "https://images.unsplash.com/photo-1563509893962-e64e9a594833?q=80&w=800&auto=format&fit=crop", to: "å¸‚å€æ™šé¤" },
                    { time: "18:00", title: "é’æ£®é„‰åœŸæ–™ç†æ™šé¤", tag: "Food", desc: "äº«ç”¨å¸†ç«‹è²å‘³å™Œç‡’ (è²ç„¼ãå‘³å™Œ)ã€‚", detail: "å‘³å™Œç‡’æ˜¯å°‡å¸†ç«‹è²èˆ‡è›‹ä¸€èµ·åœ¨é‹ä¸­ç‡’çƒ¤çš„å‚³çµ±æ–™ç†ã€‚é»é¤æ™‚è«‹å‹™å¿…ä½¿ç”¨ã€ä¸åƒç´…è‚‰ã€å¡ç‰‡ç¢ºèªæ¹¯åº•æ˜¯å¦å«æœ‰è±¬è‚‰æˆåˆ†ã€‚", img: "https://images.unsplash.com/photo-1627662236254-8c83e29f048c?q=80&w=800&auto=format&fit=crop" }
                ]
            },
            {
                day: 3, date: "02.04", week: "WED",
                heroTitle: "æš–çˆåˆ—è»Šèˆ‡è˜‹æœæ´¾",
                heroImg: "https://images.unsplash.com/photo-1549643276-fbc2bd5f4038?q=80&w=800&auto=format&fit=crop",
                events: [
                    { time: "09:00", title: "ç§Ÿè»Šèˆ‡è¼‰è¡Œæ", tag: "Transport", desc: "é’æ£®ç«™å–è»Šã€‚å›é£¯åº—è¼‰è¡Œæã€‚", detail: "é›ªåœ°è‡ªé§•ç¬¬ä¸€å¤©ï¼Œè«‹åœ¨åœè»Šå ´ç·´ç¿’ç…è»Šå’Œè½‰å‘æ‰‹æ„Ÿã€‚è»Šé€Ÿæ”¾æ…¢ï¼Œä¿æŒå®‰å…¨è·é›¢ã€‚", from: "Dormy Inn Aomori", to: "ELMè³¼ç‰©ä¸­å¿ƒ" },
                    { time: "10:15", title: "ELM è³¼ç‰©ä¸­å¿ƒ", tag: "Shopping", desc: "ã€ä»»å‹™ã€‘3COINS+plus è³¼è²·å¾©å¤å°ç›¸æ©Ÿã€‚", nav: { mapcode: "168 649 346*52" }, detail: "è³¼ç‰©ä¸­å¿ƒå…§æœ‰ 3COINSã€‚é€™æ˜¯å¹³åŸè·¯ç·šçš„ç†±èº«é§•é§›ï¼Œç›¸å°å®‰å…¨ã€‚è«‹å°‡ã€è²·ç›¸æ©Ÿã€å¡ç‰‡æº–å‚™å¥½ã€‚", img: "https://images.unsplash.com/photo-1516035069371-29a1b244cc32?q=80&w=800&auto=format&fit=crop", to: "æ´¥è¼•äº”æ‰€å·åŸç«™" },
                    { time: "11:10", title: "ç§»å‹•è‡³æ´¥è¼•äº”æ‰€å·åŸç«™", tag: "Transport", desc: "è‡ªé§•å‰å¾€ã€‚æº–å‚™æ­ä¹˜æš–çˆåˆ—è»Šã€‚", detail: "è»Šç¨‹ç´„ 1 å°æ™‚ï¼Œè«‹æ³¨æ„è·¯é‚Šé›ªå †ã€‚è«‹é ç•™è¶³å¤ æ™‚é–“åœ¨è»Šç«™åœè»Šèˆ‡è³¼ç¥¨ã€‚", from: "ELMè³¼ç‰©ä¸­å¿ƒ", to: "æ´¥è¼•äº”æ‰€å·åŸç«™" },
                    { time: "12:30", title: "æš–çˆåˆ—è»Š (æ´¥è¼•éµé“)", tag: "Experience", desc: "æ´¥è¼•éµé“ã€‚è»Šä¸Šå¿…åƒç¾çƒ¤é­·é­šã€‚", nav: { mapcode: "168 619 432*22" }, detail: "å†¬å¤©é™å®šçš„ç‰¹è‰²åˆ—è»Šï¼Œè»Šå…§æœ‰æš–çˆå¯çƒ¤é­·é­šå–æš–ã€‚è«‹é å…ˆåœ¨è»Šç«™è³¼è²·é­·é­šä¹¾ã€‚é€™è¶Ÿæ˜¯é›£å¾—çš„å¾©å¤é«”é©—ã€‚", img: "https://images.unsplash.com/photo-1474487548417-781cb71495f3?q=80&w=800&auto=format&fit=crop", to: "è—¤ç”°ç´€å¿µåº­åœ’" },
                    { time: "15:30", title: "å¤§æ­£æµªæ¼«å–«èŒ¶å®¤", tag: "Food", desc: "ã€CRITICALã€‘16:00 æœ€å¾Œé»é¤ã€‚å“åšè˜‹æœæ´¾ã€‚", nav: { mapcode: "71 071 513*78" }, detail: "ä½æ–¼å¼˜å‰åŸæ—çš„è—¤ç”°ç´€å¿µåº­åœ’å…§ï¼Œæ˜¯é«”é©—å„ªé›…å¤§æ­£æ™‚ä»£æ°›åœçš„çµ•ä½³åœ°é»ã€‚å‹™å¿…ä½¿ç”¨ã€ç„¡è‚‰æ¡‚ã€å¡ç‰‡ç¢ºèªï¼", img: "https://images.unsplash.com/photo-1568571780765-9276ac8b75a2?q=80&w=800&auto=format&fit=crop", to: "å¼˜å‰åŸ" },
                    { time: "16:30", title: "å¼˜å‰åŸç™½å¤©é›ªæ™¯", tag: "Sightseeing", desc: "åœ¨é›ªä¸­æ¼«æ­¥å¼˜å‰å…¬åœ’ã€‚", detail: "å¼˜å‰åŸå†¬å¤©æœƒèˆ‰è¾¦é›ªç‡ˆç± ç¥­ï¼Œè­·åŸæ²³çµå†°éå¸¸å£¯è§€ã€‚å¯ä»¥è¶è‘—å¤©é»‘å‰æ‹é›ªæ™¯ã€‚", img: "https://images.unsplash.com/photo-1549643276-fbc2bd5f4038?q=80&w=800&auto=format&fit=crop", to: "Dormy Inn Aomori" },
                    { time: "17:30", title: "è¿”å›é’æ£®å¸‚", tag: "Transport", desc: "å¤œé–“é›ªåœ°æ…¢è¡Œï¼Œæ³¨æ„å®‰å…¨ã€‚è¿”å› Dormy Innã€‚", detail: "å¾å¼˜å‰è¿”å›é’æ£®å¸‚å€ç‚ºåœ‹é“ 7 è™Ÿï¼Œè»Šæµè¼ƒå¤§ï¼Œè·¯æ³ç›¸å°å¥½ä½†ä»éœ€æ¥µæ…¢é€Ÿé§•é§›ã€‚", from: "å¼˜å‰", to: "Dormy Inn Aomori" }
                ]
            },
            {
                day: 4, date: "02.05", week: "THU",
                heroTitle: "é›ªæ€ªèˆ‡ç™½è‰²ç›Ÿç´„",
                heroImg: "https://images.unsplash.com/photo-1487667258413-5a089052b658?q=80&w=800&auto=format&fit=crop",
                alert: "âš ï¸ å®‰å…¨è­¦ç¤ºï¼šè‹¥çºœè»Šåœé§›ï¼Œè«‹å‹™å¿…åŸè·¯æŠ˜è¿”ï¼ç¦æ­¢å¾€åå’Œç”°æ¹–æ–¹å‘ã€‚",
                events: [
                    { time: "09:00", title: "å¤å·å¸‚å ´ æ—©é¤", tag: "Food", desc: "å¿«å»å¿«å›ï¼Œäº«ç”¨è‡ªé¸ã®ã£ã‘ä¸¼ã€‚", detail: "è‡ªé¸é…æ–™çš„ DIY æµ·é®®ä¸¼ï¼Œæ¨‚è¶£åè¶³ã€‚å‹™å¿…åœ¨ 09:30 å‰çµæŸä¸¦ä¸Šè·¯ï¼Œä»¥ç¢ºä¿ä¸Šå±±æ™‚é–“ã€‚", img: "https://images.unsplash.com/photo-1563820986754-051871f3b392?q=80&w=800&auto=format&fit=crop", to: "å…«ç”²ç”°çºœè»Šç«™" },
                    { time: "10:40", title: "å…«ç”²ç”°çºœè»Š", tag: "Nature", desc: "æ¨¹å†°è§€è³ã€‚å±±ä¸Šæ¥µå†·è«‹å…¨å‰¯æ­¦è£ã€‚", nav: { mapcode: "99 055 336*13" }, detail: "å…«ç”²ç”°æ˜¯æ—¥æœ¬è‘—åçš„ã€è±ªé›ªåœ°å¸¶ã€ï¼Œæ¨¹å†° (Snow Monsters) æ™¯è§€å£¯è§€ã€‚è«‹åœ¨å±±ä¸‹å†æ¬¡ç¢ºèªé‹è¡Œç‹€æ…‹ã€‚", img: "https://images.unsplash.com/photo-1517299321609-52687d1bc55a?q=80&w=800&auto=format&fit=crop", to: "æ˜Ÿé‡é’æ£®å±‹" },
                    { time: "14:00", title: "å‰å¾€æ˜Ÿé‡é’æ£®å±‹", tag: "Drive", desc: "ã€ä¿å‘½è·¯ç·šã€‘å°èˆªè«‹è¨­ä¸­ç¹¼é»ã€Œé™¸å¥§æ”¶è²»é“è·¯ã€ï¼Œé€™æ˜¯æœ€å®‰å…¨è·¯å¾‘ã€‚", detail: "åŸè·¯ä¸‹å±±å¾Œï¼Œèµ°ä»˜è²»çš„é™¸å¥§é“è·¯å‰å¾€ä¸‰æ¾¤å¸‚ï¼Œé›–ç„¶ç¹è·¯ï¼Œä½†é¿é–‹äº†ç©é›ªæ·±åšçš„å±±å€é“è·¯ï¼Œç¢ºä¿å®‰å…¨ã€‚", from: "å…«ç”²ç”°", to: "æ˜Ÿé‡ é’æ£®å±‹" },
                    { time: "16:00", title: "æ˜Ÿé‡ é’æ£®å±‹", tag: "Hotel", desc: "Check-inã€‚äº«å—é ‚ç´šæº«æ³‰èˆ‡ç¥­å…¸æ°›åœã€‚", nav: { mapcode: "84 583 002*44" }, detail: "é£¯åº—çš„ä¸»é¡Œæ˜¯ã€é’æ£®çš„å››å­£ç¥­å…¸ã€ï¼Œcheck-inå¾Œå¯å…ˆå»é ç´„æµ®æ¹¯ï¼ˆéœ²å¤©æº«æ³‰ï¼‰ã€‚", img: "https://images.unsplash.com/photo-1560935105-d1448b11a511?q=80&w=800&auto=format&fit=crop" }
                ]
            },
            {
                day: 5, date: "02.06", week: "FRI",
                heroTitle: "å†¬æ—¥æˆ€æ­Œ",
                heroImg: "https://images.unsplash.com/photo-1548777123-e213912bc571?q=80&w=800&auto=format&fit=crop",
                events: [
                    { time: "10:00", title: "æš–çˆé¦¬è»Š", tag: "Relax", desc: "ã€é£¯åº—æ´»å‹•ã€‘é¦¬è»Šä¸Šäº«ç”¨é»å¿ƒã€‚", detail: "æ˜Ÿé‡é’æ£®å±‹çš„ç¶“å…¸æ´»å‹•ï¼Œåœ¨é›ªä¸­æ­ä¹˜é¦¬è»Šï¼Œäº«å—æº«æš–çš„æš–çˆå’Œçƒ¤é­·é­šã€‚", img: "https://images.unsplash.com/photo-1500595046743-cd271d694d30?q=80&w=800&auto=format&fit=crop", to: "æ»‘é›ªå ´" },
                    { time: "13:00", title: "æ»‘é›ªç·´ç¿’", tag: "Activity", desc: "ç¶ ä¹‹å¤§åœ°æ»‘é›ªå ´ã€‚äººå°‘é©åˆåˆå­¸è€…ã€‚", nav: { phone: "0175-63-4848" }, detail: "é€™å€‹ç”ºç‡Ÿæ»‘é›ªå ´å¡åº¦å¹³ç·©ï¼Œé©åˆä½ å€‘ç·´ç¿’ã€‚è¨˜å¾—ç§Ÿå€Ÿå…¨å¥—è£å‚™ã€‚", img: "https://images.unsplash.com/photo-1551698618-1dfe5d97d256?q=80&w=800&auto=format&fit=crop", to: "é’æ£®å±‹" },
                    { time: "20:00", title: "é™¸å¥§ç¥­å…¸å±‹", tag: "Culture", desc: "è§€è³é’æ£®ç¡é­”ç¥­è¡¨æ¼”ã€‚", detail: "æ¿ƒç¸®äº†é’æ£®å››å¤§ç¥­å…¸çš„ç²¾è¯è¡¨æ¼”ï¼Œéå¸¸éœ‡æ’¼ã€‚è«‹æå‰å‰å¾€ï¼Œæ‰¾å€‹å¥½ä½ç½®ã€‚", img: "https://images.unsplash.com/photo-1533230554519-5374be216259?q=80&w=800&auto=format&fit=crop" }
                ]
            },
            {
                day: 6, date: "02.07", week: "SAT",
                heroTitle: "æ»¿è¼‰è€Œæ­¸",
                heroImg: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=800&auto=format&fit=crop",
                events: [
                    { time: "10:00", title: "æœ€çµ‚éµå¾‹ï¼šæº–æ™‚å‡ºç™¼", tag: "Transport", desc: "é–‹è»Šé›¢é–‹é£¯åº—ã€‚ä¸Šè·¯è«‹é–‹å¤§ç‡ˆï¼Œæ¥µè‡´æ…¢é€Ÿå®‰å…¨é§•é§›ã€‚", detail: "å¾é’æ£®å±‹å‰å¾€é’æ£®æ©Ÿå ´ç´„ 1 å°æ™‚ 20 åˆ†é˜ã€‚å¿…é ˆé ç•™æ™‚é–“çµ¦åŠ æ²¹å’Œé‚„è»Šæ‰‹çºŒã€‚", from: "æ˜Ÿé‡ é’æ£®å±‹", to: "é’æ£®æ©Ÿå ´" },
                    { time: "13:00", title: "é’æ£®æ©Ÿå ´é‚„è»Š", tag: "Transport", desc: "è¨˜å¾—åŠ æ»¿æ²¹å†é‚„è»Šã€‚", img: "https://images.unsplash.com/photo-1569930784237-7b6a2d699397?q=80&w=800&auto=format&fit=crop" },
                    { time: "14:00", title: "æœ€å¾Œæ¡è²·", tag: "Shopping", desc: "æ©Ÿå ´å…ç¨…åº—ã€‚", detail: "é’æ£®æ©Ÿå ´ä¸å¤§ï¼Œä½†ä»å¯è³¼è²·åˆ°ç‹æ—è˜‹æœæ±ã€è˜‹æœæ´¾ç­‰åœ¨åœ°ä¼´æ‰‹ç¦®ã€‚", img: "https://images.unsplash.com/photo-1579705745811-a32bef7856a3?q=80&w=800&auto=format&fit=crop" }
                ]
            }
        ];

        let currentIdx = 0;
        let expenses = JSON.parse(localStorage.getItem('expenses_v2')) || [];
        let currentUser = 'YK';
        let currentRate = 0.22; // default Fallback

        // --- INIT ---
        window.enterApp = function() {
            document.getElementById('intro-screen').style.transform = 'translateY(-100%)';
            renderTrip();
            fetchRate();
        };

        window.onload = function() {
            const start = new Date("2026-02-02").getTime();
            const now = new Date().getTime();
            const days = Math.ceil((start - now) / (1000 * 60 * 60 * 24));
            document.getElementById('days-left').innerText = days > 0 ? days : 0;
            document.getElementById('header-days').innerText = days > 0 ? days : 0;
        };

        // --- FETCH RATE ---
        function fetchRate() {
            fetch('https://api.exchangerate-api.com/v4/latest/JPY')
                .then(response => response.json())
                .then(data => {
                    if(data && data.rates && data.rates.TWD) {
                        currentRate = data.rates.TWD;
                        document.getElementById('current-rate').innerText = "1 JPY = " + currentRate.toFixed(4) + " TWD";
                        renderExpenses(); // Re-render with new rate
                    }
                })
                .catch(err => {
                    document.getElementById('current-rate').innerText = "é›¢ç·šåŒ¯ç‡: " + currentRate;
                });
        }

        // --- RENDER TRIP ---
        window.renderTrip = function() {
            const nav = document.getElementById('date-nav');
            nav.innerHTML = tripData.map((d, i) => `
                <div class="d-item ${i === currentIdx ? 'active' : ''}" onclick="switchDay(${i})">
                    <div class="d-week">${d.week}</div>
                    <div class="d-num">${d.date.split('.')[1]}</div>
                </div>
            `).join('');

            const day = tripData[currentIdx];
            const container = document.getElementById('timeline-container');
            
            let alertHtml = '';
            if (day.alert) {
                alertHtml = `<div class="alert-banner"><i class="fa-solid fa-triangle-exclamation" style="color:#D9333F; margin-top:3px;"></i><div style="margin-left:10px;"><div style="color:var(--accent-main); font-weight:500;">ä»Šæ—¥å®‰å…¨è­¦ç¤º</div><span class="alert-highlight">${day.alert}</span></div></div>`;
            }

            let html = `
                <div class="hero-card">
                    <img src="${day.heroImg}" class="hero-img">
                    <div class="hero-overlay">
                        <div class="hero-title">${day.heroTitle}</div>
                    </div>
                </div>
                ${alertHtml}
                <div class="timeline-block">
            `;

            html += day.events.map((ev, i) => {
                const data = encodeURIComponent(JSON.stringify(ev));
                const delay = i * 0.1;
                
                // Determine icon based on tag
                let icon = 'fa-circle';
                if (ev.tag === 'Transport' || ev.tag === 'Drive') icon = 'fa-car-side';
                if (ev.tag === 'Hotel') icon = 'fa-bed';
                if (ev.tag === 'Shopping') icon = 'fa-bag-shopping';
                if (ev.tag === 'Food' || ev.tag === 'Cuisine') icon = 'fa-utensils';
                if (ev.tag === 'Sightseeing' || ev.tag === 'Nature' || ev.tag === 'Art') icon = 'fa-map-pin';
                if (ev.tag === 'Experience' || ev.tag === 'Activity') icon = 'fa-person-skiing';

                return `
                    <div class="event-node visible" style="transition-delay: ${delay}s">
                        <div class="time-dot"></div>
                        <div class="event-card" onclick="openDetail('${data}')">
                            <span class="event-tag">${ev.tag}</span>
                            <div class="event-title">${ev.title}</div>
                            <div style="font-size:0.7rem; color:#888; margin-top:5px; display:flex; align-items:center; gap:8px;">
                                <i class="fa-solid ${icon}"></i> 
                                <span>${ev.desc}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            html += `</div>`;

            container.innerHTML = html;
        }

        window.switchDay = function(i) {
            if(i === currentIdx) return;
            currentIdx = i;
            renderTrip();
        }

        window.switchView = function(view, btn) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById('view-' + view).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');
            
            if(view === 'wallet') {
                renderExpenses();
            }
            window.scrollTo(0,0);
        }

        // --- WALLET ---
        window.selectUser = function(user, btn) {
            currentUser = user;
            document.querySelectorAll('.user-btn').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');
        }

        window.calculatePreview = function(val) {
            if(!val) {
                document.getElementById('preview-twd').innerText = "â‰ˆ TWD 0";
                return;
            }
            const twd = Math.round(parseInt(val) * currentRate);
            document.getElementById('preview-twd').innerText = "â‰ˆ TWD " + twd.toLocaleString();
        }

        window.addExpense = function() {
            const item = document.getElementById('ex-item').value;
            const price = parseInt(document.getElementById('ex-price').value);
            
            if(item && price) {
                const now = new Date();
                const timeString = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0');
                
                expenses.unshift({
                    user: currentUser,
                    item, 
                    price,
                    time: timeString,
                    date: (now.getMonth()+1) + "/" + now.getDate()
                });
                
                localStorage.setItem('expenses_v2', JSON.stringify(expenses));
                renderExpenses();
                
                document.getElementById('ex-item').value = '';
                document.getElementById('ex-price').value = '';
                document.getElementById('preview-twd').innerText = "â‰ˆ TWD 0";
            }
        }

        function renderExpenses() {
            let total = 0;
            const html = expenses.map(e => {
                total += e.price;
                return `
                    <div class="expense-item">
                        <div class="exp-meta">
                            <div class="exp-user">${e.user}</div>
                            <div>
                                <div style="font-weight:500;">${e.item}</div>
                                <div style="font-size:0.75rem; color:#999;">${e.date} ${e.time}</div>
                            </div>
                        </div>
                        <div class="serif">Â¥${e.price.toLocaleString()}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('expense-list').innerHTML = html;
            document.getElementById('total-jpy').innerText = "Â¥" + total.toLocaleString();
            document.getElementById('total-twd').innerText = (total * currentRate).toFixed(0);
        }

        // --- TRANSLATE ---
        window.translateNow = function() {
            const text = document.getElementById('trans-input').value;
            if(text) {
                const url = `https://translate.google.com/?sl=zh-TW&tl=ja&text=${encodeURIComponent(text)}&op=translate`;
                window.open(url, '_blank');
            }
        }
        
        // --- MAPS ---
        window.openGoogleMap = function(title) {
            // Opens Google Maps app/website with the location name
            window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(title)}`, '_blank');
        }
        
        window.openFullTripMap = function() {
            // Opens Google Maps with custom markers for the whole trip
            // NOTE: Coordinates are hardcoded to represent the general flow for this demo.
            const markers = [
                'JRå‡½é¤¨ç«™', 'UNIQLOå‡½é¤¨æ˜­å’Œåº—', 'å‡½é¤¨å±±', 'é’æ£®ç«™', 'é’æ£®ç¸£ç«‹ç¾è¡“é¤¨', 'æ´¥è¼•äº”æ‰€å·åŸç«™', 'å¤§æ­£æµªæ¼«å–«èŒ¶å®¤', 'å…«ç”²ç”°çºœè»Š', 'æ˜Ÿé‡é’æ£®å±‹', 'é’æ£®æ©Ÿå ´'
            ];
            
            const destination = markers.join(' to ');
            window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(destination)}`, '_blank');
        }


        // --- MODAL ---
        window.openDetail = function(dataStr) {
            const data = JSON.parse(decodeURIComponent(dataStr));
            document.getElementById('m-title').innerText = data.title;
            document.getElementById('m-desc').innerHTML = `
                <h3 class="serif" style="font-size: 1.2rem; margin-bottom: 10px; color: var(--accent-main); border-bottom: 1px solid #EEE;">å°éŠç­†è¨˜ / Local Insight</h3>
                <p style="white-space: pre-wrap;">${data.detail || data.desc}</p>
            `;
            document.getElementById('m-tag').innerText = data.tag;
            document.getElementById('m-img').src = data.img;
            
            // MapCode Section
            const mapSec = document.getElementById('m-map-section');
            if (data.nav && data.nav.mapcode) {
                mapSec.classList.remove('hidden');
                document.getElementById('m-mapcode').innerText = data.nav.mapcode;
            } else {
                mapSec.classList.add('hidden');
            }
            
            // Google Maps Preview Section
            const gmapPreview = document.getElementById('m-gmap-preview');
            const gmapImg = document.getElementById('m-gmap-img');
            
            if (data.from && data.to) {
                // If it's a movement event
                gmapPreview.classList.remove('hidden');
                // Static map image showing route between two points
                gmapImg.src = `https://maps.googleapis.com/maps/api/staticmap?size=600x200&maptype=roadmap&markers=color:0x1C2541|label:A|${encodeURIComponent(data.from)}&markers=color:0xD9333F|label:B|${encodeURIComponent(data.to)}&path=color:0x1C2541|weight:5|${encodeURIComponent(data.from)}|${encodeURIComponent(data.to)}&key=YOUR_API_KEY`;
                gmapImg.alt = `å¾ ${data.from} åˆ° ${data.to} çš„è·¯ç·šåœ–`;
            } else if (data.title && (data.tag !== 'Transport' && data.tag !== 'Drive')) {
                // If it's a location event (sightseeing/food/hotel)
                 gmapPreview.classList.remove('hidden');
                 // Static map image showing a single point of interest
                 gmapImg.src = `https://maps.googleapis.com/maps/api/staticmap?size=600x200&maptype=roadmap&markers=color:0x1C2541|label:P|${encodeURIComponent(data.title)}&zoom=14&center=${encodeURIComponent(data.title)}&key=YOUR_API_KEY`;
                 gmapImg.alt = `${data.title} çš„ä½ç½®åœ–`;
            } else {
                gmapPreview.classList.add('hidden');
            }


            document.getElementById('detail-modal').classList.add('active');
            document.querySelector('.modal-overlay').classList.add('active');
        }

        window.closeModal = function() {
            document.getElementById('detail-modal').classList.remove('active');
            document.querySelector('.modal-overlay').classList.remove('active');
        }

        window.copyMapCode = function() {
            const code = document.getElementById('m-mapcode').innerText;
            navigator.clipboard.writeText(code).then(() => alert('MapCode å·²è¤‡è£½ï¼'));
        }

        window.showFs = function(jp, cn) {
            document.getElementById('fs-jp').innerText = jp;
            document.getElementById('fs-cn').innerText = cn;
            document.getElementById('fs-text-modal').classList.add('active');
        }
        window.closeFs = function() {
            document.getElementById('fs-text-modal').classList.remove('active');
        }

    </script>
</body>
</html>
