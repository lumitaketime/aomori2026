<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ÈùíÊ£ÆÂáΩÈ§®ÂÜ¨ÊóÖ 2026</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#F2EFE9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #F2EFE9;
            --card-glass: rgba(255, 255, 255, 0.9);
            --primary-wood: #8D6E63;
            --secondary-wood: #A1887F;
            --text-main: #4E342E;
            --text-light: #8D6E63;
            --shadow-card: 0 4px 12px rgba(141, 110, 99, 0.1);
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#D7CCC8 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text-main);
            margin: 0;
            padding: 0;
            padding-bottom: calc(90px + var(--safe-area-bottom));
            overscroll-behavior-y: none;
        }

        /* --- Header --- */
        .hero-section {
            background: linear-gradient(180deg, rgba(255,255,255,0) 0%, var(--bg-color) 100%),
                        url('https://images.unsplash.com/photo-1548261320-56d15b021319?q=80&w=2574&auto=format&fit=crop'); 
            background-size: cover;
            background-position: center;
            padding: 50px 20px 20px;
            border-radius: 0 0 30px 30px;
            position: relative;
        }

        h1 { font-size: 1.6rem; margin: 0; color: #3E2723; text-shadow: 0 2px 10px rgba(255,255,255,0.8); }
        .subtitle { font-size: 0.9rem; color: #5D4037; font-weight: 500; margin-top: 5px; opacity: 0.9; }

        /* --- Tools & Currency Widget (New) --- */
        .utility-bar {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            overflow-x: auto;
            padding-bottom: 5px;
            scrollbar-width: none;
        }
        .util-card {
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(5px);
            border-radius: 12px;
            padding: 10px 15px;
            min-width: 100px;
            box-shadow: var(--shadow-card);
            border: 1px solid rgba(255,255,255,0.6);
            flex-shrink: 0;
        }
        .util-label { font-size: 0.75rem; color: var(--text-light); font-weight: bold; margin-bottom: 2px; }
        .util-value { font-size: 1.1rem; font-weight: 700; color: var(--text-main); }
        .util-sub { font-size: 0.7rem; color: #888; }

        /* --- View Toggle Switch --- */
        .view-toggle-container {
            display: flex;
            justify-content: center;
            margin: 15px 0 5px;
        }
        .view-toggle {
            background: #EFEBE9;
            border-radius: 20px;
            padding: 4px;
            display: flex;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }
        .toggle-btn {
            padding: 6px 16px;
            border-radius: 16px;
            border: none;
            background: transparent;
            color: #8D6E63;
            font-size: 0.9rem;
            font-weight: bold;
            transition: 0.3s;
        }
        .toggle-btn.active { background: white; color: #4E342E; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* --- Tabs & Content --- */
        .tab-content { display: none; padding: 20px; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- Day Tabs (Horizontal Scroll) --- */
        .day-tabs {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 5px 20px;
            margin-bottom: 10px;
            scrollbar-width: none;
        }
        .day-tab {
            background: white;
            padding: 8px 16px;
            border-radius: 20px;
            white-space: nowrap;
            font-size: 0.9rem;
            color: var(--text-light);
            border: 1px solid transparent;
            transition: 0.2s;
        }
        .day-tab.active {
            background: var(--primary-wood);
            color: white;
            box-shadow: 0 4px 10px rgba(141, 110, 99, 0.3);
        }

        /* --- Itinerary Styling --- */
        .timeline-card {
            background: var(--card-glass);
            border-radius: 18px;
            padding: 16px;
            margin-bottom: 15px;
            box-shadow: var(--shadow-card);
            position: relative;
            border-left: 4px solid var(--primary-wood);
        }
        .card-top { display: flex; justify-content: space-between; margin-bottom: 6px; }
        .card-time { 
            font-weight: 700; color: var(--primary-wood); background: #EFEBE9;
            padding: 2px 8px; border-radius: 6px; font-size: 0.85rem;
        }
        .card-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 5px; }
        .card-desc { font-size: 0.9rem; color: #666; line-height: 1.5; margin-bottom: 10px; }
        .btn-map {
            display: inline-flex; align-items: center; background: white; color: #1565C0;
            padding: 6px 12px; border-radius: 10px; font-size: 0.8rem; font-weight: bold;
            border: 1px solid #E3F2FD; text-decoration: none;
        }

        /* --- Expense Styles (Multi-User) --- */
        .expense-dashboard {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px;
        }
        .user-stat {
            background: white; padding: 10px 5px; border-radius: 12px; text-align: center;
            box-shadow: var(--shadow-card);
        }
        .stat-name { font-size: 0.8rem; color: #888; font-weight: bold; }
        .stat-val { font-size: 1rem; font-weight: bold; color: var(--primary-wood); }

        .input-pill-group {
            background: white; border-radius: 15px; padding: 8px;
            display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; box-shadow: var(--shadow-card);
        }
        .input-pill-group input, .input-pill-group select {
            border: 1px solid #eee; padding: 8px; border-radius: 8px; outline: none; background: #fff;
        }
        #expense-name { flex: 2; min-width: 120px; }
        #expense-price { flex: 1; min-width: 70px; }
        #expense-payer { flex: 1; min-width: 60px; font-weight: bold; color: var(--primary-wood); }
        .btn-add {
            background: var(--secondary-wood); color: white; border: none;
            padding: 0 20px; border-radius: 8px; font-weight: bold; width: 100%;
        }

        /* --- Translation Tool --- */
        .trans-box {
            background: white; padding: 20px; border-radius: 20px; box-shadow: var(--shadow-card); margin-bottom: 20px;
        }
        .trans-input {
            width: 100%; border: 2px solid #eee; padding: 15px; border-radius: 12px;
            font-size: 1rem; margin-bottom: 10px; font-family: sans-serif;
        }
        .btn-trans {
            width: 100%; background: #4285F4; color: white; padding: 12px;
            border-radius: 12px; border: none; font-weight: bold; font-size: 1rem;
            display: flex; justify-content: center; align-items: center; gap: 8px;
        }

        /* --- Bottom Nav --- */
        .nav-container {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; height: 65px;
            background: rgba(78, 52, 46, 0.95); backdrop-filter: blur(10px);
            border-radius: 50px; display: flex; justify-content: space-evenly; align-items: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.25); z-index: 100;
        }
        .nav-item { color: rgba(255,255,255,0.5); font-size: 1.4rem; padding: 10px; transition: 0.3s; position: relative; }
        .nav-item.active { color: #fff; transform: translateY(-3px); }
        .nav-item.active::after {
            content: ''; position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; background: #fff; border-radius: 50%;
        }
    </style>
</head>
<body>

    <header class="hero-section">
        <h1>ÈùíÊ£ÆÂáΩÈ§®ÂÜ¨ÊóÖ</h1>
        <div class="subtitle">2026.02.02 - 02.07 ‚Ä¢ 6 Days</div>
        
        <div class="utility-bar">
            <div class="util-card">
                <div class="util-label">JPY ÂåØÁéá (‰º∞)</div>
                <div class="util-value" id="rate-display">0.22</div>
                <div class="util-sub" id="rate-calc">1000ÂÜÜ ‚âà 220ÂÖÉ</div>
            </div>
            <div class="util-card">
                <div class="util-label">ÂÄíÊï∏Ë®àÊôÇ</div>
                <div class="util-value" id="countdown-days">--</div>
                <div class="util-sub">Days Left</div>
            </div>
            <div class="util-card">
                <div class="util-label">üìç ÂáΩÈ§® (‰ªäÊó•)</div>
                <div class="util-value" id="temp-hakodate">--¬∞</div>
            </div>
        </div>
    </header>

    <div id="tab-itinerary" class="tab-content active">
        <div class="view-toggle-container">
            <div class="view-toggle">
                <button class="toggle-btn active" onclick="setViewMode('day', this)">ÂàÜÊó•Ê™¢Ë¶ñ</button>
                <button class="toggle-btn" onclick="setViewMode('all', this)">Á∏ΩË¶ΩÊ®°Âºè</button>
            </div>
        </div>

        <div class="day-tabs" id="day-tabs-container">
            </div>

        <div id="itinerary-list" style="padding-bottom: 20px;"></div>
    </div>

    <div id="tab-expenses" class="tab-content">
        <h3 style="color:var(--text-main); margin-bottom:10px;">Â§ö‰∫∫Ë®òÂ∏≥ (TWD)</h3>
        
        <div class="expense-dashboard">
            <div class="user-stat">
                <div class="stat-name">YK ‰ª£Â¢ä</div>
                <div class="stat-val" id="total-yk">$0</div>
            </div>
            <div class="user-stat">
                <div class="stat-name">YY ‰ª£Â¢ä</div>
                <div class="stat-val" id="total-yy">$0</div>
            </div>
            <div class="user-stat">
                <div class="stat-name">YS ‰ª£Â¢ä</div>
                <div class="stat-val" id="total-ys">$0</div>
            </div>
        </div>

        <div class="input-pill-group">
            <input type="text" id="expense-name" placeholder="È†ÖÁõÆ (‰æã: Â±ÖÈÖíÂ±ã)">
            <input type="number" id="expense-price" placeholder="ÈáëÈ°ç">
            <select id="expense-payer">
                <option value="YK">YK</option>
                <option value="YY">YY</option>
                <option value="YS">YS</option>
            </select>
            <button class="btn-add" onclick="addExpense()">+ Ë®ò‰∏ÄÁ≠Ü</button>
        </div>

        <div id="expense-list" style="padding-bottom: 20px;"></div>
    </div>

    <div id="tab-tools" class="tab-content">
        <h3 style="color:var(--text-main); margin-bottom:15px;">ÁøªË≠ØËàáÂ∑•ÂÖ∑</h3>
        
        <div class="trans-box">
            <div style="font-weight:bold; margin-bottom:10px; color:#555;">Âç≥ÊôÇÁøªË≠Ø (Ë∑≥ËΩâ Google)</div>
            <textarea id="trans-input" class="trans-input" rows="3" placeholder="Ëº∏ÂÖ•‰Ω†ÊÉ≥Ë™™ÁöÑ‰∏≠Êñá..."></textarea>
            <button class="btn-trans" onclick="doTranslate()">
                <i class="fa-solid fa-language"></i> ÁøªË≠ØÊàêÊó•Êñá
            </button>
        </div>

        <div class="trans-box">
            <div style="font-weight:bold; margin-bottom:10px; color:#555;">ÂåØÁéáË©¶ÁÆó (ÂåØÁéá: <span id="calc-rate-val">0.22</span>)</div>
            <div style="display:flex; gap:10px; align-items:center;">
                <input type="number" id="calc-jpy" placeholder="Êó•Âπ£ JPY" style="padding:10px; width:45%; border:1px solid #ddd; border-radius:8px;" oninput="calcMoney('jpy')">
                <i class="fa-solid fa-arrow-right-arrow-left" style="color:#888;"></i>
                <input type="number" id="calc-twd" placeholder="Âè∞Âπ£ TWD" style="padding:10px; width:45%; border:1px solid #ddd; border-radius:8px;" oninput="calcMoney('twd')">
            </div>
        </div>
    </div>

    <div class="nav-container">
        <div class="nav-item active" onclick="switchTab('itinerary', this)"><i class="fa-solid fa-map-location-dot"></i></div>
        <div class="nav-item" onclick="switchTab('expenses', this)"><i class="fa-solid fa-wallet"></i></div>
        <div class="nav-item" onclick="switchTab('tools', this)"><i class="fa-solid fa-toolbox"></i></div>
    </div>

    <script>
        // --- 1. Ë°åÁ®ãË≥áÊñô (Updated Final Version) ---
        const tripData = [
            {
                day: 1, date: "2/2 (‰∏Ä)", title: "ÂáΩÈ§®Êé°Ë≤∑„ÉªÂ§úÊôØ",
                events: [
                    { time: "11:10", title: "ÊäµÈÅîÂáΩÈ§®Ê©üÂ†¥ (HKD)", desc: "ÂÖ•Â¢ÉÊâãÁ∫å„ÄÅÈ†òË°åÊùé", icon: "‚úàÔ∏è", loc: "ÂáΩÈ§®Á©∫Ê∏Ø" },
                    { time: "13:15", title: "UNIQLO Êé°Ë≥º", desc: "Êê≠Ë®àÁ®ãËªäÂâçÂæÄÂáΩÈ§®Êò≠Âíå Town Plaza", icon: "üõçÔ∏è", loc: "UNIQLO ÂáΩÈ§®Êò≠Âíå„Çø„Ç¶„É≥„Éó„É©„Ç∂Â∫ó" },
                    { time: "14:20", title: "Bic Camera", desc: "ÈõªÂô®ËàáÊîùÂΩ±Âë®ÈÇäÊé°Ë≥º", icon: "üì∑", loc: "„Ç≥„Ç∏„Éû√ó„Éì„ÉÉ„ÇØ„Ç´„É°„É© ÂáΩÈ§®Â∫ó" },
                    { time: "15:15", title: "ÂõûÈ£ØÂ∫óÊîæÊà∞Âà©ÂìÅ", desc: "Ë®àÁ®ãËªäÁßªÂãï", icon: "üöï", loc: "JR Inn Hakodate" },
                    { time: "16:00", title: "ÈáëÊ£ÆÁ¥ÖÁ£öÂÄâÂ∫´", desc: "ËºïË£ùÊº´Ê≠•Ê∏ØÁÅ£", icon: "üß±", loc: "ÈáëÊ£ÆËµ§„É¨„É≥„Ç¨ÂÄâÂ∫´" },
                    { time: "17:00", title: "ÂáΩÈ§®Â±±Â§úÊôØ", desc: "ÁôæËê¨Â§úÊôØ (Á∫úËªä)", icon: "üåÉ", loc: "ÂáΩÈ§®Â±±„É≠„Éº„Éó„Ç¶„Çß„Ç§" },
                    { time: "ÊôöÈ§ê", title: "ÁÅ£ÂçÄÊôöÈ§ê", desc: "ÂáΩÈ§®Á´ôÊàñÁÅ£ÂçÄÈôÑËøë", icon: "üçΩÔ∏è", loc: "ÂáΩÈ§®ÈßÖ" }
                ]
            },
            {
                day: 2, date: "2/3 (‰∫å)", title: "ÈùíÊ£ÆËóùË°ì„ÉªË≥ºÁâ©",
                events: [
                    { time: "08:00", title: "ÂáΩÈ§®ÊúùÂ∏Ç", desc: "Êó©È§êÔºöÊµ∑ÈÆÆ‰∏º„ÄÅÈá£ÁÉèË≥ä", icon: "ü¶ë", loc: "ÂáΩÈ§®ÊúùÂ∏Ç" },
                    { time: "10:00", title: "Êñ∞ÂππÁ∑öÂæÄÈùíÊ£Æ", desc: "È†êË®à 13:45 ÊäµÈÅîÈùíÊ£ÆÁ´ô", icon: "üöÖ", loc: "Êñ∞ÂáΩÈ§®ÂåóÊñóÈßÖ" },
                    { time: "14:15", title: "Dormy Inn", desc: "ÊîæË°åÊùé (Ë®àÁ®ãËªä)", icon: "üè®", loc: "Dormy Inn Aomori" },
                    { time: "14:40", title: "ÈùíÊ£ÆÁ∏£Á´ãÁæéË°ìÈ§®", desc: "ÂèÉËßÄÂ•àËâØÁæéÊô∫„ÄåÈùíÊ£ÆÁä¨„Äç", icon: "üé®", loc: "ÈùíÊ£ÆÁúåÁ´ãÁæéË°ìÈ§®" },
                    { time: "18:00", title: "ÈùíÊ£ÆÊâáË≤ùÂ∞èÂ±ã", desc: "ÊôöÈ§ê", icon: "üêö", loc: "„ÅÇ„Åä„ÇÇ„ÇäÂ∏ÜÁ´ãÂ∞èÂ±ã" },
                    { time: "19:30", title: "ÂîêÂêâË®∂Âæ∑", desc: "ÈùíÊ£ÆÊñ∞Áî∫Â∫óÊé°Ë≥º", icon: "üêß", loc: "„Éâ„É≥„Éª„Ç≠„Éõ„Éº„ÉÜ ÈùíÊ£ÆÊñ∞Áî∫Â∫ó" }
                ]
            },
            {
                day: 3, date: "2/4 (‰∏â)", title: "ÊöñÁàêÂàóËªä„ÉªËòãÊûúÊ¥æ",
                events: [
                    { time: "09:00", title: "ÁßüËªäËá™Èßï", desc: "ÈùíÊ£ÆÁ´ôÂèñËªä (4WD)", icon: "üöó", loc: "JRÈßÖ„É¨„É≥„Çø„Ç´„ÉºÈùíÊ£ÆÂñ∂Ê•≠ÊâÄ" },
                    { time: "10:15", title: "ELM Ë≥ºÁâ©‰∏≠ÂøÉ", desc: "3COINS+plus (ÈôêÊôÇ35ÂàÜ)", icon: "üõí", loc: "ELM Shopping Center" },
                    { time: "12:30", title: "ÊöñÁàêÂàóËªä", desc: "Ê¥•ËºïÈêµÈÅì ÁÉ§È≠∑È≠ö", icon: "üî•", loc: "Ê¥•ËªΩ‰∫îÊâÄÂ∑ùÂéüÈßÖ" },
                    { time: "15:30", title: "Ëó§Áî∞Á¥ÄÂøµÂ∫≠Âúí", desc: "„ÄêÈáçË¶Å„ÄëË∂ïÂú®16:00ÂâçÈªûÈ§ê", icon: "‚òï", loc: "Ëó§Áî∞Ë®òÂøµÂ∫≠Âúí" },
                    { time: "16:30", title: "ÂºòÂâçÂüéÈõ™Èõï", desc: "Ê¨£Ë≥ûÁôΩÂ§©Èõ™ÊôØ", icon: "‚ùÑÔ∏è", loc: "ÂºòÂâçÂÖ¨Âúí" },
                    { time: "17:30", title: "ËøîÂõûÈùíÊ£ÆÂ∏Ç", desc: "Â§úÈñìÈõ™Âú∞ÈßïÈßõÂ∞èÂøÉ", icon: "üöó", loc: "Dormy Inn Aomori" }
                ]
            },
            {
                day: 4, date: "2/5 (Âõõ)", title: "Ê®πÂÜ∞„ÉªÊªëÈõ™„ÉªÊòüÈáé",
                events: [
                    { time: "08:45", title: "Âè§Â∑ùÂ∏ÇÂ†¥", desc: "Êó©È§ê Nokkedon", icon: "üçö", loc: "ÈùíÊ£ÆÈ≠öËèú„Çª„É≥„Çø„Éº" },
                    { time: "09:30", title: "ÂâçÂæÄÂÖ´Áî≤Áî∞", desc: "‰∏äÂ±±ËªäÁ®ãÁ¥Ñ1hr 15m", icon: "üöó", loc: "ÂÖ´Áî≤Áî∞„É≠„Éº„Éó„Ç¶„Çß„Éº" },
                    { time: "10:40", title: "ÂÖ´Áî≤Áî∞Ê®πÂÜ∞", desc: "Êê≠Á∫úËªäÁúã Snow Monsters", icon: "üö†", loc: "ÂÖ´Áî≤Áî∞„É≠„Éº„Éó„Ç¶„Çß„Éº" },
                    { time: "13:15", title: "È¶¨ÈñÄÊ∫´Ê≥âÊªëÈõ™Â†¥", desc: "ÂàùÂ≠∏ËÄÖÊªëÈõ™È´îÈ©ó", icon: "üéø", loc: "„Åæ„Åã„Å©Ê∏©Ê≥â„Çπ„Ç≠„ÉºÂ†¥" },
                    { time: "15:45", title: "ÂâçÂæÄÊòüÈáé", desc: "ËªäÁ®ã35ÂàÜ", icon: "üöó", loc: "ÊòüÈáé„É™„Çæ„Éº„Éà ÈùíÊ£ÆÂ±ã" },
                    { time: "17:30", title: "Nore Sore È£üÂ†Ç", desc: "È£ØÂ∫óËá™Âä©ÊôöÈ§ê", icon: "üç±", loc: "ÊòüÈáé„É™„Çæ„Éº„Éà ÈùíÊ£ÆÂ±ã" }
                ]
            },
            {
                day: 5, date: "2/6 (‰∫î)", title: "ÊòüÈáéÊÖ¢Ê¥ªÂÖ®Êó•",
                events: [
                    { time: "‰∏äÂçà", title: "Êô®ÈñìÊµÆÊπØ", desc: "Èú≤Â§©È¢®ÂëÇ„ÄÅÊó©È§ê", icon: "‚ô®Ô∏è", loc: "ÊòüÈáé„É™„Çæ„Éº„Éà ÈùíÊ£ÆÂ±ã" },
                    { time: "10:00", title: "ÊöñÁàêÈ¶¨Ëªä", desc: "ÈúÄÈ†êÁ¥Ñ", icon: "üê¥", loc: "ÊòüÈáé„É™„Çæ„Éº„Éà ÈùíÊ£ÆÂ±ã" },
                    { time: "11:30", title: "ÂÖ´È£ü‰∏≠ÂøÉ", desc: "ÂçàÈ§êÔºöÁÇ≠ÁÉ§Êµ∑ÈÆÆ", icon: "üêü", loc: "ÂÖ´È£ü„Çª„É≥„Çø„Éº" },
                    { time: "‰∏ãÂçà", title: "Èá£ÊâáË≤ù/ÂïÜÂ∫óË°ó", desc: "È£ØÂ∫óÂÖßÊ¥ªÂãï", icon: "üéâ", loc: "ÊòüÈáé„É™„Çæ„Éº„Éà ÈùíÊ£ÆÂ±ã" },
                    { time: "17:30", title: "ÂçóÈÉ®Êõ≤Â±ã/ÊôöÈ§ê", desc: "Êá∑Áü≥ÊñôÁêÜÊàñËá™Âä©È§ê", icon: "üç≤", loc: "ÊòüÈáé„É™„Çæ„Éº„Éà ÈùíÊ£ÆÂ±ã" },
                    { time: "20:00", title: "Èô∏Â•ßÁ•≠ÂÖ∏Â±ã", desc: "ËßÄË≥ûË°®Êºî", icon: "ü•Å", loc: "ÊòüÈáé„É™„Çæ„Éº„Éà ÈùíÊ£ÆÂ±ã" }
                ]
            },
            {
                day: 6, date: "2/7 (ÂÖ≠)", title: "ÂÆâÂÖ®ËøîÁ®ã",
                events: [
                    { time: "10:00", title: "Ê∫ñÊôÇÈÄÄÊàø", desc: "„ÄêÈêµÂæã„ÄëÈ†êÁïô3.5hrÁ∑©Ë°ù", icon: "‚ö†Ô∏è", loc: "ÊòüÈáé„É™„Çæ„Éº„Éà ÈùíÊ£ÆÂ±ã" },
                    { time: "13:00", title: "ÈùíÊ£ÆÊ©üÂ†¥", desc: "Âä†ÊªøÊ≤πÈÇÑËªä", icon: "‚õΩ", loc: "ÈùíÊ£ÆÁ©∫Ê∏Ø" },
                    { time: "14:00", title: "ÊúÄÂæåÊé°Ë≥º", desc: "ÂÖçÁ®ÖÂ∫ó/ÂúüÁî¢", icon: "üéÅ", loc: "ÈùíÊ£ÆÁ©∫Ê∏Ø" },
                    { time: "15:30", title: "BR 121", desc: "È£õÂæÄÂè∞ÁÅ£", icon: "‚úàÔ∏è", loc: "ÈùíÊ£ÆÁ©∫Ê∏Ø" }
                ]
            }
        ];

        // --- 2. Ê™¢Ë¶ñÊ®°ÂºèÈÇèËºØ ---
        let currentViewMode = 'day';
        let currentDayIdx = 0;

        function setViewMode(mode, btn) {
            currentViewMode = mode;
            document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            const tabsContainer = document.getElementById('day-tabs-container');
            if (mode === 'day') {
                tabsContainer.style.display = 'flex';
                renderDayTabs();
                renderItineraryDay(currentDayIdx);
            } else {
                tabsContainer.style.display = 'none';
                renderItineraryAll();
            }
        }

        function renderDayTabs() {
            const container = document.getElementById('day-tabs-container');
            let html = '';
            tripData.forEach((day, idx) => {
                html += `<div class="day-tab ${idx === currentDayIdx ? 'active' : ''}" onclick="switchDay(${idx})">Day ${day.day}</div>`;
            });
            container.innerHTML = html;
        }

        function switchDay(idx) {
            currentDayIdx = idx;
            renderDayTabs();
            renderItineraryDay(idx);
        }

        function renderItineraryDay(idx) {
            const container = document.getElementById('itinerary-list');
            const day = tripData[idx];
            let eventsHtml = day.events.map(ev => createEventCard(ev)).join('');
            container.innerHTML = `
                <div style="margin-bottom:10px;">
                    <h2 style="font-size:1.4rem; color:var(--text-main);">${day.date} ${day.title}</h2>
                </div>
                ${eventsHtml}
            `;
        }

        function renderItineraryAll() {
            const container = document.getElementById('itinerary-list');
            let html = '';
            tripData.forEach(day => {
                let eventsHtml = day.events.map(ev => createEventCard(ev)).join('');
                html += `
                    <div style="margin-top:30px; margin-bottom:10px; border-bottom:2px solid #ddd; padding-bottom:5px;">
                        <h3 style="color:var(--primary-wood);">Day ${day.day} - ${day.title}</h3>
                    </div>
                    ${eventsHtml}
                `;
            });
            container.innerHTML = html;
        }

        function createEventCard(ev) {
            const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(ev.loc)}`;
            return `
                <div class="timeline-card">
                    <div class="card-top">
                        <span class="card-time">${ev.time}</span>
                        <span style="font-size:1.2rem;">${ev.icon}</span>
                    </div>
                    <div class="card-title">${ev.title}</div>
                    <div class="card-desc">${ev.desc}</div>
                    <a href="${mapUrl}" target="_blank" class="btn-map">
                        <i class="fa-solid fa-location-arrow" style="margin-right:5px;"></i> Â∞éËà™
                    </a>
                </div>
            `;
        }

        // --- 3. Ë®òÂ∏≥ÈÇèËºØ (Â§ö‰∫∫Áâà) ---
        let expenses = JSON.parse(localStorage.getItem('trip_expenses_v3')) || [];
        
        function renderExpenses() {
            const list = document.getElementById('expense-list');
            list.innerHTML = '';
            
            let totals = { YK: 0, YY: 0, YS: 0 };

            expenses.forEach((ex, i) => {
                totals[ex.payer] += parseInt(ex.price);
                list.innerHTML += `
                    <div style="background:white; padding:12px; border-radius:12px; margin-bottom:8px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                        <div>
                            <div style="font-weight:bold; font-size:1rem;">${ex.name}</div>
                            <div style="font-size:0.8rem; color:#888;">
                                <span style="background:#eee; padding:2px 6px; border-radius:4px; margin-right:5px;">${ex.payer}</span>
                                $${ex.price}
                            </div>
                        </div>
                        <i class="fa-solid fa-trash" style="color:#ffab91; cursor:pointer; padding:5px;" onclick="delExpense(${i})"></i>
                    </div>
                `;
            });

            document.getElementById('total-yk').innerText = `$${totals.YK.toLocaleString()}`;
            document.getElementById('total-yy').innerText = `$${totals.YY.toLocaleString()}`;
            document.getElementById('total-ys').innerText = `$${totals.YS.toLocaleString()}`;
            
            localStorage.setItem('trip_expenses_v3', JSON.stringify(expenses));
        }

        function addExpense() {
            const name = document.getElementById('expense-name').value;
            const price = document.getElementById('expense-price').value;
            const payer = document.getElementById('expense-payer').value;
            
            if(name && price) {
                expenses.unshift({ name, price, payer, date: new Date() });
                document.getElementById('expense-name').value = '';
                document.getElementById('expense-price').value = '';
                renderExpenses();
            }
        }

        function delExpense(i) {
            if(confirm('Á¢∫ÂÆöÂà™Èô§Ê≠§Á≠ÜÊ¨æÈ†ÖÔºü')) {
                expenses.splice(i, 1);
                renderExpenses();
            }
        }

        // --- 4. Â∑•ÂÖ∑ÈÇèËºØ (ÁøªË≠Ø & ÂåØÁéá) ---
        let currentRate = 0.22; // È†êË®≠

        function doTranslate() {
            const text = document.getElementById('trans-input').value;
            if(text) {
                const url = `https://translate.google.com/?sl=zh-TW&tl=ja&text=${encodeURIComponent(text)}&op=translate`;
                window.open(url, '_blank');
            }
        }

        function calcMoney(source) {
            const jpyInput = document.getElementById('calc-jpy');
            const twdInput = document.getElementById('calc-twd');
            
            if (source === 'jpy') {
                twdInput.value = (jpyInput.value * currentRate).toFixed(0);
            } else {
                jpyInput.value = (twdInput.value / currentRate).toFixed(0);
            }
        }

        async function fetchRateAndWeather() {
            // ÂåØÁéá (‰ΩøÁî®ÂÖçË≤ªAPIÔºåËã•Â§±ÊïóÂâáÁî®0.22)
            try {
                const res = await fetch('https://api.exchangerate-api.com/v4/latest/JPY');
                const data = await res.json();
                if(data && data.rates && data.rates.TWD) {
                    currentRate = data.rates.TWD;
                    document.getElementById('rate-display').innerText = currentRate.toFixed(3);
                    document.getElementById('rate-calc').innerText = `1000ÂÜÜ ‚âà ${(1000*currentRate).toFixed(0)}ÂÖÉ`;
                    document.getElementById('calc-rate-val').innerText = currentRate.toFixed(3);
                }
            } catch(e) { console.log('Rate fetch failed, using default'); }

            // Â§©Ê∞£ (Open-Meteo)
            try {
                const wRes = await fetch("https://api.open-meteo.com/v1/forecast?latitude=41.76&longitude=140.73&current=temperature_2m&timezone=Asia%2FTokyo");
                const wData = await wRes.json();
                document.getElementById('temp-hakodate').innerText = Math.round(wData.current.temperature_2m) + "¬∞";
            } catch(e) {}
            
            // ÂÄíÊï∏
            const tripDate = new Date("2026-02-02").getTime();
            const now = new Date().getTime();
            document.getElementById('countdown-days').innerText = Math.ceil((tripDate - now)/(1000*60*60*24));
        }

        // --- 5. ÂàùÂßãÂåñ ---
        function switchTab(tab, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            window.scrollTo(0,0);
        }

        window.onload = function() {
            setViewMode('day', document.querySelector('.toggle-btn.active'));
            renderExpenses();
            fetchRateAndWeather();
        }
    </script>
</body>
</html>
