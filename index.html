<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ÈùíÊ£ÆÂáΩÈ§®ÂÜ¨ÊóÖ 2026</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#F2EFE9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #F2EFE9;
            --card-glass: rgba(255, 255, 255, 0.95);
            --primary-wood: #8D6E63;
            --secondary-wood: #A1887F;
            --text-main: #4E342E;
            --text-sub: #8D6E63;
            --shadow-card: 0 4px 15px rgba(141, 110, 99, 0.08);
            --shadow-float: 0 10px 30px rgba(0,0,0,0.15);
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#D7CCC8 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text-main);
            margin: 0;
            padding: 0;
            padding-bottom: calc(90px + var(--safe-area-bottom));
            overscroll-behavior-y: none;
        }

        /* --- Header --- */
        .hero-section {
            height: 280px;
            background: linear-gradient(180deg, rgba(0,0,0,0.1) 0%, var(--bg-color) 100%),
                        url('https://images.unsplash.com/photo-1548261320-56d15b021319?q=80&w=2574') center/cover;
            position: relative;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }
        
        .hero-title-group { margin-bottom: 20px; text-shadow: 0 2px 4px rgba(255,255,255,0.8); }
        h1 { font-size: 2rem; margin: 0; color: #3E2723; }
        .subtitle { font-size: 0.95rem; font-weight: bold; color: #5D4037; opacity: 0.9; }

        /* --- Widget Bar --- */
        .widget-bar {
            display: flex; gap: 10px; overflow-x: auto; scrollbar-width: none; margin-top: -30px; padding: 0 20px 10px;
            position: relative; z-index: 10;
        }
        .widget-card {
            background: rgba(255,255,255,0.9); backdrop-filter: blur(8px);
            border-radius: 14px; padding: 10px 15px; min-width: 110px;
            box-shadow: var(--shadow-card); flex-shrink: 0;
            border: 1px solid rgba(255,255,255,0.5);
        }
        .widget-label { font-size: 0.75rem; color: var(--text-sub); font-weight: bold; }
        .widget-val { font-size: 1.1rem; font-weight: 800; color: var(--text-main); margin-top: 2px; }

        /* --- View Toggle --- */
        .view-toggle {
            display: flex; justify-content: center; gap: 10px; margin: 10px 0;
        }
        .toggle-pill {
            padding: 6px 16px; border-radius: 20px; font-size: 0.9rem; font-weight: bold;
            background: #E0D8D6; color: #8D6E63; border: none; transition: 0.3s;
        }
        .toggle-pill.active { background: var(--primary-wood); color: white; box-shadow: 0 4px 10px rgba(141,110,99,0.3); }

        /* --- Day Tabs --- */
        .day-tabs { display: flex; gap: 10px; overflow-x: auto; padding: 10px 20px; scrollbar-width: none; }
        .day-tab {
            background: white; padding: 8px 16px; border-radius: 12px; font-size: 0.9rem; white-space: nowrap;
            color: var(--text-sub); box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: 0.2s;
        }
        .day-tab.active { background: var(--text-main); color: white; transform: scale(1.05); }

        /* --- Itinerary List (Card Style) --- */
        .itinerary-container { padding: 10px 20px; }
        .event-card {
            background: white; border-radius: 18px; padding: 15px; margin-bottom: 15px;
            display: flex; align-items: center; gap: 15px;
            box-shadow: var(--shadow-card); position: relative; overflow: hidden;
            transition: transform 0.2s; cursor: pointer;
        }
        .event-card:active { transform: scale(0.98); }
        .event-card::before {
            content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 6px;
            background: var(--primary-wood);
        }
        
        .event-thumb {
            width: 60px; height: 60px; border-radius: 12px; object-fit: cover; background: #eee;
            flex-shrink: 0;
        }
        .event-info { flex: 1; }
        .event-time { 
            font-size: 0.8rem; font-weight: 700; color: white; background: var(--secondary-wood);
            padding: 2px 8px; border-radius: 6px; display: inline-block; margin-bottom: 4px;
        }
        .event-title { font-size: 1.05rem; font-weight: 700; color: var(--text-main); line-height: 1.3; }
        .event-arrow { color: #ccc; font-size: 1.2rem; }

        /* --- Detail Modal (Bottom Sheet) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4); z-index: 900; opacity: 0; visibility: hidden; transition: 0.3s;
            backdrop-filter: blur(3px);
        }
        .modal-overlay.open { opacity: 1; visibility: visible; }
        
        .detail-modal {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 85vh;
            background: #FAF9F6; border-radius: 30px 30px 0 0; z-index: 1000;
            transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            overflow-y: auto; display: flex; flex-direction: column;
            box-shadow: var(--shadow-float);
        }
        .detail-modal.open { transform: translateY(0); }

        .modal-hero {
            height: 250px; width: 100%; object-fit: cover;
            mask-image: linear-gradient(to bottom, black 80%, transparent 100%);
        }
        .modal-close-btn {
            position: absolute; top: 20px; right: 20px; width: 36px; height: 36px;
            background: rgba(255,255,255,0.9); border-radius: 50%; border: none;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; color: #333; box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 1010;
        }
        
        .modal-content { padding: 0 25px 40px; margin-top: -40px; position: relative; }
        .modal-tag {
            background: var(--text-main); color: white; padding: 5px 12px; border-radius: 8px;
            font-size: 0.9rem; font-weight: bold; display: inline-block; margin-bottom: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .modal-title { font-size: 1.8rem; font-weight: 800; margin-bottom: 15px; color: #3E2723; line-height: 1.2; }
        
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .action-btn {
            padding: 12px; border-radius: 12px; border: none; font-weight: bold; font-size: 0.95rem;
            display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); text-decoration: none;
        }
        .btn-google { background: #E3F2FD; color: #1565C0; }
        .btn-web { background: #F3E5F5; color: #7B1FA2; }
        
        .info-box {
            background: white; padding: 20px; border-radius: 16px; margin-bottom: 20px;
            box-shadow: var(--shadow-card); border-left: 4px solid var(--secondary-wood);
        }
        .info-label { font-size: 0.85rem; color: #999; font-weight: bold; letter-spacing: 1px; margin-bottom: 8px; }
        .info-text { font-size: 1rem; line-height: 1.6; color: #555; white-space: pre-line; }

        /* --- Expense & Tools (Keep Simple) --- */
        .tab-content { display: none; padding: 20px; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- Bottom Nav --- */
        .nav-container {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; height: 65px;
            background: rgba(78, 52, 46, 0.95); backdrop-filter: blur(10px);
            border-radius: 50px; display: flex; justify-content: space-evenly; align-items: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.25); z-index: 2000;
        }
        .nav-item { color: rgba(255,255,255,0.5); font-size: 1.4rem; padding: 10px; transition: 0.3s; position: relative; }
        .nav-item.active { color: #fff; transform: translateY(-3px); }
        .nav-item.active::after {
            content: ''; position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; background: #fff; border-radius: 50%;
        }
        
        /* Helper Classes */
        .text-center { text-align: center; }
        .pill-group { background: white; padding: 10px; border-radius: 12px; display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 15px; }
        .form-input { border: 1px solid #eee; padding: 10px; border-radius: 8px; flex: 1; }
        .btn-main { background: var(--primary-wood); color: white; border: none; padding: 10px 20px; border-radius: 8px; width: 100%; font-weight: bold; }

    </style>
</head>
<body>

    <!-- HERO HEADER -->
    <header class="hero-section">
        <div class="hero-title-group">
            <h1>ÈùíÊ£ÆÂáΩÈ§®ÂÜ¨ÊóÖ</h1>
            <div class="subtitle">2026.02.02 - 02.07 ‚Ä¢ Family Trip</div>
        </div>
    </header>

    <!-- WIDGETS -->
    <div class="widget-bar">
        <div class="widget-card">
            <div class="widget-label">ÂÄíÊï∏Ë®àÊôÇ</div>
            <div class="widget-val" id="countdown-display">--</div>
        </div>
        <div class="widget-card">
            <div class="widget-label">JPY ÂåØÁéá</div>
            <div class="widget-val" id="rate-display">0.22</div>
        </div>
        <div class="widget-card">
            <div class="widget-label">ÂáΩÈ§®Ê∞£Ê∫´</div>
            <div class="widget-val" id="temp-hakodate">--¬∞</div>
        </div>
        <div class="widget-card">
            <div class="widget-label">ÈùíÊ£ÆÊ∞£Ê∫´</div>
            <div class="widget-val" id="temp-aomori">--¬∞</div>
        </div>
    </div>

    <!-- TAB 1: ITINERARY -->
    <div id="tab-itinerary" class="tab-content active" style="padding: 0;">
        <div class="view-toggle">
            <button class="toggle-pill active" onclick="setViewMode('day', this)">ÂàÜÊó•Ê™¢Ë¶ñ</button>
            <button class="toggle-pill" onclick="setViewMode('all', this)">Á∏ΩË¶ΩÊ®°Âºè</button>
        </div>

        <div class="day-tabs" id="day-tabs-container">
            <!-- JS Generated -->
        </div>

        <div id="itinerary-list" class="itinerary-container">
            <!-- JS Generated Cards -->
        </div>
    </div>

    <!-- TAB 2: EXPENSES -->
    <div id="tab-expenses" class="tab-content">
        <h2 style="margin-top:0;">Â§ö‰∫∫Ë®òÂ∏≥Á∞ø</h2>
        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; margin-bottom:20px;">
            <div class="widget-card text-center" style="min-width:auto;">
                <div class="widget-label">YK ‰ª£Â¢ä</div>
                <div class="widget-val" id="total-yk" style="font-size:1rem;">$0</div>
            </div>
            <div class="widget-card text-center" style="min-width:auto;">
                <div class="widget-label">YY ‰ª£Â¢ä</div>
                <div class="widget-val" id="total-yy" style="font-size:1rem;">$0</div>
            </div>
            <div class="widget-card text-center" style="min-width:auto;">
                <div class="widget-label">YS ‰ª£Â¢ä</div>
                <div class="widget-val" id="total-ys" style="font-size:1rem;">$0</div>
            </div>
        </div>

        <div class="pill-group">
            <input type="text" id="ex-name" class="form-input" placeholder="È†ÖÁõÆ" style="min-width:100px;">
            <input type="number" id="ex-price" class="form-input" placeholder="$" style="max-width:80px;">
            <select id="ex-payer" class="form-input" style="max-width:80px;">
                <option value="YK">YK</option>
                <option value="YY">YY</option>
                <option value="YS">YS</option>
            </select>
            <button class="btn-main" onclick="addExpense()">Ë®òÂ∏≥</button>
        </div>
        <div id="expense-list"></div>
    </div>

    <!-- TAB 3: TOOLS -->
    <div id="tab-tools" class="tab-content">
        <h2 style="margin-top:0;">ÂØ¶Áî®Â∑•ÂÖ∑</h2>
        <div class="info-box">
            <div class="info-label">Âç≥ÊôÇÁøªË≠Ø (Ë∑≥ËΩâ Google)</div>
            <textarea id="trans-input" class="form-input" style="width:100%; margin-bottom:10px;" rows="3" placeholder="Ëº∏ÂÖ•‰∏≠Êñá..."></textarea>
            <button class="btn-main" style="background:#4285F4;" onclick="doTranslate()">ÁøªË≠ØÊàêÊó•Êñá</button>
        </div>
        <div class="info-box">
            <div class="info-label">ÂåØÁéáË©¶ÁÆó</div>
            <div style="display:flex; gap:10px; align-items:center;">
                <input type="number" id="calc-jpy" class="form-input" placeholder="JPY" oninput="calcMoney('jpy')">
                <i class="fa-solid fa-right-left" style="color:#999;"></i>
                <input type="number" id="calc-twd" class="form-input" placeholder="TWD" oninput="calcMoney('twd')">
            </div>
        </div>
    </div>

    <!-- DETAIL MODAL -->
    <div class="modal-overlay" id="modal-overlay" onclick="closeDetail()"></div>
    <div class="detail-modal" id="detail-modal">
        <button class="modal-close-btn" onclick="closeDetail()"><i class="fa-solid fa-xmark"></i></button>
        <img src="" id="modal-img" class="modal-hero">
        <div class="modal-content">
            <span class="modal-tag" id="modal-time">10:00</span>
            <div class="modal-title" id="modal-title">Title</div>
            
            <div class="action-grid">
                <a href="#" target="_blank" id="btn-map" class="action-btn btn-google">
                    <i class="fa-solid fa-location-dot"></i> Google Â∞éËà™
                </a>
                <a href="#" target="_blank" id="btn-web" class="action-btn btn-web">
                    <i class="fa-solid fa-globe"></i> ÂÆòÊñπÁ∂≤Á´ô
                </a>
            </div>

            <div class="info-box">
                <div class="info-label">ÊîªÁï•Á≠ÜË®ò & Ë©≥Á¥∞Ë≥áË®ä</div>
                <div class="info-text" id="modal-desc">Description...</div>
            </div>
        </div>
    </div>

    <!-- BOTTOM NAV -->
    <div class="nav-container">
        <div class="nav-item active" onclick="switchTab('itinerary', this)"><i class="fa-solid fa-map"></i></div>
        <div class="nav-item" onclick="switchTab('expenses', this)"><i class="fa-solid fa-receipt"></i></div>
        <div class="nav-item" onclick="switchTab('tools', this)"><i class="fa-solid fa-kit-medical"></i></div>
    </div>

    <script>
        // --- DATA: Ë°åÁ®ãË≥áÊñôÂ∫´ (4.0Áâà: Âê´ÂúñÁâá„ÄÅÈÄ£Áµê„ÄÅË©≥Á¥∞ÊîªÁï•) ---
        // ÂúñÁâá‰æÜÊ∫ê‰ΩøÁî® Unsplash Source ÈóúÈçµÂ≠ó
        const tripData = [
            {
                day: 1, date: "2/2 (‰∏Ä)", title: "ÂáΩÈ§®ÊäµÈÅî",
                events: [
                    { 
                        time: "11:10", title: "ÊäµÈÅîÂáΩÈ§®Ê©üÂ†¥", icon: "‚úàÔ∏è",
                        loc: "ÂáΩÈ§®Á©∫Ê∏Ø",
                        img: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=800&auto=format&fit=crop",
                        url: "https://airport.ne.jp/ch_t/",
                        desc: "„ÄêÂÖ•Â¢ÉÊîªÁï•„Äë\nÊ©üÂ†¥‰∏çÂ§ßÔºåÈÄöÈóúÈÄöÂ∏∏ÂæàÂø´„ÄÇ\nÈ†òÂÆåË°åÊùéÂæåÔºåÁõ¥Êé•Âà∞ÂÖ•Â¢ÉÂ§ßÂª≥Â∞ãÊâæË®àÁ®ãËªä‰πòËªäËôï„ÄÇ\nÊ∞£Ê∫´È†êË®à -5Â∫¶ÔºåË´ãÂú®Ê©üÂ†¥ÂÖßÊääÂ∏ΩÂ≠êÊâãÂ•óÁ©øÊà¥Â•ΩÂÜçÂá∫ÈñÄ„ÄÇ"
                    },
                    { 
                        time: "13:15", title: "UNIQLO Êé°Ë≥º", icon: "üõçÔ∏è",
                        loc: "UNIQLO ÂáΩÈ§®Êò≠Âíå„Çø„Ç¶„É≥„Éó„É©„Ç∂Â∫ó",
                        img: "https://images.unsplash.com/photo-1542060748-10c28b62716f?q=80&w=800",
                        url: "https://map.uniqlo.com/jp/ja/detail/10101377",
                        desc: "„ÄêË≥ºÁâ©‰ªªÂãô 1„Äë\n‰ΩçÊñºÊò≠Âíå Town Plaza„ÄÇ\nÂøÖË≤∑Ê∏ÖÂñÆÔºöÁôºÁÜ±Ë°£ (Heattech Ultra Warm)„ÄÅÈò≤È¢®Ë§≤„ÄÅÁæΩÁµ®Â§ñÂ•ó„ÄÇ\nÈÄôË£°‰πüÊúâË∂ÖÂ∏ÇÔºåÂèØ‰ª•È†Ü‰æøË≤∑ÈªûÈõ∂È£üÂú®Ëªä‰∏äÂêÉ„ÄÇ"
                    },
                    { 
                        time: "16:00", title: "ÈáëÊ£ÆÁ¥ÖÁ£öÂÄâÂ∫´", icon: "üß±",
                        loc: "ÈáëÊ£ÆËµ§„É¨„É≥„Ç¨ÂÄâÂ∫´",
                        img: "https://images.unsplash.com/photo-1579500057271-9c6a71cb069b?q=80&w=800&auto=format&fit=crop",
                        url: "https://hakodate-kanemori.com/tw",
                        desc: "„ÄêÊîùÂΩ±Èªû„Äë\nÂÇçÊôöËóçË™øÊôÇÈñì (Blue Hour) ÊãçÁÖßÊúÄÁæé„ÄÇ\nÊé®Ëñ¶Âéª„ÄåSnaffle's„ÄçË≤∑Ëµ∑Âè∏ËõãÁ≥ïÔºåÂèØ‰ª•ÁèæÂ†¥ÂêÉ„ÄÇ\nÈÄôÈÇäÈù†ËøëÊµ∑ÈÇäÈ¢®Â§ßÔºåÂúçÂ∑æË¶ÅÂúçÂ•Ω„ÄÇ"
                    },
                    { 
                        time: "17:00", title: "ÂáΩÈ§®Â±±Â§úÊôØ", icon: "üåÉ",
                        loc: "ÂáΩÈ§®Â±±„É≠„Éº„Éó„Ç¶„Çß„Ç§",
                        img: "https://images.unsplash.com/photo-1532236204992-f5e85c024202?q=80&w=800&auto=format&fit=crop",
                        url: "https://334.co.jp/cht/",
                        desc: "„ÄêÁôæËê¨Â§úÊôØ„Äë\n‰∏ñÁïå‰∏âÂ§ßÂ§úÊôØ‰πã‰∏Ä„ÄÇ\nÊê≠‰πòÁ∫úËªäÁ¥Ñ 3 ÂàÜÈêòÂèØÈÅîÂ±±È†Ç„ÄÇ\nËßÄÊôØÂè∞‰∫∫ÊΩÆÁúæÂ§öÔºåÂª∫Ë≠∞Âà∞Êà∂Â§ñÁ¨¨‰∫åÂ±§Áî≤ÊùøÔºåË¶ñÈáéËºÉÂ•Ω‰ΩÜÈùûÂ∏∏ÂÜ∑ÔºÅ"
                    }
                ]
            },
            {
                day: 2, date: "2/3 (‰∫å)", title: "ÁßªÂãïËá≥ÈùíÊ£Æ",
                events: [
                    { 
                        time: "08:00", title: "ÂáΩÈ§®ÊúùÂ∏Ç", icon: "ü¶ë",
                        loc: "ÂáΩÈ§®ÊúùÂ∏Ç",
                        img: "https://images.unsplash.com/photo-1559339352-11d035aa65de?q=80&w=800",
                        url: "http://www.hakodate-asaichi.com/",
                        desc: "„ÄêÂøÖÂêÉÊîªÁï•„Äë\n1. Èá£Ê¥ªÁÉèË≥ä (ÂÖÉÁ•ñÊ¥ª„ÅÑ„ÅãÈá£Â†Ä)ÔºöÁèæÈá£ÁèæÊÆ∫ÔºåÂè£ÊÑüÁàΩËÑÜ„ÄÇ\n2. Êµ∑ÈÆÆ‰∏ºÔºöÊé®Ëñ¶„Äå„Åç„Åè„ÇàÈ£üÂ†Ç„ÄçÊàñ„Äå‰∏ÄËä±‰∫≠„Åü„Å≥„Åò„Äç„ÄÇ\n3. ÁÉ§ÂìàÂØÜÁìúÔºöÁï∂Â≠£Ê∞¥Êûú‰πü‰∏çË¶ÅÈåØÈÅé„ÄÇ"
                    },
                    { 
                        time: "14:40", title: "ÈùíÊ£ÆÁ∏£Á´ãÁæéË°ìÈ§®", icon: "üé®",
                        loc: "ÈùíÊ£ÆÁúåÁ´ãÁæéË°ìÈ§®",
                        img: "https://images.unsplash.com/photo-1629012435532-6d2a452d765d?q=80&w=800&auto=format&fit=crop",
                        url: "https://www.aomori-museum.jp/tw/",
                        desc: "„ÄêÂ•àËâØÁæéÊô∫„Äë\nÂøÖÁúãÔºöÈ´òÈÅî 8.5 ÂÖ¨Â∞∫ÁöÑ„ÄåÈùíÊ£ÆÁä¨„Äç„ÄÇ\nÊ≥®ÊÑèÔºöÁæéË°ìÈ§® 17:00 ÈñâÈ§®ÔºåÊúÄÂæåÂÖ•Â†¥ 16:30ÔºåÊôÇÈñìË¶ÅÊäìÁ∑ä„ÄÇ\nËã•Á©çÈõ™Â§™Ê∑±ÔºåÊà∂Â§ñÂçÄÂèØËÉΩÊúÉÂ∞ÅÈñâÔºåÂè™ËÉΩÂæûÂÆ§ÂÖßËßÄÁúã„ÄÇ"
                    },
                    { 
                        time: "18:00", title: "ÈùíÊ£ÆÊâáË≤ùÂ∞èÂ±ã", icon: "üêö",
                        loc: "„ÅÇ„Åä„ÇÇ„ÇäÂ∏ÜÁ´ãÂ∞èÂ±ã",
                        img: "https://images.unsplash.com/photo-1625937759425-420008064b32?q=80&w=800",
                        url: "https://aomori-hotategoya.com/",
                        desc: "„ÄêÈá£ÊâáË≤ùÈ´îÈ©ó„Äë\nÈôêÊôÇ 3 ÂàÜÈêòÔºå500 Êó•ÂúìÈá£‰∏ÄÊ¨°„ÄÇ\nÈá£Âà∞ÁöÑÊâáË≤ùÂèØ‰ª•ÈÅ∏ÊìáÔºöÂà∫Ë∫´„ÄÅÁÇ≠ÁÉ§ÊàñÊè°Â£ΩÂè∏„ÄÇ\nÈùûÂ∏∏Â•ΩÁé©‰∏îÊñ∞ÈÆÆÔºåÂ§±Êïó‰πüÊúâ‰øùÂ∫ï 2 È°ÜÔºÅ"
                    }
                ]
            },
            {
                day: 3, date: "2/4 (‰∏â)", title: "ÊöñÁàêÂàóËªä",
                events: [
                    { 
                        time: "10:15", title: "ELM Ë≥ºÁâ©‰∏≠ÂøÉ", icon: "üõí",
                        loc: "ELM Shopping Center",
                        img: "https://images.unsplash.com/photo-1519567241046-7f570eee3d9f?q=80&w=800",
                        url: "https://elm-no-machi.jp/",
                        desc: "„Äê3COINS+plus„Äë\nÈôêÊôÇ‰ªªÂãôÔºö35 ÂàÜÈêòÊé°Ë≥ºÔºÅ\nÈÄôË£°ÁöÑ 3COINS ÊòØÂ§ßÂûãÂ∫óÔºåÊúâÂæàÂ§öÂèØÊÑõÁöÑÈõ™ÁêÉË£ΩÈÄ†Ê©üÂíå‰øùÊöñÂ∞èÁâ©„ÄÇ\nË≤∑ÂÆåÁ´ãÂàªÂâçÂæÄ‰∫îÊâÄÂ∑ùÂéüÁ´ô„ÄÇ"
                    },
                    { 
                        time: "12:30", title: "Ê¥•ËºïÊöñÁàêÂàóËªä", icon: "üî•",
                        loc: "Ê¥•ËªΩ‰∫îÊâÄÂ∑ùÂéüÈßÖ",
                        img: "https://images.unsplash.com/photo-1475738972911-5b44ce984c42?q=80&w=800&auto=format&fit=crop",
                        url: "https://tsutetsu.com/stove.html",
                        desc: "„ÄêÂÜ¨Â≠£ÈôêÂÆö„Äë\nËªäÂªÇÂÖßÊúâÁáíÁÖ§ÁÇ≠ÁöÑÊöñÁàê„ÄÇ\n‰∏äËªäÂæåÊúÉÊúâË≤©ÂîÆÊé®ËªäÔºåÂãôÂøÖË≥ºË≤∑„ÄåÁÉ§È≠∑È≠ö (Surume)„ÄçÔºåËªäÊéåÂ∞èÂßêÊúÉÂπ´‰Ω†Âú®ÊöñÁàê‰∏äÁèæÁÉ§„ÄÇ\nÈÖç‰∏ä‰∏ÄÁì∂Ê¥•ËºïÊ∏ÖÈÖíÔºåÊúõËëóÁ™óÂ§ñÈõ™ÊôØÔºåÁµïÈÖç„ÄÇ"
                    },
                    { 
                        time: "15:30", title: "Ëó§Áî∞Á¥ÄÂøµÂ∫≠Âúí", icon: "üçé",
                        loc: "Ëó§Áî∞Ë®òÂøµÂ∫≠Âúí",
                        img: "https://images.unsplash.com/photo-1568285908272-98c94625579d?q=80&w=800",
                        url: "http://www.hirosakipark.or.jp/hujita/",
                        desc: "„ÄêÂ§ßÊ≠£Êµ™Êº´Âñ´Ëå∂ÂÆ§„Äë\n‰ªªÂãôÔºöË∂ïÂú® 16:00 ÈªûÈ§êÊà™Ê≠¢ÂâçÊäµÈÅî„ÄÇ\nÂøÖÈªûÔºöÂºòÂâçËòãÊûúÊ¥æ (ÈÄôË£°ÊúâÈõÜÁµêÂ§öÂÆ∂ÂêçÂ∫óÁöÑËòãÊûúÊ¥æÂèØÈÅ∏)„ÄÇ\nÂùêÂú®ÈôΩÂÖâÊàøÊ¨£Ë≥ûÂ∫≠ÂúíÈõ™ÊôØ„ÄÇ"
                    }
                ]
            },
            {
                day: 4, date: "2/5 (Âõõ)", title: "Ê®πÂÜ∞ËàáÊòüÈáé",
                events: [
                    { 
                        time: "10:40", title: "ÂÖ´Áî≤Áî∞Ê®πÂÜ∞", icon: "‚ùÑÔ∏è",
                        loc: "ÂÖ´Áî≤Áî∞„É≠„Éº„Éó„Ç¶„Çß„Éº",
                        img: "https://images.unsplash.com/photo-1483921020237-2ff51e8e4b22?q=80&w=800&auto=format&fit=crop",
                        url: "http://www.hakkoda-ropeway.jp/",
                        desc: "„ÄêSnow Monsters„Äë\nÊê≠‰πòÁ∫úËªäÂà∞Â±±È†ÇÂÖ¨ÂúíÁ´ô„ÄÇ\nÂ±±È†ÇÊ∞£Ê∫´Ê•µ‰Ωé (Á¥Ñ -10Â∫¶)ÔºåÈ¢®Â§ßÔºåÂãôÂøÖÂÖ®ÂâØÊ≠¶Ë£ù (Ë≠∑ÁõÆÈè°„ÄÅÈù¢ÁΩ©)„ÄÇ\nËã•Â§©Ê∞£Êô¥ÊúóÔºåÊôØËâ≤Â£ØËßÄÔºõËã•Êö¥È¢®Èõ™ÔºåÁ∫úËªäÂèØËÉΩÂÅúÈßõ (ÂÇôÊ°àÔºöÈ¶¨ÈñÄÊªëÈõ™Â†¥)„ÄÇ"
                    },
                    { 
                        time: "17:30", title: "ÊòüÈáéÈùíÊ£ÆÂ±ã", icon: "üè®",
                        loc: "ÊòüÈáé„É™„Çæ„Éº„Éà ÈùíÊ£ÆÂ±ã",
                        img: "https://images.unsplash.com/photo-1571003123894-1f0594d2b5d9?q=80&w=800&auto=format&fit=crop",
                        url: "https://hoshinoresorts.com/zh_tw/hotels/aomoriya/",
                        desc: "„ÄêÂÖ•‰ΩèÊîªÁï•„Äë\nCheck-in ÂæåÂÖàÈ†êÁ¥ÑÂõûÁ®ãÊé•ÈßÅËªä (Â¶ÇÊûúÈúÄË¶Å)„ÄÇ\nÊôöÈ§êÔºöNore Sore È£üÂ†Ç (Ëá™Âä©È§ê)ÔºåÊâáË≤ù„ÄÅËòãÊûúÊ±ÅÂêÉÂà∞È£Ω„ÄÇ\nÊôö‰∏äË®òÂæóÂéªÊ≠°È®∞Âª£Â†¥ (Jawamegu Hiroba) ÈÄõÈÄõ„ÄÇ"
                    }
                ]
            },
            {
                day: 5, date: "2/6 (‰∫î)", title: "ÊòüÈáéÂÖ®Êó•",
                events: [
                    { 
                        time: "09:00", title: "ÊµÆÊπØÊ∫´Ê≥â", icon: "‚ô®Ô∏è",
                        loc: "ÊòüÈáé„É™„Çæ„Éº„Éà ÈùíÊ£ÆÂ±ã",
                        img: "https://images.unsplash.com/photo-1519711683935-717e1345d355?q=80&w=800",
                        url: "https://hoshinoresorts.com/zh_tw/hotels/aomoriya/hotsprings/",
                        desc: "„ÄêÁµïÊôØÊ∫´Ê≥â„Äë\nÈú≤Â§©È¢®ÂëÇ„ÄåÊµÆÊπØ„ÄçÁúãËµ∑‰æÜÂÉèÊµÆÂú®Ê∞¥Ê±†‰∏ä„ÄÇ\nÂÜ¨Â§©Âë®ÂúçÊúÉÊúâÁù°È≠îÁáàÁ±†Ë£ùÈ£æÔºåÂä†‰∏äÈõ™ÊôØÔºåÁæé‰∏çÂãùÊî∂„ÄÇ\nÊó©‰∏ä‰∫∫ËºÉÂ∞ëÔºåÊòØÊ≥°ÊπØÂ•ΩÊôÇÊ©ü„ÄÇ"
                    },
                    { 
                        time: "11:30", title: "ÂÖ´È£ü‰∏≠ÂøÉ", icon: "üêü",
                        loc: "ÂÖ´È£ü„Çª„É≥„Çø„Éº",
                        img: "https://images.unsplash.com/photo-1534483509719-3feaee7c30da?q=80&w=800",
                        url: "https://www.849net.com/",
                        desc: "„Äê‰∏ÉËº™Êùë„Äë\nÂú®Â∏ÇÂ†¥ÂÖßË≥ºË≤∑ÂñúÊ≠°ÁöÑÊµ∑ÈÆÆ (ÁîüË†î„ÄÅÊâáË≤ù„ÄÅËù¶Â≠ê)„ÄÇ\nÁßüÁî®ÁÇ≠ÁÅ´Áàê (‰∏ÉËº™) ÁèæÁÉ§ÁèæÂêÉ„ÄÇ\nÊé®Ëñ¶ÔºöÈÄôË£°ÁöÑ‰πæË≤®Âíå‰º¥ÊâãÁ¶Æ‰πüÈùûÂ∏∏ÈΩäÂÖ®„ÄÇ"
                    },
                    { 
                        time: "20:00", title: "Èô∏Â•ßÁ•≠ÂÖ∏Â±ã", icon: "ü•Å",
                        loc: "ÊòüÈáé„É™„Çæ„Éº„Éà ÈùíÊ£ÆÂ±ã",
                        img: "https://images.unsplash.com/photo-1516280440614-6697288d5d38?q=80&w=800",
                        url: "https://hoshinoresorts.com/zh_tw/hotels/aomoriya/activities/show/",
                        desc: "„ÄêÂøÖÁúãË°®Êºî„Äë\nÂ±ïÁèæÈùíÊ£ÆÂõõÂ§ßÁ•≠ÂÖ∏ÁöÑÁÜ±Ë°ÄË°®Êºî„ÄÇ\nËä±ÊñóÁ¨†Ëàû„ÄÅÁù°È≠îÁáàÁ±†ÈÅãË°å„ÄÅÂ§™ÈºìÊºîÂ•è„ÄÇ\nÈúÄÊèêÂâçÈ†êÁ¥ÑÂ∫ß‰ΩçÔºåÊ∞£Ê∞õÈùûÂ∏∏ÁÜ±È¨ßÔºÅ"
                    }
                ]
            },
            {
                day: 6, date: "2/7 (ÂÖ≠)", title: "ÂÆâÂÖ®ËøîÁ®ã",
                events: [
                    { 
                        time: "13:00", title: "ÈùíÊ£ÆÊ©üÂ†¥", icon: "‚úàÔ∏è",
                        loc: "ÈùíÊ£ÆÁ©∫Ê∏Ø",
                        img: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=800",
                        url: "https://www.aomori-airport.co.jp/",
                        desc: "„ÄêÊúÄÂæåË°ùÂà∫„Äë\n1. ÈÇÑËªäÂâçË®òÂæóÂä†ÊªøÊ≤π„ÄÇ\n2. ÂÖçÁ®ÖÂ∫óÔºöË≥ºË≤∑ÈùíÊ£ÆËòãÊûúÊ¥æ„ÄÅËòãÊûúÊ±Å„ÄÅÂ§ßËíú‰ªôË≤ù„ÄÇ\n3. Á¢∫Ë™çË≠∑ÁÖßÂíåÈö®Ë∫´Ë°åÊùé„ÄÇ"
                    }
                ]
            }
        ];

        // --- JS LOGIC ---

        // 1. View Mode & Render
        let currentMode = 'day';
        let currentDayIdx = 0;

        function setViewMode(mode, btn) {
            currentMode = mode;
            document.querySelectorAll('.toggle-pill').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderItinerary();
        }

        function renderItinerary() {
            const container = document.getElementById('itinerary-list');
            const tabsContainer = document.getElementById('day-tabs-container');
            
            // Render Tabs
            if (currentMode === 'day') {
                tabsContainer.style.display = 'flex';
                let tabsHtml = '';
                tripData.forEach((day, i) => {
                    tabsHtml += `<div class="day-tab ${i === currentDayIdx ? 'active' : ''}" onclick="switchDay(${i})">Day ${day.day}</div>`;
                });
                tabsContainer.innerHTML = tabsHtml;
            } else {
                tabsContainer.style.display = 'none';
            }

            // Render List
            let listHtml = '';
            
            if (currentMode === 'day') {
                const day = tripData[currentDayIdx];
                listHtml += `<h2 style="margin:10px 0 20px;">${day.date} ${day.title}</h2>`;
                day.events.forEach(ev => listHtml += createEventCard(ev));
            } else {
                tripData.forEach(day => {
                    listHtml += `<h3 style="margin:30px 0 15px; color:var(--text-sub); border-bottom:1px solid #ddd; padding-bottom:5px;">${day.date} ${day.title}</h3>`;
                    day.events.forEach(ev => listHtml += createEventCard(ev));
                });
            }
            container.innerHTML = listHtml;
        }

        function switchDay(i) {
            currentDayIdx = i;
            renderItinerary();
        }

        function createEventCard(ev) {
            // Encode data into card for click handler
            const dataStr = encodeURIComponent(JSON.stringify(ev));
            return `
                <div class="event-card" onclick="openDetail('${dataStr}')">
                    <img src="${ev.img}" class="event-thumb">
                    <div class="event-info">
                        <div class="event-time">${ev.time}</div>
                        <div class="event-title">${ev.title}</div>
                    </div>
                    <div class="event-arrow"><i class="fa-solid fa-chevron-right"></i></div>
                </div>
            `;
        }

        // 2. Modal Logic
        function openDetail(dataStr) {
            const ev = JSON.parse(decodeURIComponent(dataStr));
            
            document.getElementById('modal-img').src = ev.img;
            document.getElementById('modal-time').innerText = ev.time;
            document.getElementById('modal-title').innerText = ev.title;
            document.getElementById('modal-desc').innerText = ev.desc;
            
            // Buttons
            const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(ev.loc)}`;
            document.getElementById('btn-map').href = mapUrl;
            document.getElementById('btn-web').href = ev.url || '#';
            
            document.getElementById('modal-overlay').classList.add('open');
            document.getElementById('detail-modal').classList.add('open');
        }

        function closeDetail() {
            document.getElementById('modal-overlay').classList.remove('open');
            document.getElementById('detail-modal').classList.remove('open');
        }

        // 3. Expenses & Tools
        let expenses = JSON.parse(localStorage.getItem('trip_expenses_v4')) || [];
        
        function renderExpenses() {
            const list = document.getElementById('expense-list');
            list.innerHTML = '';
            let totals = { YK: 0, YY: 0, YS: 0 };

            expenses.forEach((ex, i) => {
                totals[ex.payer] += parseInt(ex.price);
                list.innerHTML += `
                    <div style="background:white; padding:12px; border-radius:12px; margin-bottom:8px; display:flex; justify-content:space-between; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                        <div><strong>${ex.name}</strong> <span style="font-size:0.8rem; color:#888;">(${ex.payer})</span></div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <strong>$${ex.price}</strong>
                            <i class="fa-solid fa-trash" style="color:#ff8a80;" onclick="delExpense(${i})"></i>
                        </div>
                    </div>
                `;
            });

            document.getElementById('total-yk').innerText = `$${totals.YK}`;
            document.getElementById('total-yy').innerText = `$${totals.YY}`;
            document.getElementById('total-ys').innerText = `$${totals.YS}`;
            localStorage.setItem('trip_expenses_v4', JSON.stringify(expenses));
        }

        function addExpense() {
            const name = document.getElementById('ex-name').value;
            const price = document.getElementById('ex-price').value;
            const payer = document.getElementById('ex-payer').value;
            if(name && price) {
                expenses.unshift({ name, price, payer });
                document.getElementById('ex-name').value = '';
                document.getElementById('ex-price').value = '';
                renderExpenses();
            }
        }
        function delExpense(i) {
            if(confirm('Âà™Èô§?')) { expenses.splice(i,1); renderExpenses(); }
        }

        // Tools
        let rate = 0.22;
        async function initData() {
            try {
                // Rate
                const res = await fetch('https://api.exchangerate-api.com/v4/latest/JPY');
                const data = await res.json();
                if(data.rates.TWD) {
                    rate = data.rates.TWD;
                    document.getElementById('rate-display').innerText = rate.toFixed(3);
                }
                // Weather
                const wRes = await fetch("https://api.open-meteo.com/v1/forecast?latitude=41.76,40.82&longitude=140.73,140.74&current=temperature_2m&timezone=Asia%2FTokyo");
                const wData = await wRes.json();
                document.getElementById('temp-hakodate').innerText = Math.round(wData[0].current.temperature_2m) + "¬∞";
                document.getElementById('temp-aomori').innerText = Math.round(wData[1].current.temperature_2m) + "¬∞";
            } catch(e) {}
            
            // Countdown
            const days = Math.ceil((new Date("2026-02-02") - new Date())/(1000*60*60*24));
            document.getElementById('countdown-display').innerText = days + "Â§©";
        }

        function doTranslate() {
            const txt = document.getElementById('trans-input').value;
            if(txt) window.open(`https://translate.google.com/?sl=zh-TW&tl=ja&text=${encodeURIComponent(txt)}&op=translate`, '_blank');
        }

        function calcMoney(src) {
            const j = document.getElementById('calc-jpy');
            const t = document.getElementById('calc-twd');
            if(src==='jpy') t.value = (j.value * rate).toFixed(0);
            else j.value = (t.value / rate).toFixed(0);
        }

        // Init
        function switchTab(t, el) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('tab-'+t).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            window.scrollTo(0,0);
        }

        window.onload = function() {
            initData();
            renderItinerary();
            renderExpenses();
        }
    </script>
</body>
</html>
