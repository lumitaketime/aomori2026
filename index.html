<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>L'VOYAGE | å‡½é¤¨-é’æ£® æ—æªä¹‹æ—…</title>
    <meta name="theme-color" content="#1C2541">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Noto+Serif+TC:wght@300;500;700&family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Palette: Luxury Winter */
            --bg-body: #F9F8F4;
            --bg-card: #FFFFFF;
            --text-primary: #1A1A1A;
            --text-secondary: #666666;
            --accent-main: #1C2541; /* åˆå¤œè— */
            --accent-gold: #B49B67; /* é¦™æª³é‡‘ */
            --accent-red: #D9333F; /* é’æ£®ç´… */
            --line-light: #E0E0E0;
            --shadow-soft: 0 10px 40px -10px rgba(0,0,0,0.08);
            --font-serif: 'Cormorant Garamond', 'Noto Serif TC', serif;
            --font-sans: 'Noto Sans TC', sans-serif;
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; padding: 0;
            background-color: var(--bg-body);
            color: var(--text-primary);
            font-family: var(--font-sans);
            padding-bottom: calc(100px + var(--safe-bottom)); /* å¢åŠ åº•éƒ¨ç©ºé–“çµ¦å››å€‹æŒ‰éˆ• */
            overflow-x: hidden;
        }

        h1, h2, h3, .serif { font-family: var(--font-serif); }
        .hidden { display: none; } /* ä¿®æ­£å¾Œçš„ hidden class */

        /* --- INTRO --- */
        #intro-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background: var(--accent-main); color: white;
            z-index: 9999; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            transition: transform 1s cubic-bezier(0.77, 0, 0.175, 1);
            padding: 0 30px; /* é˜²æ­¢æ–‡å­—è²¼é‚Š */
        }
        
        /* FIX: ç¢ºä¿ intro-text å…§å®¹ç½®ä¸­ */
        .intro-text {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center; /* ç¢ºä¿å­å…ƒç´ ï¼ˆå¦‚æŒ‰éˆ•ï¼‰ç½®ä¸­ */
        }

        .intro-countdown-block { margin-bottom: 40px; opacity: 0; animation: fadeIn 1.5s ease forwards 0.3s; text-align: center; }
        .countdown-value { font-size: 5rem; line-height: 1; font-weight: 300; color: var(--accent-gold); font-family: var(--font-serif); }
        .intro-btn {
            margin-top: 50px; padding: 15px 40px; border: 1px solid rgba(255,255,255,0.3);
            background: transparent; color: white; font-family: var(--font-serif);
            font-size: 1.1rem; letter-spacing: 2px; cursor: pointer; transition: 0.3s;
            opacity: 0; animation: fadeIn 1.5s ease forwards 1s;
        }
        @keyframes fadeIn { to { opacity: 1; } }
        
        /* NEW: å°é¢å‹•æ…‹æ–‡å­—æ¨£å¼ - å„ªåŒ–ç‰ˆ */
        #dynamic-intro-text {
            font-family: var(--font-serif); /* ä½¿ç”¨è¥¯ç·šå­—é«”æ›´æœ‰è³ªæ„Ÿ */
            font-size: 1.1rem; 
            margin-top: 20px; 
            color: rgba(255,255,255,0.9); 
            max-width: 320px; 
            text-align: center; 
            line-height: 1.6; 
            min-height: 60px; /* é ç•™é«˜åº¦é¿å…è·³å‹• */
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 1.5s ease-in-out; /* æ›´æ…¢çš„æ·¡å…¥æ·¡å‡º */
            padding: 5px 0;
            letter-spacing: 1px;
        }

        /* --- HEADER --- */
        .elegant-header {
            padding: 40px 20px 20px;
            background: linear-gradient(to bottom, #F9F8F4 90%, rgba(249,248,244,0));
            position: sticky; top: 0; z-index: 100;
        }
        .top-meta { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px; }
        .brand { font-family: var(--font-serif); font-size: 1.4rem; font-weight: 700; letter-spacing: 1px; color: var(--accent-main); }
        
        .status-value { font-family: var(--font-serif); font-size: 2rem; line-height: 1; color: var(--accent-gold); text-align: right; }
        .status-label { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 2px; color: var(--text-secondary); text-align: right; margin-top: 5px; }

        /* DATE SCROLLER */
        .date-scroller { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
        .date-scroller::-webkit-scrollbar { display: none; }
        .d-item { 
            min-width: 60px; text-align: center; opacity: 0.4; transition: 0.4s; cursor: pointer; 
            display: flex; flex-direction: column; align-items: center;
        }
        .d-item.active { opacity: 1; transform: scale(1.1); }
        .d-week { font-size: 0.7rem; letter-spacing: 1px; margin-bottom: 5px; text-transform: uppercase; }
        .d-num { font-family: var(--font-serif); font-size: 1.5rem; position: relative; }
        .d-item.active .d-num::after {
            content: ''; position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; background: var(--accent-gold); border-radius: 50%;
        }

        /* --- TRIP VIEW --- */
        .container { padding: 0 20px; max-width: 600px; margin: 0 auto; }
        
        .hero-card {
            position: relative; height: 280px; border-radius: 4px; overflow: hidden; margin-bottom: 30px;
            box-shadow: var(--shadow-soft);
        }
        .hero-img { width: 100%; height: 100%; object-fit: cover; transition: transform 10s ease; }
        .hero-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%; padding: 25px;
            background: linear-gradient(to top, rgba(28,37,65,0.9), transparent); color: white;
        }
        .hero-title { font-size: 1.6rem; margin: 0; line-height: 1.3; font-weight: 500; color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }

        .timeline-block { position: relative; padding-left: 20px; border-left: 1px solid var(--line-light); margin-left: 10px; }
        .event-node { margin-bottom: 35px; position: relative; opacity: 0; transform: translateY(20px); transition: 0.6s ease; }
        .event-node.visible { opacity: 1; transform: translateY(0); }
        
        .time-dot { 
            position: absolute; left: -25px; top: 0; width: 9px; height: 9px; 
            background: var(--bg-body); border: 2px solid var(--accent-main); border-radius: 50%; 
        }
        .event-card {
            background: var(--bg-card); padding: 20px; border-radius: 4px;
            box-shadow: var(--shadow-soft); cursor: pointer; transition: 0.3s;
            border-bottom: 2px solid transparent;
        }
        .event-card:active { transform: scale(0.98); }
        .event-tag { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 2px; color: var(--text-secondary); margin-bottom: 8px; display: block; }
        .event-title { font-family: var(--font-serif); font-size: 1.25rem; margin-bottom: 6px; color: var(--accent-main); font-weight: 700; }
        
        /* äº¤é€šå¡ç‰‡å°ˆå±¬æ¨£å¼ (Ticket Style) - æ»¿è¶³ç¬¬ 2 é»éœ€æ±‚ */
        .transport-card {
            background: #F0F4F8; /* æ·ºè—ç°èƒŒæ™¯ */
            border-left: 3px solid #4A5672; /* æ·±è—è‰²ç·šæ¢ */
            position: relative;
            /* Remove standard card shadow for a flatter ticket look, or change it */
            box-shadow: 0 4px 15px -5px rgba(0,0,0,0.1); 
            padding: 20px 30px; /* å¢åŠ å·¦å³é‚Šè·çµ¦å‡¹æ´ç©ºé–“ */
        }
        /* å·¦å³åŠåœ“å½¢å‡¹æ´æ•ˆæœ */
        .transport-card::before,
        .transport-card::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 24px; /* Size of the cutout */
            height: 24px; /* Size of the cutout */
            background: var(--bg-body); /* å¿…é ˆèˆ‡ body èƒŒæ™¯è‰²åŒ¹é… */
            border-radius: 50%;
            transform: translateY(-50%);
            z-index: 2; 
            box-shadow: var(--shadow-soft); /* è®“å‡¹æ´æ›´æœ‰ç«‹é«”æ„Ÿ */
        }
        .transport-card::before {
            left: -12px; /* åŠå¾‘å¤§å°ï¼Œè®“å·¦å´å½¢æˆå‡¹é™· */
        }
        .transport-card::after {
            right: -12px; /* åŠå¾‘å¤§å°ï¼Œè®“å³å´å½¢æˆå‡¹é™· */
        }

        .alert-banner {
            background: rgba(217, 51, 63, 0.08); border-left: 3px solid var(--accent-red);
            padding: 15px; margin-bottom: 30px; border-radius: 0 4px 4px 0;
            display: flex; gap: 12px; align-items: flex-start;
        }
        .alert-highlight { color: var(--accent-red); font-weight: 700; display: block; margin-top: 4px; font-size: 0.85rem;}

        /* --- WALLET VIEW --- */
        .wallet-card { background: white; padding: 25px; border-radius: 8px; box-shadow: var(--shadow-soft); margin-bottom: 20px; }
        .rate-badge {
            background: #E8F5E9; color: #2E7D32; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; 
            display: inline-block; margin-bottom: 10px; font-weight: bold;
        }
        .input-group { margin-bottom: 20px; }
        .input-elegant { 
            width: 100%; border: none; border-bottom: 1px solid var(--line-light); 
            padding: 15px 0; font-size: 1.1rem; background: transparent; outline: none; border-radius: 0;
        }
        .twd-preview { font-size: 0.9rem; color: var(--accent-gold); margin-top: 5px; text-align: right; font-weight: 500;}
        
        .user-selector { display: flex; gap: 10px; margin-bottom: 20px; }
        .user-btn {
            flex: 1; padding: 10px; border: 1px solid var(--line-light); border-radius: 4px;
            background: transparent; color: var(--text-secondary); cursor: pointer; transition: 0.2s;
            font-family: var(--font-serif); font-size: 1rem;
        }
        .user-btn.active { background: var(--accent-main); color: white; border-color: var(--accent-main); }
        
        .expense-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #EEE; align-items: center; }
        .exp-user { 
            width: 30px; height: 30px; border-radius: 50%; background: var(--accent-main); color: white;
            display: flex; justify-content: center; align-items: center; font-size: 0.7rem; margin-right: 10px;
        }
        .exp-meta { display: flex; align-items: center; }
        .exp-time { font-size: 0.7rem; color: #999; margin-left: 8px; }

        /* è¨˜å¸³é  - åŒ¯ç‡æ›ç®—å°å·¥å…· (æ›´ç·Šæ¹Š) - æ»¿è¶³ç¬¬ 1 é»éœ€æ±‚ */
        #currency-converter {
            background: #F0F4F8; 
            padding: 15px; /* ç¸®å° padding */
            border-radius: 8px; 
            margin-bottom: 20px; /* ç¸®å° margin */
            border: 1px solid #E0E0E0;
        }
        #currency-converter h3 {
            font-size: 1.1rem !important; /* ç¸®å°æ¨™é¡Œ */
        }
        .converter-input { 
            border-bottom: 2px solid var(--accent-gold); 
            font-size: 1.2rem; /* ç¸®å°å­—é«” */
            font-family: var(--font-serif);
            text-align: center;
            padding: 10px 0; /* ç¸®å° padding */
        }
        .converter-output {
            text-align: center;
            font-size: 1.5rem; /* ç¸®å°å­—é«” */
            color: var(--accent-red);
            font-weight: 700;
            margin-top: 5px; /* ç¸®å° margin */
        }
        #currency-converter .serif {
            font-size: 1.4rem !important; /* ç¸®å° Â¥/NT$ ç¬¦è™Ÿ */
            margin: 0 5px;
        }


        /* --- TRANSLATE VIEW --- */
        .trans-input-area { background: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow-soft); margin-bottom: 30px; }
        .trans-btn { width: 100%; padding: 15px; background: var(--accent-main); color: white; border: none; margin-top: 15px; cursor: pointer; border-radius: 4px; }
        .ps-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .ps-card {
            background: white; padding: 20px 15px; border-radius: 8px; box-shadow: var(--shadow-soft);
            text-align: center; border: 1px solid #EEE; cursor: pointer; transition: 0.2s;
        }
        .ps-card:active { transform: scale(0.98); border-color: var(--accent-gold); }
        .ps-icon { font-size: 1.8rem; margin-bottom: 10px; display: block; }
        .ps-title { font-size: 0.9rem; font-weight: 600; }

        /* --- INFO VIEW --- */
        .info-card { background: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow-soft); margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; }
        .info-icon { width: 40px; height: 40px; border-radius: 50%; background: #F5F5F5; display: flex; justify-content: center; align-items: center; color: var(--accent-main); margin-right: 15px; }
        .info-text h3 { margin: 0; font-size: 1rem; color: var(--text-primary); }
        .info-text p { margin: 5px 0 0; font-size: 0.8rem; color: var(--text-secondary); }
        
        /* Map Overview Style */
        .map-overview-card {
            background: white; padding: 15px; border-radius: 8px; box-shadow: var(--shadow-soft); margin-bottom: 20px;
        }
        .map-iframe { width: 100%; height: 300px; border: none; border-radius: 4px; }


        /* --- NAV BAR --- */
        .glass-nav {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 95%; max-width: 400px;
            background: rgba(28, 37, 65, 0.95); backdrop-filter: blur(10px);
            border-radius: 40px; padding: 12px 20px;
            display: flex; justify-content: space-around; align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1000;
        }
        .nav-btn { color: rgba(255,255,255,0.4); font-size: 1.2rem; cursor: pointer; transition: 0.3s; position: relative; padding: 10px; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .nav-btn span { font-size: 0.6rem; font-family: var(--font-sans); letter-spacing: 1px; }
        .nav-btn.active { color: var(--accent-gold); transform: translateY(-2px); }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 1900;
            opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-full {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 90vh;
            background: var(--bg-body); z-index: 2000; border-radius: 20px 20px 0 0;
            transform: translateY(100%); transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            overflow-y: auto; padding-bottom: 40px;
        }
        .modal-full.active { transform: translateY(0); }
        .modal-header-img { height: 250px; width: 100%; object-fit: cover; }
        
        /* Detail Info Card Styles */
        .modal-content {
            padding: 0 20px;
        }
        .info-group {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed var(--line-light);
        }
        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            font-size: 0.9rem;
        }
        .info-label {
            color: var(--text-secondary);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .info-value {
            font-weight: 700;
            color: var(--accent-main);
            text-align: right;
            word-break: break-word;
        }

        /* Full Screen Text */
        #fs-text-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 2100; display: flex; flex-direction: column;
            justify-content: center; align-items: center; padding: 40px;
            text-align: center; transform: scale(0.9); opacity: 0; pointer-events: none; transition: 0.3s;
        }
        #fs-text-modal.active { transform: scale(1); opacity: 1; pointer-events: auto; }
        .fs-jp { font-size: 2.5rem; font-weight: 700; margin-bottom: 20px; line-height: 1.4; color: var(--text-primary); }
        .fs-cn { font-size: 1.2rem; color: #666; background: #F5F5F5; padding: 10px 20px; border-radius: 20px; }

    </style>
</head>
<body>

    <!-- Intro -->
    <div id="intro-screen">
        <div class="intro-text">
            <div class="intro-countdown-block">
                <div class="countdown-value" id="days-left">--</div>
                <div style="font-size: 0.9rem; letter-spacing: 3px; color: rgba(255,255,255,0.8);">DAYS LEFT</div>
            </div>
            <div class="intro-title" style="letter-spacing: 3px; font-size: 1.2rem; text-align: center;">å‡½é¤¨-é’æ£® æ—æªä¹‹æ—…</div>
            <!-- NEW: äº’å‹•æ–‡å­—å€å¡Š -->
            <div id="dynamic-intro-text"></div> 
            <button class="intro-btn" onclick="enterApp()">é–‹å•Ÿæ—…ç¨‹</button>
        </div>
    </div>

    <!-- Main App -->
    <div id="app-container">
        
        <div class="elegant-header">
            <div class="top-meta">
                <div class="brand">L'VOYAGE</div>
                <div style="text-align: right;">
                    <div class="status-value" id="header-days">--</div>
                    <div class="status-label">DAYS TO GO</div>
                </div>
            </div>
            <div class="date-scroller" id="date-nav">
                <!-- JS Generated -->
            </div>
        </div>

        <!-- 1. TRIP VIEW -->
        <div id="view-trip" class="view-section">
            <div class="container" id="timeline-container">
                <!-- JS Generated -->
            </div>
        </div>

        <!-- 2. WALLET VIEW -->
        <div id="view-wallet" class="view-section hidden">
            <div class="container">
                <div class="wallet-card" style="text-align: center; background: #1C2541; color: white;">
                    <div style="font-size: 0.8rem; color: #AAA; letter-spacing: 1px; margin-bottom: 5px;">ESTIMATED TOTAL</div>
                    <div class="serif" style="font-size: 2.5rem; color: #B49B67;" id="total-jpy">Â¥0</div>
                    <div style="color: #EEE; font-size: 0.9rem;">â‰ˆ TWD <span id="total-twd">0</span></div>
                </div>

                <div class="wallet-card">
                    <div class="rate-badge">å³æ™‚åŒ¯ç‡: <span id="current-rate">Loading...</span></div>
                    
                    <!-- NEW: æ›ç®—å°å·¥å…· (æ›´ç·Šæ¹Š) -->
                    <div id="currency-converter">
                        <h3 class="serif" style="margin-top:0; margin-bottom: 10px; color: var(--accent-main);">æ—¥å¹£/å°å¹£æ›ç®—</h3>
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <input type="tel" id="convert-jpy" class="input-elegant converter-input" placeholder="æ—¥å¹£" oninput="convertCurrency(this.value)" style="width:40%; margin-bottom:0;">
                            <span class="serif" style="font-size: 1.4rem; color: var(--accent-main);">Â¥</span>
                            <i class="fa-solid fa-right-left" style="color: #666; font-size: 0.8rem;"></i>
                            <span class="serif" style="font-size: 1.4rem; color: var(--accent-red);">NT$</span>
                            <div class="converter-output" id="convert-twd-output" style="width:40%;">0</div>
                        </div>
                    </div>

                    <div class="user-selector">
                        <button class="user-btn active" onclick="selectUser('YK', this)">YK</button>
                        <button class="user-btn" onclick="selectUser('YY', this)">YY</button>
                        <button class="user-btn" onclick="selectUser('YS', this)">YS</button>
                    </div>

                    <div class="input-group">
                        <input type="text" id="ex-item" class="input-elegant" placeholder="é …ç›® (ä¾‹å¦‚ï¼šè˜‹æœæ´¾)">
                    </div>
                    <div class="input-group">
                        <input type="tel" id="ex-price" class="input-elegant" placeholder="é‡‘é¡ (æ—¥å¹£)" oninput="calculatePreview(this.value)">
                        <div class="twd-preview" id="preview-twd">â‰ˆ TWD 0</div>
                    </div>
                    
                    <button class="intro-btn" style="width: 100%; margin-top: 10px; border-color: #1C2541; color: #1C2541;" onclick="addExpense()">è¨˜éŒ„æ”¯å‡º</button>
                </div>
                
                <h3 class="serif" style="padding-left: 10px; margin-bottom: 15px;">è¿‘æœŸæ”¯å‡º History</h3>
                <div id="expense-list"></div>
            </div>
        </div>

        <!-- 3. TRANSLATE VIEW -->
        <div id="view-trans" class="view-section hidden">
            <div class="container">
                
                <!-- Realtime Input -->
                <div class="trans-input-area">
                    <h3 class="serif" style="margin-top:0;">å³æ™‚ç¿»è­¯</h3>
                    <textarea id="trans-input" class="input-elegant" rows="3" placeholder="è¼¸å…¥ä¸­æ–‡... (ä¾‹å¦‚ï¼šè«‹å•é€™å€‹å¤šå°‘éŒ¢ï¼Ÿ)" style="border: 1px solid #EEE; padding: 10px;"></textarea>
                    <button class="trans-btn" onclick="translateNow()">
                        <i class="fa-solid fa-language"></i> ç¿»è­¯æˆæ—¥æ–‡
                    </button>
                    <div id="trans-output-box" class="wallet-card hidden" style="margin-top: 15px; border-left: 3px solid var(--accent-gold);">
                        <div style="font-size: 0.75rem; color: #999;">ä¸­æ–‡åŸæ–‡: <span id="trans-zh"></span></div>
                        <div class="serif" style="font-size: 1.5rem; color: var(--accent-main); margin-top: 5px;" id="trans-jp-result"></div>
                        <button onclick="showFs(document.getElementById('trans-jp-result').innerText, document.getElementById('trans-zh').innerText)" class="trans-btn" style="background: var(--accent-gold); margin-top: 10px; padding: 8px; font-size: 0.9rem;">
                            <i class="fa-solid fa-expand"></i> å…¨è¢å¹•å­—å¡
                        </button>
                    </div>
                </div>

                <!-- Point & Speak Cards -->
                <h3 class="serif" style="margin: 30px 0 15px;">æŒ‡å·®ç¢ºèª</h3>
                <div class="ps-grid">
                    <div class="ps-card warning" onclick="showFs('ç§ã¯ç‰›è‚‰ã¨è±šè‚‰ã¨ç¾Šè‚‰ãŒé£Ÿã¹ã‚‰ã‚Œã¾ã›ã‚“ã€‚', 'æˆ‘ä¸åƒç‰›ã€è±¬ã€ç¾Šè‚‰')">
                        <span class="ps-icon">ğŸ¥©</span>
                        <div class="ps-title">ä¸åƒç´…è‚‰</div>
                    </div>
                    <div class="ps-card" onclick="showFs('ã‚¹ãƒ¼ãƒ—ã«ç‰›ã‚„è±šã®ã‚¨ã‚­ã‚¹ã¯å…¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ', 'æ¹¯é ­å«è‚‰å—ï¼Ÿ')">
                        <span class="ps-icon">ğŸœ</span>
                        <div class="ps-title">æ¹¯é ­ç¢ºèª</div>
                    </div>
                    <div class="ps-card" onclick="showFs('ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚', 'éº»ç…©çµå¸³')">
                        <span class="ps-icon">ğŸ’³</span>
                        <div class="ps-title">çµå¸³</div>
                    </div>
                    <div class="ps-card" onclick="showFs('ã“ã‚Œã‚’ãã ã•ã„ã€‚', 'æˆ‘è¦é€™å€‹')">
                        <span class="ps-icon">ğŸ‘‰</span>
                        <div class="ps-title">æˆ‘è¦é€™å€‹</div>
                    </div>
                    <div class="ps-card" onclick="showFs('ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', 'å»æ‰€åœ¨å“ªï¼Ÿ')">
                        <span class="ps-icon">ğŸš»</span>
                        <div class="ps-title">æ‰¾å»æ‰€</div>
                    </div>
                    <div class="ps-card danger" onclick="showFs('åŠ©ã‘ã¦ãã ã•ã„ï¼', 'æ•‘å‘½ï¼')">
                        <span class="ps-icon">ğŸ†˜</span>
                        <div class="ps-title">ç·Šæ€¥æ±‚æ•‘</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. INFO VIEW -->
        <div id="view-info" class="view-section hidden">
            <div class="container">
                
                <!-- NEW: Map Overview (Interactive Embed) -->
                <div class="map-overview-card" style="margin-top: 20px;">
                    <h2 class="serif" style="margin-top: 0; color: var(--accent-main); font-size: 1.3rem;">æ—…è¡Œç¸½è¦½åœ°åœ– (äº’å‹•)</h2>
                    <p style="color: #666; font-size: 0.9rem; margin-bottom: 10px;">å¯ç¸®æ”¾ã€æ‹–æ›³ï¼ŒæŒæ¡æ•´é«”å‹•ç·š</p>
                    <iframe id="trip-map-overview-iframe" 
                            class="map-iframe"
                            allowfullscreen="" 
                            loading="lazy" 
                            referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>

                <div class="wallet-card">
                    <h2 class="serif" style="margin-top: 0; color: var(--accent-main);">é‡è¦è³‡è¨Šå½™æ•´</h2>
                    <p style="color: #666; font-size: 0.9rem;">ç·Šæ€¥æ™‚åˆ»èˆ‡é€šé—œå¿…å‚™</p>
                </div>

                <div class="info-card" onclick="window.open('https://vjw-lp.digital.go.jp/zh-hant/', '_blank')">
                    <div style="display:flex; align-items:center;">
                        <div class="info-icon" style="background: #FFF3E0; color: #E65100;"><i class="fa-solid fa-passport"></i></div>
                        <div class="info-text">
                            <h3>Visit Japan Web</h3>
                            <p>å…¥å¢ƒå¯©æŸ¥ & æµ·é—œç”³å ± QR Code</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-chevron-right" style="color:#CCC;"></i>
                </div>

                <div class="info-card" onclick="window.location.href='tel:110'">
                    <div style="display:flex; align-items:center;">
                        <div class="info-icon" style="background: #FFEBEE; color: #D32F2F;"><i class="fa-solid fa-shield-halved"></i></div>
                        <div class="info-text">
                            <h3>æ—¥æœ¬å ±è­¦ 110</h3>
                            <p>é‡åˆ°äº‹æ•…æˆ–çŠ¯ç½ªæ™‚</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-phone" style="color:var(--accent-red);"></i>
                </div>

                <div class="info-card" onclick="window.location.href='tel:119'">
                    <div style="display:flex; align-items:center;">
                        <div class="info-icon" style="background: #FFEBEE; color: #D32F2F;"><i class="fa-solid fa-truck-medical"></i></div>
                        <div class="info-text">
                            <h3>ç«è­¦/æ•‘è­·è»Š 119</h3>
                            <p>æ€¥ç—…æˆ–å—å‚·æ™‚</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-phone" style="color:var(--accent-red);"></i>
                </div>

                <div class="info-card" onclick="window.location.href='tel:+81-11-222-2930'">
                    <div style="display:flex; align-items:center;">
                        <div class="info-icon" style="background: #E3F2FD; color: #1565C0;"><i class="fa-solid fa-building-flag"></i></div>
                        <div class="info-text">
                            <h3>é§æ—¥ä»£è¡¨è™• (æœ­å¹Œåˆ†è™•)</h3>
                            <p>åŒ—æµ·é“/é’æ£®ç·Šæ€¥è¯çµ¡: +81-11-222-2930</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-phone" style="color:#1565C0);"></i>
                </div>
            </div>
        </div>

    </div>

    <!-- 4-Button Navigation -->
    <div class="glass-nav">
        <div class="nav-btn active" onclick="switchView('trip', this)">
            <i class="fa-solid fa-map-location-dot"></i>
            <span>è¡Œç¨‹</span>
        </div>
        <div class="nav-btn" onclick="switchView('wallet', this)">
            <i class="fa-solid fa-wallet"></i>
            <span>è¨˜å¸³</span>
        </div>
        <div class="nav-btn" onclick="switchView('trans', this)">
            <i class="fa-solid fa-comments"></i>
            <span>ç¿»è­¯</span>
        </div>
        <div class="nav-btn" onclick="switchView('info', this)">
            <i class="fa-solid fa-circle-info"></i>
            <span>è³‡è¨Š</span>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal-overlay" onclick="closeModal()"></div>
    <div class="modal-full" id="detail-modal">
        <div style="position: sticky; top: 0; padding: 10px; text-align: right; z-index: 10;">
            <button onclick="closeModal()" style="background: white; border: none; width: 36px; height: 36px; border-radius: 50%; box-shadow: 0 2px 10px rgba(0,0,0,0.1); color: #333;"><i class="fa-solid fa-times"></i></button>
        </div>
        <img src="" id="m-img" class="modal-header-img" onerror="this.onerror=null; this.src='https://placehold.co/800x600?text=No+Image';">
        <div class="modal-content">
            <span id="m-tag" style="font-size: 0.7rem; letter-spacing: 2px; color: var(--accent-gold); text-transform: uppercase;">TAG</span>
            <h2 id="m-title" class="serif" style="font-size: 1.8rem; margin: 5px 0 20px 0; line-height: 1.2;">Title</h2>
            
            <!-- Map Code Section -->
            <div id="m-map-section" style="background: #F0F4F8; padding: 15px; border-radius: 8px; margin-top: 20px; display: flex; justify-content: space-between; align-items: center;" class="hidden">
                <div>
                    <div style="font-size: 0.7rem; color: #666; letter-spacing: 1px;">NAVIGATE (MAPCODE)</div>
                    <div id="m-mapcode" style="font-family: monospace; font-size: 1.2rem; font-weight: 700; color: var(--accent-main);">--</div>
                </div>
                <button onclick="copyMapCode()" style="background: var(--accent-main); color: white; border: none; padding: 8px 15px; border-radius: 4px;">è¤‡è£½</button>
            </div>
            
            <!-- Google Maps Preview (Interactive Embed) -->
            <div id="m-gmap-preview" class="hidden" style="margin-top: 20px; text-align: center;">
                <iframe id="m-gmap-iframe" class="map-iframe" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                <button onclick="openExternalMap()" style="background: #333; color: white; padding: 8px 15px; border-radius: 4px; margin-top: 10px;">
                    <i class="fa-solid fa-location-arrow"></i> åœ¨ Google åœ°åœ–ä¸­é–‹å•Ÿ
                </button>
            </div>

            <!-- New: Transport/Reservation Info Section -->
            <div id="m-detail-info" class="hidden info-group">
                <h3 class="serif" style="font-size: 1.2rem; margin-bottom: 15px; color: var(--accent-main);">é è¨‚ / äº¤é€šè³‡è¨Š</h3>
                <!-- Content will be injected here -->
            </div>

            <p id="m-desc" style="font-size: 1rem; line-height: 1.8; color: #555; margin-top: 25px;">Description</p>
        </div>
    </div>

    <!-- Full Screen Text Modal -->
    <div id="fs-text-modal" onclick="closeFs()">
        <div class="fs-jp" id="fs-jp">--</div>
        <div class="fs-cn" id="fs-cn">--</div>
        <div class="fs-close" style="position: absolute; bottom: 50px; color: #999; font-size: 0.9rem;">é»æ“Šä»»æ„è™•é—œé–‰</div>
    </div>

    <script>
        // NOTE: Replace 'YOUR_API_KEY' with a valid Google Maps API Key to enable map functionality.
        const GOOGLE_MAPS_API_KEY = "AIzaSyAX9nvh4bJpiM6-oTm8FoUSZeSBpxZBc1E"; 
    </script>

    <script type="module">
        // --- FIREBASE IMPORTS ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, query, orderBy, onSnapshot, addDoc, serverTimestamp, setDoc, doc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

        // setLogLevel('debug'); // Enable for debugging

        // --- GLOBAL STATE & CONFIG ---
        // GOOGLE_MAPS_API_KEY is now global
        
        let db;
        let auth;
        let expensesRef;
        let currentRate = 0.22; // default Fallback
        let currentIdx = 0;
        let currentUser = 'YK';
        let expenses = [];
        
        // Canvas environment variables (MANDATORY)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');


        // --- FIREBASE INITIALIZATION & AUTH ---
        const setupFirebase = async () => {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Sign in logic
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }

                // Listen for Auth State changes to initialize Firestore listener
                onAuthStateChanged(auth, (user) => {
                    // Get userId AFTER successful auth
                    const userId = auth.currentUser?.uid || crypto.randomUUID(); 
                    
                    // Firestore path: /artifacts/{appId}/public/data/expenses
                    // We use "public" so all three members can sync expenses.
                    const collectionPath = `artifacts/${appId}/public/data/expenses`;
                    expensesRef = collection(db, collectionPath);
                    
                    console.log("Firebase Auth Ready. Collection Path:", collectionPath);
                    
                    // Now safe to start data listeners
                    subscribeToExpenses();
                });

            } catch (error) {
                console.error("Firebase Initialization/Auth Error:", error);
                // Fallback to static render if critical error
                window.renderTrip();
            }
        };

        // --- FIRESTORE SUBSCRIPTION (Real-time Sync) ---
        const subscribeToExpenses = () => {
            // NOTE: Firestore orderBy() is complex; we fetch all and sort in memory.
            const q = query(expensesRef);

            onSnapshot(q, (snapshot) => {
                expenses = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Sort expenses by timestamp (newest first) in memory
                expenses.sort((a, b) => {
                    const timeA = a.timestamp?.toMillis() || 0;
                    const timeB = b.timestamp?.toMillis() || 0;
                    return timeB - timeA;
                });
                
                console.log("Expenses updated from cloud:", expenses.length);
                window.renderExpenses(); // Re-render the wallet view
            }, (error) => {
                console.error("Error subscribing to expenses:", error);
            });
        };

        // --- FIRESTORE WRITE FUNCTION ---
        window.addExpense = async function() {
            const item = document.getElementById('ex-item').value;
            const price = parseInt(document.getElementById('ex-price').value);
            
            if(!item || !price || price <= 0) {
                // Show custom modal instead of alert()
                // Using a simple polyfill alert here as generating a custom modal UI is heavy
                if (window.confirm) {
                    window.confirm("è«‹è¼¸å…¥æœ‰æ•ˆçš„é …ç›®åç¨±å’Œé‡‘é¡ã€‚");
                } else {
                    console.log("è«‹è¼¸å…¥æœ‰æ•ˆçš„é …ç›®åç¨±å’Œé‡‘é¡ã€‚");
                }
                return;
            }
            
            if (!expensesRef) {
                if (window.confirm) {
                    window.confirm("æ•¸æ“šåº«æœªå°±ç·’ï¼Œè«‹æª¢æŸ¥é€£ç·šã€‚");
                } else {
                    console.log("æ•¸æ“šåº«æœªå°±ç·’ï¼Œè«‹æª¢æŸ¥é€£ç·šã€‚");
                }
                return;
            }

            try {
                const newExpense = {
                    user: currentUser,
                    item, 
                    price,
                    timestamp: serverTimestamp(), // Firestore generates timestamp on the server
                    rate: currentRate,
                };

                await addDoc(expensesRef, newExpense);
                
                // Clear UI fields after successful add
                document.getElementById('ex-item').value = '';
                document.getElementById('ex-price').value = '';
                document.getElementById('preview-twd').innerText = "â‰ˆ TWD 0";

            } catch (error) {
                console.error("Error adding document:", error);
                if (window.confirm) {
                    window.confirm("è¨˜éŒ„å¤±æ•—ï¼šè«‹æª¢æŸ¥ç¶²è·¯å’Œæ¬Šé™ã€‚");
                } else {
                    console.log("è¨˜éŒ„å¤±æ•—ï¼šè«‹æª¢æŸ¥ç¶²è·¯å’Œæ¬Šé™ã€‚");
                }
            }
        }
        
        // --- WALLET RENDERING (Updated to use synced 'expenses' array) ---
        window.renderExpenses = function() {
            let total = 0;
            
            // Render total summary
            expenses.forEach(e => {
                total += e.price;
            });
            
            document.getElementById('total-jpy').innerText = "Â¥" + total.toLocaleString();
            document.getElementById('total-twd').innerText = (total * currentRate).toFixed(0);

            // Render expense list
            const html = expenses.map(e => {
                // Safely format timestamp if it exists
                const dateObj = e.timestamp ? e.timestamp.toDate() : new Date();
                const timeString = dateObj.getHours().toString().padStart(2,'0') + ":" + dateObj.getMinutes().toString().padStart(2,'0');
                const dateString = (dateObj.getMonth()+1) + "/" + dateObj.getDate();
                
                return `
                    <div class="expense-item">
                        <div class="exp-meta">
                            <div class="exp-user">${e.user}</div>
                            <div>
                                <div style="font-weight:500;">${e.item}</div>
                                <div style="font-size:0.75rem; color:#999;">${dateString} ${timeString}</div>
                            </div>
                        </div>
                        <div class="serif">Â¥${e.price.toLocaleString()}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('expense-list').innerHTML = html;
        }

        // --- TRANSLATION FUNCTION (Stub to fix ReferenceError) ---
        window.translateNow = async function() {
            const input = document.getElementById('trans-input').value.trim();
            const outputBox = document.getElementById('trans-output-box');
            const transZh = document.getElementById('trans-zh');
            const transJpResult = document.getElementById('trans-jp-result');

            if (!input) {
                // Using console log as a non-intrusive alert replacement
                console.warn("ç¿»è­¯è¼¸å…¥ç‚ºç©ºã€‚");
                outputBox.classList.add('hidden');
                return;
            }

            // Simulate loading
            transZh.innerText = input;
            transJpResult.innerText = "æ­£åœ¨å‘¼å«ç¿»è­¯æœå‹™...";
            outputBox.classList.remove('hidden');

            // Simulate the translation result after a small delay
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Placeholder/Stub result
            transJpResult.innerText = "ç›®å‰å³æ™‚ç¿»è­¯åŠŸèƒ½æ­£åœ¨ä¸²æ¥ä¸­ï¼Œè«‹å…ˆä½¿ç”¨æŒ‡å·®ç¢ºèªå¡ç‰‡ã€‚"; 
            
            // For pointing and speaking, we use the original phrase
            window.showFs(transJpResult.innerText, input);
        }

        // --- STARTUP LOGIC ---
        window.enterApp = function() {
            document.getElementById('intro-screen').style.transform = 'translateY(-100%)';
            window.renderTrip();
            window.fetchRate();
            window.renderFullTripMap();
        };

        // NEW: å°é¢äº’å‹•æ–‡å­—é‚è¼¯ - æ‹†åˆ†èˆ‡æ™‚é–“æ„ŸçŸ¥
        const timeSensitiveMessages = {
            // 08:00 - 17:59 (Daytime: Work & Endurance)
            work: [
                "ä»Šå¤©çš„ä»»å‹™å†å¤šä¹Ÿæ²’é—œä¿‚ï¼Œæƒ³æƒ³å‡½é¤¨å±±çš„ç™¾è¬å¤œæ™¯åœ¨ç­‰ä½ ã€‚",
                "å·¥ä½œå¾ˆç´¯å°å§ï¼Ÿå†æ’ä¸€ä¸‹ï¼Œé’æ£®çš„è˜‹æœæ´¾æœƒæ²»ç™’é€™ä¸€åˆ‡ã€‚",
                "åŠ ç­çš„æ™‚å€™æƒ³ä¸€æƒ³ï¼Œæ˜Ÿé‡é’æ£®å±‹çš„éœ²å¤©æº«æ³‰æ­£åœ¨å†’è‘—ç†±æ°£ã€‚",
                "ç•¶ä½ è¦ºå¾—ç²¾ç–²åŠ›ç›¡æ™‚ï¼Œè¨˜å¾—æœ‰ä¸€ç¢—å¹¸é‹å°ä¸‘æ¼¢å ¡æ˜¯ç‚ºä½ è€Œåšçš„ã€‚",
                "è–ªæ°´å°±æ˜¯ç‚ºäº†è®Šæˆæ©Ÿç¥¨å’Œæµ·é®®ä¸¼è€Œå­˜åœ¨çš„ï¼Œå†æ’ä¸€ä¸‹ï¼",
                "å†å …æŒä¸€ä¸‹ï¼ŒDormy Inn çš„å¤œé³´æ‹‰éºµåœ¨å‘¼å–šä½ ç–²æ†Šçš„éˆé­‚ã€‚",
                "ç‚ºäº†é‚£ä¸€æ¯æš–çˆåˆ—è»Šä¸Šçš„æ¸…é…’ï¼Œä»Šå¤©çš„é³¥äº‹éƒ½ä¸ç®—ä»€éº¼ã€‚",
                "ä»Šå¤©çš„åŠªåŠ›ï¼Œéƒ½æ˜¯ç‚ºäº†åœ¨å…«ç”²ç”°å±±çœ‹æ¨¹å†°æ™‚èƒ½ç„¡æ†‚ç„¡æ…®ã€‚",
                "è®“é€™é€±éå¾—å¿«ä¸€é»å§ï¼Œæˆ‘å€‘å’Œé’æ£®çŠ¬æœ‰å€‹ç´„å®šã€‚",
                "é›ªé´æº–å‚™å¥½äº†å—ï¼Ÿé’æ£®çš„é›ªä¸æ˜¯é–‹ç©ç¬‘çš„ï¼Œæˆ‘å€‘éœ€è¦ç¦¦å¯’ç¥è£ã€‚",
                "è­·ç…§å’Œé§•ç…§è­¯æœ¬ï¼Œæ˜¯ä¸æ˜¯è©²æ‹¿å‡ºä¾†ç¢ºèªä¸€ä¸‹æœ‰æ•ˆæœŸé™äº†ï¼Ÿ",
                "æ‰‹æ©Ÿè¨˜æ†¶é«”æ¸…ç©ºäº†å—ï¼Ÿé’æ£®çš„ç¾å¯èƒ½æœƒå¡çˆ†ä½ çš„ç›¸ç°¿å–”ã€‚",
                "é‚£é›™é™ªä½ èµ°éå¾ˆå¤šè·¯çš„é‹å­ï¼Œé€™æ¬¡é˜²æ»‘åŠŸèƒ½è¶³å¤ æ‡‰ä»˜åŒ—åœ‹çš„é›ªå—ï¼Ÿ",
                "å¢¨é¡æº–å‚™å¥½äº†å—ï¼Ÿé›ªåœ°åå°„çš„é™½å…‰ï¼Œæœ‰æ™‚å€™æ¯”ä½ çš„æœªä¾†é‚„è€€çœ¼ã€‚",
                "å¼˜å‰åŸèˆ‡å¤§æ­£æµªæ¼«çš„æ•…äº‹ï¼Œè¦ä¸è¦å‡ºç™¼å‰å…ˆæŸ¥æŸ¥çœ‹ï¼Ÿ",
                "å†å …æŒä¸€ä¸‹ï¼ŒæŠŠé‚£äº›è®“ä½ ç†æ™ºæ–·ç·šçš„ç¬é–“éƒ½ç•™åœ¨é€™è£¡ã€‚",
                "æŠŠé‚£äº›è®“ä½ å¿ƒç…©çš„äººäº‹ç‰©ï¼Œæƒ³åƒæˆå…«ç”²ç”°å±±ä¸Šçš„é›ªæ€ªå°±å¥½äº†ï¼ˆç¬‘ï¼‰ã€‚"
            ],
            // 18:00 - 23:59 (Evening: Anticipation & Planning)
            evening: [
                "æƒ³åƒä¸€ä¸‹ï¼Œå¹¸é‹å°ä¸‘æ¼¢å ¡æ·‹ä¸Šç‰¹è£½é†¬æ±çš„é‚£ä¸€ç¬é–“...",
                "åœ¨æš–çˆåˆ—è»Šä¸Šçƒ¤é­·é­šçš„é¦™æ°£ï¼Œä½ æƒ³å¥½è¦é…å“ªä¸€æ¬¾æ¸…é…’äº†å—ï¼Ÿ",
                "å¤å·å¸‚å ´çš„ã€Œå»åƒä¸¼ã€ï¼Œä½ æƒ³å¥½ç¬¬ä¸€æ¨£è¦å¤¾ä»€éº¼äº†å—ï¼Ÿ",
                "é’æ£®çš„è˜‹æœæœ‰å¾ˆå¤šç¨®ï¼Œä½ è¦ä¸è¦å…ˆæŸ¥æŸ¥çœ‹ã€Œå¯Œå£«ã€å’Œã€Œç‹æ—ã€çš„å·®åˆ¥ï¼Ÿ",
                "åœ¨å¤§æ­£æµªæ¼«å–«èŒ¶å®¤å–ä¸‹åˆèŒ¶ï¼Œæ˜¯ä¸æ˜¯è©²é»ä¸€æ¯è˜‹æœç´…èŒ¶ä¾†æ­é…ï¼Ÿ",
                "æˆ‘å€‘å³å°‡æ¬£è³å‡½é¤¨å±±å¤œæ™¯ï¼Œç›¸æ©Ÿè¨˜æ†¶é«”æ¸…ç©ºäº†å—ï¼Ÿ",
                "Day 2 çš„ç§»å‹•æ—¥æœ‰é»é•·ï¼Œæº–å‚™å¥½ä½ å€‘çš„å…«å¦åº«å­˜äº†å—ï¼Ÿ",
                "æˆ‘å€‘å³å°‡æ¬£è³ä¸–ç•Œä¸‰å¤§å¤œæ™¯ä¹‹ä¸€ï¼Œä½ çš„å¿ƒæ˜¯ä¸æ˜¯å·²ç¶“é£›åˆ°å‡½é¤¨å±±äº†ï¼Ÿ",
                "é€™æ˜¯çµ¦æœªä¾†çš„ä½ çš„æé†’ï¼šè¨˜å¾—å¤šæ‹ä¸€é»åˆç…§ï¼Œä¸è¦åªæœ‰é¢¨æ™¯å–”ã€‚",
                "è¦ä¸è¦å…ˆä¸Šç¶²æŸ¥æŸ¥å¥ˆè‰¯ç¾æ™ºçš„ã€Œé’æ£®çŠ¬ã€ï¼Ÿå®ƒåœ¨ç¾è¡“é¤¨ç­‰è‘—æˆ‘å€‘ã€‚",
                "é€™æ¬¡ç§Ÿçš„è»Šå°±æ˜¯æˆ‘å€‘çš„ç§»å‹•åŸå ¡ï¼Œè£¡é¢åªè£ç¬‘è²ã€‚",
                "é€™æ¬¡æ—…è¡Œï¼Œæˆ‘å€‘ä¸è«‡å…¬äº‹ã€ä¸æ¥é›»è©±ï¼Œåªè«‡é¢¨æœˆèˆ‡ç¾é£Ÿã€‚",
                "èª°å…ˆæå·¥ä½œçš„äº‹ï¼Œèª°å°±è¦è«‹åƒä¸€æ”¯è˜‹æœç³–ã€‚",
                "æ¯å¤©çœ‹è‘—å€’æ•¸æ•¸å­—è®Šå°‘ï¼Œå˜´è§’æ˜¯ä¸æ˜¯æœƒä¸è‡ªè¦ºä¸Šæšï¼Ÿ",
                "æ‰€æœ‰çš„ç­‰å¾…ï¼Œéƒ½æ˜¯ç‚ºäº†ç›¸é‡æ™‚çš„é‚£ä¸€åˆ»ç¾å¥½ã€‚",
                "æƒ³åƒä¸€ä¸‹ï¼Œæ­¤åˆ»çš„å¼˜å‰åŸï¼Œé›ªæ­£éœéœåœ°è½ä¸‹ï¼Œç­‰å¾…è‘—ä½ çš„åˆ°ä¾†ã€‚",
                "åœ¨å”å‰è¨¶å¾·å¤±å¿ƒç˜‹ï¼Œè¨˜å¾—æé†’å°æ–¹ï¼šã€Œè¡Œæç®±é‚„å¡å¾—ä¸‹å—ï¼Ÿã€"
            ],
            // 00:00 - 07:59 (Night: Rest & Healing)
            rest: [
                "å‰›å¿™å®Œå—ï¼Ÿé–‰ä¸Šçœ¼ï¼Œæƒ³åƒè‡ªå·±æ­£æ³¡åœ¨æ˜Ÿé‡é’æ£®å±‹çš„éœ²å¤©æº«æ³‰è£¡ã€‚",
                "ç¸½æ˜¯ç…§é¡§åˆ¥äººçš„ä½ ï¼Œé€™æ¬¡æ›é’æ£®ä¾†å¥½å¥½ç…§é¡§ä½ ã€‚",
                "ä»Šå¤©çš„äº¤ç­é‚„é †åˆ©å—ï¼ŸæŠŠä¸é †å¿ƒçš„äº‹éƒ½ç•™åœ¨å°ç£ï¼Œæˆ‘å€‘å»å‡½é¤¨çœ‹å¤œæ™¯æ´—çœ¼ç›ã€‚",
                "çŸ¥é“ä½ è‚©è†€å¾ˆé‡ï¼Œæ‰€ä»¥æˆ‘å€‘å®‰æ’äº†æº«æ³‰ï¼ŒæŠŠé‚£äº›è²¬ä»»éƒ½æ´—æ‰ã€‚",
                "é–‰ä¸Šçœ¼ç›ï¼Œæƒ³åƒä¸€ä¸‹é›¶ä¸‹äº”åº¦çš„ç©ºæ°£å¸é€²è‚ºè£¡ï¼Œé‚£ç¨®ä¹¾æ·¨çš„æ„Ÿè¦ºã€‚",
                "æ‰‹æŒ‡æ•²éµç›¤å¤ªä¹…äº†ï¼Œå®ƒå€‘ç¾åœ¨åªæƒ³æ¡è‘—æš–æš–çš„æ¸…é…’æ¯ã€‚",
                "é€ƒé›¢é‚£äº›ä¸è¬›ç†çš„äººäº‹ç‰©ï¼Œå»è¦‹è¦‹åªæœƒé»é ­åƒè‰çš„é¦¬å…’å§ã€‚",
                "è®“å¼˜å‰åŸçš„ç™½è‰²é›ªæ™¯ï¼Œè¦†è“‹æ‰è…¦ä¸­é‚£äº›é›œäº‚çš„å¾…è¾¦äº‹é …ã€‚",
                "ä½ ç´¯ç©çš„ç–²æ†Šï¼Œéœ€è¦ä¸€ç¢—å‡½é¤¨æœå¸‚çš„æµ·é®®ä¸¼ä¾†é€²è¡Œéœè„ˆæ³¨å°„ï¼ˆèª¤ï¼‰ã€‚",
                "æš«æ™‚æŠŠã€Œè²¬ä»»æ„Ÿã€èª¿æˆé£›èˆªæ¨¡å¼ï¼Œå¥½å—ï¼Ÿ",
                "ä½ çš„è€å¿ƒé¤˜é¡å·²ä¸è¶³ï¼Ÿæ²’é—œä¿‚ï¼Œå‡½é¤¨çš„ç™¾è¬å¤œæ™¯æœƒå¹«ä½ å……å€¼ã€‚",
                "å¸Œæœ›ä½ ä»Šæ™šèƒ½ä¸€å¤œå¥½çœ ï¼Œæ˜å¤©é†’ä¾†é›¢å‡ºç™¼åˆæ›´è¿‘ä¸€æ­¥äº†ã€‚",
                "ä½ ç‚ºå¤§å®¶ä»˜å‡ºçš„å¿ƒåŠ›ï¼Œæ˜Ÿé‡é’æ£®å±‹çš„ç†±æ¹¯æœƒç‚ºä½ è£œå›ä¾†ã€‚",
                "æŠŠå¿ƒæ¸…ç©ºï¼Œæº–å‚™è£æ»¿é’æ£®çš„è—å¤©èˆ‡ç™½é›ªã€‚",
                "ç¾åœ¨æ˜¯å±¬æ–¼ä½ çš„å®‰éœæ™‚é–“ï¼Œå¥½å¥½ä¼‘æ¯ï¼Œå„²å‚™æ˜å¤©çš„å¿«æ¨‚ã€‚",
                "æ‰€æœ‰çš„å£“åŠ›å’Œç…©æƒ±ï¼Œéƒ½äº¤çµ¦æº«æ³‰å’Œæ‹‰éºµå§ï¼"
            ]
        };
        
        let lastMessageIndex = -1;

        window.startDynamicText = function() {
            const textElement = document.getElementById('dynamic-intro-text');
            let currentCategory = [];

            const updateText = () => {
                const hour = new Date().getHours();
                let targetKey;

                if (hour >= 8 && hour <= 17) {
                    targetKey = 'work'; // 08:00 - 17:59 (ç™½å¤©)
                } else if (hour >= 18 && hour <= 23) {
                    targetKey = 'evening'; // 18:00 - 23:59 (å‚æ™š/æ™šä¸Š)
                } else {
                    targetKey = 'rest'; // 00:00 - 07:59 (æ·±å¤œ/æ¸…æ™¨)
                }
                
                currentCategory = timeSensitiveMessages[targetKey];
                
                // --- Selection Logic ---
                textElement.style.opacity = 0;

                setTimeout(() => {
                    let newIndex;
                    do {
                        newIndex = Math.floor(Math.random() * currentCategory.length);
                    } while (newIndex === lastMessageIndex && currentCategory.length > 1);
                    
                    lastMessageIndex = newIndex;
                    textElement.innerText = currentCategory[newIndex];
                    
                    // Fade in
                    textElement.style.opacity = 1;

                }, 1000); // 1.5s transition time, wait 1s to switch text for smoothness
            };

            // Start immediately
            updateText(); 
            
            // Repeat every 30 seconds (30000ms)
            setInterval(updateText, 30000);
        }

        window.onload = function() {
            // Initialize Firebase setup
            setupFirebase();

            const start = new Date("2026-02-02").getTime();
            const now = new Date().getTime();
            const days = Math.ceil((start - now) / (1000 * 60 * 60 * 24));
            document.getElementById('days-left').innerText = days > 0 ? days : 0;
            document.getElementById('header-days').innerText = days > 0 ? days : 0;
            
            // Set initial view to trip (needed for the hidden fix)
            document.getElementById('view-trip').style.display = 'block';

            // Start dynamic intro text after initial setup
            // Delayed slightly to let the rest of the intro fade in first
            setTimeout(() => {
                window.startDynamicText(); 
            }, 1000);
        };
        
        // --- EXISTING FUNCTIONS (Copied over for context) ---
        window.fetchRate = function() {
            fetch('https://api.exchangerate-api.com/v4/latest/JPY')
                .then(response => response.json())
                .then(data => {
                    if(data && data.rates && data.rates.TWD) {
                        currentRate = data.rates.TWD;
                        document.getElementById('current-rate').innerText = "1 JPY = " + currentRate.toFixed(4) + " TWD";
                        window.renderExpenses();
                    }
                })
                .catch(err => {
                    document.getElementById('current-rate').innerText = "é›¢ç·šåŒ¯ç‡: " + currentRate;
                });
        }
        
        window.selectUser = function(user, btn) {
            currentUser = user;
            document.querySelectorAll('.user-btn').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');
        }

        window.calculatePreview = function(val) {
            if(!val) {
                document.getElementById('preview-twd').innerText = "â‰ˆ TWD 0";
                return;
            }
            const twd = Math.round(parseInt(val) * currentRate);
            document.getElementById('preview-twd').innerText = "â‰ˆ TWD " + twd.toLocaleString();
        }

        window.convertCurrency = function(val) {
             if(!val) {
                document.getElementById('convert-twd-output').innerText = "0";
                return;
            }
            const twd = Math.round(parseInt(val) * currentRate);
            document.getElementById('convert-twd-output').innerText = twd.toLocaleString();
        }


        // --- MAPS & DETAIL VIEW FUNCTIONS ---
        // (Unchanged logic for brevity)
        const tripData = [
            // ... (Your tripData remains here for itinerary rendering)
            {
                day: 1, date: "02.02", week: "MON",
                heroTitle: "å‡½é¤¨ï¼šç™¾å…ƒç™¼ç†±è¡£èˆ‡ç™¾è¬å¤œæ™¯",
                heroImg: "https://images.unsplash.com/photo-1542640244-7e67286feb8f?q=80&w=800&auto=format&fit=crop&w=800&h=600", 
                events: [
                    { 
                        time: "11:10", title: "æŠµé”å‡½é¤¨æ©Ÿå ´ (HKD)", tag: "Transport", desc: "å…¥å¢ƒæ‰‹çºŒï¼Œé ˜å–è¡Œæã€‚", 
                        detail: "é‡é»æç¤ºï¼šå‡½é¤¨æ©Ÿå ´è¦æ¨¡ç²¾å·§ï¼Œå…¥å¢ƒé€Ÿåº¦å¿«ã€‚è«‹é ç•™æ™‚é–“æº–å‚™æ­ä¹˜å·´å£«ã€‚", 
                        img: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=800&auto=format&fit=crop&w=800&h=600",
                        to: "JRå‡½é¤¨ç«™"
                    },
                    { 
                        time: "12:00", title: "æ©Ÿå ´å·´å£« -> JR å‡½é¤¨ç«™", tag: "Transport", desc: "æ­ä¹˜å·´å£«ã€‚ç´„ 20-30 åˆ†é˜è»Šç¨‹ã€‚", 
                        detail: "é€™æ˜¯æœ€ç¶“æ¿Ÿçš„ç§»å‹•æ–¹å¼ï¼Œè»Šç¨‹ç´„ 20-30 åˆ†é˜ã€‚è«‹æº–å‚™å¥½é›¶éŒ¢ã€‚", 
                        from: "å‡½é¤¨æ©Ÿå ´", to: "JRå‡½é¤¨ç«™", 
                        transport_info: {type: "æ©Ÿå ´å·´å£«", departure: "12:00", arrival: "12:30", note: "è»Šç¨‹ç´„ 20-30 åˆ†é˜ã€‚"} 
                    },
                    { 
                        time: "12:30", title: "JR Inn Hakodate å¯„æ”¾è¡Œæ", tag: "Hotel", desc: "æŠµé”é£¯åº—ï¼Œè¾¦ç†å…¥ä½æ‰‹çºŒæˆ–å¯„æ”¾è¡Œæã€‚", 
                        detail: "JR Inn Hakodate ä½æ–¼å‡½é¤¨ç«™æ—ï¼Œåœ°ç†ä½ç½®æ¥µä½³ã€‚é€™æ˜¯ Day 2 å‰å¾€æ–°å¹¹ç·šçš„æœ€ä½³èµ·é»ã€‚", 
                        reservation_info: { type: "Hotel", number: "JRIH-2026", name: "YOU/YK", check_in: "15:00", guests: "3åæˆäºº" }
                    },
                    { 
                        time: "12:45", title: "è¨ˆç¨‹è»Šå‰å¾€ UNIQLO æ˜­å’Œåº—", tag: "Transport", desc: "å¾é£¯åº—æ­è¨ˆç¨‹è»Šå‡ºç™¼ã€‚ç´„ 20-25 åˆ†é˜è»Šç¨‹ã€‚", 
                        detail: "UNIQLO å‡½é¤¨æ˜­å’Œåº—é›¢å¸‚å€è¼ƒé ï¼Œè¨ˆç¨‹è»Šæ˜¯æ­£ç¢ºé¸æ“‡ï¼Œå¯ç›´æ¥ç”¨ã€MapCodeã€å°èˆªçµ¦å¸æ©Ÿçœ‹ã€‚", 
                        from: "JRå‡½é¤¨ç«™", to: "UNIQLO å‡½é¤¨æ˜­å’Œåº—", 
                        transport_info: { type: "è¨ˆç¨‹è»Š", time_estimate: "20-25åˆ†é˜", note: "è«‹ç”¨ GO App æˆ–è«‹é£¯åº—å«è»Š" }
                    },
                    { 
                        time: "13:15", title: "UNIQLO å‡½é¤¨æ˜­å’Œåº—", tag: "Shopping", desc: "ã€è³¼ç‰©ä»»å‹™ã€‘æ¡è³¼ç™¼ç†±è¡£ã€‚", nav: { mapcode: "86 254 073*65" }, 
                        detail: "ã€å°éŠçŸ¥è­˜ã€‘éƒŠå€åº—é‹ªæ¬¾å¼é½Šå…¨ï¼Œä½†è¨˜ä½ï¼šåœ¨é’æ£®çš„åš´å¯’ä¸‹ï¼Œç¦¦å¯’è£å‚™é æ¯”æ™‚å°šé‡è¦ï¼", 
                        img: "https://images.unsplash.com/photo-1441986300917-64674bd600d8?q=80&w=800&auto=format&fit=crop&w=800&h=600",
                        to: "JR Inn Hakodate" 
                    },
                    { 
                        time: "14:45", title: "è¨ˆç¨‹è»Šè¿”å›é£¯åº—", tag: "Transport", desc: "è«‹åº—å“¡å¹«å¿™å«è»Šè¿”å›é£¯åº—ã€‚", 
                        detail: "è«‹é ç•™è¶³å¤ æ™‚é–“é¿å…å»¶èª¤å¾ŒçºŒçš„å¸‚é›»è¡Œç¨‹ã€‚", 
                        from: "UNIQLO å‡½é¤¨æ˜­å’Œåº—", to: "JR Inn Hakodate", 
                        transport_info: { type: "è¨ˆç¨‹è»Š", time_estimate: "25åˆ†é˜" }
                    },
                    { 
                        time: "15:15", title: "é£¯åº—å¸è²¨ä¼‘æ¯", tag: "Hotel", desc: "è¿”å›é£¯åº—å¸è²¨ï¼Œç¨ä½œæ•´ç†ã€‚", 
                        detail: "é€™æ˜¯ç•¶å¤©å”¯ä¸€çš„ç·©è¡æ™‚é–“ï¼Œè«‹å……åˆ†åˆ©ç”¨ã€‚"
                    },
                    { 
                        time: "15:45", title: "å¸‚é›»è‡³åå­—è¡—ç«™", tag: "Transport", desc: "æ­ä¹˜å¸‚é›» (è·¯é¢é›»è»Š) è‡³ã€Œåå­—è¡—ç«™ã€ã€‚", 
                        detail: "å‡½é¤¨å¸‚é›»æ˜¯é«”é©—å‡½é¤¨é¢¨æƒ…çš„ä¸€éƒ¨åˆ†ã€‚è«‹åœ¨ã€å‡½é¤¨ç«™å‰ã€ä¸Šè»Šï¼Œè‡³ã€åå­—è¡—ç«™ã€ä¸‹è»Šã€‚", 
                        from: "å‡½é¤¨ç«™å‰", to: "åå­—è¡—ç«™", 
                        transport_info: { type: "å¸‚é›»", time_estimate: "10åˆ†é˜", note: "æº–å‚™é›¶éŒ¢æˆ–ä½¿ç”¨äº¤é€šå¡" }
                    },
                    { 
                        time: "16:10", title: "é‡‘æ£®ç´…ç£šå€‰åº«", tag: "Sightseeing", desc: "ç°¡å–®é€›è¡—ã€æ‹ç…§ã€‚", 
                        detail: "ã€æ­·å²åº•è˜Šã€‘é€™æ˜¯æ˜æ²»æ™‚æœŸçš„å¤è€å€‰åº«ç¾¤ï¼Œè¦‹è­‰äº†å‡½é¤¨ä½œç‚ºåœ‹éš›å•†æ¸¯çš„ç¹è¯ã€‚åœ¨é›ªä¸­ï¼Œç´…ç£šèˆ‡ç™½é›ªå½¢æˆå¼·çƒˆå°æ¯”ï¼Œéå¸¸æœ‰è©©æ„ã€‚", 
                        img: "https://images.unsplash.com/photo-1616790933557-4180d5663702?q=80&w=800&auto=format&fit=crop&w=800&h=600",
                        to: "å‡½é¤¨å±±çºœè»Šç«™"
                    },
                    { 
                        time: "16:50", title: "æ­¥è¡Œè‡³å‡½é¤¨å±±çºœè»Šç«™", tag: "Transport", desc: "é›ªåœ°æ­¥è¡Œç´„ 10-15 åˆ†é˜ï¼Œæœ‰äº›å¾®ä¸Šå¡ã€‚", 
                        detail: "è«‹æ³¨æ„é˜²æ»‘ã€‚æ­¥è¡Œæ˜¯æœ€ä½³é¸æ“‡ï¼Œå› ç‚ºæ­¤æ™‚è»Šæµé–‹å§‹è®Šå¤šã€‚", 
                        from: "é‡‘æ£®ç´…ç£šå€‰åº«", to: "å‡½é¤¨å±±çºœè»Šç«™", 
                        transport_info: { type: "æ­¥è¡Œ", time_estimate: "10-15åˆ†é˜", note: "æ³¨æ„é˜²æ»‘" }
                    },
                    { 
                        time: "17:10", title: "æ­ä¹˜çºœè»Šä¸Šå±±", tag: "Transport", desc: "ä¸Šå±±ç´„ 3 åˆ†é˜ã€‚", 
                        detail: "è«‹å‹™å¿…æå‰æ’éšŠï¼Œé¿å…éŒ¯éæ—¥è½å¾Œçš„é»ƒé‡‘è§€æ™¯æ™‚é–“ã€‚", 
                        from: "å±±éº“ç«™", to: "è§€æ™¯å°", 
                        transport_info: { type: "çºœè»Š", time_estimate: "3åˆ†é˜", note: "å±±ä¸Šé¢¨å¤§ï¼" }
                    },
                    { 
                        time: "17:15", title: "å‡½é¤¨å±±ç™¾è¬å¤œæ™¯", tag: "Sightseeing", desc: "æ—¥è½æ™‚é–“ç´„ 16:50ï¼Œæ­¤æ™‚å‰›å¥½æ¥å¤œæ™¯ã€‚", nav: { mapcode: "86 041 028*25" }, 
                        detail: "ã€çŸ¥æ€§æ¢ç´¢ã€‘å¤œæ™¯çš„ç¨ç‰¹ä¹‹è™•åœ¨æ–¼å…©å´æµ·ç£æ”¶æŸçš„æ²™é ¸å²¬åœ°å½¢ã€‚å‹™å¿…æ¶ä½”æœ€ä½³ä½ç½®ã€‚çºœè»Šé‹è¡Œç‹€æ…‹å¯é å…ˆæŸ¥è©¢ã€‚", 
                        img: "https://images.unsplash.com/photo-1535392460594-553655519f93?q=80&w=800&auto=format&fit=crop&w=800&h=600",
                        to: "å¹¸é‹å°ä¸‘æ¼¢å ¡" 
                    },
                    { 
                        time: "18:30", title: "æ­çºœè»Šä¸‹å±± -> è¿”å›ç«™å‰", tag: "Transport", desc: "æ­çºœè»Šä¸‹å±±å¾Œï¼Œå»ºè­°æ­è¨ˆç¨‹è»Šå›å‡½é¤¨ç«™å‰ã€‚", 
                        detail: "ä¸‹å±±æ™‚äººæ½®æ“æ“ ï¼Œè¨ˆç¨‹è»Šæ˜¯çœåŠ›çœæ™‚çš„é¸æ“‡ï¼Œè»Šè³‡ç´„ 1000 æ—¥åœ“å…§ã€‚", 
                        from: "è§€æ™¯å°", to: "å‡½é¤¨ç«™å‰", 
                        transport_info: { type: "è¨ˆç¨‹è»Š/æ­¥è¡Œ", note: "å»ºè­°è¨ˆç¨‹è»Šï¼ŒçœåŠ›" }
                    },
                    { 
                        time: "19:00", title: "å¹¸é‹å°ä¸‘æ¼¢å ¡ (å‡½é¤¨ç«™å‰åº—)", tag: "Food", desc: "æ™šé¤ï¼šå¿…é»ä¸­è¯é›è…¿å ¡ã€‚", 
                        detail: "ã€åœ¨åœ°ç‰¹è‰²ã€‘é€™å®¶æ¼¢å ¡åº—æ˜¯å‡½é¤¨çš„é©•å‚²ï¼Œæ˜¯æ—¥æœ¬Bç´šç¾é£Ÿçš„ä»£è¡¨ã€‚è«‹ä½¿ç”¨ã€ä¸åƒç´…è‚‰ã€å¡ç‰‡ç¢ºèªå…¶ä»–å“é …ã€‚", 
                        img: "https://images.unsplash.com/photo-1594212699903-ec8a3eca50f5?q=80&w=800&auto=format&fit=crop&w=800&h=600"
                    },
                    { 
                        time: "20:30", title: "JR Inn Hakodate ä¼‘æ¯", tag: "Hotel", desc: "Day 1 çµæŸã€‚", 
                        detail: "æ—©é»ä¼‘æ¯ï¼Œç‚ºéš”å¤©çš„é•·é€”ç§»å‹•åšæº–å‚™ã€‚"
                    }
                ]
            },
            {
                day: 2, date: "02.03", week: "TUE",
                heroTitle: "ç§»å‹•æ—¥ï¼šè·¨è¶Šæ´¥è¼•æµ·å³½",
                heroImg: "https://images.unsplash.com/photo-1532236395709-7d70320fec2d?q=80&w=800&auto=format&fit=crop&w=800&h=600",
                events: [
                    { time: "08:00", title: "å‡½é¤¨æœå¸‚æ—©é¤", tag: "Food", desc: "äº«ç”¨æµ·é®®ä¸¼/é‡£çƒè³Šã€‚", detail: "ã€è¶£å‘³ã€‘æœå¸‚è£¡æœ€æœ‰åçš„é«”é©—æ˜¯ã€é‡£çƒè³Šã€ï¼Œå¯ä»¥ç¾é‡£ç¾åƒï¼è¨˜å¾—è¦è²¨æ¯”ä¸‰å®¶ã€‚", img: "https://images.unsplash.com/photo-1574765798950-c8f7734a36f7?q=80&w=800&auto=format&fit=crop&w=800&h=600", to: "JRå‡½é¤¨ç«™" },
                    { 
                        time: "09:30", title: "JR å‡½é¤¨ç«™é–˜é–€", tag: "Transport", desc: "é€²å…¥ JR å‡½é¤¨ç«™é–˜é–€ï¼Œæº–å‚™æ­è»Šã€‚", 
                        detail: "æ™‚é–“ç·Šè¿«ï¼Œè«‹æå‰ç¢ºèªæœˆå°ã€‚éœ€æ›ä¹˜å…©æ¬¡ï¼ˆLocal â†’ æ–°å¹¹ç·š â†’ Localï¼‰ã€‚", 
                        from: "å‡½é¤¨æœå¸‚", to: "JRå‡½é¤¨ç«™", 
                        transport_info: { type: "æ­¥è¡Œ", time_estimate: "10åˆ†é˜", note: "æº–å‚™å¥½ JR Pass (è‹¥æœ‰)" }
                    },
                    { 
                        time: "10:00", title: "Hashodate Liner", tag: "Transport", desc: "å‰å¾€ã€Œæ–°å‡½é¤¨åŒ—æ–—ç«™ã€ã€‚", 
                        detail: "é€™æ˜¯éŠœæ¥æ–°å¹¹ç·šçš„æ¥é§åˆ—è»Šï¼Œè»Šç¨‹ç´„ 20 åˆ†é˜ã€‚", 
                        from: "JRå‡½é¤¨ç«™", to: "æ–°å‡½é¤¨åŒ—æ–—ç«™", 
                        transport_info: { type: "å€é–“åˆ—è»Š", name_jp: "Hashodate Liner", departure: "10:00", arrival: "10:20" }
                    },
                    { 
                        time: "10:35", title: "åŒ—æµ·é“æ–°å¹¹ç·š (éš¼ Hayabusa)", tag: "Transport", desc: "å‰å¾€ã€Œæ–°é’æ£®ç«™ã€ã€‚", 
                        detail: "ã€çŸ¥æ€§æ¢ç´¢ã€‘æ–°å¹¹ç·šç©¿è¶Šçš„ã€é’å‡½éš§é“ã€æ›¾æ˜¯ä¸–ç•Œæœ€é•·æµ·åº•éš§é“ã€‚é€™è¶Ÿç§»å‹•æ¨™èªŒè‘—ä½ å€‘å¾åŒ—æµ·é“è¸å…¥æœ¬å·æ±åŒ—ã€‚", 
                        from: "æ–°å‡½é¤¨åŒ—æ–—ç«™", to: "æ–°é’æ£®ç«™", 
                        transport_info: { type: "æ–°å¹¹ç·š", name_jp: "ã¯ã‚„ã¶ã•", ticket_no: "E892-001234", seat_no: "æŒ‡å®šå¸­ 8è™Ÿè»Š 12A/B/C", departure: "10:35", arrival: "11:35" }
                    },
                    { 
                        time: "11:40", title: "è½‰ä¹˜ JR å¥§ç¾½æœ¬ç·š", tag: "Transport", desc: "è½‰ä¹˜ JR å¥§ç¾½æœ¬ç·š å‰å¾€ã€Œé’æ£®ç«™ã€ã€‚", 
                        detail: "æ–°é’æ£®ç«™åˆ°é’æ£®ç«™è·é›¢å¾ˆçŸ­ï¼Œè»Šç¨‹ç´„ 6 åˆ†é˜ï¼Œæ˜¯é’æ£®å¸‚å€çš„æœ€å¾Œä¸€æ®µæ¥é§ã€‚", 
                        from: "æ–°é’æ£®ç«™", to: "é’æ£®ç«™", 
                        transport_info: { type: "JRå¥§ç¾½æœ¬ç·š", departure: "11:40", arrival: "11:46", note: "æ³¨æ„æœˆå°è³‡è¨Š" }
                    },
                    { 
                        time: "12:00", title: "æŠµé” JR é’æ£®ç«™", tag: "Transport", desc: "å‡ºç«™ï¼Œæº–å‚™åˆé¤èˆ‡å¯„ç‰©ã€‚", 
                        detail: "é’æ£®ç«™æ˜¯å¸‚å€ä¸­å¿ƒï¼Œä¹Ÿæ˜¯ Day 3 ç§Ÿè»Šåœ°é»ï¼Œè«‹ç†Ÿæ‚‰å‘¨é‚Šç’°å¢ƒã€‚"
                    },
                    { 
                        time: "12:15", title: "è¨ˆç¨‹è»Šè‡³ Dormy Inn å¯„ç‰©", tag: "Transport", desc: "æ­è¨ˆç¨‹è»Šå¯„æ”¾è¡Œæã€‚", 
                        detail: "é›–æœªåˆ° Check-in æ™‚é–“ (15:00)ï¼Œä½†å¯å…ˆå¯„ç‰©ã€‚è»Šç¨‹ç´„ 5 åˆ†é˜ã€‚", 
                        from: "é’æ£®ç«™", to: "Dormy Inn Aomori", 
                        transport_info: { type: "è¨ˆç¨‹è»Š", time_estimate: "5åˆ†é˜" }
                    },
                    { 
                        time: "12:40", title: "é’æ£®ç«™é™„è¿‘åˆé¤", tag: "Food", desc: "æ¨è–¦ï¼šå‘³å™Œå’–å“©ç‰›å¥¶æ‹‰éºµã€‚", 
                        detail: "ã€åœ¨åœ°ç‰¹è‰²ã€‘å‘³å™Œå’–å“©ç‰›å¥¶æ‹‰éºµæ˜¯é’æ£®çš„ç¨å‰µç¾é£Ÿï¼Œå£å‘³æ¿ƒéƒä½†éå¸¸ç‰¹åˆ¥ï¼Œå€¼å¾—å˜—è©¦ã€‚", 
                        img: "https://images.unsplash.com/photo-1549492193-f0270a316223?q=80&w=800&auto=format&fit=crop&w=800&h=600"
                    },
                    { 
                        time: "13:40", title: "è¨ˆç¨‹è»Šå‰å¾€é’æ£®ç¸£ç«‹ç¾è¡“é¤¨", tag: "Transport", desc: "æ­è¨ˆç¨‹è»Šã€‚ç´„ 20 åˆ†é˜è»Šç¨‹ã€‚", 
                        detail: "ç¾è¡“é—œä½æ–¼éƒŠå€ï¼Œè¨ˆç¨‹è»Šæ˜¯æœ€ä½³é¸æ“‡ã€‚", 
                        from: "é’æ£®å¸‚å€", to: "é’æ£®ç¸£ç«‹ç¾è¡“é¤¨", 
                        transport_info: { type: "è¨ˆç¨‹è»Š", time_estimate: "20åˆ†é˜" }
                    },
                    { 
                        time: "14:00", title: "é’æ£®ç¸£ç«‹ç¾è¡“é¤¨", tag: "Art", desc: "å¿…çœ‹å¥ˆè‰¯ç¾æ™ºã€Œé’æ£®çŠ¬ã€ã€‚", nav: { mapcode: "99 489 495*20" }, 
                        detail: "ã€è—è¡“åº•è˜Šã€‘é€™æ£Ÿå»ºç¯‰æ¨¡æ“¬äº†è€ƒå¤éºå€çš„æºæ¸ ã€‚å¥ˆè‰¯ç¾æ™ºçš„ã€é’æ£®çŠ¬ã€é«˜é” 8.5 å…¬å°ºï¼Œæ˜¯ç‚ºé’æ£®é‡èº«æ‰“é€ çš„å·¨ä½œã€‚æ³¨æ„æœ€å¾Œå…¥å ´ç‚º 16:30ã€‚", 
                        img: "https://images.unsplash.com/photo-1563509893962-e64e9a594833?q=80&w=800&auto=format&fit=crop&w=800&h=600",
                        to: "Dormy Inn Aomori" 
                    },
                    { 
                        time: "16:15", title: "è¨ˆç¨‹è»Šè¿”å›å¸‚å€/é£¯åº—", tag: "Transport", desc: "æ­è¨ˆç¨‹è»Šè¿”å›ã€‚", 
                        detail: "é ç•™æ™‚é–“è¾¦ç†å…¥ä½æ‰‹çºŒã€‚", 
                        from: "é’æ£®ç¸£ç«‹ç¾è¡“é¤¨", to: "Dormy Inn Aomori", 
                        transport_info: { type: "è¨ˆç¨‹è»Š", time_estimate: "20åˆ†é˜" }
                    },
                    { 
                        time: "16:40", title: "Dormy Inn Aomori è¾¦ç†å…¥ä½", tag: "Hotel", desc: "æ­£å¼ Check-inã€‚", 
                        detail: "ç¢ºèªè¡Œææ˜¯å¦å·²é€å›æˆ¿é–“ï¼Œä¸¦é ˜å–æˆ¿å¡ã€‚", 
                        reservation_info: { type: "Hotel", number: "DMAO-10023", name: "YOU/YK", check_in: "15:00", guests: "3åæˆäºº" }
                    },
                    { 
                        time: "18:00", title: "é’æ£®é„‰åœŸæ–™ç†æ™šé¤", tag: "Food", desc: "ä¾‹å¦‚ï¼šæ´¥è¼•ä¸‰å‘³ç·šå±…é…’å±‹ã€‚", 
                        detail: "ã€è¶£å‘³ã€‘å¸†ç«‹è²ï¼ˆæ‰‡è²ï¼‰æ˜¯é’æ£®çš„ä»£è¡¨æµ·ç”¢ã€‚è«‹ä½¿ç”¨ã€ä¸åƒç´…è‚‰ã€å¡ç‰‡ç¢ºèªæ¹¯åº•æˆåˆ†ã€‚", 
                        img: "https://images.unsplash.com/photo-1627662236254-8c83e29f048c?q=80&w=800&auto=format&fit=crop&w=800&h=600"
                    },
                    { 
                        time: "19:30", title: "å”å‰è¨¶å¾· é’æ£®åƒåˆˆåº—", tag: "Shopping", desc: "è³¼ç‰©ã€‚é›¢é£¯åº—æ­¥è¡Œç´„ 15 åˆ†é˜ï¼Œå»ºè­°è¨ˆç¨‹è»Šã€‚", 
                        detail: "ä½œç‚ºæ™šé¤å¾Œçš„æ•£æ­¥è¡Œç¨‹ï¼Œå¯ä»¥æ¡è³¼é›¶é£Ÿå’Œé›œè²¨ã€‚è«‹å‹™å¿…å°‡ã€è±¡å°ä¿æº«ç“¶ã€ä»»å‹™å®Œæˆã€‚", 
                        to: "Dormy Inn Aomori"
                    },
                    { 
                        time: "21:30", title: "å¤œé³´æ‹‰éºµ", tag: "Food", desc: "å›é£¯åº—äº«ç”¨å…è²»å®µå¤œã€‚", 
                        detail: "é€šå¸¸æ˜¯å…è²»é†¬æ²¹æ‹‰éºµï¼Œåœ¨æº«æ³‰é–‹æ”¾æ™‚é–“æä¾›ã€‚åƒè¬ä¸è¦éŒ¯éï¼"
                    },
                    { 
                        time: "22:00", title: "Dormy Inn Aomori æ³¡æ¹¯", tag: "Relax", desc: "å¤©ç„¶æº«æ³‰ã€‚", 
                        detail: "æ¶ˆé™¤ä¸€å¤©çš„ç–²å‹ï¼Œç‚ºæ˜å¤©çš„è‡ªé§•æŒ‘æˆ°åšæº–å‚™ã€‚"
                    }
                ]
            },
            {
                day: 3, date: "02.04", week: "WED",
                heroTitle: "æš–çˆåˆ—è»Šèˆ‡è˜‹æœæ´¾",
                heroImg: "https://images.unsplash.com/photo-1549643276-fbc2bd5f4038?q=80&w=800&auto=format&fit=crop&w=800&h=600",
                events: [
                    { 
                        time: "09:00", title: "é’æ£®ç«™å‰ç§Ÿè»Šè¡Œå–è»Š", tag: "Transport", desc: "ã€ç§Ÿè»Šé–‹å§‹ã€‘æ‰‹çºŒç´„ 30 åˆ†é˜ã€‚", 
                        detail: "é›ªåœ°è‡ªé§•ç¬¬ä¸€å¤©ï¼Œè«‹åœ¨åœè»Šå ´ç·´ç¿’ç…è»Šå’Œè½‰å‘æ‰‹æ„Ÿã€‚è«‹å‹™å¿…ç¢ºä¿ç§Ÿè»Šå…¬å¸å·²å®‰è£é›ªèƒã€‚", 
                        from: "Dormy Inn Aomori", to: "ELMè³¼ç‰©ä¸­å¿ƒ", 
                        transport_info: { type: "è‡ªé§•", car_type: "é›ªèƒç¢ºèªå®Œç•¢", note: "é§•é§›è«‹æ…¢é€Ÿç†±èº«" } 
                    },
                    { 
                        time: "09:30", title: "å›é£¯åº—è¼‰äººèˆ‡è¡Œæ", tag: "Transport", desc: "è¨­å®šå°èˆªï¼Œé–‹å§‹è‡ªé§•ã€‚", 
                        detail: "è«‹å‹™å¿…å°‡è¡Œæå’Œæ‰€æœ‰æ¡è³¼ç‰©å“è£ä¸Šè»Šï¼Œç¢ºä¿è»Šå…§ç©ºé–“é…ç½®å¦¥ç•¶ã€‚", 
                        from: "é’æ£®ç«™å‰", to: "ELMè³¼ç‰©ä¸­å¿ƒ", 
                        transport_info: { type: "è‡ªé§•", time_estimate: "50-60åˆ†é˜" }
                    },
                    { 
                        time: "10:45", title: "3COINS+plus (ELM)", tag: "Shopping", desc: "ã€ä»»å‹™ 1ã€‘å¿«é€Ÿè²·ç›¸æ©Ÿï¼Œæ§åˆ¶åœ¨ 35 åˆ†é˜å…§ã€‚", nav: { mapcode: "168 649 346*52" }, 
                        detail: "ELM è³¼ç‰©ä¸­å¿ƒå¾ˆå¤§ï¼Œè«‹è¨˜ä¸‹åœè»Šä½ç½®ã€‚è«‹å°‡ã€è²·ç›¸æ©Ÿã€å¡ç‰‡æº–å‚™å¥½ï¼Œè¿…é€Ÿå®Œæˆä»»å‹™ã€‚", 
                        img: "https://images.unsplash.com/photo-1516035069371-29a1b244cc32?q=80&w=800&auto=format&fit=crop&w=800&h=600", 
                        to: "æ´¥è¼•äº”æ‰€å·åŸç«™" 
                    },
                    { 
                        time: "11:20", title: "é–‹è»Šå‰å¾€æ´¥è¼•äº”æ‰€å·åŸç«™", tag: "Transport", desc: "è»Šç¨‹ç´„ 10 åˆ†é˜ï¼Œæº–å‚™æ­ä¹˜æš–çˆåˆ—è»Šã€‚", 
                        detail: "æŠµé”å¾Œï¼Œè«‹åœ¨è»Šç«™æ—çš„æ”¶è²»åœè»Šå ´åœè»Šã€è²·ç¥¨ã€‚æš–çˆåˆ—è»Šç­æ¬¡æ¥µå°‘ã€‚", 
                        from: "ELMè³¼ç‰©ä¸­å¿ƒ", to: "æ´¥è¼•äº”æ‰€å·åŸç«™", 
                        transport_info: { type: "è‡ªé§•", time_estimate: "10åˆ†é˜", note: "è³¼è²·ä¹˜è»Šåˆ¸ + æš–çˆåˆ¸ (å»ç¨‹)" }
                    },
                    { 
                        time: "11:50", title: "æš–çˆåˆ—è»Š (å»ç¨‹)", tag: "Experience", desc: "æ­ä¹˜æ´¥è¼•éµé“ã€Œæš–çˆåˆ—è»Šã€è‡³é‡‘æœ¨ç«™ã€‚", 
                        detail: "è»Šä¸Šæ´»å‹•ï¼šé»çƒ¤é­·é­šã€å–æ¸…é…’ã€æ‹ç…§ã€‚é€™æ˜¯æ„Ÿå—æ´¥è¼•æ¥µåœ°é¢¨å…‰çš„çµ•ä½³æ–¹å¼ã€‚", 
                        from: "æ´¥è¼•äº”æ‰€å·åŸç«™", to: "é‡‘æœ¨ç«™", 
                        transport_info: { type: "æ´¥è¼•éµé“", name_jp: "ã‚¹ãƒˆãƒ¼ãƒ–åˆ—è»Š", departure: "11:50", arrival: "12:15" }
                    },
                    { 
                        time: "12:15", title: "é‡‘æœ¨ç«™ (ä¸­å ´ä¼‘æ¯)", tag: "Sightseeing", desc: "åœ¨æœˆå°æ‹é›ªæ™¯ã€è»Šç«™ç«™é«”æ‹ç…§ã€‚", 
                        detail: "åœç•™æ™‚é–“ç´„ 23 åˆ†é˜ï¼Œå»ºè­°åœ¨è»Šç«™å‘¨é‚Šæ´»å‹•å³å¯ï¼Œä¸è¦è·‘é ï¼Œä»¥å…éŒ¯éå›ç¨‹åˆ—è»Šã€‚", 
                        to: "æ´¥è¼•äº”æ‰€å·åŸç«™"
                    },
                    { 
                        time: "12:38", title: "æ­ä¹˜å›ç¨‹åˆ—è»Š (ä¸€èˆ¬è»Šå»‚)", tag: "Transport", desc: "æ­ä¹˜å›ç¨‹åˆ—è»Šè¿”å›äº”æ‰€å·åŸç«™ã€‚", 
                        detail: "åªéœ€è³¼è²·ã€ä¹˜è»Šåˆ¸ã€å³å¯ã€‚é€šå¸¸æ­¤æ™‚æ®µå›ç¨‹å¯èƒ½é‚„æ˜¯åŒä¸€ç­è»Šé ­æ‹–å›ï¼Œè«‹ç›´æ¥åæ™®é€šè»Šå»‚ã€‚", 
                        from: "é‡‘æœ¨ç«™", to: "æ´¥è¼•äº”æ‰€å·åŸç«™", 
                        transport_info: { type: "æ´¥è¼•éµé“", note: "æ­ä¹˜æ™®é€šè»Šå»‚ (ä¸éœ€æš–çˆåˆ¸)" }
                    },
                    { 
                        time: "13:15", title: "å–è»Šå‰å¾€å¼˜å‰å¸‚", tag: "Transport", desc: "é›ªåœ°è»Šç¨‹ç´„ 50-60 åˆ†é˜ã€‚", 
                        detail: "å‰å¾€å¼˜å‰ï¼Œè·¯ç¨‹è¼ƒé•·ï¼Œè«‹ä¿æŒå®‰å…¨è»Šé€Ÿï¼Œå°¤å…¶æ³¨æ„èé›ªå¾Œçš„æ¿•æ»‘è·¯é¢ã€‚", 
                        from: "æ´¥è¼•äº”æ‰€å·åŸç«™", to: "è—¤ç”°ç´€å¿µåº­åœ’", 
                        transport_info: { type: "è‡ªé§•", time_estimate: "50-60åˆ†é˜" }
                    },
                    { 
                        time: "14:30", title: "å¤§æ­£æµªæ¼«å–«èŒ¶å®¤ (è—¤ç”°ç´€å¿µåº­åœ’)", tag: "Food", desc: "ã€CRITICALã€‘å¿…åƒè˜‹æœæ´¾ã€‚16:00 æœ€å¾Œé»é¤ã€‚", nav: { mapcode: "71 071 513*78" }, 
                        detail: "ã€æ­·å²åº•è˜Šã€‘å¼˜å‰æ˜¯è˜‹æœæ´¾è–åœ°ã€‚é€™å®¶ä½æ–¼å„ªé›…çš„è¥¿å¼åº­åœ’å…§ï¼Œæ˜¯é«”é©—å¤§æ­£æ™‚æœŸæµªæ¼«çš„æœ€ä½³åœ°é»ã€‚è«‹ä½¿ç”¨ã€ç„¡è‚‰æ¡‚ã€å¡ç‰‡ç¢ºèªã€‚", 
                        img: "https://images.unsplash.com/photo-1568571780765-9276ac8b75a2?q=80&w=800&auto=format&fit=crop&w=800&h=600", 
                        to: "å¼˜å‰åŸ" 
                    },
                    { 
                        time: "15:30", title: "å¼˜å‰åŸ / å¼˜å‰å…¬åœ’", tag: "Sightseeing", desc: "æ¬£è³ç™½å¤©é›ªæ™¯ã€ç´…æ©‹ã€‚", 
                        detail: "ã€çŸ¥æ€§æ¢ç´¢ã€‘å¼˜å‰åŸæ˜¯æ±åŒ—å”¯ä¸€ä¿æœ‰å¤©å®ˆé–£çš„åŸå ¡ã€‚äºŒæœˆçš„é›ªæ™¯éå¸¸å„ªç¾ï¼Œè­·åŸæ²³çµå†°ï¼Œæ„Ÿå—åŒ—åœ‹ç¨æœ‰çš„éœè¬ã€‚", 
                        img: "https://images.unsplash.com/photo-1549643276-fbc2bd5f4038?q=80&w=800&auto=format&fit=crop&w=800&h=600", 
                        to: "æ˜Ÿå·´å…‹ å¼˜å‰å…¬åœ’å‰åº—"
                    },
                    { 
                        time: "16:30", title: "æ˜Ÿå·´å…‹ å¼˜å‰å…¬åœ’å‰åº—", tag: "Shopping", desc: "å¤è¹Ÿæ”¹å»ºï¼Œéå¸¸ç¾ã€‚", 
                        detail: "é€™å®¶æ˜Ÿå·´å…‹æ˜¯ç”±æ—¥æœ¬åœ‹å®¶è¨»å†Šçš„æœ‰å½¢æ–‡åŒ–è²¡ã€èˆŠç¬¬äº”åä¹éŠ€è¡Œæœ¬åº—ã€æ”¹å»ºï¼Œå»ºç¯‰æœ¬èº«å°±æ˜¯è—è¡“å“ã€‚", 
                        to: "Dormy Inn Aomori"
                    },
                    { 
                        time: "17:30", title: "é–‹è»Šè¿”å›é’æ£®å¸‚", tag: "Transport", desc: "å¤œé–“é›ªåœ°æ…¢è¡Œï¼Œæ³¨æ„å®‰å…¨ã€‚", 
                        detail: "å¤œé–“é§•é§›åœ¨åœ‹é“ 7 è™Ÿä¸Šï¼Œè»Šé€Ÿå‹™å¿…æ”¾æ…¢ã€‚çµæŸè‡ªé§•ç†±èº«ï¼Œè¿”å›é£¯åº—ã€‚", 
                        from: "å¼˜å‰", to: "Dormy Inn Aomori", 
                        transport_info: { type: "è‡ªé§•", time_estimate: "1å°æ™‚", note: "å¤œé–“é§•é§›è«‹ä¿æŒè»Šè·" }
                    }
                ]
            },
            {
                day: 4, date: "02.05", week: "THU",
                heroTitle: "å±±æ—ï¼šå°‹æ‰¾å…«ç”²ç”°é›ªæ€ª",
                heroImg: "https://images.unsplash.com/photo-1487667258413-5a089052b658?q=80&w=800&auto=format&fit=crop&w=800&h=600",
                alert: "âš ï¸ å®‰å…¨è­¦ç¤ºï¼šè‹¥çºœè»Šåœé§›ï¼Œè«‹å‹™å¿…åŸè·¯ä¸‹å±±ï¼ä¸å¯å‰å¾€åå’Œç”°æ¹–æ–¹å‘ã€‚",
                events: [
                    { 
                        time: "08:30", title: "å¤å·å¸‚å ´ æ—©é¤", tag: "Food", desc: "åƒã€Œã®ã£ã‘ä¸¼ (Nokkedon)ã€ã€‚", 
                        detail: "ã€è¶£å‘³ã€‘åœ¨å¸‚å ´å…§å„æ”¤ä½è‡ªç”±æ­é…æµ·é®®åšæˆç¨ä¸€ç„¡äºŒçš„æµ·é®®ä¸¼ã€‚å‹™å¿…åœ¨ 09:30 å‰ä¸Šå±±ã€‚", 
                        img: "https://images.unsplash.com/photo-1563820986754-051871f3b392?q=80&w=800&auto=format&fit=crop&w=800&h=600", 
                        to: "å…«ç”²ç”°çºœè»Šç«™" 
                    },
                    { 
                        time: "09:30", title: "é–‹è»Šä¸Šå±±å‰å¾€å…«ç”²ç”°çºœè»Šç«™", tag: "Drive", desc: "é›ªåœ°å±±è·¯ï¼Œè»Šç¨‹ç´„ 45-60 åˆ†é˜ã€‚", 
                        detail: "è«‹é–‹å•Ÿå¤§ç‡ˆï¼Œä¿æŒè»Šè·ï¼Œé€™æ®µæ˜¯ä¸Šå¡è·¯æ®µã€‚", 
                        from: "é’æ£®å¸‚å€", to: "å…«ç”²ç”°çºœè»Šç«™", 
                        transport_info: { type: "è‡ªé§•", time_estimate: "45-60åˆ†é˜", note: "æ³¨æ„ä¸Šå¡æ‰“æ»‘" }
                    },
                    { 
                        time: "10:30", title: "æŠµé”çºœè»Šç«™ï¼Œè³¼ç¥¨", tag: "Activity", desc: "åœè»Šï¼Œè³¼ç¥¨ã€‚", 
                        detail: "è«‹é å…ˆç¢ºèªç•¶æ—¥çºœè»Šé‹è¡Œç‹€æ³ã€‚è³¼ç¥¨æ™‚è«‹è©¢å•å±±é ‚é¢¨é€Ÿèˆ‡èƒ½è¦‹åº¦ã€‚", 
                        nav: { mapcode: "99 055 336*13" }
                    },
                    { 
                        time: "11:00", title: "æ­ä¹˜çºœè»Šè³æ¨¹å†° (é›ªæ€ª)", tag: "Nature", desc: "å±±é ‚æ¥µå†·ï¼Œåœç•™ç´„ 20-30 åˆ†é˜å³éœ€ä¸‹å±±ã€‚", 
                        detail: "ã€çŸ¥æ€§æ¢ç´¢ã€‘æ¨¹å†°çš„å½¢æˆéœ€è¦æ¥µç«¯æ¢ä»¶ã€‚å±±é ‚æº«åº¦å¯èƒ½ä½æ–¼ -10Â°Cï¼Œè«‹ç©¿è‘—æœ€åšå¯¦çš„è£å‚™ï¼", 
                        img: "https://images.unsplash.com/photo-1517299321609-52687d1bc55a?q=80&w=800&auto=format&fit=crop&w=800&h=600", 
                        to: "æ˜Ÿé‡é’æ£®å±‹" 
                    },
                    { 
                        time: "12:30", title: "åˆé¤ (çºœè»Šç«™é£Ÿå ‚/ä¸‹å±±é€”ä¸­)", tag: "Food", desc: "åœ¨å±±å€æˆ–ä¸‹å±±é€”ä¸­ç”¨é¤ã€‚", 
                        detail: "åœ¨å±±å€é£Ÿå ‚å¯äº«ç”¨ç†±é¨°é¨°çš„è•éº¥éºµæˆ–å’–å“©é£¯ï¼Œå¿«é€Ÿè£œå……ç†±é‡ã€‚"
                    },
                    { 
                        time: "13:30", title: "å‰å¾€æ˜Ÿé‡é’æ£®å±‹", tag: "Drive", desc: "ã€ä¿å‘½è·¯ç·šã€‘é–‹è»Šä¸‹å±±ï¼Œè½‰é™¸å¥¥æ”¶è²»é“è·¯ (Michinoku Toll Road)ã€‚", 
                        detail: "åŸè·¯ä¸‹å±±å¾Œï¼Œèµ°å¹³å¦çš„æ”¶è²»é“è·¯é›–ç„¶è¼ƒç¹ï¼Œä½†é¿é–‹äº†å±±å€ç©é›ªå’Œç™½éœ§ï¼Œæ˜¯è³‡æ·±å°éŠæ¨è–¦çš„å®‰å…¨é¸é …ã€‚", 
                        from: "å…«ç”²ç”°", to: "æ˜Ÿé‡ é’æ£®å±‹", 
                        transport_info: { type: "è‡ªé§•", time_estimate: "1.5 - 2å°æ™‚", note: "æ”¶è²»é“è·¯å®‰å…¨ï¼Œä½†è«‹å‹¿è¶…é€Ÿ" }
                    },
                    { 
                        time: "15:30", title: "æ˜Ÿé‡ é’æ£®å±‹ Check-in", tag: "Hotel", desc: "äº«å—é ‚ç´šæº«æ³‰èˆ‡ç¥­å…¸æ°›åœã€‚", nav: { mapcode: "84 583 002*44" }, 
                        detail: "ã€è¶£å‘³ã€‘é’æ£®å±‹çš„è¨­è¨ˆä¸»è»¸æ˜¯ã€NORESORE (ç›¡æƒ…äº«å—)ã€ã€‚è«‹å„˜å¿« check-inï¼Œé ç´„æ™šä¸Šçš„ã€é™¸å¥§ç¥­å…¸å±‹ã€ï¼Œä¸¦é«”é©—éœ²å¤©æº«æ³‰ã€æµ®æ¹¯ã€ã€‚", 
                        img: "https://images.unsplash.com/photo-1560935105-d1448b11a511?q=80&w=800&auto=format&fit=crop&w=800&h=600",
                        reservation_info: { type: "Resort", number: "HOS-AOM-1234", name: "YOU/YK", check_in: "15:30", guests: "3åæˆäºº", phone: "+81-50-3134-8096" }
                    },
                    { 
                        time: "17:30", title: "æ™šé¤ï¼šNore Sore é£Ÿå ‚", tag: "Food", desc: "å·²é ç´„è‡ªåŠ©é¤ã€‚", 
                        detail: "ç›¡æƒ…äº«ç”¨é£¯åº—æä¾›çš„é’æ£®ç¾é£Ÿè‡ªåŠ©é¤ã€‚"
                    },
                    { 
                        time: "20:00", title: "é™¸å¥§ç¥­å…¸å±‹è¡¨æ¼”", tag: "Culture", desc: "ã€æ–‡åŒ–é«”é©—ã€‘è§€è³é’æ£®ç¡é­”ç¥­è¡¨æ¼”ã€‚", 
                        detail: "ã€æ–‡åŒ–åº•è˜Šã€‘é€™æ˜¯å°‡é’æ£®æœ€å…·ä»£è¡¨æ€§çš„å››å¤§ç¥­å…¸ï¼ˆç¡é­”ç¥­ã€ç«‹ä½æ­¦å¤šç­‰ï¼‰æ¿ƒç¸®æˆä¸€å°çš„ç²¾å½©è¡¨æ¼”ã€‚æ˜¯äº†è§£é’æ£®æ–‡åŒ–æœ€å¿«ã€æœ€ç†±æƒ…çš„æ–¹å¼ã€‚", 
                        img: "https://images.unsplash.com/photo-1533230554519-5374be216255?q=80&w=800&auto=format&fit=crop&w=800&h=600"
                    }
                ]
            },
            {
                day: 5, date: "02.06", week: "FRI",
                heroTitle: "é«”é©—ï¼šæš–çˆé¦¬è»Šèˆ‡æ»‘é›ª",
                heroImg: "https://images.unsplash.com/photo-1548777123-e213912bc571?q=80&w=800&auto=format&fit=crop&w=800&h=600",
                events: [
                    { time: "07:30", title: "é£¯åº—æ—©é¤", tag: "Food", desc: "äº«ç”¨é£¯åº—æ—©é¤ã€‚", detail: "è«‹åœ¨ç”¨é¤æ™‚ç¢ºèªç•¶å¤©æ»‘é›ªå ´çš„å¤©æ°£ç‹€æ³ã€‚" },
                    { 
                        time: "10:00", title: "æš–çˆé¦¬è»Š (Stove Carriage)", tag: "Relax", desc: "ã€é£¯åº—æ´»å‹•ã€‘åœ¨é¦¬è»Šä¸Šäº«ç”¨é»å¿ƒã€‚", 
                        detail: "ã€çŸ¥æ€§æ¢ç´¢ã€‘åœ¨è¢«ç™½é›ªè¦†è“‹çš„å…¬åœ’è£¡ï¼Œæ­è‘—é¦¬è»Šï¼Œåœ¨æº«æš–çš„æš–çˆæ—çƒ¤é­·é­šï¼Œéå¸¸æµªæ¼«ã€‚éœ€äº‹å‰é ç´„ã€‚", 
                        img: "https://images.unsplash.com/photo-1500595046743-cd271d694d30?q=80&w=800&auto=format&fit=crop&w=800&h=600", 
                        to: "æ»‘é›ªå ´" 
                    },
                    { 
                        time: "11:00", title: "é–‹è»Šå‰å¾€æ»‘é›ªå ´", tag: "Drive", desc: "è·é›¢é’æ£®å±‹ç´„ 30 åˆ†é˜è»Šç¨‹ã€‚", 
                        detail: "æ»‘é›ªå ´é€šå¸¸æŒ‡ æ±åŒ—ç”ºå°å·åŸæ¹–å…¬åœ’æ»‘é›ªå ´ï¼Œè·¯æ³å¹³å¦ï¼Œä½†ä»éœ€æ³¨æ„é›ªé¢ã€‚", 
                        from: "æ˜Ÿé‡ é’æ£®å±‹", to: "ç¶ ä¹‹å¤§åœ°èˆ‡ç¾…æ›¼ä¹‹æ£®å…¬åœ’", 
                        transport_info: { type: "è‡ªé§•", time_estimate: "30åˆ†é˜" }
                    },
                    { time: "11:30", title: "æ»‘é›ªå ´é£Ÿå ‚åˆé¤", tag: "Food", desc: "åœ¨æ»‘é›ªå ´ç”¨é¤ã€‚", detail: "åˆé¤æ™‚é–“å¯è§€å¯Ÿå ´åœ°å’Œäººæ½®ç‹€æ³ã€‚" },
                    { time: "12:30", title: "ç§Ÿå€Ÿæ»‘é›ªè£å‚™", tag: "Activity", desc: "ç§Ÿå€Ÿ Ski/Snowboardã€‚", detail: "è«‹å‹™å¿…æª¢æŸ¥è£å‚™æ˜¯å¦åˆè…³ï¼Œä¸¦ç¢ºä¿é ­ç›”å®‰å…¨å¸¶ç‰¢å›ºã€‚" },
                    { 
                        time: "13:00", title: "æ»‘é›ªé«”é©—", tag: "Activity", desc: "åˆå­¸è€…å»ºè­° 2 å°æ™‚å·²è¶³å¤ ã€‚", nav: { phone: "0175-63-4848" }, 
                        detail: "ç”ºç‡Ÿæ»‘é›ªå ´çš„å¡åº¦è¼ƒç·©ï¼Œå°æ–¼æˆäººåˆå­¸è€…ä¾†èªªå£“åŠ›è¼ƒå°ï¼Œæ˜¯ç·´ç¿’åŸºæœ¬æŠ€å·§çš„ç†æƒ³é¸æ“‡ã€‚", 
                        img: "https://images.unsplash.com/photo-1551698618-1dfe5d97d256?q=80&w=800&auto=format&fit=crop&w=800&h=600", 
                        to: "é’æ£®å±‹" 
                    },
                    { time: "15:00", title: "æ­¸é‚„è£å‚™ï¼Œè¿”å›é’æ£®å±‹", tag: "Drive", desc: "é–‹è»Šè¿”å›é£¯åº—ã€‚", detail: "æ­¸é‚„è£å‚™å¾Œï¼Œè«‹ä»”ç´°æª¢æŸ¥æ˜¯å¦æœ‰éºæ¼ç‰©å“ã€‚", from: "æ»‘é›ªå ´", to: "æ˜Ÿé‡ é’æ£®å±‹" },
                    { time: "16:00", title: "å›é£¯åº—ä¼‘æ¯/æ³¡æ¹¯", tag: "Relax", desc: "å›é£¯åº—ä¼‘æ¯ï¼Œå†æ¬¡æ³¡æ¹¯æš–èº«ã€‚", detail: "æº«æ³‰æ˜¯æ¶ˆé™¤æ»‘é›ªç–²å‹çš„æœ€ä½³æ–¹å¼ã€‚" },
                    { 
                        time: "20:00", title: "é™¸å¥§ç¥­å…¸å±‹è¡¨æ¼”", tag: "Culture", desc: "ã€æ–‡åŒ–é«”é©—ã€‘è§€è³é’æ£®ç¡é­”ç¥­è¡¨æ¼”ã€‚", 
                        detail: "ã€æ–‡åŒ–åº•è˜Šã€‘é€™æ˜¯å°‡é’æ£®æœ€å…·ä»£è¡¨æ€§çš„å››å¤§ç¥­å…¸ï¼ˆç¡é­”ç¥­ã€ç«‹ä½æ­¦å¤šç­‰ï¼‰æ¿ƒç¸®æˆä¸€å°çš„ç²¾å½©è¡¨æ¼”ã€‚æ˜¯äº†è§£é’æ£®æ–‡åŒ–æœ€å¿«ã€æœ€ç†±æƒ…çš„æ–¹å¼ã€‚", 
                        img: "https://images.unsplash.com/photo-1533230554519-5374be216255?q=80&w=800&auto=format&fit=crop&w=800&h=600"
                    }
                ]
            },
            {
                day: 6, date: "02.07", week: "SAT",
                heroTitle: "æ»¿è¼‰è€Œæ­¸",
                heroImg: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=800&auto=format&fit=crop&w=800&h=600",
                events: [
                    { time: "08:00", title: "é£¯åº—æ—©é¤", tag: "Food", desc: "äº«ç”¨é£¯åº—æ—©é¤ã€‚", detail: "æœ€å¾Œä¸€å¤©ï¼ŒæŠŠæ¡æ™‚é–“äº«å—æ—©é¤ã€‚" },
                    { 
                        time: "10:00", title: "Check-outï¼Œæº–æ™‚å‡ºç™¼", tag: "Transport", desc: "é–‹è»Šé›¢é–‹é£¯åº—ã€‚æ¥µè‡´æ…¢é€Ÿå®‰å…¨é§•é§›ã€‚", 
                        detail: "ã€æœ€çµ‚éµå¾‹ã€‘ç¢ºä¿è»Šçª—ç»ç’ƒä¹¾æ·¨ï¼Œè¦–ç·šè‰¯å¥½ã€‚è«‹é ç•™ 20 åˆ†é˜ä»¥ä¸Šçµ¦åŠ æ²¹ç«™æ’éšŠã€‚", 
                        from: "æ˜Ÿé‡ é’æ£®å±‹", to: "é’æ£®æ©Ÿå ´", 
                        transport_info: { type: "è‡ªé§•", time_estimate: "1å°æ™‚ 20åˆ†é˜", note: "å‡ºç™¼å‰å‹™å¿…åŠ æ»¿æ²¹" }
                    },
                    { time: "12:00", title: "æ©Ÿå ´é™„è¿‘åŠ æ»¿æ²¹ (Full Tank)", tag: "Drive", desc: "åŠ æ»¿æ²¹å¾Œï¼Œå‰å¾€é‚„è»Šåœ°é»ã€‚", detail: "è«‹å°‹æ‰¾æ©Ÿå ´æœ€è¿‘çš„åŠ æ²¹ç«™ï¼Œé¿å…é‚„è»Šå»¶èª¤ã€‚", img: "https://images.unsplash.com/photo-1569930784237-7b6a2d699397?q=80&w=800&auto=format&fit=crop&w=800&h=600" },
                    { time: "12:30", title: "è¾¦ç†é‚„è»Šæ‰‹çºŒ", tag: "Transport", desc: "æª¢æŸ¥è»Šæ³ï¼Œè¾¦ç†é‚„è»Šã€‚", detail: "è«‹ç¢ºä¿è»Šå…§æ²’æœ‰éºæ¼ç‰©å“ï¼Œä¸¦å°‡è»Šé‘°åŒ™äº¤é‚„çµ¦ç§Ÿè»Šå…¬å¸ã€‚", from: "é‚„è»Šé»", to: "æ©Ÿå ´èˆªå»ˆ" },
                    { time: "13:00", title: "æŠµé”æ©Ÿå ´èˆªå»ˆ", tag: "Transport", desc: "æº–å‚™ Check-inã€‚" },
                    { time: "13:30", title: "è¾¦ç†ç™»æ©Ÿæ‰‹çºŒ (BR 121)", tag: "Flight", desc: "é•·æ¦®èˆªç©ºæ«ƒæª¯ã€‚", detail: "ç¢ºèªç™»æ©Ÿå£è³‡è¨Šã€‚", reservation_info: { type: "Flight", number: "BR121", name: "YOU/YK/YY/YS", departure: "15:30", arrival: "18:30 (TPE)", gate: "3A" } },
                    { time: "14:00", title: "æ©Ÿå ´å…ç¨…åº— (æ¡è²·)", tag: "Shopping", desc: "æ¡è²·è˜‹æœæ´¾ã€è˜‹æœæ±ã€ä¹¾è²¨ã€‚", detail: "é’æ£®æ©Ÿå ´é›–ç„¶å°ï¼Œä½†æœ‰è±å¯Œçš„è˜‹æœè£½å“å¯ä¾›é¸æ“‡ã€‚å¯ä»¥æŠŠæ²’è²·é½Šçš„ä¼´æ‰‹ç¦®åœ¨é€™è£¡è£œé½Šã€‚", img: "https://images.unsplash.com/photo-1579705745811-a32bef7856a3?q=80&w=800&auto=format&fit=crop&w=800&h=600" },
                    { time: "15:30", title: "æ­æ©Ÿè¿”å°", tag: "Flight", desc: "å†è¦‹é’æ£®ï¼ŒæœŸå¾…ä¸‹æ¬¡æ—…ç¨‹ã€‚", detail: "ç¥æ—…é€”æ„‰å¿«ï¼" }
                ]
            }
        ];

        window.switchDay = function(i) {
            if(i === currentIdx) return;
            currentIdx = i;
            // é»æ“Šæ—¥æœŸæ™‚ï¼Œå¼·åˆ¶åˆ‡æ›åˆ°è¡Œç¨‹é 
            if (document.getElementById('view-trip').style.display === 'none') {
                 // æ¨¡æ“¬é»æ“Šè¡Œç¨‹æŒ‰éˆ•
                const tripBtn = document.querySelector('.nav-btn:nth-child(1)');
                window.switchView('trip', tripBtn); 
            } else {
                window.renderTrip();
            }
        }

        window.switchView = function(view, btn) {
            // ä¿®æ­£ Bug: ç§»é™¤æ‰€æœ‰ view-section çš„ display å±¬æ€§ï¼Œç„¶å¾Œå†è¨­å®šç›®æ¨™ view ç‚º block
            document.querySelectorAll('.view-section').forEach(el => {
                el.style.display = 'none';
            });
            document.getElementById('view-' + view).style.display = 'block';

            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');
            
            if(view === 'wallet') {
                window.renderExpenses(); 
            }
            if(view === 'info') {
                window.renderFullTripMap();
            }
            window.scrollTo(0,0);
        }
        
        // --- UPDATED renderTrip FUNCTION ---
        window.renderTrip = function() {
            const nav = document.getElementById('date-nav');
            nav.innerHTML = tripData.map((d, i) => `
                <div class="d-item ${i === currentIdx ? 'active' : ''}" onclick="switchDay(${i})">
                    <div class="d-week">${d.week}</div>
                    <div class="d-num">${d.date.split('.')[1]}</div>
                </div>
            `).join('');

            const day = tripData[currentIdx];
            const container = document.getElementById('timeline-container');
            
            let alertHtml = '';
            if (day.alert) {
                alertHtml = `<div class="alert-banner"><i class="fa-solid fa-triangle-exclamation" style="color:#D9333F; margin-top:3px;"></i><div style="margin-left:10px;"><div style="color:var(--accent-main); font-weight:500;">ä»Šæ—¥å®‰å…¨è­¦ç¤º</div><span class="alert-highlight">${day.alert}</span></div></div>`;
            }

            let html = `
                <div class="hero-card">
                    <img src="${day.heroImg}" class="hero-img">
                    <div class="hero-overlay">
                        <div class="hero-title">${day.heroTitle}</div>
                    </div>
                </div>
                ${alertHtml}
                <div class="timeline-block">
            `;

            html += day.events.map((ev, i) => {
                const data = encodeURIComponent(JSON.stringify(ev));
                const delay = i * 0.1;
                
                // Determine icon based on tag
                let icon = 'fa-circle';
                if (ev.tag === 'Transport' || ev.tag === 'Drive' || ev.tag === 'Flight') icon = 'fa-car-side';
                if (ev.tag === 'Hotel' || ev.tag === 'Check-in') icon = 'fa-bed';
                if (ev.tag === 'Shopping') icon = 'fa-bag-shopping';
                if (ev.tag === 'Food' || ev.tag === 'Cuisine' || ev.tag === 'é¤é£²') icon = 'fa-utensils';
                if (ev.tag === 'Sightseeing' || ev.tag === 'Nature' || ev.tag === 'Art' || ev.tag === 'Experience' || ev.tag === 'æ™¯é»') icon = 'fa-map-pin';
                if (ev.tag === 'Activity' || ev.tag === 'Relax' || ev.tag === 'Culture' || ev.tag === 'é«”é©—') icon = 'fa-person-skiing';
                if (ev.tag === 'Flight') icon = 'fa-plane';
                
                // ä½¿ç”¨æ–°çš„äº¤é€šå¡ç‰‡æ¨£å¼
                const cardClass = (ev.tag === 'Transport' || ev.tag === 'Drive' || ev.tag === 'Flight') ? 'transport-card' : '';


                return `
                    <div class="event-node visible" style="transition-delay: ${delay}s">
                        <div class="time-dot"></div>
                        <div class="event-card ${cardClass}" onclick="openDetail('${data}')">
                            <!-- å¢åŠ æ™‚é–“é¡¯ç¤º (æ»¿è¶³ç¬¬ 3 é»éœ€æ±‚) -->
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <span class="event-tag">${ev.tag}</span>
                                <span style="font-family: var(--font-serif); font-weight: 700; color: var(--accent-red); font-size: 1.1rem;">${ev.time}</span>
                            </div>
                            <div class="event-title">${ev.title}</div>
                            <div style="font-size:0.7rem; color:#888; margin-top:5px; display:flex; align-items:center; gap:8px;">
                                <i class="fa-solid ${icon}"></i> 
                                <span>${ev.desc}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            html += `</div>`;

            container.innerHTML = html;
        }

        function getMapUrl(data) {
             const base = `https://www.google.com/maps/embed/v1/`;
             let embedUrl = '';
             let query = '';
             
             if (data.from && data.to) {
                 // Movement (Route Mode)
                 embedUrl = `${base}directions?key=${GOOGLE_MAPS_API_KEY}`;
                 query = `&origin=${encodeURIComponent(data.from)}&destination=${encodeURIComponent(data.to)}&mode=driving`;
             } else if (data.title) {
                 // Location (Search Mode - FIX: Using search mode for flexibility)
                 embedUrl = `${base}search?key=${GOOGLE_MAPS_API_KEY}`;
                 query = `&q=${encodeURIComponent(data.title)}`;
             } else {
                 return null;
             }
             return embedUrl + query;
        }

        window.renderFullTripMap = function() {
            const mapIframe = document.getElementById('trip-map-overview-iframe');
            
            // Build the waypoints list for the overall view
            const waypoints = tripData.flatMap(day => 
                day.events.filter(e => e.title.includes('å‡½é¤¨') || e.title.includes('é’æ£®') || e.title.includes('å…«ç”²ç”°') || e.title.includes('æ´¥è¼•') || e.title.includes('å¼˜å‰') )
                             .map(e => e.title)
            ).join('|');

            // Use Embed API with a centralized view of the main cities
            const embedUrl = `https://www.google.com/maps/embed/v1/view?key=${GOOGLE_MAPS_API_KEY}&center=40.7831,140.7431&zoom=8&q=${encodeURIComponent(waypoints)}`;

            mapIframe.src = embedUrl;
        }
        
        window.openExternalMap = function() {
            // Opens Google Maps app/website for the current modal's location
            const currentTitle = document.getElementById('m-title').innerText;
            window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(currentTitle)}`, '_blank');
        }

        function createInfoItem(icon, label, value) {
            if (!value) return '';
            return `
                <div class="info-item">
                    <div class="info-label">
                        <i class="fa-solid ${icon}"></i>
                        <span>${label}</span>
                    </div>
                    <div class="info-value">${value}</div>
                </div>
            `;
        }

        window.openDetail = function(dataStr) {
            const data = JSON.parse(decodeURIComponent(dataStr));
            document.getElementById('m-title').innerText = data.title;
            document.getElementById('m-desc').innerHTML = `
                <h3 class="serif" style="font-size: 1.2rem; margin-bottom: 10px; color: var(--accent-main); border-bottom: 1px solid #EEE;">å°éŠç­†è¨˜ / Local Insight</h3>
                <p style="white-space: pre-wrap;">${data.detail || data.desc}</p>
            `;
            document.getElementById('m-tag').innerText = data.tag;
            document.getElementById('m-img').src = data.img;
            
            // --- INFO CARD GENERATION ---
            const infoGroup = document.getElementById('m-detail-info');
            let infoHtml = '';
            // Clone the existing header to preserve styles
            const headerHtml = infoGroup.querySelector('h3') ? infoGroup.querySelector('h3').outerHTML : `<h3 class="serif" style="font-size: 1.2rem; margin-bottom: 15px; color: var(--accent-main);">é è¨‚ / äº¤é€šè³‡è¨Š</h3>`;

            if (data.reservation_info) {
                // Accommodation/Reservation Info (Hotel/Resort)
                const res = data.reservation_info;
                infoGroup.classList.remove('hidden');
                infoHtml += createInfoItem('fa-hashtag', 'é è¨‚ç·¨è™Ÿ', res.number);
                infoHtml += createInfoItem('fa-user', 'é è¨‚äºº/æˆ¿å®¢', res.name);
                infoHtml += createInfoItem('fa-calendar-check', 'å…¥ä½/Check-in', res.check_in);
                infoHtml += createInfoItem('fa-users', 'æˆ¿å®¢äººæ•¸', res.guests);
                infoHtml += createInfoItem('fa-phone', 'é£¯åº—é›»è©±', res.phone);
                
            } else if (data.transport_info) {
                // Transport Info (Train/Drive/Bus)
                const trans = data.transport_info;
                infoGroup.classList.remove('hidden');
                infoHtml += createInfoItem('fa-train-subway', 'äº¤é€šé¡å‹', trans.type);
                infoHtml += createInfoItem('fa-ticket', 'è»Šç¥¨/è¨‚å–®è™Ÿç¢¼', trans.ticket_no);
                infoHtml += createInfoItem('fa-clock', 'é è¨ˆå‡ºç™¼', trans.departure);
                infoHtml += createInfoItem('fa-clock-rotate-left', 'é è¨ˆæŠµé”', trans.arrival);
                infoHtml += createInfoItem('fa-couch', 'è»Šå»‚/åº§ä½', trans.seat_no);
                infoHtml += createInfoItem('fa-car', 'è»Šç¨®/è»Šæ¬¡', trans.name_jp || trans.car_type);
                infoHtml += createInfoItem('fa-road', 'å‚™è¨»/æ™‚é•·', trans.note || trans.time_estimate);

            } else {
                infoGroup.classList.add('hidden');
            }
            // Re-inject header and new content
            infoGroup.innerHTML = headerHtml + infoHtml;


            // MapCode Section
            const mapSec = document.getElementById('m-map-section');
            if (data.nav && data.nav.mapcode) {
                mapSec.classList.remove('hidden');
                document.getElementById('m-mapcode').innerText = data.nav.mapcode;
            } else {
                mapSec.classList.add('hidden');
            }
            
            // Google Maps Interactive Embed Section
            const gmapPreview = document.getElementById('m-gmap-preview');
            const gmapIframe = document.getElementById('m-gmap-iframe');
            const mapUrl = getMapUrl(data);
            
            if (mapUrl && GOOGLE_MAPS_API_KEY) {
                gmapPreview.classList.remove('hidden');
                gmapIframe.src = mapUrl;
            } else {
                gmapPreview.classList.add('hidden');
            }


            document.getElementById('detail-modal').classList.add('active');
            document.querySelector('.modal-overlay').classList.add('active');
        }

        window.closeModal = function() {
            document.getElementById('detail-modal').classList.remove('active');
            document.querySelector('.modal-overlay').classList.remove('active');
        }

        window.copyMapCode = function() {
            const code = document.getElementById('m-mapcode').innerText;
            // Use execCommand for broader compatibility in iFrame environments
            const textArea = document.createElement('textarea');
            textArea.value = code;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    if (window.confirm) {
                        window.confirm('MapCode å·²è¤‡è£½ï¼');
                    } else {
                        console.log('MapCode å·²è¤‡è£½ï¼');
                    }
                } else {
                    if (window.confirm) {
                        window.confirm('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ã€‚');
                    } else {
                        console.log('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ã€‚');
                    }
                }
            } catch (err) {
                 if (window.confirm) {
                        window.confirm('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ã€‚');
                    } else {
                        console.log('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ã€‚');
                    }
            }
            document.body.removeChild(textArea);
        }

        window.showFs = function(jp, cn) {
            document.getElementById('fs-jp').innerText = jp;
            document.getElementById('fs-cn').innerText = cn;
            document.getElementById('fs-text-modal').classList.add('active');
        }
        window.closeFs = function() {
            document.getElementById('fs-text-modal').classList.remove('active');
        }

    </script>
</body>
</html>
