<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>L'VOYAGE | 青森函館 2026</title>
    <meta name="theme-color" content="#1a1a1a">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Noto+Serif+TC:wght@300;500;700&family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Palette: Luxury Winter */
            --bg-body: #F9F8F4; /* 溫暖的紙白色 */
            --bg-card: #FFFFFF;
            --text-primary: #1A1A1A;
            --text-secondary: #666666;
            --accent-main: #1C2541; /* 午夜藍 */
            --accent-gold: #B49B67; /* 香檳金 */
            --line-light: #E0E0E0;
            --shadow-soft: 0 10px 40px -10px rgba(0,0,0,0.08);
            --font-serif: 'Cormorant Garamond', 'Noto Serif TC', serif;
            --font-sans: 'Noto Sans TC', sans-serif;
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; padding: 0;
            background-color: var(--bg-body);
            color: var(--text-primary);
            font-family: var(--font-sans);
            padding-bottom: calc(80px + var(--safe-bottom));
            overflow-x: hidden;
        }

        /* --- TYPOGRAPHY --- */
        h1, h2, h3, .serif { font-family: var(--font-serif); }
        .italic { font-style: italic; }

        /* --- COVER SCREEN (INTRO) --- */
        #intro-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background: var(--accent-main); color: white;
            z-index: 9999; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            transition: transform 1s cubic-bezier(0.77, 0, 0.175, 1);
        }
        .intro-text { 
            text-align: center; 
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* NEW INTRO COUNTDOWN STYLES */
        .intro-countdown-block {
            margin-bottom: 40px;
            opacity: 0;
            animation: fadeIn 1.5s ease forwards 0.3s;
        }
        
        .countdown-value {
            font-size: 8rem; /* Extremely large */
            line-height: 1;
            font-weight: 300;
            color: var(--accent-gold);
            font-family: var(--font-serif);
        }
        
        .countdown-label-intro {
            font-size: 1rem;
            letter-spacing: 3px;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            text-align: center;
            margin-top: 10px;
        }
        /* END NEW INTRO COUNTDOWN STYLES */

        .intro-title-block {
            text-align: center; 
            opacity: 0; 
            animation: fadeIn 1.5s ease forwards 0.8s;
        }

        .intro-title { font-size: 3rem; letter-spacing: 5px; margin-bottom: 10px; font-weight: 300; }
        .intro-sub { font-size: 0.9rem; letter-spacing: 3px; color: var(--accent-gold); text-transform: uppercase; }
        .intro-btn {
            margin-top: 40px; padding: 15px 40px; border: 1px solid rgba(255,255,255,0.3);
            background: transparent; color: white; font-family: var(--font-serif);
            font-size: 1.1rem; letter-spacing: 2px; cursor: pointer; transition: 0.3s;
            opacity: 0; animation: fadeIn 1.5s ease forwards 1s;
        }
        .intro-btn:hover { background: white; color: var(--accent-main); }

        @keyframes fadeIn { to { opacity: 1; } }

        /* --- HEADER --- */
        .elegant-header {
            padding: 40px 20px 20px;
            background: linear-gradient(to bottom, #F9F8F4 80%, rgba(249,248,244,0));
            position: sticky; top: 0; z-index: 100;
        }
        .top-meta { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px; }
        .brand { font-family: var(--font-serif); font-size: 1.5rem; font-weight: 700; letter-spacing: 1px; color: var(--accent-main); }
        .countdown { font-family: var(--font-serif); font-size: 3rem; line-height: 1; color: var(--accent-gold); }
        .countdown-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px; text-align: right; color: var(--text-secondary); }

        /* --- DATE NAV (Minimalist) --- */
        .date-scroller { display: flex; gap: 20px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
        .date-scroller::-webkit-scrollbar { display: none; }
        .d-item { 
            min-width: 60px; text-align: center; opacity: 0.4; transition: 0.4s; cursor: pointer; 
            display: flex; flex-direction: column; align-items: center;
        }
        .d-item.active { opacity: 1; transform: scale(1.1); }
        .d-week { font-size: 0.7rem; letter-spacing: 1px; margin-bottom: 5px; text-transform: uppercase; }
        .d-num { font-family: var(--font-serif); font-size: 1.5rem; position: relative; }
        .d-item.active .d-num::after {
            content: ''; position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; background: var(--accent-gold); border-radius: 50%;
        }

        /* --- MAIN CONTENT --- */
        .container { padding: 0 20px; max-width: 600px; margin: 0 auto; }
        
        .hero-card {
            position: relative; height: 300px; border-radius: 2px; overflow: hidden; margin-bottom: 40px;
            box-shadow: var(--shadow-soft);
        }
        .hero-img { width: 100%; height: 100%; object-fit: cover; transition: transform 10s ease; }
        .hero-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%; padding: 30px;
            background: linear-gradient(to top, rgba(28,37,65,0.9), transparent); color: white;
        }
        .hero-day { font-size: 0.8rem; letter-spacing: 3px; color: var(--accent-gold); margin-bottom: 10px; text-transform: uppercase; }
        .hero-title { font-size: 1.8rem; margin: 0; line-height: 1.3; font-weight: 500; text-shadow: 0 2px 10px rgba(0,0,0,0.3); }

        /* Timeline Redesign */
        .timeline-block { position: relative; padding-left: 20px; border-left: 1px solid var(--line-light); margin-left: 10px; }
        
        .event-node { margin-bottom: 40px; position: relative; opacity: 0; transform: translateY(20px); transition: 0.6s ease; }
        .event-node.visible { opacity: 1; transform: translateY(0); }
        
        .time-dot { 
            position: absolute; left: -25px; top: 0; width: 9px; height: 9px; 
            background: var(--bg-body); border: 2px solid var(--accent-main); border-radius: 50%; 
        }
        
        .time-label { 
            font-family: var(--font-serif); font-size: 1.1rem; color: var(--accent-gold); font-style: italic; margin-bottom: 5px; 
        }

        .event-card {
            background: var(--bg-card); padding: 25px; border-radius: 4px; /* Shaper corners for elegance */
            box-shadow: var(--shadow-soft); cursor: pointer; transition: 0.3s;
            border-bottom: 2px solid transparent;
        }
        .event-card:hover { transform: translateY(-3px); border-bottom: 2px solid var(--accent-gold); }
        .event-card.special-event { border: 1px solid var(--accent-gold); background: linear-gradient(to bottom right, #FFFCF5, #FFFFFF); }
        
        .event-tag { 
            font-size: 0.6rem; text-transform: uppercase; letter-spacing: 2px; color: var(--text-secondary); margin-bottom: 10px; display: block; 
        }
        .event-title { font-family: var(--font-serif); font-size: 1.3rem; margin-bottom: 8px; color: var(--accent-main); font-weight: 700; }
        .event-desc { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; font-weight: 300; }
        .event-img { width: 100%; height: 150px; object-fit: cover; margin-top: 15px; filter: grayscale(10%); transition: 0.3s; }
        .event-card:hover .event-img { filter: grayscale(0%); }

        /* --- FLOATING NAV --- */
        .glass-nav {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px;
            background: rgba(28, 37, 65, 0.9); backdrop-filter: blur(10px);
            border-radius: 50px; padding: 15px 30px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1000;
        }
        .nav-btn { color: rgba(255,255,255,0.5); font-size: 1.2rem; cursor: pointer; transition: 0.3s; position: relative; }
        .nav-btn.active { color: var(--accent-gold); transform: translateY(-2px); }
        .nav-btn.active::after {
            content: ''; position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; background: var(--accent-gold); border-radius: 50%;
        }

        /* --- MODAL (Full Screen Overlay) --- */
        .modal-full {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-body); z-index: 2000;
            opacity: 0; pointer-events: none; transition: 0.4s ease;
            overflow-y: auto;
        }
        .modal-full.active { opacity: 1; pointer-events: auto; }
        
        .modal-hero { height: 40vh; width: 100%; object-fit: cover; }
        .modal-content { padding: 40px 20px; transform: translateY(50px); transition: 0.5s ease; opacity: 0; max-width: 600px; margin: 0 auto; }
        .modal-full.active .modal-content { transform: translateY(0); opacity: 1; transition-delay: 0.2s; }
        
        .close-fab {
            position: fixed; top: 20px; right: 20px; width: 40px; height: 40px;
            background: white; border-radius: 50%; display: flex; justify-content: center; align-items: center;
            box-shadow: var(--shadow-soft); cursor: pointer; z-index: 2100; color: var(--accent-main);
        }

        /* --- UTILS --- */
        .hidden { display: none; }
        .money-display { text-align: center; padding: 40px 0; background: white; margin-bottom: 20px; }
        .input-elegant { 
            width: 100%; border: none; border-bottom: 1px solid var(--line-light); 
            padding: 15px 0; font-family: var(--font-serif); font-size: 1.1rem; 
            background: transparent; margin-bottom: 20px; outline: none; border-radius: 0;
        }
        .btn-elegant {
            width: 100%; padding: 15px; background: var(--accent-main); color: white;
            border: none; letter-spacing: 2px; font-family: var(--font-serif); cursor: pointer;
        }

    </style>
</head>
<body>

    <!-- Intro Screen -->
    <div id="intro-screen">
        <div class="intro-text">
            
            <!-- COUNTDOWN ADDED HERE -->
            <div class="intro-countdown-block">
                <div class="countdown-value" id="intro-days-left">--</div>
                <div class="countdown-label-intro">距離出發 (DAYS LEFT)</div>
            </div>
            <!-- END COUNTDOWN -->
            
            <div class="intro-title-block">
                <div class="intro-sub">AOMORI & HAKODATE</div>
                <div class="intro-title serif">青森函館<br>冬日紀行</div>
            </div>
            
            <button class="intro-btn" onclick="enterApp()">開啟旅程</button>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app-container">
        
        <div class="elegant-header">
            <div class="top-meta">
                <div class="brand">L'VOYAGE</div>
                <div>
                    <div class="countdown" id="days-left">--</div>
                    <div class="countdown-label">距離出發</div>
                </div>
            </div>
            
            <div class="date-scroller" id="date-nav">
                <!-- Dates generated by JS -->
            </div>
        </div>

        <!-- TRIP TAB -->
        <div id="view-trip" class="view-section">
            <div class="container" id="timeline-container">
                <!-- Timeline content generated by JS -->
            </div>
        </div>

        <!-- WALLET TAB -->
        <div id="view-wallet" class="view-section hidden">
            <div class="container">
                <div class="hero-card" style="height: 200px;">
                    <img src="https://placehold.co/800x400/1C2541/FFFFFF?text=Travel+Wallet" class="hero-img">
                    <div class="hero-overlay">
                        <div class="hero-title serif">旅費管家</div>
                    </div>
                </div>
                
                <div class="money-display">
                    <div style="font-size: 0.9rem; color: var(--text-secondary); letter-spacing: 1px;">總支出 TOTAL EXPENDITURE</div>
                    <div class="serif" style="font-size: 2.5rem; color: var(--accent-main); margin: 10px 0;" id="total-jpy">¥0</div>
                    <div style="color: var(--accent-gold);">≈ TWD <span id="total-twd">0</span></div>
                </div>

                <div style="background: white; padding: 30px; box-shadow: var(--shadow-soft);">
                    <input type="text" id="ex-item" class="input-elegant" placeholder="項目名稱 (例如：晚餐)">
                    <input type="number" id="ex-price" class="input-elegant" placeholder="金額 (日幣)">
                    <button class="btn-elegant" onclick="addExpense()">記錄支出</button>
                </div>

                <div id="expense-list" style="margin-top: 40px;"></div>
            </div>
        </div>

        <!-- TOOLS TAB -->
        <div id="view-tools" class="view-section hidden">
            <div class="container">
                <div style="padding: 40px 0;">
                    <h2 class="serif" style="text-align: center; color: var(--accent-main); margin-bottom: 40px;">旅行隨身秘書</h2>
                    
                    <div class="event-card" style="margin-bottom: 20px;" onclick="openDetail(JSON.stringify({title:'實用翻譯', desc:'餐廳點餐與日常對話', pointSpeak:[{cn:'麻煩結帳', jp:'お会計をお願いします'}, {cn:'我不吃豬肉', jp:'豚肉は食べられません'}]}))">
                        <div class="event-title"><i class="fa-solid fa-language"></i> 快速翻譯</div>
                        <div class="event-desc">點餐、問路必備的日文短句。</div>
                    </div>
                    
                    <div class="event-card" style="margin-bottom: 20px;">
                        <div class="event-title"><i class="fa-solid fa-cloud-sun"></i> 天氣預報</div>
                        <div class="event-desc">查詢青森、函館的降雪機率與氣溫。</div>
                    </div>

                    <div class="event-card">
                        <div class="event-title"><i class="fa-solid fa-suitcase-medical"></i> 緊急聯絡</div>
                        <div class="event-desc">警察: 110, 救護車: 119, 駐日辦事處資訊。</div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Floating Navigation -->
    <div class="glass-nav">
        <div class="nav-btn active" onclick="switchView('trip', this)"><i class="fa-solid fa-map"></i></div>
        <div class="nav-btn" onclick="switchView('wallet', this)"><i class="fa-solid fa-wallet"></i></div>
        <div class="nav-btn" onclick="switchView('tools', this)"><i class="fa-solid fa-compass"></i></div>
    </div>

    <!-- Full Screen Detail Modal -->
    <div class="modal-full" id="detail-modal">
        <div class="close-fab" onclick="closeModal()"><i class="fa-solid fa-times"></i></div>
        <img src="" id="m-img" class="modal-hero">
        <div class="modal-content">
            <div id="m-tag" style="color: var(--accent-gold); letter-spacing: 2px; font-size: 0.8rem; font-weight: bold; margin-bottom: 10px;">TAG</div>
            <h1 id="m-title" class="serif" style="font-size: 2.2rem; margin: 0 0 20px 0; line-height: 1.2;">Title</h1>
            <p id="m-desc" style="font-size: 1.1rem; line-height: 1.8; color: #444;">Description</p>
            
            <div id="m-ps-area" style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #EEE;">
                <h3 class="serif">指差會話 Communication</h3>
                <div id="m-ps-content"></div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const tripData = [
            {
                day: 1, date: "02.02", week: "MON",
                heroTitle: "函館：北國的起點與百萬夜景",
                heroImg: "https://placehold.co/800x600/1C2541/FFFFFF?text=Hakodate+Night+View",
                events: [
                    { time: "11:10", title: "抵達函館機場 (HKD)", tag: "Transport", desc: "入境手續，領取行李。搭乘 12:30 機場巴士前往 JR 函館站。", img: "https://placehold.co/600x300/B49B67/FFFFFF?text=Hakodate+Airport" },
                    { time: "13:35", title: "購物任務：UNIQLO & Bic Camera", tag: "Shopping", desc: "搭計程車前往。採購防寒用品與電器。務必快狠準，15:15 前結束。", pointSpeak: [{cn:"請載我到 Bic Camera", jp:"ビックカメラまでお願いします"}] },
                    { time: "15:45", title: "金森紅磚倉庫", tag: "Sightseeing", desc: "飯店卸貨後，搭市電前往。感受港邊風情。", img: "https://placehold.co/600x300/964B00/FFFFFF?text=Red+Brick+Warehouse" },
                    { time: "17:00", title: "函館山百萬夜景", tag: "Experience", desc: "搭乘纜車上山。山上風大請注意保暖。晚餐於灣區享用。", img: "https://placehold.co/600x300/1C2541/FFFFFF?text=Mt+Hakodate" },
                    { time: "宿", title: "JR Inn Hakodate", tag: "Hotel", desc: "函館站旁，交通便利。", img: "https://placehold.co/600x200/555/FFF?text=JR+Inn" }
                ]
            },
            {
                day: 2, date: "02.03", week: "TUE",
                heroTitle: "穿越時光列車：從海港到藝術之都",
                heroImg: "https://placehold.co/800x600/DDDDDD/333333?text=Aomori+Museum",
                events: [
                    { time: "08:00", title: "函館朝市早餐", tag: "Cuisine", desc: "享用新鮮海鮮丼。步行前往。", pointSpeak: [{cn:"我要海膽", jp:"ウニをください"}] },
                    { time: "10:00", title: "移動至青森", tag: "Transport", desc: "搭乘新幹線穿越津輕海峽。13:45 抵達青森站。", img: "https://placehold.co/600x300/333/FFF?text=Shinkansen" },
                    { time: "14:40", title: "青森縣立美術館", tag: "Art", desc: "搭計程車前往。探訪奈良美智著名的「青森犬」。", img: "https://placehold.co/600x300/FFF/333?text=Aomori+Dog" },
                    { time: "18:00", title: "晚餐：青森鄉土料理", tag: "Cuisine", desc: "步行前往市區餐廳享用在地美食。", pointSpeak: [{cn:"有推薦的鄉土料理嗎？", jp:"おすすめの郷土料理はありますか？"}] },
                    { time: "19:30", title: "唐吉訶德購物", tag: "Shopping", desc: "離飯店近，作為晚餐後的散步行程。", img: "https://placehold.co/600x200/FFD700/333?text=Don+Quijote" },
                    { time: "宿", title: "Dormy Inn Aomori", tag: "Hotel", desc: "享受溫泉與夜鳴拉麵。", img: "https://placehold.co/600x200/555/FFF?text=Dormy+Inn" }
                ]
            },
            {
                day: 3, date: "02.04", week: "WED",
                heroTitle: "津輕鐵道與弘前雪景",
                heroImg: "https://placehold.co/800x600/B49B67/FFFFFF?text=Stove+Train",
                events: [
                    { time: "09:00", title: "租車開始", tag: "Transport", desc: "青森站取車，自駕開始。回飯店載行李。", img: "https://placehold.co/600x300/555/FFF?text=Car+Rental" },
                    { time: "10:15", title: "ELM 購物中心", tag: "Shopping", desc: "【任務 1】3COINS+plus 採買，限時 35 分鐘。", pointSpeak: [{cn:"請問 3COINS 在哪裡？", jp:"3COINSはどこですか？"}] },
                    { time: "12:30", title: "暖爐列車 (津輕鐵道)", tag: "Journey", desc: "【任務 2】體驗復古暖爐列車，車上享用烤魷魚。", img: "https://placehold.co/600x300/A52A2A/FFF?text=Stove+Train+Experience" },
                    { time: "15:30", title: "藤田紀念庭園", tag: "Cuisine", desc: "【任務 3：CRITICAL】大正浪漫喫茶室，16:00 前必須完成點餐。品嚐蘋果派。", pointSpeak: [{cn:"我要蘋果派", jp:"アップルパイをください"}] },
                    { time: "16:30", title: "弘前城白天雪景", tag: "Sightseeing", desc: "在雪中漫步弘前公園。", img: "https://placehold.co/600x300/FFF/333?text=Hirosaki+Castle" },
                    { time: "17:30", title: "返回青森市", tag: "Transport", desc: "夜間雪地慢行，注意安全。返回 Dormy Inn。", img: "https://placehold.co/600x200/1C2541/FFF?text=Night+Drive" }
                ]
            },
            {
                day: 4, date: "02.05", week: "THU",
                heroTitle: "登上雲海邊界：與「雪樹精靈」的白色盟約",
                heroImg: "https://placehold.co/800x600/E0E0E0/333333?text=Snow+Monsters",
                events: [
                    { time: "09:00", title: "古川市場 早餐", tag: "Cuisine", desc: "快去快回，享用自選のっけ丼。", pointSpeak: [{cn:"飯少一點", jp:"ご飯少なめで"}] },
                    { time: "11:00", title: "八甲田樹冰觀光", tag: "Nature", desc: "搭乘纜車欣賞 Snow Monsters。山頂極冷，全副武裝。", img: "https://placehold.co/600x300/FFF/888?text=Hakkoda+Ropeway" },
                    { time: "14:00", title: "前往星野青森屋", tag: "Transport", desc: "約 2 小時車程。享受沿途雪景。", img: "https://placehold.co/600x200/555/FFF?text=Drive+to+Hoshino" },
                    { time: "16:00", title: "青森屋 Check-in", tag: "Hotel", desc: "抵達星野度假村。辦理入住。", img: "https://placehold.co/600x300/C5A059/FFF?text=Aomoriya" },
                    { time: "17:30", title: "晚餐：Nore Sore 食堂", tag: "Cuisine", desc: "已預約自助餐。盡情享用青森美食。", img: "https://placehold.co/600x200/FFA500/FFF?text=Buffet+Dinner" }
                ]
            },
            {
                day: 5, date: "02.06", week: "FRI",
                heroTitle: "冬日戀歌：馬車暖爐裡的溫柔",
                heroImg: "https://placehold.co/800x600/8B4513/FFFFFF?text=Stove+Carriage",
                events: [
                    { time: "10:00", title: "暖爐馬車 (Stove Carriage)", tag: "Experience", desc: "【飯店活動】在馬車上享用點心，環繞公園。", img: "https://placehold.co/600x300/8B4513/FFF?text=Horse+Carriage" },
                    { time: "14:00", title: "滑雪體驗", tag: "Activity", desc: "前往綠之大地與羅曼之森滑雪場。練習滑雪。", img: "https://placehold.co/600x300/ADD8E6/333?text=Skiing" },
                    { time: "17:30", title: "飯店溫泉與休息", tag: "Relax", desc: "享受露天溫泉「浮湯」。", img: "https://placehold.co/600x200/1C2541/FFF?text=Onsen" },
                    { time: "20:00", title: "陸奧祭典屋表演", tag: "Culture", desc: "【文化體驗】觀賞青森四大祭典表演，感受熱情。", img: "https://placehold.co/600x300/D32F2F/FFF?text=Matsuri+Show" }
                ]
            },
            {
                day: 6, date: "02.07", week: "SAT",
                heroTitle: "返程：滿載回憶",
                heroImg: "https://placehold.co/800x600/555555/FFFFFF?text=Departure",
                events: [
                    { time: "10:00", title: "最終鐵律：準時出發", tag: "Transport", desc: "開車離開飯店。上路請開大燈，極致慢速安全駕駛。", img: "https://placehold.co/600x300/333/FFF?text=Safe+Driving" },
                    { time: "13:00", title: "青森機場還車", tag: "Transport", desc: "抵達機場，加滿油，辦理還車。", img: "https://placehold.co/600x200/555/FFF?text=Car+Return" },
                    { time: "14:00", title: "最終任務：伴手禮", tag: "Shopping", desc: "機場免稅店最後採購。", pointSpeak: [{cn:"這是青森限定嗎？", jp:"これは青森限定ですか？"}] },
                    { time: "15:30", title: "搭機返台 (BR 121)", tag: "Flight", desc: "再見青森，期待下次旅程。", img: "https://placehold.co/600x300/1C2541/FFF?text=Flight+BR121" }
                ]
            }
        ];

        let currentIdx = 0;
        let expenses = JSON.parse(localStorage.getItem('elegant_expenses')) || [];

        // --- INIT ---
        function enterApp() {
            document.getElementById('intro-screen').style.transform = 'translateY(-100%)';
            renderTrip();
            // No need to call updateCountdown here, it runs on load.
        }

        function updateCountdown() {
            const start = new Date("2026-02-02");
            const now = new Date();
            const diff = Math.ceil((start - now) / (1000 * 60 * 60 * 24));
            
            const daysDisplay = diff > 0 ? diff : "0";
            
            // Update the header countdown
            const headerDaysEl = document.getElementById('days-left');
            if (headerDaysEl) {
                 headerDaysEl.innerText = daysDisplay;
            }

            // Update the INTRO screen countdown
            const introDaysEl = document.getElementById('intro-days-left');
            if (introDaysEl) {
                introDaysEl.innerText = daysDisplay;
            }
        }

        // --- RENDER TRIP ---
        function renderTrip() {
            // Render Nav
            const nav = document.getElementById('date-nav');
            nav.innerHTML = tripData.map((d, i) => `
                <div class="d-item ${i === currentIdx ? 'active' : ''}" onclick="switchDay(${i})">
                    <div class="d-week">${d.week}</div>
                    <div class="d-num">${d.date.split('.')[1]}</div>
                </div>
            `).join('');

            // Render Timeline
            const day = tripData[currentIdx];
            const container = document.getElementById('timeline-container');
            
            let html = `
                <div class="hero-card fade-in">
                    <img src="${day.heroImg}" class="hero-img">
                    <div class="hero-overlay">
                        <div class="hero-day">DAY ${day.day} / ${day.week}</div>
                        <h2 class="hero-title serif">${day.heroTitle}</h2>
                    </div>
                </div>
                <div class="timeline-block">
            `;

            html += day.events.map((ev, i) => {
                const data = encodeURIComponent(JSON.stringify(ev));
                const delay = i * 0.1;
                // Highlight critical or special tasks
                const isSpecial = ev.title.includes("任務") || ev.title.includes("鐵律");
                const specialClass = isSpecial ? 'special-event' : '';
                
                return `
                    <div class="event-node visible" style="transition-delay: ${delay}s">
                        <div class="time-dot"></div>
                        <div class="time-label">${ev.time}</div>
                        <div class="event-card ${specialClass}" onclick="openDetail('${data}')">
                            <span class="event-tag">${ev.tag}</span>
                            <div class="event-title">${ev.title}</div>
                            <div class="event-desc">${ev.desc}</div>
                            ${ev.img ? `<img src="${ev.img}" class="event-img">` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            html += `</div>`; // Close timeline-block
            container.innerHTML = html;
        }

        function switchDay(idx) {
            currentIdx = idx;
            renderTrip();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- NAVIGATION ---
        function switchView(view, btn) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById('view-' + view).classList.remove('hidden');
            
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');

            if(view === 'wallet') renderExpenses();
            window.scrollTo(0,0);
        }

        // --- MODAL ---
        function openDetail(dataStr) {
            const data = JSON.parse(decodeURIComponent(dataStr));
            document.getElementById('m-title').innerText = data.title;
            document.getElementById('m-desc').innerText = data.desc;
            document.getElementById('m-tag').innerText = data.tag || "INFO";
            document.getElementById('m-img').src = data.img || "https://placehold.co/800x600/F4F4F4/CCCCCC?text=L'VOYAGE";
            
            const psDiv = document.getElementById('m-ps-content');
            if(data.pointSpeak) {
                document.getElementById('m-ps-area').style.display = 'block';
                psDiv.innerHTML = data.pointSpeak.map(p => `
                    <div style="margin-top:15px; padding:15px; background:#F9F9F9; border-left:3px solid var(--accent-gold);">
                        <div style="font-size:0.9rem; color:#666;">${p.cn}</div>
                        <div class="serif" style="font-size:1.4rem; color:var(--text-primary); margin-top:5px;">${p.jp}</div>
                    </div>
                `).join('');
            } else {
                document.getElementById('m-ps-area').style.display = 'none';
            }

            document.getElementById('detail-modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('detail-modal').classList.remove('active');
        }

        // --- WALLET ---
        function addExpense() {
            const item = document.getElementById('ex-item').value;
            const price = parseInt(document.getElementById('ex-price').value);
            if(item && price) {
                expenses.unshift({ item, price, date: new Date().toLocaleDateString() });
                localStorage.setItem('elegant_expenses', JSON.stringify(expenses));
                renderExpenses();
                document.getElementById('ex-item').value = '';
                document.getElementById('ex-price').value = '';
            }
        }

        function renderExpenses() {
            const rate = 0.22;
            let total = 0;
            const html = expenses.map(ex => {
                total += ex.price;
                return `
                    <div style="display:flex; justify-content:space-between; padding:15px 0; border-bottom:1px solid #EEE;">
                        <div>
                            <div style="font-weight:500;">${ex.item}</div>
                            <div style="font-size:0.8rem; color:#999;">${ex.date}</div>
                        </div>
                        <div class="serif" style="font-size:1.1rem;">¥${ex.price.toLocaleString()}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('expense-list').innerHTML = html;
            document.getElementById('total-jpy').innerText = '¥' + total.toLocaleString();
            document.getElementById('total-twd').innerText = (total * rate).toFixed(0);
        }

        // Initial setup - MUST run immediately to display intro countdown
        updateCountdown();

    </script>
</body>
</html>
