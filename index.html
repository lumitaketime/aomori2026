<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ÈùíÊ£ÆÂáΩÈ§®ÂÜ¨ÊóÖ 2026</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#F2EFE9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #F2EFE9;
            --card-glass: rgba(255, 255, 255, 0.95);
            --primary-wood: #8D6E63;
            --secondary-wood: #A1887F;
            --accent-blue: #546E7A;
            --text-main: #4E342E;
            --shadow-card: 0 4px 15px rgba(141, 110, 99, 0.08);
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#D7CCC8 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text-main);
            margin: 0; padding-bottom: calc(90px + var(--safe-area-bottom));
            overscroll-behavior-y: none;
        }

        /* --- 1. Header (Double Bar) --- */
        .hero-section {
            background: linear-gradient(180deg, rgba(0,0,0,0.1) 0%, var(--bg-color) 100%),
                        url('https://images.unsplash.com/photo-1548261320-56d15b021319?q=80&w=2574') center/cover;
            padding: 20px; padding-top: 50px; border-radius: 0 0 30px 30px;
        }
        
        .status-grid {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 15px;
        }
        .status-card {
            background: rgba(255,255,255,0.85); backdrop-filter: blur(8px);
            border-radius: 12px; padding: 8px; text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.4);
        }
        .status-label { font-size: 0.7rem; color: #666; font-weight: bold; }
        .status-val { font-size: 1rem; font-weight: 800; color: var(--text-main); margin-top: 2px; }
        .status-icon { font-size: 1.2rem; margin-bottom: 2px; }

        /* --- View Toggle --- */
        .view-toggle { display: flex; justify-content: center; gap: 10px; margin: 15px 0; }
        .toggle-pill {
            padding: 6px 16px; border-radius: 20px; font-size: 0.9rem; font-weight: bold;
            background: #E0D8D6; color: #8D6E63; border: none; transition: 0.3s;
        }
        .toggle-pill.active { background: var(--primary-wood); color: white; box-shadow: 0 4px 10px rgba(141,110,99,0.3); }

        /* --- Itinerary --- */
        .day-tabs { display: flex; gap: 10px; overflow-x: auto; padding: 0 20px 10px; scrollbar-width: none; }
        .day-tab {
            background: white; padding: 8px 16px; border-radius: 12px; font-size: 0.9rem; white-space: nowrap;
            color: var(--secondary-wood); box-shadow: var(--shadow-card); transition: 0.2s;
        }
        .day-tab.active { background: var(--text-main); color: white; transform: scale(1.05); }

        .weather-advice-box {
            background: linear-gradient(135deg, #ECEFF1, #CFD8DC);
            border-radius: 16px; padding: 15px; margin: 0 20px 20px;
            border-left: 5px solid var(--accent-blue);
            box-shadow: var(--shadow-card);
        }
        .wa-title { font-weight: bold; color: var(--accent-blue); font-size: 0.9rem; margin-bottom: 5px; display: flex; align-items: center; gap: 5px; }
        .wa-text { font-size: 0.85rem; line-height: 1.5; color: #455A64; }

        .event-card {
            background: white; border-radius: 18px; padding: 15px; margin: 0 20px 15px;
            display: flex; gap: 15px; position: relative;
            box-shadow: var(--shadow-card); cursor: pointer; transition: transform 0.2s;
        }
        .event-card:active { transform: scale(0.98); }
        .event-thumb { width: 70px; height: 70px; border-radius: 12px; object-fit: cover; background: #eee; flex-shrink: 0; }
        .event-info { flex: 1; min-width: 0; }
        .event-time { font-size: 0.8rem; font-weight: 700; color: white; background: var(--secondary-wood); padding: 2px 8px; border-radius: 6px; display: inline-block; margin-bottom: 4px; }
        .event-title { font-size: 1.05rem; font-weight: 700; color: var(--text-main); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .event-meta { font-size: 0.85rem; color: #888; margin-top: 4px; display: flex; align-items: center; gap: 5px; }

        /* Transport Card Variant */
        .event-card.transport {
            background: #FFF8E1; border: 1px dashed #FFB74D;
        }
        .trans-badge { background: #FFB74D; color: #fff; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; }

        /* --- Expenses --- */
        .rate-banner {
            background: var(--text-main); color: white; padding: 15px; border-radius: 16px;
            text-align: center; margin: 0 20px 20px; box-shadow: 0 5px 15px rgba(78, 52, 46, 0.3);
        }
        .rate-val { font-size: 1.5rem; font-weight: bold; margin: 5px 0; }
        .rate-sub { font-size: 0.8rem; opacity: 0.8; }

        .add-box {
            background: white; padding: 15px; border-radius: 16px; margin: 0 20px 20px;
            box-shadow: var(--shadow-card);
        }
        .form-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .form-input { 
            border: 1px solid #eee; padding: 12px; border-radius: 10px; font-size: 1rem; width: 100%; outline: none; background: #FAFAFA;
        }
        .currency-switch { display: flex; background: #eee; border-radius: 10px; padding: 2px; flex: 1; }
        .curr-opt {
            flex: 1; text-align: center; padding: 10px; border-radius: 8px; font-size: 0.8rem; font-weight: bold; color: #888; transition: 0.3s;
        }
        .curr-opt.active { background: white; color: var(--text-main); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn-save { background: var(--primary-wood); color: white; width: 100%; border: none; padding: 12px; border-radius: 10px; font-weight: bold; font-size: 1rem; }

        /* --- Tools --- */
        .tools-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 20px; }
        .tool-card {
            background: white; border-radius: 16px; padding: 20px 10px; text-align: center;
            box-shadow: var(--shadow-card); cursor: pointer;
        }
        .tool-icon { font-size: 2rem; display: block; margin-bottom: 8px; }
        .tool-text { font-weight: bold; font-size: 0.9rem; color: var(--text-main); }
        
        .custom-trans-box {
            background: white; padding: 15px; border-radius: 16px; margin: 0 20px 20px;
            box-shadow: var(--shadow-card); display: flex; gap: 10px;
        }

        /* --- Modals --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 2000; opacity: 0; visibility: hidden; transition: 0.3s;
            backdrop-filter: blur(5px);
        }
        .modal-overlay.open { opacity: 1; visibility: visible; }
        
        /* Card Modal (Translation) */
        .card-modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9);
            width: 90%; max-width: 350px; background: white; border-radius: 20px; padding: 30px;
            z-index: 2200; text-align: center; opacity: 0; visibility: hidden; transition: 0.3s;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .card-modal.open { transform: translate(-50%, -50%) scale(1); opacity: 1; visibility: visible; }
        .big-text { font-size: 2rem; font-weight: 900; color: #333; line-height: 1.3; margin: 20px 0; word-break: break-all; }
        
        /* Detail Modal */
        .detail-modal {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 85vh;
            background: #FAF9F6; border-radius: 30px 30px 0 0; z-index: 2100;
            transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            overflow-y: auto; display: flex; flex-direction: column;
        }
        .detail-modal.open { transform: translateY(0); }
        .modal-hero { height: 250px; width: 100%; object-fit: cover; }
        .modal-content { padding: 25px; }
        .action-btn { padding: 12px; border-radius: 12px; border: none; font-weight: bold; display: flex; justify-content: center; gap: 8px; text-decoration: none; margin-bottom: 10px;}
        .btn-google { background: #E3F2FD; color: #1565C0; width: 100%; }

        /* --- Nav --- */
        .tab-content { display: none; padding-bottom: 20px; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .nav-container {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; height: 65px;
            background: rgba(78, 52, 46, 0.95); backdrop-filter: blur(10px);
            border-radius: 50px; display: flex; justify-content: space-evenly; align-items: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.25); z-index: 3000;
        }
        .nav-item { color: rgba(255,255,255,0.5); font-size: 1.4rem; padding: 10px; transition: 0.3s; position: relative; }
        .nav-item.active { color: #fff; transform: translateY(-3px); }
    </style>
</head>
<body>

    <!-- HEADER: Countdown & Weather -->
    <header class="hero-section">
        <h1 style="color:#3E2723; margin:0;">ÈùíÊ£ÆÂáΩÈ§®ÂÜ¨ÊóÖ</h1>
        <div style="font-size:0.9rem; color:#5D4037; margin-bottom:15px;">2026.02.02 - 02.07</div>

        <div class="status-grid">
            <div class="status-card">
                <div class="status-icon">‚è≥</div>
                <div class="status-label">ÂÄíÊï∏</div>
                <div class="status-val" id="countdown-days">--</div>
            </div>
            <div class="status-card">
                <div class="status-icon">üå°Ô∏è</div>
                <div class="status-label">ÂáΩÈ§®/ÈùíÊ£Æ</div>
                <div class="status-val" id="weather-now">--¬∞</div>
            </div>
            <div class="status-card">
                <div class="status-icon">üí¥</div>
                <div class="status-label">JPY ÂåØÁéá</div>
                <div class="status-val" id="rate-mini">0.22</div>
            </div>
        </div>
    </header>

    <!-- TAB 1: ITINERARY -->
    <div id="tab-itinerary" class="tab-content active">
        <div class="view-toggle">
            <button class="toggle-pill active" onclick="setViewMode('day', this)">ÂàÜÊó•Ê™¢Ë¶ñ</button>
            <button class="toggle-pill" onclick="setViewMode('all', this)">Á∏ΩË¶ΩÊ®°Âºè</button>
        </div>

        <div class="day-tabs" id="day-tabs-container"></div>
        <div id="itinerary-content"></div>
    </div>

    <!-- TAB 2: EXPENSES -->
    <div id="tab-expenses" class="tab-content">
        <div class="rate-banner">
            <div style="font-size:0.8rem; opacity:0.8;">ÁõÆÂâçÂç≥ÊôÇÂåØÁéá</div>
            <div class="rate-val" id="rate-big">0.22</div>
            <div class="rate-sub">1 JPY ‚âà 0.22 TWD</div>
        </div>
        
        <div style="padding:0 20px; margin-bottom:15px; display:flex; justify-content:space-between; font-size:0.9rem; color:#666;">
            <span>YK: <b id="total-yk">$0</b></span>
            <span>YY: <b id="total-yy">$0</b></span>
            <span>YS: <b id="total-ys">$0</b></span>
        </div>

        <div class="add-box">
            <div class="form-row">
                <input type="text" id="ex-name" class="form-input" placeholder="È†ÖÁõÆ (Â¶Ç: ÊôöÈ§ê)">
            </div>
            <div class="form-row">
                <input type="number" id="ex-price" class="form-input" placeholder="ÈáëÈ°ç" style="flex:2;">
                <div class="currency-switch">
                    <div class="curr-opt active" onclick="setCurrency('JPY', this)">JPY</div>
                    <div class="curr-opt" onclick="setCurrency('TWD', this)">TWD</div>
                </div>
            </div>
            <div class="form-row">
                <select id="ex-payer" class="form-input">
                    <option value="YK">YK ‰ªòÊ¨æ</option>
                    <option value="YY">YY ‰ªòÊ¨æ</option>
                    <option value="YS">YS ‰ªòÊ¨æ</option>
                </select>
            </div>
            <button class="btn-save" onclick="addExpense()">+ Ë®ò‰∏ÄÁ≠Ü</button>
        </div>

        <div id="expense-list" style="padding:0 20px;"></div>
    </div>

    <!-- TAB 3: TOOLS (TRANSLATION) -->
    <div id="tab-tools" class="tab-content">
        <h2 style="margin:0 0 15px 20px;">Ê∫ùÈÄöÁøªË≠Ø</h2>
        
        <div class="custom-trans-box">
            <input type="text" id="custom-text" class="form-input" placeholder="Ëº∏ÂÖ•‰∏≠Êñá...">
            <button class="btn-save" style="width:auto; padding:0 20px;" onclick="translateCustom()">
                <i class="fa-solid fa-language"></i> ÁøªÊó•Êñá
            </button>
        </div>

        <div class="tools-grid">
            <div class="tool-card" onclick="showCard('Ë±öËÇâ„ÅØÈ£ü„Åπ„Çâ„Çå„Åæ„Åõ„ÇìÔºàÈ≠ö‰ªãÈ°û„ÅØÂ§ß‰∏àÂ§´„Åß„ÅôÔºâ', 'Êàë‰∏çÂêÉËÇâÈ°û (Êµ∑ÈÆÆÂèØ‰ª•)')">
                <span class="tool-icon">üêü</span>
                <span class="tool-text">‰∏çÂêÉËÇâ(Êµ∑ÈÆÆÂèØ)</span>
            </div>
            <div class="tool-card" onclick="showCard('„Åä‰ºöË®à„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô', 'È∫ªÁÖ©ÁµêÂ∏≥')">
                <span class="tool-icon">üí¥</span>
                <span class="tool-text">ÁµêÂ∏≥</span>
            </div>
            <div class="tool-card" onclick="showCard('„Åô„Åø„Åæ„Åõ„Çì„ÄÅ„Éà„Ç§„É¨„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü', 'Ë´ãÂïèÂªÅÊâÄÂú®Âì™Ë£°Ôºü')">
                <span class="tool-icon">üöª</span>
                <span class="tool-text">ÊâæÂªÅÊâÄ</span>
            </div>
            <div class="tool-card" onclick="showCard('„Åì„Çå„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô', 'ÊàëË¶ÅÈÄôÂÄã (Êåá)')">
                <span class="tool-icon">üëà</span>
                <span class="tool-text">ÊàëË¶ÅÈÄôÂÄã</span>
            </div>
            <div class="tool-card" onclick="showCard('ÂÜôÁúü„ÇíÊíÆ„Å£„Å¶„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü', 'ËÉΩÂπ´ÊàëÂÄëÊãçÁÖßÂóéÔºü')">
                <span class="tool-icon">üì∏</span>
                <span class="tool-text">Âπ´ÂøôÊãçÁÖß</span>
            </div>
            <div class="tool-card" onclick="showCard('Ë¢ã„ÅØ„ÅÑ„Çä„Åæ„Åõ„Çì', '‰∏çÁî®Ë¢ãÂ≠ê')">
                <span class="tool-icon">üõçÔ∏è</span>
                <span class="tool-text">‰∏çÁî®Ë¢ãÂ≠ê</span>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div class="modal-overlay" id="modal-overlay" onclick="closeAllModals()"></div>

    <!-- Card Modal (Trans) -->
    <div class="card-modal" id="card-modal">
        <div class="sub-text" id="card-cn">‰∏≠Êñá</div>
        <div class="big-text" id="card-jp">Loading...</div>
        <button class="btn-save" onclick="closeAllModals()">ÈóúÈñâ</button>
    </div>

    <!-- Detail Modal -->
    <div class="detail-modal" id="detail-modal">
        <button onclick="closeAllModals()" style="position:absolute; top:20px; right:20px; z-index:2200; width:36px; height:36px; border-radius:50%; border:none; box-shadow:0 4px 10px rgba(0,0,0,0.1);">‚úï</button>
        <img src="" id="modal-img" class="modal-hero">
        <div class="modal-content">
            <h2 id="modal-title" style="margin-top:0;">Title</h2>
            <div id="modal-meta" style="color:#666; margin-bottom:15px;">Time</div>
            <a href="#" target="_blank" id="btn-map" class="action-btn btn-google">
                <i class="fa-solid fa-location-dot"></i> Google Maps Â∞éËà™
            </a>
            <div style="background:white; padding:15px; border-radius:12px; margin-top:15px; border-left:4px solid var(--secondary-wood);">
                <div style="font-weight:bold; color:#999; font-size:0.8rem; margin-bottom:5px;">Ë©≥Á¥∞ÊîªÁï•</div>
                <div id="modal-desc" style="line-height:1.6; color:#444; white-space:pre-line;"></div>
            </div>
        </div>
    </div>

    <!-- NAV -->
    <div class="nav-container">
        <div class="nav-item active" onclick="switchTab('itinerary', this)"><i class="fa-solid fa-map"></i></div>
        <div class="nav-item" onclick="switchTab('expenses', this)"><i class="fa-solid fa-receipt"></i></div>
        <div class="nav-item" onclick="switchTab('tools', this)"><i class="fa-solid fa-language"></i></div>
    </div>

    <script>
        // --- DATA ---
        const tripData = [
            {
                day: 1, date: "2/2 (‰∏Ä)", title: "ÂáΩÈ§®ÊäµÈÅî",
                weatherAdvice: "‚òÄÔ∏è Êó©ÊôöÊ∫´Â∑ÆÂ§ßÔΩúÂáΩÈ§®Ê∞£Ê∫´Á¥Ñ -2¬∞CÔºåÈ¢®Â§ß„ÄÇ\nÂª∫Ë≠∞ÔºöÊäµÈÅîÊôÇË´ãÂÖàÂ∞áÂ∏ΩÂ≠ê„ÄÅÊâãÂ•ó„ÄÅÂúçÂ∑æÊà¥Â•ΩÂÜçËµ∞Âá∫Ê©üÂ†¥„ÄÇÊôö‰∏äÁúãÂ§úÊôØÈùûÂ∏∏ÂÜ∑ÔºåÊöñÊöñÂåÖË´ãË≤ºÂ•Ω„ÄÇ",
                events: [
                    { time: "11:10", title: "ÊäµÈÅîÂáΩÈ§®Ê©üÂ†¥", type: "transport", icon: "‚úàÔ∏è", loc: "ÂáΩÈ§®Á©∫Ê∏Ø", img: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=800", desc: "ÂÖ•Â¢ÉÂæåÁõ¥Êé•ÂâçÂæÄË®àÁ®ãËªä‰πòËªäËôï„ÄÇ" },
                    { time: "11:40", title: "Ë®àÁ®ãËªäÂâçÂæÄ UNIQLO", type: "transport", icon: "üöï", loc: "UNIQLO ÂáΩÈ§®Êò≠Âíå„Çø„Ç¶„É≥„Éó„É©„Ç∂Â∫ó", img: "https://images.unsplash.com/photo-1549317661-bd32c8ce0db2?q=80&w=800", desc: "ËªäÁ®ãÁ¥Ñ 20 ÂàÜÈêò„ÄÇËªäË≥áÈ†ê‰º∞ 3000 Êó•Âúì„ÄÇ" },
                    { time: "13:15", title: "UNIQLO Êé°Ë≥º", type: "spot", icon: "üõçÔ∏è", loc: "UNIQLO ÂáΩÈ§®Êò≠Âíå„Çø„Ç¶„É≥„Éó„É©„Ç∂Â∫ó", img: "https://images.unsplash.com/photo-1542060748-10c28b62716f?q=80&w=800", desc: "ÂøÖË≤∑ÔºöHeattech ÁôºÁÜ±Ë°£„ÄÅÈò≤È¢®Ë§≤„ÄÇ" },
                    { time: "17:00", title: "ÂáΩÈ§®Â±±Â§úÊôØ", type: "spot", icon: "üåÉ", loc: "ÂáΩÈ§®Â±±„É≠„Éº„Éó„Ç¶„Çß„Ç§", img: "https://images.unsplash.com/photo-1532236204992-f5e85c024202?q=80&w=800", desc: "ÁôæËê¨Â§úÊôØ„ÄÇËßÄÊôØÂè∞È¢®Â§ßÔºåÂª∫Ë≠∞ÂÅúÁïô 30 ÂàÜÈêò„ÄÇ" }
                ]
            },
            {
                day: 2, date: "2/3 (‰∫å)", title: "ÁßªÂãïËá≥ÈùíÊ£Æ",
                weatherAdvice: "‚ùÑÔ∏è ÈôçÈõ™Ê©üÁéáÈ´òÔΩúÈùíÊ£ÆÊ∞£Ê∫´Á¥Ñ -4¬∞C„ÄÇ\nÂª∫Ë≠∞Ôºö‰ªäÊó•Èï∑ÊôÇÈñìÂú®Êà∂Â§ñÁßªÂãïÔºåÈûãÂ≠êÂãôÂøÖÈò≤ÊªëÈò≤Ê∞¥„ÄÇÁæéË°ìÈ§®ÈôÑËøëÂèØËÉΩÁ©çÈõ™ËºÉÊ∑±„ÄÇ",
                events: [
                    { time: "08:00", title: "ÂáΩÈ§®ÊúùÂ∏Ç", type: "spot", icon: "ü¶ë", loc: "ÂáΩÈ§®ÊúùÂ∏Ç", img: "https://images.unsplash.com/photo-1559339352-11d035aa65de?q=80&w=800", desc: "È´îÈ©óÈá£Ê¥ªÁÉèË≥ä„ÄÇ" },
                    { time: "10:00", title: "Êñ∞ÂππÁ∑ö ÂæÄÈùíÊ£Æ", type: "transport", icon: "üöÖ", loc: "Êñ∞ÂáΩÈ§®ÂåóÊñóÈßÖ", img: "https://images.unsplash.com/photo-1512423249052-4467554e4772?q=80&w=800", desc: "„ÄêHayabusa 18Ëôü„Äë\nÊñ∞ÂáΩÈ§®ÂåóÊñó -> Êñ∞ÈùíÊ£Æ\nÈ†êË®à 11:05 ÊäµÈÅî„ÄÇË´ãÊèêÊó© 20 ÂàÜÈêòÈÄ≤Á´ô„ÄÇ" },
                    { time: "14:40", title: "ÈùíÊ£ÆÁ∏£Á´ãÁæéË°ìÈ§®", type: "spot", icon: "üé®", loc: "ÈùíÊ£ÆÁúåÁ´ãÁæéË°ìÈ§®", img: "https://images.unsplash.com/photo-1629012435532-6d2a452d765d?q=80&w=800", desc: "ÂøÖÁúãÔºöÈùíÊ£ÆÁä¨„ÄÇ17:00 ÈñâÈ§®„ÄÇ" }
                ]
            },
            {
                day: 3, date: "2/4 (‰∏â)", title: "ÊöñÁàêÂàóËªä",
                weatherAdvice: "‚òÅÔ∏è Â§öÈõ≤ÊôÇÊô¥ÔΩú‰∫îÊâÄÂ∑ùÂéü -3¬∞C„ÄÇ\nÂª∫Ë≠∞ÔºöÊöñÁàêÂàóËªäËªäÂªÇÂÖßÈùûÂ∏∏Ê∫´ÊöñÔºàÊúâÁÇ≠ÁÅ´ÁàêÔºâÔºåÂª∫Ë≠∞Á©øÂÆπÊòìÁ©øËÑ´ÁöÑÂ§ñÂ•ó„ÄÇ",
                events: [
                    { time: "09:00", title: "ÁßüËªäËá™Èßï", type: "transport", icon: "üöó", loc: "JRÈßÖ„É¨„É≥„Çø„Ç´„ÉºÈùíÊ£ÆÂñ∂Ê•≠ÊâÄ", img: "https://images.unsplash.com/photo-1449965408869-eaa3f722e40d?q=80&w=800", desc: "ÂèñËªäÔºö4WD Èõ™ËÉé„ÄÇÊ™¢Êü•ËªäË∫´ÂàÆÁóï„ÄÇ" },
                    { time: "12:30", title: "Ê¥•ËºïÊöñÁàêÂàóËªä", type: "spot", icon: "üî•", loc: "Ê¥•ËªΩ‰∫îÊâÄÂ∑ùÂéüÈßÖ", img: "https://images.unsplash.com/photo-1475738972911-5b44ce984c42?q=80&w=800", desc: "ÂøÖË≤∑ÁÉ§È≠∑È≠ö„ÄÇËªäÁ•®+ÊöñÁàêÂà∏„ÄÇ" },
                    { time: "15:30", title: "Ëó§Áî∞Á¥ÄÂøµÂ∫≠Âúí", type: "spot", icon: "üçé", loc: "Ëó§Áî∞Ë®òÂøµÂ∫≠Âúí", img: "https://images.unsplash.com/photo-1568285908272-98c94625579d?q=80&w=800", desc: "16:00 ÂâçÈªûÈ§ê„ÄÇÂøÖÂêÉÂºòÂâçËòãÊûúÊ¥æ„ÄÇ" }
                ]
            },
            {
                day: 4, date: "2/5 (Âõõ)", title: "Ê®πÂÜ∞ËàáÊòüÈáé",
                weatherAdvice: "üå¨Ô∏è Âº∑È¢®ÈÖ∑ÂØíÔΩúÂÖ´Áî≤Áî∞Â±±È†Ç -10¬∞C„ÄÇ\nÂª∫Ë≠∞ÔºöÂ±±È†ÇÈ´îÊÑüÊ•µÂÜ∑ÔºåÂøÖÈ†àÂÖ®ÂâØÊ≠¶Ë£ùÔºàÊØõÂ∏Ω„ÄÅÊâãÂ•ó„ÄÅÈò≤È¢®Â±§Ôºâ„ÄÇËã•È¢®Â§ßÁ∫úËªäÂÅúÈßõÔºåË´ãÂü∑Ë°å B Ë®àÁï´„ÄÇ",
                events: [
                    { time: "09:30", title: "ÈñãËªäÂâçÂæÄÂÖ´Áî≤Áî∞", type: "transport", icon: "üöó", loc: "ÂÖ´Áî≤Áî∞„É≠„Éº„Éó„Ç¶„Çß„Éº", img: "https://images.unsplash.com/photo-1506079932028-11f67f6b95b4?q=80&w=800", desc: "Â±±Ë∑ØË´ãÂ∞èÂøÉÊâìÊªë„ÄÇËªäÁ®ãÁ¥Ñ 1 Â∞èÊôÇ 15 ÂàÜ„ÄÇ" },
                    { time: "10:40", title: "ÂÖ´Áî≤Áî∞Ê®πÂÜ∞", type: "spot", icon: "‚ùÑÔ∏è", loc: "ÂÖ´Áî≤Áî∞„É≠„Éº„Éó„Ç¶„Çß„Éº", img: "https://images.unsplash.com/photo-1483921020237-2ff51e8e4b22?q=80&w=800", desc: "Snow Monsters„ÄÇËã•Á∫úËªäÂÅúÈßõÔºåÊîπÂéªÈ¶¨ÈñÄÊªëÈõ™Â†¥„ÄÇ" },
                    { time: "17:30", title: "ÊòüÈáéÈùíÊ£ÆÂ±ã", type: "spot", icon: "üè®", loc: "ÊòüÈáé„É™„Çæ„Éº„Éà ÈùíÊ£ÆÂ±ã", img: "https://images.unsplash.com/photo-1571003123894-1f0594d2b5d9?q=80&w=800", desc: "Check-in„ÄÇÊôöÈ§ê Nore Sore È£üÂ†Ç„ÄÇ" }
                ]
            },
            {
                day: 5, date: "2/6 (‰∫î)", title: "ÊòüÈáéÂÖ®Êó•",
                weatherAdvice: "üå§Ô∏è ËàíÈÅ©ÂÜ¨Êó•ÔΩú‰∏âÊæ§Â∏Ç -5¬∞C„ÄÇ\nÂª∫Ë≠∞Ôºö‰∏ªË¶ÅÂú®È£ØÂ∫óËàáÂÖ´È£ü‰∏≠ÂøÉÂÆ§ÂÖßÊ¥ªÂãïÔºåÁ©øËëóËºïÈ¨Ü‰øùÊöñÂç≥ÂèØ„ÄÇ",
                events: [
                    { time: "09:00", title: "ÊµÆÊπØÊ∫´Ê≥â", type: "spot", icon: "‚ô®Ô∏è", loc: "ÊòüÈáé„É™„Çæ„Éº„Éà ÈùíÊ£ÆÂ±ã", img: "https://images.unsplash.com/photo-1519711683935-717e1345d355?q=80&w=800", desc: "Èú≤Â§©È¢®ÂëÇ„ÄÇ" },
                    { time: "11:30", title: "ÂÖ´È£ü‰∏≠ÂøÉ", type: "spot", icon: "üêü", loc: "ÂÖ´È£ü„Çª„É≥„Çø„Éº", img: "https://images.unsplash.com/photo-1534483509719-3feaee7c30da?q=80&w=800", desc: "‰∏ÉËº™ÊùëÁÇ≠ÁÉ§Êµ∑ÈÆÆÂçàÈ§ê„ÄÇ" },
                    { time: "20:00", title: "Èô∏Â•ßÁ•≠ÂÖ∏Â±ã", type: "spot", icon: "ü•Å", loc: "ÊòüÈáé„É™„Çæ„Éº„Éà ÈùíÊ£ÆÂ±ã", img: "https://images.unsplash.com/photo-1516280440614-6697288d5d38?q=80&w=800", desc: "Áù°È≠îÁ•≠Ë°®ÊºîÔºåÈúÄÈ†êÁ¥Ñ„ÄÇ" }
                ]
            },
            {
                day: 6, date: "2/7 (ÂÖ≠)", title: "ÂÆâÂÖ®ËøîÁ®ã",
                weatherAdvice: "‚òÅÔ∏è Èô∞Â§©ÔΩúÈùíÊ£ÆÂ∏Ç -3¬∞C„ÄÇ\nÂª∫Ë≠∞ÔºöÂõûÁ®ãË°åÊùéËºÉÈáçÔºåÊ≥®ÊÑèÊ©üÂ†¥Âú∞Êªë„ÄÇË´ãÊèêÊó© 2.5 Â∞èÊôÇÊäµÈÅîÊ©üÂ†¥„ÄÇ",
                events: [
                    { time: "10:00", title: "Âá∫ÁôºÂæÄÊ©üÂ†¥", type: "transport", icon: "üöó", loc: "ÈùíÊ£ÆÁ©∫Ê∏Ø", img: "https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?q=80&w=800", desc: "È†êÁïô 3.5 Â∞èÊôÇÈõ™Âú∞Á∑©Ë°ù„ÄÇ" },
                    { time: "13:00", title: "ÈùíÊ£ÆÊ©üÂ†¥", type: "spot", icon: "‚úàÔ∏è", loc: "ÈùíÊ£ÆÁ©∫Ê∏Ø", img: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=800", desc: "ÈÇÑËªä (Âä†ÊªøÊ≤π)„ÄÇÊúÄÂæåÊé°Ë≤∑„ÄÇ" }
                ]
            }
        ];

        // --- GLOBAL VARS ---
        let expenses = JSON.parse(localStorage.getItem('expenses_v6')) || [];
        let currentRate = 0.22;
        let selectedCurrency = 'JPY'; // Default JPY

        // --- INIT ---
        window.onload = function() {
            initData();
            setViewMode('day', document.querySelector('.toggle-pill.active'));
            renderExpenses();
        };

        async function initData() {
            // Countdown
            const days = Math.ceil((new Date("2026-02-02") - new Date())/(1000*60*60*24));
            document.getElementById('countdown-days').innerText = days;
            
            // Rate & Weather
            try {
                const rRes = await fetch('https://api.exchangerate-api.com/v4/latest/JPY');
                const rData = await rRes.json();
                if(rData.rates.TWD) {
                    currentRate = rData.rates.TWD;
                    document.getElementById('rate-mini').innerText = currentRate.toFixed(2);
                    document.getElementById('rate-big').innerText = currentRate.toFixed(3);
                }
                
                const wRes = await fetch("https://api.open-meteo.com/v1/forecast?latitude=41.76&longitude=140.73&current=temperature_2m&timezone=Asia%2FTokyo");
                const wData = await wRes.json();
                document.getElementById('weather-now').innerText = Math.round(wData.current.temperature_2m) + "¬∞";
            } catch(e) {}
        }

        // --- ITINERARY ---
        let currentMode = 'day';
        let currentDayIdx = 0;

        function setViewMode(mode, btn) {
            currentMode = mode;
            document.querySelectorAll('.toggle-pill').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderItinerary();
        }

        function renderItinerary() {
            const container = document.getElementById('itinerary-content');
            const tabsContainer = document.getElementById('day-tabs-container');
            
            if(currentMode === 'day') {
                tabsContainer.style.display = 'flex';
                tabsContainer.innerHTML = tripData.map((d,i) => 
                    `<div class="day-tab ${i===currentDayIdx?'active':''}" onclick="switchDay(${i})">Day ${d.day}</div>`
                ).join('');
                
                const day = tripData[currentDayIdx];
                container.innerHTML = `
                    <div class="weather-advice-box">
                        <div class="wa-title">‚òÅÔ∏è Áï∂Êó•Â§©Ê∞£ÁÆ°ÂÆ∂</div>
                        <div class="wa-text">${day.weatherAdvice}</div>
                    </div>
                    <h2 style="margin:0 20px 15px;">${day.date} ${day.title}</h2>
                    ${day.events.map(ev => createCard(ev)).join('')}
                `;
            } else {
                tabsContainer.style.display = 'none';
                container.innerHTML = tripData.map(day => `
                    <div style="margin:30px 20px 10px; font-weight:bold; color:#8D6E63; border-bottom:1px solid #ddd;">Day ${day.day} - ${day.title}</div>
                    ${day.events.map(ev => createCard(ev)).join('')}
                `).join('');
            }
        }

        function switchDay(i) { currentDayIdx = i; renderItinerary(); }

        function createCard(ev) {
            const data = encodeURIComponent(JSON.stringify(ev));
            const isTrans = ev.type === 'transport';
            return `
                <div class="event-card ${isTrans?'transport':''}" onclick="openDetail('${data}')">
                    <img src="${ev.img}" class="event-thumb">
                    <div class="event-info">
                        ${isTrans ? '<span class="trans-badge">ÁßªÂãï</span>' : ''}
                        <div class="event-time">${ev.time}</div>
                        <div class="event-title">${ev.title}</div>
                        <div class="event-meta"><i class="fa-solid fa-location-dot"></i> ${ev.loc}</div>
                    </div>
                    <i class="fa-solid fa-chevron-right" style="color:#ccc; align-self:center;"></i>
                </div>
            `;
        }

        // --- EXPENSES ---
        function setCurrency(c, el) {
            selectedCurrency = c;
            document.querySelectorAll('.curr-opt').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        function addExpense() {
            const name = document.getElementById('ex-name').value;
            const price = document.getElementById('ex-price').value;
            const payer = document.getElementById('ex-payer').value;
            if(name && price) {
                expenses.unshift({ name, price, payer, curr: selectedCurrency, rate: currentRate });
                document.getElementById('ex-name').value = '';
                document.getElementById('ex-price').value = '';
                renderExpenses();
            }
        }

        function renderExpenses() {
            const list = document.getElementById('expense-list');
            list.innerHTML = '';
            let totals = { YK:0, YY:0, YS:0 };
            
            expenses.forEach((ex, i) => {
                let twd = ex.curr === 'JPY' ? Math.round(ex.price * ex.rate) : parseInt(ex.price);
                totals[ex.payer] += twd;
                list.innerHTML += `
                    <div style="background:white; padding:12px; border-radius:12px; margin-bottom:10px; display:flex; justify-content:space-between; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                        <div><strong>${ex.name}</strong> <span style="font-size:0.8rem;">(${ex.payer})</span></div>
                        <div style="text-align:right;">
                            <div>${ex.curr} ${ex.price}</div>
                            ${ex.curr==='JPY' ? `<div style="font-size:0.75rem; color:#999;">‚âà TWD ${twd}</div>` : ''}
                        </div>
                        <i class="fa-solid fa-trash" style="color:#ff8a80; margin-left:10px;" onclick="delEx(${i})"></i>
                    </div>
                `;
            });
            document.getElementById('total-yk').innerText = '$'+totals.YK;
            document.getElementById('total-yy').innerText = '$'+totals.YY;
            document.getElementById('total-ys').innerText = '$'+totals.YS;
            localStorage.setItem('expenses_v6', JSON.stringify(expenses));
        }
        function delEx(i) { if(confirm('Âà™Èô§?')) { expenses.splice(i,1); renderExpenses(); } }

        // --- TRANSLATION ---
        async function translateCustom() {
            const text = document.getElementById('custom-text').value;
            if(!text) return;
            
            showCard(text, 'ÁøªË≠Ø‰∏≠...');
            document.getElementById('card-jp').innerText = 'Loading...';
            
            try {
                // ‰ΩøÁî®ÂÖçË≤ª API ÈÄ≤Ë°åÂç≥ÊôÇÁøªË≠Ø (DemoÁî®ÈÄî)
                const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=zh-TW|ja`);
                const data = await res.json();
                if(data.responseData) {
                    document.getElementById('card-jp').innerText = data.responseData.translatedText;
                } else {
                    document.getElementById('card-jp').innerText = "ÁøªË≠ØÂ§±Êïó";
                }
            } catch(e) {
                document.getElementById('card-jp').innerText = "Á∂≤Ë∑ØÈåØË™§";
            }
        }

        function showCard(jp, cn) {
            document.getElementById('card-jp').innerText = jp;
            document.getElementById('card-cn').innerText = cn;
            document.getElementById('modal-overlay').classList.add('open');
            document.getElementById('card-modal').classList.add('open');
        }

        // --- MODALS ---
        function openDetail(dataStr) {
            const ev = JSON.parse(decodeURIComponent(dataStr));
            document.getElementById('modal-title').innerText = ev.title;
            document.getElementById('modal-meta').innerText = `${ev.type==='transport'?'ÁßªÂãï':'Ë°åÁ®ã'} ‚Ä¢ ${ev.time}`;
            document.getElementById('modal-img').src = ev.img;
            document.getElementById('modal-desc').innerText = ev.desc;
            document.getElementById('btn-map').href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(ev.loc)}`;
            
            document.getElementById('modal-overlay').classList.add('open');
            document.getElementById('detail-modal').classList.add('open');
        }

        function closeAllModals() {
            document.querySelectorAll('.open').forEach(el => el.classList.remove('open'));
        }
        function switchTab(t, el) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('tab-'+t).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }
    </script>
</body>
</html>
