<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é’æ£®å‡½é¤¨å†¬æ—… 2026</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#F2EFE9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #F2EFE9;
            --card-glass: rgba(255, 255, 255, 0.95);
            --primary-wood: #8D6E63;
            --secondary-wood: #A1887F;
            --accent-blue: #78909C;
            --text-main: #4E342E;
            --text-sub: #8D6E63;
            --shadow-card: 0 4px 15px rgba(141, 110, 99, 0.08);
            --shadow-float: 0 10px 30px rgba(0,0,0,0.15);
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#D7CCC8 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text-main);
            margin: 0; padding: 0;
            padding-bottom: calc(90px + var(--safe-area-bottom));
            overscroll-behavior-y: none;
        }

        /* --- Smart Header --- */
        .hero-section {
            background: linear-gradient(180deg, rgba(0,0,0,0.1) 0%, var(--bg-color) 100%),
                        url('https://images.unsplash.com/photo-1548261320-56d15b021319?q=80&w=2574') center/cover;
            padding: 20px;
            padding-top: 60px;
            border-radius: 0 0 30px 30px;
            margin-bottom: 20px;
        }

        /* æ™ºæ…§æé†’æ°£æ³¡ */
        .smart-bubble {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.6);
            margin-top: 10px;
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-5px); } 100% { transform: translateY(0px); } }

        .bubble-icon { font-size: 2rem; }
        .bubble-content h3 { margin: 0; font-size: 1rem; color: var(--primary-wood); }
        .bubble-content p { margin: 2px 0 0; font-size: 0.85rem; color: #666; }

        /* --- View Toggle --- */
        .view-toggle { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .toggle-pill {
            padding: 6px 16px; border-radius: 20px; font-size: 0.9rem; font-weight: bold;
            background: #E0D8D6; color: #8D6E63; border: none; transition: 0.3s;
        }
        .toggle-pill.active { background: var(--primary-wood); color: white; box-shadow: 0 4px 10px rgba(141,110,99,0.3); }

        /* --- Itinerary Card --- */
        .day-tabs { display: flex; gap: 10px; overflow-x: auto; padding: 0 20px 10px; scrollbar-width: none; }
        .day-tab {
            background: white; padding: 8px 16px; border-radius: 12px; font-size: 0.9rem; white-space: nowrap;
            color: var(--text-sub); box-shadow: var(--shadow-card); transition: 0.2s;
        }
        .day-tab.active { background: var(--text-main); color: white; transform: scale(1.05); }

        .itinerary-container { padding: 0 20px; }
        .event-card {
            background: white; border-radius: 18px; padding: 15px; margin-bottom: 15px;
            display: flex; align-items: center; gap: 15px; position: relative;
            box-shadow: var(--shadow-card); cursor: pointer; transition: transform 0.2s;
        }
        .event-card:active { transform: scale(0.98); }
        
        .event-weather {
            position: absolute; top: 10px; right: 10px; 
            font-size: 0.75rem; color: var(--accent-blue); background: #E3F2FD;
            padding: 2px 6px; border-radius: 6px; font-weight: bold;
        }

        .event-thumb { width: 60px; height: 60px; border-radius: 12px; object-fit: cover; background: #eee; flex-shrink: 0; }
        .event-info { flex: 1; }
        .event-time { font-size: 0.8rem; font-weight: 700; color: white; background: var(--secondary-wood); padding: 2px 8px; border-radius: 6px; display: inline-block; margin-bottom: 4px; }
        .event-title { font-size: 1.05rem; font-weight: 700; color: var(--text-main); }
        
        /* --- Expenses (New Layout) --- */
        .expense-header { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-card {
            background: white; padding: 10px 5px; border-radius: 12px; text-align: center;
            box-shadow: var(--shadow-card);
        }
        .stat-label { font-size: 0.75rem; color: #999; font-weight: bold; }
        .stat-val { font-size: 0.95rem; font-weight: 800; color: var(--primary-wood); }

        .add-box {
            background: white; padding: 15px; border-radius: 16px; box-shadow: var(--shadow-card); margin-bottom: 20px;
        }
        .form-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .form-input { 
            border: 1px solid #eee; padding: 12px; border-radius: 10px; font-size: 1rem; width: 100%; outline: none; background: #FAFAFA;
        }
        .currency-switch {
            display: flex; background: #eee; border-radius: 10px; padding: 2px;
        }
        .curr-opt {
            flex: 1; text-align: center; padding: 8px; border-radius: 8px; font-size: 0.8rem; font-weight: bold; color: #888; transition: 0.3s;
        }
        .curr-opt.active { background: white; color: var(--text-main); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn-save { background: var(--primary-wood); color: white; width: 100%; border: none; padding: 12px; border-radius: 10px; font-weight: bold; font-size: 1rem; }

        /* --- Translation Tools --- */
        .tools-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .tool-card {
            background: white; border-radius: 16px; padding: 20px 10px; text-align: center;
            box-shadow: var(--shadow-card); cursor: pointer; transition: 0.2s;
            border: 2px solid transparent;
        }
        .tool-card:active { transform: scale(0.95); border-color: var(--primary-wood); }
        .tool-icon { font-size: 2rem; display: block; margin-bottom: 8px; }
        .tool-text { font-weight: bold; font-size: 0.9rem; color: var(--text-main); }
        
        .custom-trans-box {
            background: white; padding: 15px; border-radius: 16px; box-shadow: var(--shadow-card); display: flex; gap: 10px;
        }
        
        /* --- Modal (Common) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 2000; opacity: 0; visibility: hidden; transition: 0.3s;
            backdrop-filter: blur(5px);
        }
        .modal-overlay.open { opacity: 1; visibility: visible; }
        
        /* Detail Modal (Bottom Sheet) */
        .detail-modal {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 85vh;
            background: #FAF9F6; border-radius: 30px 30px 0 0; z-index: 2100;
            transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            overflow-y: auto; display: flex; flex-direction: column;
        }
        .detail-modal.open { transform: translateY(0); }
        
        /* Card Modal (Center Pop) */
        .card-modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9);
            width: 90%; max-width: 350px; background: white; border-radius: 20px; padding: 30px;
            z-index: 2200; text-align: center; opacity: 0; visibility: hidden; transition: 0.3s;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .card-modal.open { transform: translate(-50%, -50%) scale(1); opacity: 1; visibility: visible; }
        .big-text { font-size: 2.5rem; font-weight: 900; color: #333; line-height: 1.3; margin: 20px 0; word-break: break-all; }
        .sub-text { color: #888; font-size: 1rem; margin-bottom: 20px; }

        /* --- Helper --- */
        .tab-content { display: none; padding: 20px; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .nav-container {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; height: 65px;
            background: rgba(78, 52, 46, 0.95); backdrop-filter: blur(10px);
            border-radius: 50px; display: flex; justify-content: space-evenly; align-items: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.25); z-index: 3000;
        }
        .nav-item { color: rgba(255,255,255,0.5); font-size: 1.4rem; padding: 10px; transition: 0.3s; position: relative; }
        .nav-item.active { color: #fff; transform: translateY(-3px); }
        
        /* Modal Detail Styles */
        .modal-hero { height: 250px; width: 100%; object-fit: cover; mask-image: linear-gradient(to bottom, black 80%, transparent 100%); }
        .modal-content { padding: 0 25px 40px; margin-top: -40px; position: relative; }
        .modal-title { font-size: 1.8rem; font-weight: 800; margin-bottom: 15px; color: #3E2723; }
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .action-btn { padding: 12px; border-radius: 12px; border: none; font-weight: bold; display: flex; justify-content: center; gap: 8px; text-decoration: none; }
        .btn-google { background: #E3F2FD; color: #1565C0; }
        .btn-web { background: #F3E5F5; color: #7B1FA2; }
        .info-box { background: white; padding: 20px; border-radius: 16px; border-left: 4px solid var(--secondary-wood); margin-bottom: 20px; box-shadow: var(--shadow-card); }
    </style>
</head>
<body>

    <!-- 1. HEADER & SMART WIDGET -->
    <header class="hero-section">
        <h1 style="color:#3E2723; margin:0;">é’æ£®å‡½é¤¨å†¬æ—…</h1>
        <div style="font-size:0.9rem; color:#5D4037;">2026.02.02 - 02.07</div>

        <!-- Smart Bubble (JS updates this) -->
        <div class="smart-bubble" id="smart-bubble">
            <div class="bubble-icon" id="bubble-icon">â˜€ï¸</div>
            <div class="bubble-content">
                <h3 id="bubble-title">è¼‰å…¥ä¸­...</h3>
                <p id="bubble-desc">æ­£åœ¨å–å¾—ç•¶åœ°è³‡è¨Š</p>
            </div>
        </div>
    </header>

    <!-- 2. TAB: ITINERARY -->
    <div id="tab-itinerary" class="tab-content active" style="padding:0;">
        <div style="padding:0 20px;">
            <div class="view-toggle">
                <button class="toggle-pill active" onclick="setViewMode('day', this)">åˆ†æ—¥æª¢è¦–</button>
                <button class="toggle-pill" onclick="setViewMode('all', this)">ç¸½è¦½æ¨¡å¼</button>
            </div>
        </div>

        <div class="day-tabs" id="day-tabs-container"></div>
        <div id="itinerary-list" class="itinerary-container"></div>
    </div>

    <!-- 3. TAB: EXPENSES -->
    <div id="tab-expenses" class="tab-content">
        <h2 style="margin-top:0;">è¨˜å¸³ (é›™å¹£åˆ¥)</h2>
        
        <div class="expense-header">
            <div class="stat-card">
                <div class="stat-label">YK ä»£å¢Š</div>
                <div class="stat-val" id="total-yk">$0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">YY ä»£å¢Š</div>
                <div class="stat-val" id="total-yy">$0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">YS ä»£å¢Š</div>
                <div class="stat-val" id="total-ys">$0</div>
            </div>
        </div>

        <div class="add-box">
            <div class="form-row">
                <input type="text" id="ex-name" class="form-input" placeholder="é …ç›®åç¨± (å¦‚: æ™šé¤)">
            </div>
            <div class="form-row">
                <input type="number" id="ex-price" class="form-input" placeholder="é‡‘é¡" style="flex:2;">
                <div class="currency-switch" style="flex:1;">
                    <div class="curr-opt active" onclick="setCurrency('TWD', this)">TWD</div>
                    <div class="curr-opt" onclick="setCurrency('JPY', this)">JPY</div>
                </div>
            </div>
            <div class="form-row">
                <select id="ex-payer" class="form-input">
                    <option value="YK">YK ä»˜æ¬¾</option>
                    <option value="YY">YY ä»˜æ¬¾</option>
                    <option value="YS">YS ä»˜æ¬¾</option>
                </select>
            </div>
            <div style="font-size:0.8rem; color:#888; margin-bottom:10px; text-align:right;">
                ç›®å‰åŒ¯ç‡: 1 JPY â‰ˆ <span id="rate-label">0.22</span> TWD
            </div>
            <button class="btn-save" onclick="addExpense()">+ è¨˜ä¸€ç­†</button>
        </div>

        <div id="expense-list"></div>
    </div>

    <!-- 4. TAB: TOOLS (TRANSLATION) -->
    <div id="tab-tools" class="tab-content">
        <h2 style="margin-top:0;">æºé€šç¿»è­¯</h2>
        
        <!-- è‡ªè¨‚è¼¸å…¥ (ç”¢ç”Ÿå¤§å­—å¡) -->
        <div class="custom-trans-box">
            <input type="text" id="custom-text" class="form-input" placeholder="è¼¸å…¥ä½ æƒ³èªªçš„ä¸­æ–‡...">
            <button class="btn-save" style="width:auto; padding:0 20px;" onclick="showCustomCard()">
                é¡¯ç¤ºå¤§å­—
            </button>
        </div>

        <!-- é è¨­å¸¸ç”¨å¡ç‰‡ -->
        <div class="tools-grid">
            <div class="tool-card" onclick="showCard('ã™ã¿ã¾ã›ã‚“ã€ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', 'ä¸å¥½æ„æ€ï¼Œè«‹å•å»æ‰€åœ¨å“ªè£¡ï¼Ÿ')">
                <span class="tool-icon">ğŸš»</span>
                <span class="tool-text">æ‰¾å»æ‰€</span>
            </div>
            <div class="tool-card" onclick="showCard('ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™', 'éº»ç…©çµå¸³')">
                <span class="tool-icon">ğŸ’´</span>
                <span class="tool-text">çµå¸³</span>
            </div>
            <div class="tool-card" onclick="showCard('ã“ã‚Œã‚’ãŠé¡˜ã„ã—ã¾ã™', 'æˆ‘è¦é€™å€‹ (æŒ‡èœå–®)')">
                <span class="tool-icon">ğŸ‘ˆ</span>
                <span class="tool-text">æˆ‘è¦é€™å€‹</span>
            </div>
            <div class="tool-card" onclick="showCard('å†™çœŸã‚’æ’®ã£ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', 'èƒ½å¹«æˆ‘å€‘æ‹ç…§å—ï¼Ÿ')">
                <span class="tool-icon">ğŸ“¸</span>
                <span class="tool-text">å¹«å¿™æ‹ç…§</span>
            </div>
            <div class="tool-card" onclick="showCard('äºˆç´„ã—ã¦ã„ã¾ã™', 'æˆ‘æœ‰é ç´„')">
                <span class="tool-icon">ğŸ“…</span>
                <span class="tool-text">æˆ‘æœ‰é ç´„</span>
            </div>
            <div class="tool-card" onclick="showCard('è¢‹ã¯ã„ã‚Šã¾ã›ã‚“', 'ä¸ç”¨å¡‘è† è¢‹')">
                <span class="tool-icon">ğŸ›ï¸</span>
                <span class="tool-text">ä¸ç”¨è¢‹å­</span>
            </div>
             <div class="tool-card" onclick="showCard('è±šè‚‰ã¯å…¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ', 'è«‹å•é€™è£¡é¢æœ‰è±¬è‚‰å—ï¼Ÿ')">
                <span class="tool-icon">ğŸ·</span>
                <span class="tool-text">ä¸åƒè±¬è‚‰</span>
            </div>
            <div class="tool-card" onclick="showCard('ãŠã™ã™ã‚ã¯ä½•ã§ã™ã‹ï¼Ÿ', 'è«‹å•æ¨è–¦ä»€éº¼ï¼Ÿ')">
                <span class="tool-icon">ğŸ‘</span>
                <span class="tool-text">æ¨è–¦ä»€éº¼</span>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div class="modal-overlay" id="modal-overlay" onclick="closeAllModals()"></div>
    
    <!-- Detail Modal (Bottom Sheet) -->
    <div class="detail-modal" id="detail-modal">
        <button onclick="closeAllModals()" style="position:absolute; top:20px; right:20px; z-index:2200; width:36px; height:36px; border-radius:50%; border:none; box-shadow:0 4px 10px rgba(0,0,0,0.1);">âœ•</button>
        <img src="" id="modal-img" class="modal-hero">
        <div class="modal-content">
            <div class="modal-title" id="modal-title">Title</div>
            <div class="action-grid">
                <a href="#" target="_blank" id="btn-map" class="action-btn btn-google"><i class="fa-solid fa-location-dot"></i> Google å°èˆª</a>
                <a href="#" target="_blank" id="btn-web" class="action-btn btn-web"><i class="fa-solid fa-globe"></i> å®˜æ–¹ç¶²ç«™</a>
            </div>
            <div class="info-box">
                <div style="font-size:0.85rem; color:#999; font-weight:bold; margin-bottom:5px;">è©³ç´°æ”»ç•¥</div>
                <div style="line-height:1.6; white-space:pre-line; color:#555;" id="modal-desc"></div>
            </div>
        </div>
    </div>

    <!-- Card Modal (Center Translation) -->
    <div class="card-modal" id="card-modal">
        <div class="sub-text" id="card-cn">ä¸­æ–‡æ„æ€</div>
        <div class="big-text" id="card-jp">æ—¥æœ¬èª</div>
        <button class="btn-save" onclick="closeAllModals()">é—œé–‰</button>
    </div>

    <!-- NAV -->
    <div class="nav-container">
        <div class="nav-item active" onclick="switchTab('itinerary', this)"><i class="fa-solid fa-map"></i></div>
        <div class="nav-item" onclick="switchTab('expenses', this)"><i class="fa-solid fa-receipt"></i></div>
        <div class="nav-item" onclick="switchTab('tools', this)"><i class="fa-solid fa-language"></i></div>
    </div>

    <script>
        // --- DATA: è¡Œç¨‹è³‡æ–™ (å«æ¯æ—¥å¤©æ°£é æ¸¬) ---
        const tripData = [
            {
                day: 1, date: "2/2 (ä¸€)", title: "å‡½é¤¨æŠµé”", weather: "â˜ï¸ -2Â°C",
                events: [
                    { time: "11:10", title: "æŠµé”å‡½é¤¨æ©Ÿå ´", icon: "âœˆï¸", loc: "å‡½é¤¨ç©ºæ¸¯", img: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=800", url: "https://airport.ne.jp/ch_t/", desc: "å…¥å¢ƒå¾Œé ˜å–è¡Œæï¼Œç›´æ¥å‰å¾€è¨ˆç¨‹è»Šä¹˜è»Šè™•ã€‚æˆ¶å¤–æº«åº¦ä½ï¼Œè«‹å…ˆç©¿å¥½å¤–å¥—ã€‚" },
                    { time: "13:15", title: "UNIQLO æ¡è³¼", icon: "ğŸ›ï¸", loc: "UNIQLO å‡½é¤¨æ˜­å’Œã‚¿ã‚¦ãƒ³ãƒ—ãƒ©ã‚¶åº—", img: "https://images.unsplash.com/photo-1542060748-10c28b62716f?q=80&w=800", url: "https://map.uniqlo.com/jp/ja/detail/10101377", desc: "è³¼è²· Heattech ç™¼ç†±è¡£ã€é˜²é¢¨è¤²ã€‚æ—é‚Šæœ‰è¶…å¸‚å¯è²·è£œçµ¦å“ã€‚" },
                    { time: "16:00", title: "é‡‘æ£®ç´…ç£šå€‰åº«", icon: "ğŸ§±", loc: "é‡‘æ£®èµ¤ãƒ¬ãƒ³ã‚¬å€‰åº«", img: "https://images.unsplash.com/photo-1579500057271-9c6a71cb069b?q=80&w=800", url: "https://hakodate-kanemori.com/tw", desc: "å‚æ™šé©åˆæ‹ç…§ã€‚æµ·é¢¨å¤§è«‹æ³¨æ„ä¿æš–ã€‚æ¨è–¦å» Snaffle's åƒèµ·å¸è›‹ç³•ã€‚" },
                    { time: "17:00", title: "å‡½é¤¨å±±å¤œæ™¯", icon: "ğŸŒƒ", loc: "å‡½é¤¨å±±ãƒ­ãƒ¼ãƒ—ã‚¦ã‚§ã‚¤", img: "https://images.unsplash.com/photo-1532236204992-f5e85c024202?q=80&w=800", url: "https://334.co.jp/cht/", desc: "æ­ä¹˜çºœè»Šä¸Šå±±ã€‚è§€æ™¯å°æˆ¶å¤–é¢¨å¤§ï¼Œå»ºè­°åœç•™ 30 åˆ†é˜å³å¯ã€‚" }
                ]
            },
            {
                day: 2, date: "2/3 (äºŒ)", title: "ç§»å‹•è‡³é’æ£®", weather: "â„ï¸ -4Â°C",
                events: [
                    { time: "08:00", title: "å‡½é¤¨æœå¸‚", icon: "ğŸ¦‘", loc: "å‡½é¤¨æœå¸‚", img: "https://images.unsplash.com/photo-1559339352-11d035aa65de?q=80&w=800", url: "http://www.hakodate-asaichi.com/", desc: "å¿…ç©ï¼šé‡£æ´»çƒè³Šã€‚æ¨è–¦æ—©é¤ï¼šæµ·é®®ä¸¼ (ããã‚ˆé£Ÿå ‚)ã€‚" },
                    { time: "14:40", title: "é’æ£®ç¸£ç«‹ç¾è¡“é¤¨", icon: "ğŸ¨", loc: "é’æ£®çœŒç«‹ç¾è¡“é¤¨", img: "https://images.unsplash.com/photo-1629012435532-6d2a452d765d?q=80&w=800", url: "https://www.aomori-museum.jp/tw/", desc: "å¿…çœ‹å¥ˆè‰¯ç¾æ™ºã€Œé’æ£®çŠ¬ã€ã€‚é–‰é¤¨æ™‚é–“ 17:00ï¼Œè«‹æŠ“ç·Šæ™‚é–“åƒè§€ã€‚" },
                    { time: "18:00", title: "é’æ£®æ‰‡è²å°å±‹", icon: "ğŸš", loc: "ã‚ãŠã‚‚ã‚Šå¸†ç«‹å°å±‹", img: "https://images.unsplash.com/photo-1625937759425-420008064b32?q=80&w=800", url: "https://aomori-hotategoya.com/", desc: "é«”é©—é‡£æ‰‡è² (500æ—¥åœ“)ã€‚é‡£åˆ°å¯é¸åˆºèº«ã€ç‚­çƒ¤æˆ–æ¡å£½å¸ã€‚" }
                ]
            },
            {
                day: 3, date: "2/4 (ä¸‰)", title: "æš–çˆåˆ—è»Š", weather: "â„ï¸ -3Â°C",
                events: [
                    { time: "10:15", title: "ELM è³¼ç‰©ä¸­å¿ƒ", icon: "ğŸ›’", loc: "ELM Shopping Center", img: "https://images.unsplash.com/photo-1519567241046-7f570eee3d9f?q=80&w=800", url: "https://elm-no-machi.jp/", desc: "3COINS+plus æ¡è³¼å°ç‰©ã€‚é™æ™‚ 35 åˆ†é˜ï¼Œè²·å®Œç›´å¥”è»Šç«™ã€‚" },
                    { time: "12:30", title: "æ´¥è¼•æš–çˆåˆ—è»Š", icon: "ğŸ”¥", loc: "æ´¥è»½äº”æ‰€å·åŸé§…", img: "https://images.unsplash.com/photo-1475738972911-5b44ce984c42?q=80&w=800", url: "https://tsutetsu.com/stove.html", desc: "å¿…è²·ï¼šçƒ¤é­·é­š (Surume)ã€‚è»Šå»‚å…§å¾ˆæº«æš–ï¼Œå¯ä»¥è„«å¤–å¥—ã€‚" },
                    { time: "15:30", title: "è—¤ç”°ç´€å¿µåº­åœ’", icon: "ğŸ", loc: "è—¤ç”°è¨˜å¿µåº­åœ’", img: "https://images.unsplash.com/photo-1568285908272-98c94625579d?q=80&w=800", url: "http://www.hirosakipark.or.jp/hujita/", desc: "å¤§æ­£æµªæ¼«å–«èŒ¶å®¤ï¼Œå‹™å¿…åœ¨ 16:00 å‰é»é¤ã€‚å¿…åƒå¼˜å‰è˜‹æœæ´¾ã€‚" }
                ]
            },
            {
                day: 4, date: "2/5 (å››)", title: "æ¨¹å†°èˆ‡æ˜Ÿé‡", weather: "ğŸŒ¬ï¸ -8Â°C",
                events: [
                    { time: "10:40", title: "å…«ç”²ç”°æ¨¹å†°", icon: "â„ï¸", loc: "å…«ç”²ç”°ãƒ­ãƒ¼ãƒ—ã‚¦ã‚§ãƒ¼", img: "https://images.unsplash.com/photo-1483921020237-2ff51e8e4b22?q=80&w=800", url: "http://www.hakkoda-ropeway.jp/", desc: "å±±é ‚æ¥µå†·ï¼Œå‹™å¿…æˆ´æ‰‹å¥—ã€å¸½å­ã€åœå·¾ã€‚è‹¥é¢¨å¤§çºœè»Šåœé§›ï¼Œæ”¹å»é¦¬é–€æ»‘é›ªå ´ã€‚" },
                    { time: "17:30", title: "æ˜Ÿé‡é’æ£®å±‹", icon: "ğŸ¨", loc: "æ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ é’æ£®å±‹", img: "https://images.unsplash.com/photo-1571003123894-1f0594d2b5d9?q=80&w=800", url: "https://hoshinoresorts.com/zh_tw/hotels/aomoriya/", desc: "å…¥ä½å¾Œå…ˆé ç´„å›ç¨‹æ¥é§ã€‚æ™šé¤ Nore Sore é£Ÿå ‚åƒåˆ°é£½ã€‚" }
                ]
            },
            {
                day: 5, date: "2/6 (äº”)", title: "æ˜Ÿé‡å…¨æ—¥", weather: "ğŸŒ¤ï¸ -5Â°C",
                events: [
                    { time: "09:00", title: "æµ®æ¹¯æº«æ³‰", icon: "â™¨ï¸", loc: "æ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ é’æ£®å±‹", img: "https://images.unsplash.com/photo-1519711683935-717e1345d355?q=80&w=800", url: "https://hoshinoresorts.com/zh_tw/hotels/aomoriya/hotsprings/", desc: "éœ²å¤©æº«æ³‰ï¼Œå‘¨åœæœ‰ç¡é­”ç‡ˆç± è£é£¾ã€‚æ—©ä¸Šäººå°‘é©åˆæ‹ç…§ (æ³¨æ„éš±ç§)ã€‚" },
                    { time: "11:30", title: "å…«é£Ÿä¸­å¿ƒ", icon: "ğŸŸ", loc: "å…«é£Ÿã‚»ãƒ³ã‚¿ãƒ¼", img: "https://images.unsplash.com/photo-1534483509719-3feaee7c30da?q=80&w=800", url: "https://www.849net.com/", desc: "ä¸ƒè¼ªæ‘ç‚­çƒ¤æµ·é®®ã€‚è³¼è²·é£Ÿæå¾Œç§Ÿç”¨ç‚­ç«çˆç¾çƒ¤ã€‚" },
                    { time: "20:00", title: "é™¸å¥§ç¥­å…¸å±‹", icon: "ğŸ¥", loc: "æ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ é’æ£®å±‹", img: "https://images.unsplash.com/photo-1516280440614-6697288d5d38?q=80&w=800", url: "https://hoshinoresorts.com/zh_tw/hotels/aomoriya/activities/show/", desc: "å±•ç¾é’æ£®å››å¤§ç¥­å…¸çš„è¡¨æ¼”ï¼Œæ°£æ°›ç†±çƒˆï¼Œéœ€é ç´„ã€‚" }
                ]
            },
            {
                day: 6, date: "2/7 (å…­)", title: "å®‰å…¨è¿”ç¨‹", weather: "â˜ï¸ -3Â°C",
                events: [
                    { time: "13:00", title: "é’æ£®æ©Ÿå ´", icon: "âœˆï¸", loc: "é’æ£®ç©ºæ¸¯", img: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=800", url: "https://www.aomori-airport.co.jp/", desc: "é‚„è»Šå‰åŠ æ»¿æ²¹ã€‚æ©Ÿå ´å…§å¯åšæœ€å¾Œæ¡è²· (è˜‹æœæ±ã€ä»™è²)ã€‚" }
                ]
            }
        ];

        // --- JS LOGIC ---
        
        // 1. Smart Header Logic
        function updateSmartHeader() {
            const hour = new Date().getHours();
            const bubbleIcon = document.getElementById('bubble-icon');
            const bubbleTitle = document.getElementById('bubble-title');
            const bubbleDesc = document.getElementById('bubble-desc');

            if (hour >= 5 && hour < 11) {
                bubbleIcon.innerText = "ğŸ§£";
                bubbleTitle.innerText = "æ—©å®‰ï¼Œæº–å‚™å‡ºç™¼ï¼";
                bubbleDesc.innerText = "æ—©æ™¨æ°£æº«è¼ƒä½ï¼Œåœå·¾æ‰‹å¥—è¦å¸¶å¥½å–”ã€‚";
            } else if (hour >= 11 && hour < 14) {
                bubbleIcon.innerText = "ğŸ±";
                bubbleTitle.innerText = "åˆå®‰ï¼Œåƒé£½äº†å—ï¼Ÿ";
                bubbleDesc.innerText = "è£œå……èƒ½é‡ï¼Œç¹¼çºŒä¸‹åˆçš„è¡Œç¨‹å§ï¼";
            } else if (hour >= 14 && hour < 17) {
                bubbleIcon.innerText = "ğŸŒ‡";
                bubbleTitle.innerText = "ä¸‹åˆå¥½ï¼Œæ³¨æ„æ—¥è½";
                bubbleDesc.innerText = "å†¬å¤©ç´„ 16:30 å¤©é»‘ï¼Œæ³¨æ„æˆ¶å¤–å…‰ç·šã€‚";
            } else {
                bubbleIcon.innerText = "ğŸŒ™";
                bubbleTitle.innerText = "æ™šå®‰ï¼Œè¾›è‹¦äº†";
                bubbleDesc.innerText = "æ³¡å€‹æº«æ³‰æ”¾é¬†ä¸€ä¸‹ï¼Œæ˜å¤©ç¹¼çºŒç©ï¼";
            }
        }

        // 2. View Mode
        let currentMode = 'day';
        let currentDayIdx = 0;

        function setViewMode(mode, btn) {
            currentMode = mode;
            document.querySelectorAll('.toggle-pill').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderItinerary();
        }

        function renderItinerary() {
            const container = document.getElementById('itinerary-list');
            const tabsContainer = document.getElementById('day-tabs-container');
            
            // Tabs
            if (currentMode === 'day') {
                tabsContainer.style.display = 'flex';
                let tabsHtml = '';
                tripData.forEach((day, i) => {
                    tabsHtml += `<div class="day-tab ${i === currentDayIdx ? 'active' : ''}" onclick="switchDay(${i})">Day ${day.day}</div>`;
                });
                tabsContainer.innerHTML = tabsHtml;
            } else {
                tabsContainer.style.display = 'none';
            }

            // List
            let listHtml = '';
            if (currentMode === 'day') {
                const day = tripData[currentDayIdx];
                listHtml += `<h2 style="margin:10px 0 20px;">${day.date} ${day.title}</h2>`;
                day.events.forEach(ev => listHtml += createEventCard(ev, day.weather));
            } else {
                tripData.forEach(day => {
                    listHtml += `<h3 style="margin:30px 0 15px; color:var(--text-sub); border-bottom:1px solid #ddd; padding-bottom:5px;">${day.date} ${day.title} <span style="font-size:0.8rem; background:#E3F2FD; padding:2px 5px; border-radius:5px;">${day.weather}</span></h3>`;
                    day.events.forEach(ev => listHtml += createEventCard(ev, day.weather));
                });
            }
            container.innerHTML = listHtml;
        }

        function switchDay(i) { currentDayIdx = i; renderItinerary(); }

        function createEventCard(ev, weather) {
            const dataStr = encodeURIComponent(JSON.stringify(ev));
            return `
                <div class="event-card" onclick="openDetail('${dataStr}')">
                    <div class="event-weather">${weather}</div>
                    <img src="${ev.img}" class="event-thumb">
                    <div class="event-info">
                        <div class="event-time">${ev.time}</div>
                        <div class="event-title">${ev.title}</div>
                    </div>
                    <i class="fa-solid fa-chevron-right" style="color:#ccc;"></i>
                </div>
            `;
        }

        // 3. Modal Logic
        function openDetail(dataStr) {
            const ev = JSON.parse(decodeURIComponent(dataStr));
            document.getElementById('modal-img').src = ev.img;
            document.getElementById('modal-title').innerText = ev.title;
            document.getElementById('modal-desc').innerText = ev.desc;
            document.getElementById('btn-map').href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(ev.loc)}`;
            document.getElementById('btn-web').href = ev.url || '#';
            document.getElementById('modal-overlay').classList.add('open');
            document.getElementById('detail-modal').classList.add('open');
        }

        function showCard(jp, cn) {
            document.getElementById('card-jp').innerText = jp;
            document.getElementById('card-cn').innerText = cn;
            document.getElementById('modal-overlay').classList.add('open');
            document.getElementById('card-modal').classList.add('open');
        }

        function showCustomCard() {
            const text = document.getElementById('custom-text').value;
            if(text) showCard(text, 'ç¿»è­¯å…§å®¹');
        }

        function closeAllModals() {
            document.getElementById('modal-overlay').classList.remove('open');
            document.getElementById('detail-modal').classList.remove('open');
            document.getElementById('card-modal').classList.remove('open');
        }

        // 4. Expenses (Currency Logic)
        let expenses = JSON.parse(localStorage.getItem('trip_expenses_v5')) || [];
        let selectedCurrency = 'TWD';
        let currentRate = 0.22;

        function setCurrency(curr, el) {
            selectedCurrency = curr;
            document.querySelectorAll('.curr-opt').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        function renderExpenses() {
            const list = document.getElementById('expense-list');
            list.innerHTML = '';
            let totals = { YK: 0, YY: 0, YS: 0 };

            expenses.forEach((ex, i) => {
                // å¦‚æœåŸå§‹å¹£åˆ¥æ˜¯ JPYï¼Œç”¨ç•¶æ™‚è¨˜éŒ„çš„ rate æ›ç®—æˆ TWD åŠ ç¸½ï¼Œä½†é¡¯ç¤ºåŸå§‹é‡‘é¡
                let amountTWD = ex.curr === 'JPY' ? Math.round(ex.price * ex.rate) : parseInt(ex.price);
                totals[ex.payer] += amountTWD;

                list.innerHTML += `
                    <div style="background:white; padding:12px; border-radius:12px; margin-bottom:8px; display:flex; justify-content:space-between; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                        <div>
                            <strong>${ex.name}</strong> <span style="font-size:0.8rem; color:#888;">(${ex.payer})</span>
                            <div style="font-size:0.75rem; color:#aaa;">${new Date(ex.date).toLocaleDateString()}</div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-weight:bold;">${ex.curr} ${ex.price}</div>
                            ${ex.curr === 'JPY' ? `<div style="font-size:0.75rem; color:#888;">â‰ˆ TWD ${amountTWD}</div>` : ''}
                        </div>
                        <i class="fa-solid fa-trash" style="color:#ff8a80; padding:5px; margin-left:10px;" onclick="delExpense(${i})"></i>
                    </div>
                `;
            });

            document.getElementById('total-yk').innerText = `$${totals.YK.toLocaleString()}`;
            document.getElementById('total-yy').innerText = `$${totals.YY.toLocaleString()}`;
            document.getElementById('total-ys').innerText = `$${totals.YS.toLocaleString()}`;
            localStorage.setItem('trip_expenses_v5', JSON.stringify(expenses));
        }

        function addExpense() {
            const name = document.getElementById('ex-name').value;
            const price = document.getElementById('ex-price').value;
            const payer = document.getElementById('ex-payer').value;

            if(name && price) {
                expenses.unshift({ 
                    name, 
                    price, 
                    payer, 
                    curr: selectedCurrency, 
                    rate: currentRate,
                    date: new Date()
                });
                document.getElementById('ex-name').value = '';
                document.getElementById('ex-price').value = '';
                renderExpenses();
            }
        }
        function delExpense(i) { if(confirm('åˆªé™¤?')) { expenses.splice(i,1); renderExpenses(); } }

        // Init
        async function init() {
            try {
                const res = await fetch('https://api.exchangerate-api.com/v4/latest/JPY');
                const data = await res.json();
                if(data.rates.TWD) {
                    currentRate = data.rates.TWD;
                    document.getElementById('rate-label').innerText = currentRate.toFixed(3);
                }
            } catch(e) {}
            
            updateSmartHeader();
            renderItinerary();
            renderExpenses();
        }

        function switchTab(t, el) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('tab-'+t).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            window.scrollTo(0,0);
        }

        window.onload = init;
    </script>
</body>
</html>
