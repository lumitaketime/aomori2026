<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>L'VOYAGE | å‡½é¤¨-é’æ£® æ—æªä¹‹æ—…</title>
    <meta name="theme-color" content="#1C2541">
    
    <!-- PWA: Add manifest link for standalone mode -->
    <link rel="manifest" href="manifest.json">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&family=Noto+Serif+TC:wght@300;500;700&family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Palette: Luxury Winter */
            --bg-body: #F9F8F4;
            --bg-card: #FFFFFF;
            --text-primary: #1A1A1A;
            --text-secondary: #666666;
            --accent-main: #1C2541; /* åˆå¤œè— */
            --accent-gold: #B49B67; /* é¦™æª³é‡‘ */
            --accent-red: #D9333F; /* é’æ£®ç´… */
            --line-light: #E0E0E0;
            /* Design Note: Increased shadow spread for better separation during swipes */
            --shadow-soft: 0 12px 45px -10px rgba(0,0,0,0.1); 
            --font-serif: 'Cormorant Garamond', 'Noto Serif TC', serif;
            --font-sans: 'Noto Sans TC', sans-serif;
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; padding: 0;
            background-color: var(--bg-body);
            color: var(--text-primary);
            font-family: var(--font-sans);
            padding-bottom: calc(90px + var(--safe-bottom)); /* åº•éƒ¨ç©ºé–“ */
            overflow-x: hidden;
            /* Design Note: Prevents browser navigation swipe on X-axis */
            overscroll-behavior-x: none; 
            overscroll-behavior-y: auto;
        }

        h1, h2, h3, .serif { font-family: var(--font-serif); }
        .hidden { display: none !important; }
        
        /* Link Styles in Description */
        #m-desc a {
            color: var(--accent-main);
            text-decoration: underline;
            text-decoration-color: var(--accent-gold);
            text-underline-offset: 3px;
        }
        
        /* Utility styles for detail info */
        .info-group { padding: 15px 0; border-top: 1px solid #EEE; border-bottom: 1px solid #EEE; }
        .info-item { display: flex; justify-content: space-between; margin-bottom: 10px; align-items: center; }
        .info-label { font-size: 0.85rem; color: #888; display: flex; align-items: center; }
        .info-label i { margin-right: 8px; color: var(--accent-gold); }
        .info-value { font-size: 0.95rem; font-weight: 500; color: var(--accent-main); text-align: right; }


        /* --- INTRO SCREEN REDESIGN (UX/UI Optimized) --- */
        #intro-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background: linear-gradient(180deg, #1C2541 0%, #151b30 100%); /* æ·±é‚ƒåˆå¤œæ¼¸å±¤ */
            color: white;
            z-index: 9999; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            transition: transform 1s cubic-bezier(0.77, 0, 0.175, 1);
            padding: 0 30px;
            overflow: hidden; /* é˜²æ­¢é›ªèŠ±è¶…å‡º */
        }

        /* èƒŒæ™¯é£„é›ªå®¹å™¨ */
        #snow-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 1;
        }

        .snowflake {
            position: absolute;
            color: #FFF;
            opacity: 0.8;
            top: -20px;
            animation: fall linear infinite; /* Modified: Changed forwards to infinite */
            font-size: 1rem;
            text-shadow: 0 0 5px rgba(255,255,255,0.8);
        }

        @keyframes fall {
            to { transform: translateY(105vh); }
        }

        /* å…§å®¹å±¤ç´š */
        .intro-text {
            position: relative; z-index: 10;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 400px;
        }

        /* 1. ä¸­å¤®æµ®å‹•é›ªèŠ±åœ–æ¨™ - Modified for elegance */
        .intro-main-icon {
            font-size: 2.2rem; /* Modified: Smaller size for elegance */
            color: var(--accent-gold);
            margin-bottom: 20px;
            filter: drop-shadow(0 0 10px rgba(180, 155, 103, 0.3));
            animation: floatIcon 6s ease-in-out infinite;
            opacity: 0;
            animation: floatIcon 6s ease-in-out infinite, fadeIn 1.5s ease forwards 0.2s;
        }

        @keyframes floatIcon {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-8px) rotate(5deg); } /* Modified: More subtle float */
        }

        .intro-countdown-block { 
            margin-bottom: 40px; 
            opacity: 0; 
            animation: fadeIn 1.5s ease forwards 0.5s; 
            text-align: center; 
            position: relative;
        }

        /* æ•¸å­—æ¨£å¼å„ªåŒ– */
        .countdown-value { 
            font-size: 6.5rem; 
            line-height: 1; 
            font-weight: 300; 
            color: var(--accent-gold); 
            font-family: var(--font-serif);
            margin-bottom: 10px;
            text-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .countdown-label {
            font-size: 0.75rem;
            letter-spacing: 6px; /* å¢åŠ å­—è·ç‡Ÿé€ é«˜ç´šæ„Ÿ */
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
            font-weight: 400;
            margin-top: -5px;
        }

        .intro-title {
            font-family: var(--font-serif);
            font-size: 1.8rem;
            letter-spacing: 2px;
            margin-bottom: 5px;
            font-weight: 500;
            opacity: 0;
            animation: fadeIn 1.5s ease forwards 0.8s;
        }

        .intro-subtitle {
            font-family: var(--font-serif);
            font-size: 0.9rem;
            color: rgba(255,255,255,0.5);
            letter-spacing: 1px;
            margin-bottom: 20px;
            opacity: 0;
            animation: fadeIn 1.5s ease forwards 0.8s;
        }

        #dynamic-intro-text {
            font-family: var(--font-sans);
            font-size: 0.95rem; 
            margin-top: 10px; 
            color: rgba(255,255,255,0.9); 
            max-width: 320px; 
            text-align: center; 
            line-height: 1.6; 
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            animation: fadeIn 1.5s ease forwards 1s;
            padding: 5px 0;
            letter-spacing: 1px;
            font-weight: 300;
        }

        .intro-btn {
            margin-top: 40px; 
            padding: 14px 50px; 
            border: 1px solid rgba(255,255,255,0.4);
            border-radius: 50px; /* æ”¹ç‚ºåœ“è§’è† å›Šç‹€ */
            background: rgba(255,255,255,0.05); 
            backdrop-filter: blur(5px);
            color: white; 
            font-family: var(--font-serif);
            font-size: 1.1rem; 
            letter-spacing: 3px; 
            cursor: pointer; 
            transition: all 0.4s ease;
            opacity: 0; 
            animation: fadeIn 1.5s ease forwards 1.2s;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .intro-btn:hover { background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.8); transform: translateY(-2px); }
        .intro-btn:active { transform: translateY(1px); }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* --- END INTRO STYLES --- */


        /* --- HEADER --- */
        .elegant-header {
            padding: 40px 20px 20px;
            background: linear-gradient(to bottom, #F9F8F4 90%, rgba(249,248,244,0));
            position: sticky; top: 0; z-index: 100;
        }
        .top-meta { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px; }
        .brand { font-family: var(--font-serif); font-size: 1.4rem; font-weight: 700; letter-spacing: 1px; color: var(--accent-main); }
        
        .status-value { font-family: var(--font-serif); font-size: 2rem; line-height: 1; color: var(--accent-gold); text-align: right; }
        .status-label { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 2px; color: var(--text-secondary); text-align: right; margin-top: 5px; }

        /* DATE SCROLLER */
        .date-scroller { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; scroll-behavior: smooth; }
        .date-scroller::-webkit-scrollbar { display: none; }
        .d-item { 
            min-width: 60px; text-align: center; opacity: 0.4; transition: 0.4s; cursor: pointer; 
            display: flex; flex-direction: column; align-items: center;
            user-select: none;
            /* Design Note: Prevent shrinking to keep consistent tap target */
            flex-shrink: 0; 
        }
        .d-item.active { opacity: 1; transform: scale(1.1); }
        .d-week { font-size: 0.7rem; letter-spacing: 1px; margin-bottom: 5px; text-transform: uppercase; }
        .d-num { font-family: var(--font-serif); font-size: 1.5rem; position: relative; line-height: 1;}
        .d-item.active .d-num::after {
            content: ''; position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; background: var(--accent-gold); border-radius: 50%;
        }
        .d-weather { font-size: 0.6rem; margin-top: 8px; color: var(--text-secondary); display: flex; flex-direction: column; align-items: center; gap: 2px; min-height: 25px; }
        .d-weather i { font-size: 0.8rem; margin-bottom: 2px; }
        .d-item.active .d-weather { color: var(--accent-main); font-weight: 600; }

        /* --- TRIP VIEW & GESTURES --- */
        .view-section {
            /* Ensure smooth transitions */
            width: 100%;
        }

        #view-trip {
            overflow-x: hidden; /* Hide the sliding content */
            min-height: 80vh; /* Ensure touch area covers screen */
            touch-action: pan-y; /* Allow vertical scroll, handle horizontal in JS */
        }

        .container { 
            padding: 0 20px; 
            max-width: 600px; 
            margin: 0 auto; 
            /* Modified: Faster transition (0.35s) for snappier feel */
            transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.35s ease; 
            will-change: transform, opacity;
        }

        /* Animation Classes - Modified for 0.35s */
        .slide-out-left { transform: translateX(-50px); opacity: 0; }
        .slide-out-right { transform: translateX(50px); opacity: 0; }
        .slide-in-from-right { animation: slideInRight 0.35s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
        .slide-in-from-left { animation: slideInLeft 0.35s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }

        @keyframes slideInRight {
            from { transform: translateX(50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideInLeft {
            from { transform: translateX(-50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .hero-card {
            position: relative; height: 280px; border-radius: 4px; overflow: hidden; margin-bottom: 20px;
            box-shadow: var(--shadow-soft);
        }
        .hero-img { width: 100%; height: 100%; object-fit: cover; transition: transform 10s ease; }
        .hero-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%; padding: 25px;
            background: linear-gradient(to top, rgba(28,37,65,0.9), transparent); color: white;
        }
        .hero-title { font-size: 1.6rem; margin: 0; line-height: 1.3; font-weight: 500; color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }

        .timeline-block { position: relative; padding-left: 20px; border-left: 1px solid var(--line-light); margin-left: 10px; }
        .event-node { position: relative; opacity: 0; transform: translateY(20px); transition: 0.6s ease; margin-bottom: 35px; }
        .event-node.visible { opacity: 1; transform: translateY(0); }
        
        .time-dot { 
            position: absolute; left: -25px; top: 0; width: 9px; height: 9px; 
            background: var(--bg-body); border: 2px solid var(--accent-main); border-radius: 50%; 
        }
        .event-card {
            background: var(--bg-card); padding: 20px; border-radius: 4px;
            box-shadow: var(--shadow-soft); cursor: pointer; transition: 0.3s;
            border-bottom: 2px solid transparent;
        }
        .event-card:active { transform: scale(0.98); }
        .event-tag { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 2px; color: var(--text-secondary); margin-bottom: 8px; display: block; }
        .event-title { font-family: var(--font-serif); font-size: 1.25rem; margin-bottom: 6px; color: var(--accent-main); font-weight: 700; }
        
        .transport-card {
            background: #F0F4F8;
            border-left: 3px solid #4A5672;
            position: relative;
            box-shadow: 0 4px 15px -5px rgba(0,0,0,0.1); 
            padding: 20px 30px;
            margin-left: 10px; /* ç¸®æ’æ•ˆæœ */
        }
        .transport-card::before, .transport-card::after {
            content: ''; position: absolute; top: 50%;
            width: 24px; height: 24px; background: var(--bg-body);
            border-radius: 50%; transform: translateY(-50%); z-index: 2; 
            box-shadow: var(--shadow-soft);
        }
        .transport-card::before { left: -12px; }
        .transport-card::after { right: -12px; }

        .alert-banner {
            background: rgba(217, 51, 63, 0.08); border-left: 3px solid var(--accent-red);
            padding: 15px; margin-bottom: 20px; border-radius: 0 4px 4px 0;
            display: flex; gap: 12px; align-items: flex-start;
        }
        .alert-highlight { color: var(--accent-red); font-weight: 700; display: block; margin-top: 4px; font-size: 0.85rem;}

        /* --- ACTIVE EVENT GLOW EFFECT --- */
        @keyframes breathing {
            0% { box-shadow: 0 0 5px rgba(180, 155, 103, 0.2); border-color: rgba(180, 155, 103, 0.4); }
            50% { box-shadow: 0 0 20px rgba(180, 155, 103, 0.6); border-color: rgba(180, 155, 103, 1); }
            100% { box-shadow: 0 0 5px rgba(180, 155, 103, 0.2); border-color: rgba(180, 155, 103, 0.4); }
        }
        .active-event .event-card {
            border: 1px solid var(--accent-gold);
            animation: breathing 3s infinite ease-in-out;
            background: rgba(255, 255, 255, 0.95);
            transform: scale(1.02);
        }
        .active-event .time-dot {
            background: var(--accent-gold);
            border-color: var(--accent-gold);
            box-shadow: 0 0 10px var(--accent-gold);
        }
        .active-label {
            display: inline-block; background: var(--accent-gold); color: white;
            font-size: 0.6rem; padding: 2px 6px; border-radius: 4px; margin-left: 8px;
            vertical-align: middle; letter-spacing: 1px;
        }

        /* --- WALLET VIEW --- */
        .wallet-card { background: white; padding: 25px; border-radius: 8px; box-shadow: var(--shadow-soft); margin-bottom: 20px; }
        .rate-badge { background: #E8F5E9; color: #2E7D32; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; display: inline-block; margin-bottom: 10px; font-weight: bold; }
        .input-elegant { width: 100%; border: none; border-bottom: 1px solid var(--line-light); padding: 15px 0; font-size: 1.1rem; background: transparent; outline: none; border-radius: 0; }
        .twd-preview { font-size: 0.9rem; color: var(--accent-gold); margin-top: 5px; text-align: right; font-weight: 500;}
        
        .user-selector { display: flex; gap: 10px; margin-bottom: 20px; }
        .user-btn { flex: 1; padding: 10px; border: 1px solid var(--line-light); border-radius: 4px; background: transparent; color: var(--text-secondary); cursor: pointer; transition: 0.2s; font-family: var(--font-serif); font-size: 1rem; }
        .user-btn.active { background: var(--accent-main); color: white; border-color: var(--accent-main); }
        
        /* EXPENSE DASHBOARD */
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 25px; }
        .dashboard-item { 
            background: white; padding: 15px 5px; border-radius: 8px; text-align: center; 
            border: 1px solid #EEE; cursor: pointer; transition: 0.3s; 
        }
        .dashboard-item.active { border-color: var(--accent-gold); background: #FFF9F0; }
        .dash-avatar { width: 32px; height: 32px; background: var(--accent-main); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 8px; font-size: 0.8rem; }
        .dash-total { font-family: var(--font-serif); font-size: 1.1rem; color: var(--accent-main); font-weight: bold; }
        .dash-label { font-size: 0.7rem; color: #999; margin-top: 2px; }

        .expense-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #EEE; align-items: center; }
        .exp-user { width: 30px; height: 30px; border-radius: 50%; background: var(--accent-main); color: white; display: flex; justify-content: center; align-items: center; font-size: 0.7rem; margin-right: 10px; }
        .exp-meta { display: flex; align-items: center; }
        
        /* WIDGET TABS */
        .widget-tabs { display: flex; background: #EEE; border-radius: 20px; padding: 4px; margin-bottom: 15px; }
        .w-tab { flex: 1; text-align: center; padding: 8px 0; font-size: 0.85rem; color: #666; border-radius: 16px; cursor: pointer; transition: 0.3s; user-select: none; }
        .w-tab.active { background: white; color: var(--accent-main); font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        /* CURRENCY CONVERTER */
        #currency-converter { background: #F0F4F8; padding: 12px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #E0E0E0; display: flex; align-items: center; justify-content: space-between; gap: 10px; }
        .conv-col { flex: 1; display: flex; flex-direction: column; align-items: center; }
        .conv-input { border: none; border-bottom: 1px solid var(--accent-gold); background: transparent; font-size: 1.1rem; font-family: var(--font-serif); text-align: center; padding: 4px 0; width: 100%; color: var(--accent-main); outline: none; }
        .conv-label { font-size: 0.7rem; color: #888; margin-top: 4px; font-weight: 600; }

        /* TO-DO LIST */
        #todo-widget { background: #FFF; border: 1px solid #EEE; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        .todo-input-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .todo-input { flex: 1; border: none; border-bottom: 1px solid #DDD; padding: 8px; font-size: 0.95rem; outline: none; }
        .todo-add-btn { background: var(--accent-main); color: white; border: none; border-radius: 4px; width: 36px; height: 36px; cursor: pointer; }
        .todo-list { list-style: none; padding: 0; margin: 0; }
        .todo-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #F5F5F5; }
        .todo-check { margin-right: 12px; cursor: pointer; color: #DDD; font-size: 1.2rem; }
        .todo-check.checked { color: var(--accent-gold); }
        .todo-text { flex: 1; font-size: 0.95rem; color: #333; }
        .todo-text.checked { text-decoration: line-through; color: #AAA; }
        .todo-del { color: #DDD; cursor: pointer; padding: 5px; }
        .todo-del:hover { color: var(--accent-red); }

        /* --- OTHER VIEWS --- */
        .trans-input-area { background: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow-soft); margin-bottom: 30px; }
        .trans-btn { width: 100%; padding: 15px; background: var(--accent-main); color: white; border: none; margin-top: 15px; cursor: pointer; border-radius: 4px; }
        .ps-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .ps-card { background: white; padding: 20px 15px; border-radius: 8px; box-shadow: var(--shadow-soft); text-align: center; border: 1px solid #EEE; cursor: pointer; transition: 0.2s; }
        .ps-icon { font-size: 1.8rem; margin-bottom: 10px; display: block; }

        .info-card { background: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow-soft); margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; }
        .info-icon { width: 40px; height: 40px; border-radius: 50%; background: #F5F5F5; display: flex; justify-content: center; align-items: center; color: var(--accent-main); margin-right: 15px; }
        .map-overview-card { background: white; padding: 15px; border-radius: 8px; box-shadow: var(--shadow-soft); margin-bottom: 30px; }
        .map-iframe { width: 100%; height: 350px; border: none; border-radius: 4px; }
        .loading-overlay { 
            position: absolute; top: 0; left: 0; right: 0; bottom: 0; 
            background: rgba(255, 255, 255, 0.8); z-index: 50; 
            display: flex; justify-content: center; align-items: center; 
            font-size: 1.2rem; color: var(--accent-main);
        }

        /* --- NAV BAR --- */
        .glass-nav {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: auto; min-width: 280px;
            background: rgba(28, 37, 65, 0.95); backdrop-filter: blur(10px);
            border-radius: 50px; padding: 10px 30px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1000; gap: 25px;
        }
        .nav-btn { color: rgba(255,255,255,0.4); font-size: 1.4rem; cursor: pointer; transition: 0.3s; position: relative; padding: 10px; display: flex; justify-content: center; align-items: center; }
        .nav-btn.active { color: var(--accent-gold); transform: translateY(-2px); }
        .nav-btn.active::after { content: ''; position: absolute; bottom: 0; width: 4px; height: 4px; background: var(--accent-gold); border-radius: 50%; }

        /* --- MODALS --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1900; opacity: 0; pointer-events: none; transition: 0.3s; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-full {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 90vh;
            background: var(--bg-body); z-index: 2000; border-radius: 20px 20px 0 0;
            transform: translateY(100%); transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            overflow-y: auto; padding-bottom: 40px;
        }
        .modal-full.active { transform: translateY(0); }
        .modal-header-img { height: 250px; width: 100%; object-fit: cover; }
        .modal-content { padding: 0 20px; }
        
        .note-edit-area { width: 100%; padding: 10px; border: 1px solid var(--accent-gold); border-radius: 4px; font-family: var(--font-sans); margin-bottom: 10px; font-size: 1rem; line-height: 1.5; }
        .note-save-btn { background: var(--accent-gold); color: white; border: none; padding: 8px 20px; border-radius: 4px; cursor: pointer; font-size: 0.9rem; }
        .snowflake-icon { color: #B49B67; font-size: 1.1rem; cursor: pointer; margin-left: 10px; transition: transform 0.3s; display: inline-block; }
        .snowflake-icon:hover { transform: rotate(45deg); }

        #fs-text-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 2100; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 40px; text-align: center; transform: scale(0.9); opacity: 0; pointer-events: none; transition: 0.3s; }
        #fs-text-modal.active { transform: scale(1); opacity: 1; pointer-events: auto; }
        .fs-jp { font-size: 2.5rem; font-weight: 700; margin-bottom: 20px; line-height: 1.4; color: var(--text-primary); }
        .fs-cn { font-size: 1.2rem; color: #666; background: #F5F5F5; padding: 10px 20px; border-radius: 20px; }
    </style>
</head>
<body>

    <!-- Intro -->
    <div id="intro-screen">
        <!-- é›ªèŠ±èƒŒæ™¯å®¹å™¨ (JS ç”Ÿæˆ) -->
        <div id="snow-container"></div>

        <div class="intro-text">
            <!-- 1. ä¸­å¤®æµ®å‹•çš„é›ªèŠ±åœ–æ¨™ -->
            <i class="fa-solid fa-snowflake intro-main-icon"></i>
            
            <!-- 2. å€’æ•¸å€åŸŸ -->
            <div class="intro-countdown-block">
                <div class="countdown-value" id="days-left">--</div>
                <div class="countdown-label">DAYS TO DEPARTURE</div>
            </div>

            <div class="intro-title">æ—æªèˆ‡ç™½é›ªä¹‹æ—…</div>
            <div class="intro-subtitle">Hokkaido & Aomori Winter Adventure</div>
            
            <div id="dynamic-intro-text"></div> 
            <button class="intro-btn" onclick="window.enterApp()">é–‹å§‹æ—…ç¨‹</button>
        </div>
    </div>

    <!-- Main App -->
    <div id="app-container">
        
        <div class="elegant-header">
            <div class="top-meta">
                <div class="brand">L'VOYAGE</div>
                <div style="text-align: right;">
                    <div class="status-value" id="header-days">--</div>
                    <div class="status-label">DAYS TO GO</div>
                </div>
            </div>
            <div class="date-scroller" id="date-nav">
                <!-- JS Generated -->
            </div>
        </div>

        <!-- 1. TRIP VIEW -->
        <div id="view-trip" class="view-section">
            <div class="container" id="timeline-container">
                <!-- JS Generated -->
            </div>
        </div>

        <!-- 2. WALLET VIEW -->
        <div id="view-wallet" class="view-section hidden" style="position:relative;">
            <div class="container">
                <!-- 1. Summary Section -->
                <div class="wallet-card" style="text-align: center; background: #1C2541; color: white; margin-bottom: 15px;">
                    <div style="font-size: 0.8rem; color: #AAA; letter-spacing: 1px; margin-bottom: 5px;">ESTIMATED TOTAL</div>
                    <div class="serif" style="font-size: 2.5rem; color: #B49B67;" id="total-jpy">Â¥0</div>
                    <div style="color: #EEE; font-size: 0.9rem;">â‰ˆ TWD <span id="total-twd">0</span></div>
                </div>

                <!-- 2. Filter/Dashboard Section -->
                <div class="dashboard-grid">
                    <div class="dashboard-item" onclick="window.filterExpenses('YK')">
                        <div class="dash-avatar">YK</div>
                        <div class="dash-total" id="dash-yk">Â¥0</div>
                        <div class="dash-label">Total</div>
                    </div>
                    <div class="dashboard-item" onclick="window.filterExpenses('YY')">
                        <div class="dash-avatar">YY</div>
                        <div class="dash-total" id="dash-yy">Â¥0</div>
                        <div class="dash-label">Total</div>
                    </div>
                    <div class="dashboard-item" onclick="window.filterExpenses('YS')">
                        <div class="dash-avatar">YS</div>
                        <div class="dash-total" id="dash-ys">Â¥0</div>
                        <div class="dash-label">Total</div>
                    </div>
                </div>
                <!-- Reset Filter Button (Hidden by default) -->
                <div id="reset-filter-btn" class="hidden" style="text-align: center; margin-bottom: 15px;">
                    <button onclick="window.filterExpenses(null)" style="background: #EEE; border:none; padding: 5px 15px; border-radius: 20px; color: #666; font-size: 0.8rem;">
                        <i class="fa-solid fa-times"></i> æ¸…é™¤ç¯©é¸ (é¡¯ç¤ºå…¨éƒ¨)
                    </button>
                </div>

                <!-- 3. Tools/Widgets Section (Separated) -->
                <div class="wallet-card" style="padding-top: 15px; padding-bottom: 15px;">
                    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;">
                        <h3 class="serif" style="margin:0; font-size:1.1rem; color:var(--accent-main);">æ—…è¡Œå·¥å…· Tools</h3>
                        <!-- Widget Tabs Inline -->
                        <div class="widget-tabs" style="margin:0; width: 60%; background: #F5F5F5;">
                            <div class="w-tab active" id="tab-converter" onclick="window.switchWidget('converter')" style="font-size:0.75rem; padding: 4px 0;">åŒ¯ç‡</div>
                            <div class="w-tab" id="tab-todo" onclick="window.switchWidget('todo')" style="font-size:0.75rem; padding: 4px 0;">å¾…è¾¦</div>
                        </div>
                    </div>

                    <!-- Widget 1: Converter -->
                    <div id="currency-converter">
                        <div class="conv-col">
                            <input type="tel" id="calc-jpy" class="conv-input" placeholder="0" oninput="window.calcFromJpy(this.value)">
                            <div class="conv-label">JPY Â¥</div>
                        </div>
                        <i class="fa-solid fa-arrow-right-arrow-left conv-icon"></i>
                        <div class="conv-col">
                            <input type="tel" id="calc-twd" class="conv-input" placeholder="0" oninput="window.calcFromTwd(this.value)">
                            <div class="conv-label">TWD $</div>
                        </div>
                    </div>
                    <!-- Current Rate Display -->
                    <div class="rate-badge" style="width:100%; text-align:center; margin-top:5px; margin-bottom: 0;">å³æ™‚åŒ¯ç‡: <span id="current-rate">Loading...</span></div>

                    <!-- Widget 2: To-Do List -->
                    <div id="todo-widget" class="hidden">
                        <div class="todo-input-row">
                            <input type="text" id="new-todo-text" class="todo-input" placeholder="æ–°å¢å¾…è¾¦ (ä¾‹å¦‚: è²·è˜‹æœæ´¾)...">
                            <button class="todo-add-btn" onclick="window.addTodo()"><i class="fa-solid fa-plus"></i></button>
                        </div>
                        <ul id="todo-list-ul" class="todo-list">
                            <!-- JS Generated -->
                        </ul>
                    </div>
                </div>

                <!-- 4. Add Expense Section (Separated) -->
                <div class="wallet-card">
                    <h3 class="serif" style="margin:0 0 15px 0; font-size:1.1rem; color:var(--accent-main);">æ–°å¢æ”¯å‡º Add Expense</h3>
                    
                    <div class="user-selector">
                        <button class="user-btn active" onclick="window.selectUser('YK', this)">YK</button>
                        <button class="user-btn" onclick="window.selectUser('YY', this)">YY</button>
                        <button class="user-btn" onclick="window.selectUser('YS', this)">YS</button>
                    </div>

                    <div class="input-group">
                        <input type="text" id="ex-item" class="input-elegant" placeholder="é …ç›® (ä¾‹å¦‚ï¼šè˜‹æœæ´¾)">
                    </div>
                    <div class="input-group">
                        <input type="tel" id="ex-price" class="input-elegant" placeholder="é‡‘é¡ (æ—¥å¹£)" oninput="window.calculatePreview(this.value)">
                        <div class="twd-preview" id="preview-twd">â‰ˆ TWD 0</div>
                    </div>
                    
                    <button class="intro-btn" style="width: 100%; margin-top: 20px; border-color: #1C2541; background: #1C2541; color: white; opacity:1; animation:none;" onclick="window.addExpense()">è¨˜éŒ„æ”¯å‡º</button>
                </div>
                
                <!-- 5. History Section -->
                <h3 class="serif" style="padding-left: 10px; margin-bottom: 15px;">è¿‘æœŸæ”¯å‡º History</h3>
                <div id="expense-list">
                    <!-- Loading state for expenses -->
                    <div class="loading-overlay" style="position: static; margin-top: 20px; min-height: 100px;">
                        <i class="fa-solid fa-spinner fa-spin" style="margin-right: 10px;"></i> æ­£åœ¨è¼‰å…¥æ”¯å‡º...
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. TRANSLATE VIEW -->
        <div id="view-trans" class="view-section hidden">
            <div class="container">
                <div class="trans-input-area">
                    <h3 class="serif" style="margin-top:0;">å³æ™‚ç¿»è­¯</h3>
                    <textarea id="trans-input" class="input-elegant" rows="3" placeholder="è¼¸å…¥ä¸­æ–‡... (ä¾‹å¦‚ï¼šè«‹å•é€™å€‹å¤šå°‘éŒ¢ï¼Ÿ)" style="border: 1px solid #EEE; padding: 10px;"></textarea>
                    <button class="trans-btn" onclick="window.translateNow()">
                        <i class="fa-solid fa-language"></i> ç¿»è­¯æˆæ—¥æ–‡
                    </button>
                    <div id="trans-output-box" class="wallet-card hidden" style="margin-top: 15px; border-left: 3px solid var(--accent-gold);">
                        <div style="font-size: 0.75rem; color: #999;">ä¸­æ–‡åŸæ–‡: <span id="trans-zh"></span></div>
                        <div class="serif" style="font-size: 1.5rem; color: var(--accent-main); margin-top: 5px;" id="trans-jp-result"></div>
                        <button onclick="window.showFs(document.getElementById('trans-jp-result').innerText, document.getElementById('trans-zh').innerText)" class="trans-btn" style="background: var(--accent-gold); margin-top: 10px; padding: 8px; font-size: 0.9rem;">
                            <i class="fa-solid fa-expand"></i> å…¨è¢å¹•å­—å¡
                        </button>
                    </div>
                </div>

                <h3 class="serif" style="margin: 30px 0 15px;">æŒ‡å·®ç¢ºèª</h3>
                <div class="ps-grid">
                    <div class="ps-card warning" onclick="window.showFs('ç§ã¯ç‰›è‚‰ã¨è±šè‚‰ã¨ç¾Šè‚‰ãŒé£Ÿã¹ã‚‰ã‚Œã¾ã›ã‚“ã€‚', 'æˆ‘ä¸åƒç‰›ã€è±¬ã€ç¾Šè‚‰')">
                        <span class="ps-icon">ğŸ¥©</span>
                        <div class="ps-title">ä¸åƒç´…è‚‰</div>
                    </div>
                    <div class="ps-card" onclick="window.showFs('ã‚¹ãƒ¼ãƒ—ã«ç‰›ã‚„è±šã®ã‚¨ã‚­ã‚¹ã¯å…¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ', 'æ¹¯é ­å«è‚‰å—ï¼Ÿ')">
                        <span class="ps-icon">ğŸœ</span>
                        <div class="ps-title">æ¹¯é ­ç¢ºèª</div>
                    </div>
                    <div class="ps-card" onclick="window.showFs('ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚', 'éº»ç…©çµå¸³')">
                        <span class="ps-icon">ğŸ’³</span>
                        <div class="ps-title">çµå¸³</div>
                    </div>
                    <div class="ps-card" onclick="window.showFs('ã“ã‚Œã‚’ãã ã•ã„ã€‚', 'æˆ‘è¦é€™å€‹')">
                        <span class="ps-icon">ğŸ‘‰</span>
                        <div class="ps-title">æˆ‘è¦é€™å€‹</div>
                    </div>
                    <div class="ps-card" onclick="window.showFs('ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', 'å»æ‰€åœ¨å“ªï¼Ÿ')">
                        <span class="ps-icon">ğŸš»</span>
                        <div class="ps-title">æ‰¾å»æ‰€</div>
                    </div>
                    <div class="ps-card danger" onclick="window.showFs('åŠ©ã‘ã¦ãã ã•ã„ï¼', 'æ•‘å‘½ï¼')">
                        <span class="ps-icon">ğŸ†˜</span>
                        <div class="ps-title">ç·Šæ€¥æ±‚æ•‘</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. INFO VIEW -->
        <div id="view-info" class="view-section hidden">
            <div class="container">
                
                <div class="map-overview-card" style="margin-top: 20px;">
                    <h2 class="serif" style="margin-top: 0; color: var(--accent-main); font-size: 1.3rem;">æ—…è¡Œç¸½è¦½åœ°åœ–</h2>
                    <p style="color: #666; font-size: 0.9rem; margin-bottom: 10px;">ç¯„åœï¼šå…«æˆ¶ã€é’æ£®ã€å‡½é¤¨ã€å¼˜å‰</p>
                    <iframe id="trip-map-overview-iframe" 
                            class="map-iframe"
                            allowfullscreen="" 
                            loading="lazy" 
                            referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>

                <div class="wallet-card">
                    <h2 class="serif" style="margin-top: 0; color: var(--accent-main);">é‡è¦è³‡è¨Šå½™æ•´</h2>
                    <p style="color: #666; font-size: 0.9rem;">ç·Šæ€¥æ™‚åˆ»èˆ‡é€šé—œå¿…å‚™</p>
                </div>

                <div class="info-card" onclick="window.open('https://vjw-lp.digital.go.jp/zh-hant/', '_blank')">
                    <div style="display:flex; align-items:center;">
                        <div class="info-icon" style="background: #FFF3E0; color: #E65100;"><i class="fa-solid fa-passport"></i></div>
                        <div class="info-text">
                            <h3>Visit Japan Web</h3>
                            <p>å…¥å¢ƒå¯©æŸ¥ & æµ·é—œç”³å ± QR Code</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-chevron-right" style="color:#CCC;"></i>
                </div>

                <div class="info-card" onclick="window.location.href='tel:110'">
                    <div style="display:flex; align-items:center;">
                        <div class="info-icon" style="background: #FFEBEE; color: #D32F2F;"><i class="fa-solid fa-shield-halved"></i></div>
                        <div class="info-text">
                            <h3>æ—¥æœ¬å ±è­¦ 110</h3>
                            <p>é‡åˆ°äº‹æ•…æˆ–çŠ¯ç½ªæ™‚</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-phone" style="color:var(--accent-red);"></i>
                </div>

                <div class="info-card" onclick="window.location.href='tel:119'">
                    <div style="display:flex; align-items:center;">
                        <div class="info-icon" style="background: #FFEBEE; color: #D32F2F;"><i class="fa-solid fa-truck-medical"></i></div>
                        <div class="info-text">
                            <h3>ç«è­¦/æ•‘è­·è»Š 119</h3>
                            <p>æ€¥ç—…æˆ–å—å‚·æ™‚</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-phone" style="color:var(--accent-red);"></i>
                </div>

                <div class="info-card" onclick="window.location.href='tel:+81-11-222-2930'">
                    <div style="display:flex; align-items:center;">
                        <div class="info-icon" style="background: #E3F2FD; color: #1565C0;"><i class="fa-solid fa-building-flag"></i></div>
                        <div class="info-text">
                            <h3>é§æ—¥ä»£è¡¨è™• (æœ­å¹Œåˆ†è™•)</h3>
                            <p>åŒ—æµ·é“/é’æ£®ç·Šæ€¥è¯çµ¡: +81-11-222-2930</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-phone" style="color:#1565C0);"></i>
                </div>
            </div>
        </div>

    </div>

    <!-- Nav Bar -->
    <div class="glass-nav">
        <div class="nav-btn active" onclick="window.switchView('trip', this)">
            <i class="fa-solid fa-map-location-dot"></i>
        </div>
        <div class="nav-btn" onclick="window.switchView('wallet', this)">
            <i class="fa-solid fa-wallet"></i>
        </div>
        <div class="nav-btn" onclick="window.switchView('trans', this)">
            <i class="fa-solid fa-comments"></i>
        </div>
        <div class="nav-btn" onclick="window.switchView('info', this)">
            <i class="fa-solid fa-circle-info"></i>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal-overlay" onclick="window.closeModal()"></div>
    <div class="modal-full" id="detail-modal">
        <div style="position: sticky; top: 0; padding: 10px; text-align: right; z-index: 10;">
            <button onclick="window.closeModal()" style="background: white; border: none; width: 36px; height: 36px; border-radius: 50%; box-shadow: 0 2px 10px rgba(0,0,0,0.1); color: #333;"><i class="fa-solid fa-times"></i></button>
        </div>
        <img src="" id="m-img" class="modal-header-img" onerror="this.onerror=null; this.src='https://placehold.co/800x600?text=No+Image';">
        <div class="modal-content">
            <span id="m-tag" style="font-size: 0.7rem; letter-spacing: 2px; color: var(--accent-gold); text-transform: uppercase;">TAG</span>
            <h2 id="m-title" class="serif" style="font-size: 1.8rem; margin: 5px 0 20px 0; line-height: 1.2;">Title</h2>
            
            <div id="m-map-section" style="background: #F0F4F8; padding: 15px; border-radius: 8px; margin-top: 20px; display: flex; justify-content: space-between; align-items: center;" class="hidden">
                <div>
                    <div style="font-size: 0.7rem; color: #666; letter-spacing: 1px;">NAVIGATE (MAPCODE)</div>
                    <div id="m-mapcode" style="font-family: monospace; font-size: 1.2rem; font-weight: 700; color: var(--accent-main);">--</div>
                </div>
                <button onclick="window.copyMapCode()" style="background: var(--accent-main); color: white; border: none; padding: 8px 15px; border-radius: 4px;">è¤‡è£½</button>
            </div>
            
            <div id="m-gmap-preview" class="hidden" style="margin-top: 20px; text-align: center;">
                <iframe id="m-gmap-iframe" class="map-iframe" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                <div style="display: flex; gap: 10px; justify-content: center; margin-top: 10px;">
                    <button onclick="window.openExternalMap()" style="background: #333; color: white; padding: 8px 15px; border-radius: 4px; border: none; cursor: pointer;">
                        <i class="fa-solid fa-map-location-dot"></i> Google åœ°åœ–é–‹å•Ÿ
                    </button>
                    <button id="btn-navigate" class="hidden" onclick="window.openNavigation()" style="background: #4285F4; color: white; padding: 8px 15px; border-radius: 4px; border: none; cursor: pointer;">
                        <i class="fa-solid fa-diamond-turn-right"></i> é–‹å§‹å°èˆª
                    </button>
                </div>
            </div>

            <div id="m-detail-info" class="hidden info-group">
                <h3 class="serif" style="font-size: 1.2rem; margin-bottom: 15px; color: var(--accent-main);">é è¨‚ / äº¤é€šè³‡è¨Š</h3>
            </div>

            <!-- å°éŠç­†è¨˜å€å¡Š -->
            <div style="margin-top: 25px;">
                <div style="display:flex; align-items:center; margin-bottom: 10px; border-bottom: 1px solid #EEE; padding-bottom: 5px;">
                    <h3 class="serif" style="font-size: 1.2rem; margin: 0; color: var(--accent-main);">å°éŠç­†è¨˜ / Local Insight</h3>
                    <!-- é›ªèŠ±ç·¨è¼¯æŒ‰éˆ• -->
                    <i class="fa-regular fa-snowflake snowflake-icon" onclick="window.toggleEditNote()"></i>
                </div>
                
                <!-- é¡¯ç¤ºå€åŸŸ (Updated to allow HTML) -->
                <div id="m-desc" style="font-size: 1rem; line-height: 1.8; color: #555; white-space: pre-wrap; display: block;">Description</div>
                
                <!-- ç·¨è¼¯å€åŸŸ (é è¨­éš±è—) -->
                <div id="m-note-edit" class="hidden">
                    <textarea id="m-note-input" class="note-edit-area" rows="6"></textarea>
                    <div style="text-align: right;">
                        <button class="note-save-btn" onclick="window.saveNote()">å„²å­˜ç­†è¨˜</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Full Screen Text Modal -->
    <div id="fs-text-modal" onclick="window.closeFs()">
        <div class="fs-jp" id="fs-jp">--</div>
        <div class="fs-cn" id="fs-cn">--</div>
        <div class="fs-close" style="position: absolute; bottom: 50px; color: #999; font-size: 0.9rem;">é»æ“Šä»»æ„è™•é—œé–‰</div>
    </div>

    <script>
        // NOTE: In a real app, this API key should be securely handled server-side.
        // For this single-file environment, we use a mock key structure.
        const GOOGLE_MAPS_API_KEY = "AIzaSyAX9nvh4bJpiM6-oTm8FoUSZeSBpxZBc1E"; 
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, query, onSnapshot, addDoc, serverTimestamp, setDoc, doc, deleteDoc, updateDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Set log level to debug for firebase errors
        setLogLevel('debug');

        // --- DATA & MESSAGES ---
        const tripData = [
            {
                day: 1, date: "02.02", week: "MON",
                heroTitle: "å‡½é¤¨ï¼šç™¾å…ƒç™¼ç†±è¡£èˆ‡ç™¾è¬å¤œæ™¯",
                heroImg: "https://i.imgur.com/RTJNqwv.jpg", 
                fallbackImg: "https://images.unsplash.com/photo-1542640244-7e67286feb8f?q=80&w=800&auto=format&fit=crop",
                weather: { icon: "fa-spinner fa-spin", temp: "Loading..." },
                events: [
                    { 
                        time: "11:10", title: "æŠµé” å‡½é¤¨æ©Ÿå ´ (HKD)", tag: "Arrival", 
                        desc: "å…¥å¢ƒèˆ‡æº–å‚™ã€‚", 
                        detail: "ã€å°éŠç­†è¨˜ã€‘å‡½é¤¨æ©Ÿå ´é›–å°ï¼Œä½†å†¬å­£é‹ä½œéå¸¸æœ‰ç§©åºã€‚ä¸‹æ©Ÿå¾Œçš„é«”æ„Ÿæº«å·®æœƒè®“æ‚¨ç¬é–“æ¸…é†’ã€‚å…¥å¢ƒå¯©æŸ¥é€šå¸¸å¾ˆå¿«ï¼Œå‡ºé—œå¾Œï¼Œåˆ¥æ€¥è‘—é›¢é–‹ï¼Œæ·±å‘¼å¸ä¸€å£åŒ—åœ‹å†·å†½çš„ç©ºæ°£ï¼Œé€™å°±æ˜¯åŒ—æµ·é“çš„å‘³é“ã€‚", 
                        to: "JR å‡½é¤¨ç«™", 
                        location: "Hakodate Airport, Japan"
                    },
                    { 
                        time: "12:00", title: "æ©Ÿå ´å·´å£« (å¾€ JR å‡½é¤¨ç«™)", tag: "Transport", 
                        desc: "ç§»å‹•è‡³å¸‚å€ã€‚", 
                        detail: "ã€å°éŠç­†è¨˜ã€‘ä¸Šè»Šæ™‚è«‹æ³¨æ„ï¼Œæ—¥æœ¬å·´å£«æ˜¯ã€Œå¾Œé–€ä¸Šè»Šã€å‰é–€ä¸‹è»Šã€ã€‚æ²¿é€”æ‚¨æœƒçœ‹åˆ°è‘—åçš„ã€Œæ¹¯ä¹‹å·æº«æ³‰ã€å€ï¼Œè‹¥çœ‹åˆ°æµ·é‚Šæœ‰å†’ç…™çš„æ™¯è±¡ï¼Œé‚£å°±æ˜¯æº«æ³‰æµé€²æµ·è£¡çš„è­‰æ˜ã€‚",
                        navLink: "https://maps.app.goo.gl/SgEccLta3MTxhD4d9?g_st=ac",
                        from: "Hakodate Airport",
                        to: "JR Inn Hakodate", 
                        transport_info: {type: "æ©Ÿå ´å·´å£«", departure: "12:00"} 
                    },
                    { 
                        time: "12:30", title: "JR Inn Hakodate (å¯„æ”¾)", tag: "Hotel", 
                        desc: "å¯„æ”¾è¡Œæã€‚", 
                        detail: "ã€å°éŠç­†è¨˜ã€‘é¸æ“‡é€™é–“é£¯åº—æ˜¯çµ•å°æ­£ç¢ºçš„æˆ°ç•¥ï¼å®ƒèˆ‡è»Šç«™ç›´çµï¼Œä¸ç”¨æ‹–è‘—è¡Œæåœ¨é›ªåœ°è£¡æ™æ‰ã€‚å¯„æ”¾è¡Œææ™‚ï¼Œè«‹é †ä¾¿ç¢ºèªä¸€ä¸‹å¤§å»³æä¾›çš„ã€Œæ•é ­æŒ‘é¸å€ã€ï¼Œæ™šä¸Šä¸‹æ‰‹å¤ªæ…¢å°±è¢«æ¶å…‰äº†ã€‚", 
                        location: "JR Inn Hakodate",
                        navLink: "https://maps.app.goo.gl/SgEccLta3MTxhD4d9?g_st=ac",
                        to: "JR Inn Hakodate" 
                    },
                    { 
                        time: "12:50", title: "è¨ˆç¨‹è»Š (è¶•æ™‚é–“é¦–é¸)", tag: "Transport", 
                        desc: "å‰å¾€ UNIQLOã€‚", 
                        detail: "ã€å°éŠç­†è¨˜ã€‘ç‚ºäº†çœä¸‹å¯¶è²´çš„ 30-40 åˆ†é˜ï¼Œé€™ 2,500 æ—¥åœ“çš„è»Šè³‡çµ•å°å€¼å¾—ã€‚å» UNIQLO æ˜­å’Œåº—çš„å·´å£«ç­æ¬¡åœ¨é›¢å³°æ™‚é–“å¾ˆç¨€ç–ã€‚",
                        navLink: "https://maps.app.goo.gl/s85bmZtawnf7EQY26?g_st=ac",
                        from: "JR Inn Hakodate",
                        to: "UNIQLO å‡½é¤¨æ˜­å’Œåº—",
                        transport_info: { type: "è¨ˆç¨‹è»Š", note: "ç´„2500æ—¥åœ“" } 
                    },
                    { 
                        time: "13:15", title: "ä»»å‹™ 1ï¼šUNIQLO æ˜­å’Œåº—", tag: "Shopping", 
                        desc: "æ¡è³¼ç™¼ç†±è¡£ã€‚", 
                        detail: "ã€å°éŠç­†è¨˜ã€‘é€™æ˜¯åŒ—æµ·é“çš„å¤§å‹è·¯é¢åº—ï¼Œåº«å­˜é€šå¸¸æ¯”å¸‚å€ç™¾è²¨åº—é½Šå…¨ã€‚å‹™å¿…å…¥æ‰‹ã€Œè¶…æ¥µæš– (Ultra Warm)ã€ç³»åˆ—çš„ç™¼ç†±è¡£èˆ‡ç™¼ç†±è¤²ï¼Œé€™æ˜¯ç‚ºäº†å…¨ä¸–ç•Œé™é›ªé‡æœ€å¤§çš„é’æ£®åšåšçš„å¿…è¦æº–å‚™ã€‚", 
                        navLink: "https://maps.app.goo.gl/sDqtgs3kxsz7nGKU9",
                        location: "UNIQLO Hakodate Showa"
                    },
                    {
                        time: "14:45", title: "è¨ˆç¨‹è»Š (è¿”å›é£¯åº—å¸è²¨)", tag: "Transport",
                        desc: "å› JR Innã€‚",
                        detail: "ã€å°éŠç­†è¨˜ã€‘æ—¢ç„¶è²·äº†å¾ˆå¤šï¼Œæˆ‘å€‘ç›´æ¥æ­è»Šå› JR Innã€‚æŠŠæˆ°åˆ©å“ä¸Ÿå›æˆ¿é–“ï¼ˆæˆ–æ«ƒå°ï¼‰ï¼Œä¸€èº«è¼•ä¾¿å†å‡ºé–€ã€‚é£¯åº—é–€å£æ’ç­è¨ˆç¨‹è»Šå¤šï¼Œå°æ¥ä¸‹ä¾†çš„è¡Œç¨‹æ›´æ–¹ä¾¿ã€‚",
                        transport_info: { type: "è¨ˆç¨‹è»Š", note: "è¿”å›é£¯åº—" },
                        from: "UNIQLO å‡½é¤¨æ˜­å’Œåº—",
                        to: "JR Inn Hakodate"
                    },
                    {
                        time: "15:15", title: "é£¯åº—å¸è²¨ & ç¨ä½œæ•´è£", tag: "Hotel",
                        desc: "å¿«é€Ÿæ•´è£ã€‚",
                        detail: "ã€å°éŠæé†’ã€‘å‹•ä½œè¦å¿«ï¼Œæ”¾å¥½æ±è¥¿ã€ä¸Šå€‹å»æ‰€ï¼Œ15:30 æº–æ™‚å‡ºç™¼ï¼Œæ‰è¶•å¾—ä¸Šå¤œæ™¯çš„æœ€ä½³å¡ä½æ™‚é–“ã€‚",
                        location: "JR Inn Hakodate"
                    },
                    {
                        time: "15:30", title: "è¨ˆç¨‹è»Š (å‰å¾€çºœè»Šç«™)", tag: "Transport",
                        desc: "JR å‡½é¤¨ç«™ -> çºœè»Šå±±éº“ç«™ã€‚",
                        detail: "ã€è¡Œç¨‹ã€‘ç´„ 10-15 åˆ†é˜è»Šç¨‹ã€‚",
                        transport_info: { type: "è¨ˆç¨‹è»Š", note: "å¾€çºœè»Šç«™" },
                        from: "JR Inn Hakodate",
                        to: "Hakodate Ropeway"
                    },
                    { 
                        time: "16:00", title: "å‡½é¤¨å±±ç™¾è¬å¤œæ™¯", tag: "Sightseeing", 
                        desc: "æ—¥è½ Blue Hourã€‚", 
                        detail: "ã€å°éŠç­†è¨˜ã€‘å†¬å¤©çš„æ—¥è½ç´„åœ¨ 16:50ã€‚ä¸€å®šè¦å¾…åˆ°æ—¥è½å¾Œ 20-30 åˆ†é˜ï¼Œé€™æ™‚å¤©ç©ºå‘ˆç¾æ·±è—è‰² (Blue Hour)ã€‚è¨˜å¾—å¸¶æš–æš–åŒ…è²¼åœ¨æ‰‹æ©ŸèƒŒé¢ã€‚<br><br>ã€è€é³¥èªªæ•…äº‹ã€‘<br>å‡½é¤¨å¤œæ™¯è¢«ç¨±ç‚ºã€Œç™¾è¬å¤œæ™¯ã€çš„é—œéµåœ¨æ–¼çµ•ç„¡åƒ…æœ‰çš„ã€Œåœ°ç†å¥‡è¹Ÿã€ã€‚å·¦é‚Šæ˜¯ã€Œæ´¥è¼•æµ·å³½ã€ï¼Œå³é‚Šæ˜¯ã€Œå‡½é¤¨ç£ã€ï¼Œé€™å…©ç‰‡æ¼†é»‘çš„å¤§æµ·å°‡ç™¼å…‰çš„åŸå¸‚å¤¾åœ¨ä¸­é–“ï¼Œå½¢æˆäº†ä¸€å€‹åƒæ˜¯å¥³æ€§çº–ç´°è…°èº«çš„å½¢ç‹€ï¼ˆæ‰‡å½¢æµ·å³½ï¼‰ã€‚å†¬å¤©çš„å¤œæ™¯å› ç‚ºé›ªåœ°åå°„ï¼Œäº®åº¦æå‡äº† 30% ä»¥ä¸Šã€‚", 
                        navLink: "https://maps.app.goo.gl/qcq17CBzd3miW9rM6",
                        location: "Mt. Hakodate Observation Deck",
                        nav: { mapcode: "86 041 028*25" } 
                    },
                    { 
                        time: "17:30", title: "çºœè»Šä¸‹å±± -> å‰å¾€é‡‘æ£®å€‰åº«", tag: "Transport", 
                        desc: "æ­¥è¡Œæˆ–è¨ˆç¨‹è»Šã€‚", 
                        detail: "ã€å°éŠç­†è¨˜ã€‘ä¸‹å±±æ™‚äººæ½®æœƒç¬é–“çˆ†ç™¼ã€‚å¦‚æœçºœè»Šæ’éšŠè¶…é 30 åˆ†é˜ï¼Œä¸”æˆ¶å¤–é¢¨é›ªä¸å¤§ï¼Œå…¶å¯¦å¯ä»¥è€ƒæ…®æ­ä¹˜å·´å£«ä¸‹å±±ã€‚ä¸‹å±±å¾Œï¼Œé‡‘æ£®å€‰åº«å°±åœ¨å±±è…³ä¸‹ä¸é è™•ã€‚", 
                        transport_info: { type: "çºœè»Š/æ­¥è¡Œ" },
                        to: "Kanemori Red Brick Warehouse"
                    },
                    { 
                        time: "18:00", title: "é‡‘æ£®ç´…ç£šå€‰åº«ç¾¤", tag: "Sightseeing", 
                        desc: "æ™šé¤ï¼šå¹¸é‹å°ä¸‘æ¼¢å ¡ã€‚", 
                        detail: "ã€å°éŠç­†è¨˜ã€‘é€™è£¡çš„ç´…ç£šåœ¨ç™½é›ªè¦†è“‹ä¸‹ï¼Œæœ‰ä¸€ç¨®æ­æ´²è–èª•å¸‚é›†çš„æ°›åœã€‚è‘—åçš„ã€Œå¹¸é‹å°ä¸‘æ¼¢å ¡ã€ç¢¼é ­æœ«å»£åº—ï¼Œåº§ä½æ•¸å¤šä¸”æœ‰ç„¡æ•µæµ·æ™¯ã€‚å¼·çƒˆå»ºè­°ç¾åœ¨å°±åƒï¼é»äººæ°£ No.1 çš„ã€Œä¸­è¯é›è…¿æ¼¢å ¡ã€ã€‚", 
                        navLink: "https://maps.app.goo.gl/psd5nq2yRDC5zD3W6",
                        location: "Kanemori Red Brick Warehouse" 
                    },
                    { 
                        time: "18:15", title: "Pastry Snaffle's", tag: "Food", 
                        desc: "é‡‘æ£®æ´‹ç‰©é¤¨åº—ã€‚", 
                        detail: "ã€å°éŠç­†è¨˜ã€‘æŠµé”å€‰åº«å¾Œè«‹å…ˆè¡é€™è£¡ï¼è²·ä¸€é¡†ã€ŒCatch Cake (èµ·å¸æ­å§†è•¾)ã€ï¼Œé€™ä¸æ˜¯æ™®é€šèµ·å¸è›‹ç³•ï¼Œå£æ„Ÿåƒèˆ’èŠ™è•¾èˆ¬å…¥å£å³åŒ–ã€‚ä¸è¦è²·æ•´ç›’ï¼Œç›´æ¥åœ¨æ«ƒå°è²·å–®é¡†ç«™è‘—ç¾åƒï¼Œé€™æ˜¯å‡½é¤¨é™å®šçš„ã€Œé»ƒé‡‘ä¸€å£ã€ã€‚", 
                        location: "Pastry Snaffle's Kanemori"
                    },
                    { 
                        time: "19:30", title: "è¿”å›é£¯åº—", tag: "Transport", 
                        desc: "æ•£æ­¥æˆ–è¨ˆç¨‹è»Šã€‚", 
                        detail: "ã€å°éŠç­†è¨˜ã€‘åƒé£½å¾Œï¼Œæ²¿è‘—æµ·é‚Šæˆ–æ­è»Šå›é£¯åº—ã€‚", 
                        transport_info: { type: "è¨ˆç¨‹è»Š/æ•£æ­¥" },
                        to: "JR Inn Hakodate"
                    },
                    { 
                        time: "20:00", title: "ä¼‘æ¯èˆ‡å¤§æµ´å ´", tag: "Hotel", 
                        desc: "JR Inn Hakodateã€‚",
                        detail: "ã€å°éŠç­†è¨˜ã€‘ç¶“éå¯’é¢¨å¹æ‹‚ï¼Œç¾åœ¨æœ€éœ€è¦çš„æ˜¯ç†±é£Ÿèˆ‡ç†±æ°´ã€‚ç›´å¥”é ‚æ¨“å¤§æµ´å ´ï¼Œé‚£è£¡çš„ä¼‘æ¯å®¤æœ‰ä¸€æ•´é¢çš„è½åœ°çª—å¯ä»¥çœ‹åˆ°åˆ—è»Šé€²å‡ºç«™çš„è»Œé“å¤œæ™¯ï¼Œé…ä¸Šä¸€æ”¯å†°ç‰›å¥¶ï¼Œé€™æ‰æ˜¯å®Œç¾çš„ Endingã€‚", 
                        location: "JR Inn Hakodate" 
                    }
                ]
            },
            {
                day: 2, date: "02.03", week: "TUE",
                heroTitle: "æ–°å¹¹ç·šè·¨æµ·ï¼Œæ‹œè¨ªå¥ˆè‰¯ç¾æ™º",
                heroImg: "https://i.imgur.com/iqO53uS.jpg", 
                fallbackImg: "https://images.unsplash.com/photo-1532236395709-7d70320fec2d?q=80&w=800",
                weather: { icon: "fa-spinner fa-spin", temp: "Loading..." },
                events: [
                    { time: "07:30", title: "å‡½é¤¨æœå¸‚ æ—©é¤", tag: "Food", desc: "é‡£çƒè³Šé«”é©—ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘é›–ç„¶èªªæ˜¯è§€å…‰å®¢è–åœ°ï¼Œä½†ã€Œé‡£çƒè³Šã€é«”é©—çœŸçš„å¾ˆæœ‰è¶£ï¼Œç¾é‡£ç¾æ®ºçš„çƒè³Šè‚‰æ˜¯é€æ˜ä¸”çˆ½è„†çš„ï¼Œå®Œå…¨æ²’æœ‰è…¥å‘³ã€‚", location: "Hakodate Morning Market" },
                    { time: "09:30", title: "æ­¥è¡Œå›é£¯åº—å–è¡Œæ", tag: "Transport", desc: "å‰å¾€è»Šç«™ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘åƒé£½å–è¶³æ•£æ­¥å›é£¯åº—æ‹¿è¡Œæã€‚", from: "Hakodate Morning Market", to: "JR Hakodate Station", transport_info: { type: "æ­¥è¡Œ" } },
                    { 
                        time: "10:00", title: "è·¨æµ·ç§»å‹•ï¼šå‡½é¤¨ -> é’æ£®", tag: "Transport", 
                        desc: "ä¸‰æ®µå¼æ¥åŠ›ã€‚", 
                        detail: "ã€å°éŠç­†è¨˜ã€‘é€™æ˜¯ä»Šå¤©çš„é‡é ­æˆ²ï¼<br>1. å‡½é¤¨ Linerï¼šæ™®é€šé›»è»Šï¼Œæ¶çª—é‚Šä½ç½®çœ‹æœ€å¾Œé¢¨æ™¯ã€‚<br>2. æ–°å¹¹ç·šéš¼è™Ÿï¼šå…¨è»ŠæŒ‡å®šå¸­ï¼é‘½é€²ã€Œé’å‡½éš§é“ã€æ™‚æœƒæœ‰å»£æ’­ï¼Œé€™æ™‚æ‚¨æ­£ä½æ–¼æ·±æµ·ä¹‹ä¸‹ã€‚<br>3. å¥§ç¾½æœ¬ç·šï¼šæŠµé”æ–°é’æ£®å¾Œè½‰ä¹˜åœ¨ä¾†ç·šï¼Œ6åˆ†é˜åˆ°å¸‚å€ã€‚", 
                        transport_info: { type: "JR/æ–°å¹¹ç·š", departure: "10:00", note: "é’å‡½éš§é“" }, 
                        from: "JR Hakodate Station", 
                        to: "JR Aomori Station" 
                    },
                    { time: "12:15", title: "åˆé¤ï¼šé’æ£®ç«™å‘¨é‚Š", tag: "Food", desc: "Osanai é£Ÿå ‚ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘ã€ŒOsanai (ãŠã•ãªã„)ã€æ˜¯é€™è£¡çš„å‚³å¥‡é£Ÿå ‚ï¼Œå¿…é»ã€Œå¸†ç«‹è²å‘³å™Œç‡’ã€ã€‚", location: "Osanai Aomori" },
                    { time: "13:30", title: "è¨ˆç¨‹è»Š (ç›´å¥”ç¾è¡“é¤¨)", tag: "Transport", desc: "å‰å¾€ç¾è¡“é¤¨ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘ä¸å»ºè­°æ­å·´å£«ï¼Œç­è·é•·ã€‚è¨ˆç¨‹è»Šè²»ç´„ 2000 å¤šæ—¥åœ“ã€‚", transport_info: { type: "è¨ˆç¨‹è»Š" }, from: "JR Aomori Station", to: "Aomori Museum of Art" },
                    { 
                        time: "14:00", title: "é’æ£®ç¸£ç«‹ç¾è¡“é¤¨", tag: "Sightseeing", 
                        desc: "å¥ˆè‰¯ç¾æ™ºèˆ‡é’æ£®çŠ¬ã€‚", 
                        detail: "ã€å°éŠç­†è¨˜ã€‘é€™åº§ç¾è¡“é¤¨æœ¬èº«å°±æ˜¯ä¸€ä»¶è—è¡“å“ã€‚ä¸€å®šè¦å»çœ‹å¥ˆè‰¯ç¾æ™ºçš„ã€Œé’æ£®çŠ¬ã€ï¼Œå†¬å¤©æ™‚å·¥ä½œäººå“¡æœƒå¹«å¤§ç‹—æˆ´ä¸Šä¸€é ‚ã€Œé›ªå¸½ã€ï¼<br><br>ã€è€é³¥èªªæ•…äº‹ã€‘<br>ç¾è¡“é¤¨çš„è¨­è¨ˆç†å¿µéå¸¸æ·±å¥§ï¼Œå®ƒæ˜¯ç”±çŸ¥åå»ºç¯‰å¸«é’æœ¨æ·³æ‰€è¨­è¨ˆçš„ã€‚æ•´åº§ç¾è¡“é¤¨ä¸¦ä¸æ˜¯ã€Œè“‹åœ¨åœ°ä¸Šã€ï¼Œè€Œæ˜¯ã€ŒåŸ‹åœ¨åœŸè£¡ã€çš„ï¼ˆéˆæ„Ÿä¾†è‡ªä¸‰å…§ä¸¸å±±éºè·¡çš„å£•æº Trenchï¼‰ã€‚åœ¨é¤¨å…§è¡Œèµ°åƒæ˜¯åœ¨æ¢éšªã€‚é‚£éš»å·¨å¤§çš„ã€Œé’æ£®çŠ¬ã€ä½è‘—é ­ï¼Œåœ¨é›ªåœ°ä¸­é¡¯å¾—ç‰¹åˆ¥å­¤ç¨å»åˆç™‚ç™’ã€‚", 
                        location: "Aomori Museum of Art" 
                    },
                    { time: "16:00", title: "è¨ˆç¨‹è»Š (å‰å¾€ A-FACTORY)", tag: "Transport", desc: "å‰å¾€æ¸¯é‚Šã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘ç›´æ¥è«‹ç¾è¡“é¤¨æ«ƒæª¯å«è»Šå‰å¾€é’æ£®è»Šç«™æ—çš„ A-FACTORYã€‚", transport_info: { type: "è¨ˆç¨‹è»Š" }, from: "Aomori Museum of Art", to: "A-FACTORY" },
                    { 
                        time: "16:30", title: "A-FACTORY (è˜‹æœå·¥å» )", tag: "Shopping", 
                        desc: "Cidre è©¦å–ã€‚", 
                        detail: "ã€å°éŠç­†è¨˜ã€‘å‚æ™šé»ç‡ˆå¾Œçš„æ°£æ°›æ¥µä½³ã€‚é€™è£¡å¯ä»¥æ…¢æ…¢è©¦å–ä¸åŒæ¿ƒåº¦çš„ Cidre (è˜‹æœé…’)ã€‚<br><br>ã€è€é³¥èªªæ•…äº‹ã€‘<br>A-FACTORY æ˜¯é’æ£®è˜‹æœçš„ã€Œæ–‡è—å¾©èˆˆã€ã€‚é€™æ£Ÿåœ¨æµ·é‚Šç™¼å…‰çš„æˆ¿å­ï¼Œä»£è¡¨é’æ£®å¾å–®ç´”çš„ã€Œè¾²æ¥­å¤§ç¸£ã€è¯éº—è½‰èº«ç‚ºã€Œæ™‚å°šå“ç‰Œã€ã€‚ç•¶æ‚¨å–ä¸‹é‚£æ¯è˜‹æœé…’ï¼Œæ‚¨å–ä¸‹çš„ä¸åªæ˜¯é…’ï¼Œè€Œæ˜¯é’æ£®äººç‚ºäº†ç”Ÿå­˜èˆ‡æ¦®è€€ï¼Œåœ¨å‚³çµ±ä¸­æ·¬éŠå‡ºçš„æ–°æ»‹å‘³ã€‚", 
                        location: "A-FACTORY" 
                    },
                    { time: "17:00", title: "ãƒ©ã‚°ãƒã‚ª (Raguenau)", tag: "Food", desc: "Polo Chocolatã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘å°±åœ¨ A-FACTORY è³£å ´è£¡ã€‚é›–ç„¶åˆ°è™•éƒ½æœ‰è³£ï¼Œä½†å®ƒæ˜¯é’æ£®åœ¨åœ°å» å•†åšçš„ï¼Œå£æ„Ÿç´®å¯¦æ¿ƒéƒï¼ŒCP å€¼æ¥µé«˜ã€‚", location: "A-FACTORY" },
                    { time: "17:30", title: "å–è¡Œæ -> è¨ˆç¨‹è»Š", tag: "Transport", desc: "å‰å¾€é£¯åº—ã€‚", transport_info: { type: "è¨ˆç¨‹è»Š" }, to: "Dormy Inn Aomori" },
                    { time: "18:00", title: "å…¥ä½ Dormy Inn Aomori", tag: "Hotel", desc: "æ›ä¸Šé¤¨å…§æœã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘é€²æˆ¿å¾Œå…ˆæ›ä¸Šä»–å€‘æä¾›çš„èˆ’é©é¤¨å…§æœ (Samue)ï¼Œé€™å¥—è¡£æœå¯ä»¥ç©¿è‘—å»åƒæ—©é¤ã€æ³¡æº«æ³‰ç”šè‡³åƒå®µå¤œã€‚", location: "Dormy Inn Aomori" },
                    { time: "19:00", title: "æ™šé¤ï¼šé’æ£®å¸‚å€", tag: "Food", desc: "æ´¥è¼•ä¸‰å‘³ç·šæ¼”å¥ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘æ™šé¤æ¨è–¦å»é«”é©—ã€Œæ´¥è¼•ä¸‰å‘³ç·šã€çš„ç¾å ´æ¼”å¥ã€‚å±…é…’å±‹ã€ŒåŠ©å…­ã€æˆ–ã€ŒWasshoiã€æ°£æ°›éƒ½å¾ˆç†±é¬§ã€‚", location: "Aomori City Center" },
                    { time: "21:30", title: "é£¯åº—å®µå¤œ", tag: "Food", desc: "å¤œé³´æ‹‰éºµã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘çµ•å°ä¸èƒ½éŒ¯éçš„ã€Œå¤œé³´æ‹‰éºµã€ï¼", location: "Dormy Inn Aomori" }
                ]
            },
            {
                day: 3, date: "02.04", week: "WED",
                heroTitle: "é›ªåœ°é§•é§›åˆé«”é©—ï¼Œæš–çˆåˆ—è»Šèˆ‡è˜‹æœæ´¾",
                heroImg: "https://i.imgur.com/M2AVCI5.jpg", 
                fallbackImg: "https://images.unsplash.com/photo-1549643276-fbc2bd5f4038?q=80&w=800&auto=format&fit=crop",
                weather: { icon: "fa-spinner fa-spin", temp: "Loading..." },
                events: [
                    { time: "08:30", title: "æ­¥è¡Œè‡³ç§Ÿè»Šé»", tag: "Transport", desc: "å°å¿ƒé»‘å†°ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘æ—©ä¸Šè·¯é¢å¯èƒ½æœƒæœ‰ã€Œé»‘å†° (Black Ice)ã€ï¼Œçœ‹èµ·ä¾†åƒæ¿•æ½¤çš„è·¯é¢å…¶å¯¦æ˜¯è–„å†°ï¼Œèµ°è·¯åƒè¬è¦å°å¿ƒã€‚", transport_info: { type: "æ­¥è¡Œ" }, to: "Aomori Station Rental Car" },
                    { time: "09:00", title: "ç§Ÿè»Šï¼šé’æ£®ç«™å‰", tag: "Transport", desc: "è‡ªé§•é–‹å§‹ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘å–è»Šé—œéµå‹•ä½œï¼š1. ç¢ºèªé›¨åˆ·ç«‹èµ·ã€‚2. æª¢æŸ¥é›ªèƒã€‚3. è©¢å•æ²¹ç®±è“‹ä½ç½®ã€‚é›ªåœ°é§•é§›å¿ƒæ³•ï¼šæ€¥ç…è»Šã€æ€¥åŠ é€Ÿã€æ€¥è½‰å½æ˜¯çµ•å°ç¦æ­¢çš„ã€‚", transport_info: { type: "è‡ªé§•", car_type: "é›ªåœ°è£å‚™ç¢ºèª" }, from: "Aomori Rental Car", to: "Goshogawara" },
                    { time: "10:00", title: "ç§»å‹•ï¼šå¾€äº”æ‰€å·åŸ", tag: "Drive", desc: "é©æ‡‰é›ªåœ°é§•é§›ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘å‰›ä¸Šè·¯çš„å‰ 20 åˆ†é˜æœ€ç·Šå¼µï¼Œè«‹æ…¢æ…¢é–‹ï¼Œç¿’æ…£é›ªåœ°è¼ªèƒçš„æŠ“åœ°åŠ›ã€‚", transport_info: { type: "è‡ªé§•" } },
                    { time: "10:30", title: "è¶…å•†è£œçµ¦", tag: "Food", desc: "ç‚¸å¹²è²ç¾ä¹ƒæ»‹é£¯ç³°ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘åœ¨é–‹è»Šé€”ä¸­è‹¥ç¶“é Lawson æˆ– FamilyMartï¼Œé€²å»æ—©é¤å€æ‰¾æ‰¾çœ‹ã€‚é’æ£®é™å®šçš„é£¯ç³°å¸¸æœƒè±ªé‚åœ°åŒ…å…¥ã€Œæ•´é¡†å¸†ç«‹è²ã€æ‹Œç¾ä¹ƒæ»‹ã€‚", location: "Convenience Store" },
                    { time: "11:00", title: "ä»»å‹™ 2ï¼šELM è³¼ç‰©ä¸­å¿ƒ", tag: "Shopping", desc: "3COINS+plusã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘ç›´å¥” 3COINS+plusï¼Œé€™è£¡æœ‰å¾ˆå¤šä¾¿å®œåˆå¥½ç”¨çš„é›ªåœ°å°ç‰©ã€‚", nav: { mapcode: "168 649 346*52" }, location: "ELM Shopping Center" },
                    { time: "11:45", title: "æŠµé” æ´¥è¼•äº”æ‰€å·åŸç«™", tag: "Drive", desc: "åœè»Šç¦®å„€ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘åœå¥½è»Šå¾Œï¼Œè¨˜å¾—æŠŠé›¨åˆ·ç«‹èµ·ä¾†ï¼Œé€™æ˜¯é›ªåœ‹ç¦®å„€ã€‚", location: "Tsugaru Goshogawara Station" },
                    { 
                        time: "12:00", title: "ä»»å‹™ 3ï¼šæ´¥è¼•éµé“ã€Œæš–çˆåˆ—è»Šã€", tag: "Experience", 
                        desc: "çƒ¤é­·é­šèˆ‡æ˜­å’Œæ„Ÿã€‚", 
                        detail: "ã€å°éŠç­†è¨˜ã€‘é€™æ˜¯æ˜­å’Œæ™‚ä»£çš„æ´»å¤è‘£ï¼è»Šå»‚å…§æ˜¯çœŸçš„ç‡’ç…¤ç‚­çš„æš–çˆã€‚ä¸Šè»Šå¾Œä¸€å®šè¦è²·çƒ¤é­·é­šï¼Œåˆ—è»Šé•·æœƒå¹«ä½ åœ¨æš–çˆä¸Šç¾çƒ¤ã€‚<br><br>ã€è€é³¥èªªæ•…äº‹ã€‘<br>é€™åˆ—ç«è»Šæ˜¯ä¸€å°è¡Œé§›åœ¨é›ªåŸä¸Šçš„ã€Œæ™‚å…‰æ©Ÿã€ã€‚å¤–é ­æ˜¯é›¶ä¸‹å¹¾åº¦çš„æš´é¢¨é›ªï¼Œè»Šå…§å»å› ç‚ºé‚£å€‹ç‡’è‘—ç´…é€šé€šç…¤ç‚­çš„ã€Œé”æ‘©ç«çˆã€è€Œæº«æš–å¦‚æ˜¥ã€‚æ–‡è±ªã€Œå¤ªå®°æ²»ã€ç”Ÿå‰ä¹Ÿæ­éã€‚ç•¶åˆ—è»Šé•·æŠŠä¹¾é­·é­šæ”¾åœ¨ç«çˆé ‚è“‹ä¸Šã€Œæ»‹ï½ã€çš„ä¸€è²ï¼Œé…ä¸Šä¸€æ¯æ¸…é…’ï¼Œé‚£ç¨®ã€Œèµ¤è£¸è£¸çš„æ˜­å’Œæ„Ÿã€æœƒè®“æ‚¨æ„Ÿå‹•ã€‚", 
                        location: "Tsugaru Railway" 
                    },
                    { time: "13:30", title: "ç§»å‹•ï¼šå¾€å¼˜å‰", tag: "Drive", desc: "æ´¥è¼•å¯Œå£«ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘å‰å¾€å¼˜å‰çš„è·¯ä¸Šï¼Œè‹¥å¤©æ°£æ™´æœ—ï¼Œå·¦æ‰‹é‚Šæœƒå‡ºç¾å£¯éº—çš„ã€Œå²©æœ¨å±±ã€ï¼Œè¢«ç¨±ç‚ºæ´¥è¼•å¯Œå£«ã€‚", transport_info: { type: "è‡ªé§•" }, to: "Hirosaki" },
                    { time: "14:30", title: "ä»»å‹™ 4ï¼šè—¤ç”°ç´€å¿µåº­åœ’", tag: "Food", desc: "å¤§æ­£æµªæ¼«å–«èŒ¶å®¤ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘é€™è£¡åŸæœ¬æ˜¯å¯Œè±ªçš„åˆ¥å¢…ï¼Œæ´‹é¤¨å»ºç¯‰éå¸¸æœ‰æ°£æ°›ã€‚ä¸€å®šè¦æ¶çª—é‚Šçš„ä½ç½®ï¼Œçœ‹è‘—é›ªè¦†è“‹çš„æ—¥å¼åº­åœ’åƒç”œé»ã€‚", nav: { mapcode: "71 071 513*78" }, location: "Fujita Memorial Garden" },
                    { time: "14:45", title: "æ˜Ÿå·´å…‹ å¼˜å‰å…¬åœ’å‰åº—", tag: "Sightseeing", desc: "æœ€ç¾æ˜Ÿå·´å…‹ä¹‹ä¸€ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘å¦‚æœå–«èŒ¶å®¤å¤§æ’é•·é¾ï¼Œé€™è£¡æ˜¯æœ€å¼·å‚™æ¡ˆã€‚å®ƒæ˜¯åˆ©ç”¨ã€ŒèˆŠç¬¬å…«å¸«åœ˜é•·å®˜èˆã€æ”¹å»ºçš„ï¼Œä¿ç•™äº†å¤§æ­£æ™‚ä»£çš„æ´‹é¢¨å»ºç¯‰ç‰¹è‰²ã€‚", location: "Starbucks Hirosaki Park" },
                    { time: "15:45", title: "å¼˜å‰åŸ (å¼˜å‰å…¬åœ’)", tag: "Sightseeing", desc: "é›ªç‡ˆç± ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘å†¬å¤©çš„å¼˜å‰åŸé›–ç„¶å¤©å®ˆé–£å¯èƒ½æœƒç§»å‹•ï¼Œä½†é‡é»æ˜¯ã€Œé›ªç‡ˆç± ã€ã€‚", location: "Hirosaki Castle" },
                    { time: "16:30", title: "ç§»å‹•ï¼šè¿”å›é’æ£®å¸‚", tag: "Drive", desc: "åœ‹é“ 7 è™Ÿã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘å¼˜å‰åˆ°é’æ£®çš„åœ‹é“ 7 è™Ÿéå¸¸å®¹æ˜“å¡è»Šï¼Œè«‹é ç•™å……è£•æ™‚é–“ã€‚", transport_info: { type: "è‡ªé§•" }, to: "Aomori City" },
                    { time: "18:00", title: "æ™šé¤ï¼šé’æ£®å¸‚å€", tag: "Food", desc: "å‘³å™Œå’–å“©ç‰›å¥¶æ‹‰éºµã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘ä»Šæ™šæ¨è–¦å˜—è©¦é’æ£®å¸‚çš„éˆé­‚ç¾é£Ÿã€Œå‘³å™Œå’–å“©ç‰›å¥¶æ‹‰éºµã€ã€‚", location: "Aomori City Center" }
                ]
            },
            {
                day: 4, date: "02.05", week: "THU",
                heroTitle: "å‹‡é—–å…«ç”²ç”°ï¼Œå…¥ä½æ˜Ÿé‡é’æ£®å±‹",
                heroImg: "https://i.imgur.com/xOsZDUG.jpg", 
                fallbackImg: "https://images.unsplash.com/photo-1487667258413-5a089052b658?q=80&w=800",
                alert: "âš ï¸ é›ªåœ°é§•é§›è­¦ç¤ºï¼šå…«ç”²ç”°å±±è·¯æ®µç©é›ªæ¥µæ·±ï¼Œè«‹æ³¨æ„è·¯é¢ä¸Šæ–¹ç´…ç®­é ­æŒ‡æ¨™ï¼",
                weather: { icon: "fa-spinner fa-spin", temp: "Loading..." },
                events: [
                    { time: "08:00", title: "é’æ£®é­šèœä¸­å¿ƒ (å¤å·å¸‚å ´)", tag: "Food", desc: "è‡ªè£½æµ·é®®ä¸¼ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘é€™æ˜¯æœ€æœ‰è¶£çš„æ—©é¤é«”é©—ï¼æ‹¿è‘—ç¢—å»å„æ”¤ä½ã€Œé¸å¦ƒã€ã€‚ä¸€å®šè¦è©¦è©¦çœ‹é’æ£®ç‰¹ç”¢ã€Œæ‰‡è²ã€ã€‚", location: "Furukawa Market" },
                    { time: "09:30", title: "é–‹è»Šä¸Šå±±ï¼šå¾€å…«ç”²ç”°", tag: "Drive", desc: "é›ªç‰†è·¯æ®µã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘å…¨è¡Œç¨‹æœ€å±éšªè·¯æ®µï¼éš¨è‘—æµ·æ‹”å‡é«˜ï¼Œè·¯æ—ç©é›ªæœƒè®Šæˆå…©ä¸‰å…¬å°ºé«˜çš„é›ªç‰†ã€‚è«‹å‹™å¿…æ³¨æ„è·¯é¢ä¸Šæ–¹çš„ã€Œç´…ç®­é ­ã€æŒ‡æ¨™ã€‚", transport_info: { type: "è‡ªé§•" }, from: "Aomori City", to: "Hakkoda Ropeway" },
                    { 
                        time: "10:30", title: "å…«ç”²ç”°å±±æ¨¹å†° (çºœè»Š)", tag: "Nature", 
                        desc: "é›ªæ€ª (Ice Monsters)ã€‚", 
                        detail: "ã€å°éŠç­†è¨˜ã€‘é€™è£¡çš„æ¨¹å†°æ¯”è—ç‹æ›´åŸå§‹ã€æ›´ç‹‚é‡ã€‚æ­çºœè»Šåˆ°å±±é ‚å¾Œï¼Œæ‚¨æœƒç½®èº«æ–¼å†°å°ä¸–ç•Œã€‚<br><br>ã€è€é³¥èªªæ•…äº‹ã€‘<br>æ‚¨å³å°‡è¦‹åˆ°çš„ä¸åªæ˜¯æ¨¹å’Œé›ªï¼Œè€Œæ˜¯å¤§è‡ªç„¶é›•å¡‘å‡ºçš„ã€Œé›ªæ€ªã€ã€‚æ¨¹å†°å½¢æˆéœ€è¦ä¸‰å€‹å¥‡è¹Ÿï¼š1. å¤§é‡çš„ã€Œé’æ£®å†·æ‰ã€ï¼›2. ä¾†è‡ªè¥¿ä¼¯åˆ©äºçš„å­£é¢¨èˆ‡éå†·æ°´æ»´ï¼›3. æ°£æº«æŒçºŒä½æ–¼é›¶ä¸‹ 5 åº¦ã€‚å…«ç”²ç”°å±±çš„æ¨¹å†°è¦æ¨¡å®å¤§ï¼Œçœ‹è‘—æˆåƒä¸Šè¬éš»ã€Œé›ªæ€ªã€æ²¿è‘—å±±å¡æ’å±±å€’æµ·è€Œä¾†ï¼Œé‚£ç¨®éœ‡æ‡¾æ„Ÿèˆ‡æ•¬ç•å¿ƒæ²¹ç„¶è€Œç”Ÿã€‚", 
                        location: "Hakkoda Ropeway" 
                    },
                    { time: "12:00", title: "åˆé¤ï¼šçºœè»Šç«™é£Ÿå ‚", tag: "Food", desc: "è•éº¥éºµæˆ–å’–å“©ã€‚", location: "Hakkoda Ropeway Station" },
                    { time: "12:45", title: "é…¸æ¹¯æº«æ³‰ (Sukayu Onsen)", tag: "Sightseeing", desc: "åƒäººé¢¨å‘‚å¤–è§€ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘å³ä½¿ä¸é€²å»æ³¡ï¼Œå…‰æ˜¯æŠŠè»Šåœä¸‹ä¾†ï¼Œçœ‹é‚£æ£Ÿå…¨æªœæœ¨å»ºé€ çš„å¤è€å»ºç¯‰ï¼Œä»¥åŠå±‹é ‚ä¸Šåšé” 3-4 å…¬å°ºçš„é©šäººç©é›ªï¼Œå°±éå¸¸å€¼å¾—ã€‚", location: "Sukayu Onsen" },
                    { time: "13:00", title: "ç§»å‹•ï¼šå‰å¾€æ˜Ÿé‡é’æ£®å±‹", tag: "Drive", desc: "å°èˆªè¨­å®šæ³¨æ„ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘å°èˆªé™·é˜±è­¦å‘Šï¼è«‹å‹™å¿…è¨­å®šç¶“ç”±ã€Œé™¸å¥§æ”¶è²»é“è·¯ã€å¾€ä¸‰æ¾¤æ–¹å‘ã€‚", transport_info: { type: "è‡ªé§•", time_estimate: "2å°æ™‚" }, to: "Hoshino Resorts Aomoriya" },
                    { time: "15:30", title: "å…¥ä½ï¼šæ˜Ÿé‡é›†åœ˜ é’æ£®å±‹", tag: "Hotel", desc: "ç¥­å…¸ä¸»é¡Œæ¨‚åœ’ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘æ­¡è¿ä¾†åˆ°ç¥­å…¸çš„ä¸»é¡Œæ¨‚åœ’ï¼ä¸€é€²é–€å°±æœƒæœ‰æœå‹™å“¡éä¸Šè¿è³“è˜‹æœæ±ã€‚", nav: { mapcode: "84 583 002*44" }, reservation_info: { type: "Resort", number: "HOS-AOM-1234", name: "YK", check_in: "15:30" }, location: "Hoshino Resorts Aomoriya" },
                    { time: "17:00", title: "æ™šé¤ï¼šNore Sore é£Ÿå ‚", tag: "Food", desc: "åª½åª½çš„å‘³é“ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘ä¸€å®šè¦é€²æ”»ã€Œç¾ç…ç‰›æ’ã€å’Œã€Œç‚¸æ‰‡è²ã€ã€‚", location: "Nore Sore Dining" },
                    { time: "19:00", title: "æº«æ³‰ï¼šæµ®æ¹¯", tag: "Relax", desc: "éœ²å¤©æº«æ³‰ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘é€™è£¡çš„éœ²å¤©æº«æ³‰è¨­è¨ˆå¾—åƒæ¼‚æµ®åœ¨æ°´æ± ä¸Šã€‚æ³¡åœ¨ç†±æ¹¯è£¡ï¼Œçœ‹è‘—ç‡ˆå…‰æ˜ ç…§åœ¨é›ªåœ°ä¸Šï¼Œå¤¢å¹»æŒ‡æ•¸ç ´è¡¨ã€‚", location: "Aomoriya Onsen" }
                ]
            },
            {
                day: 5, date: "02.06", week: "FRI",
                heroTitle: "é¦¬è»Šå·¡éŠèˆ‡è¼•é¬†æ»‘é›ª",
                heroImg: "https://i.imgur.com/ViOh2sW.jpg", 
                fallbackImg: "https://images.unsplash.com/photo-1548777123-e213912bc571?q=80&w=800",
                weather: { icon: "fa-spinner fa-spin", temp: "Loading..." },
                events: [
                    { time: "07:30", title: "Nore Sore é£Ÿå ‚ æ—©é¤", tag: "Food", desc: "è‡ªè£½æµ·é®®ä¸¼ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘æ—©é¤çš„äº®é»æ˜¯ã€Œå¸†ç«‹è²å‘³å™Œç‡’ã€å’Œã€Œè‡ªè£½æµ·é®®ä¸¼ã€ã€‚", location: "Nore Sore Dining" },
                    { time: "09:00", title: "æš–çˆé¦¬è»Š (éœ€é ç´„)", tag: "Experience", desc: "æ´¥è¼•æ–¹è¨€å°è¦½ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘ååœ¨æœ‰æš–çˆçš„é¦¬è»Šè£¡ï¼Œé¦¬å¤«æœƒä¸€é‚Šè¶•é¦¬ä¸€é‚Šç”¨æ´¥è¼•æ–¹è¨€èŠå¤©ã€‚", location: "Aomoriya Park" },
                    { time: "11:00", title: "ç§»å‹•ï¼šå‰å¾€æ»‘é›ªå ´", tag: "Drive", desc: "è«è˜­ä¹‹æ£®ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘é™„è¿‘çš„ã€Œè«è˜­ä¹‹æ£® (Komaki Onsen Ski Area)ã€æ˜¯å€‹å°è€Œç¾çš„æ»‘é›ªå ´ï¼Œäººé€šå¸¸ä¸å¤šã€‚", transport_info: { type: "è‡ªé§•" }, to: "Komaki Onsen Ski Area" },
                    { time: "11:30", title: "æ»‘é›ªé«”é©—", tag: "Activity", desc: "ç²‰é›ªé«”é©—ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘å³ä½¿ä¸æ»‘é›ªï¼Œç§Ÿå€‹é›ªç›† (Sled) ä¾†ç©ä¹Ÿè¶…é–‹å¿ƒï¼é€™è£¡çš„é›ªè³ªæ˜¯ç²‰é›ª (Powder Snow)ã€‚", location: "Komaki Onsen Ski Area" },
                    { time: "15:30", title: "ç§»å‹•ï¼šè¿”å›é£¯åº—", tag: "Drive", desc: "å›æº«ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘ç©é›ªå¾Œèº«é«”æœƒæ¿•å†·ï¼Œå›åˆ°é£¯åº—ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ç›´å¥”ã€Œå…ƒæ¹¯ã€æˆ–å†æ¬¡å»ã€Œæµ®æ¹¯ã€å›æº«ã€‚", transport_info: { type: "è‡ªé§•" }, to: "Hoshino Resorts Aomoriya" },
                    { time: "16:00", title: "æ­¡é¨°å»£å ´", tag: "Relax", desc: "Jawamegu Hirobaã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘ä½æ–¼é£¯åº—åœ°ä¸‹æ¨“å±¤çš„å»£å ´ï¼Œæ°¸é éƒ½åœ¨éç¯€ã€‚", location: "Jawamegu Hiroba" },
                    { time: "18:00", title: "æ™šé¤", tag: "Food", desc: "é£¯åº—å…§ã€‚", location: "Hoshino Resorts Aomoriya" },
                    { 
                        time: "20:00", title: "é™¸å¥§ç¥­å…¸å±‹", tag: "Culture", 
                        desc: "ç¡é­”ç¥­è¡¨æ¼”ã€‚", 
                        detail: "ã€å°éŠç­†è¨˜ã€‘çµ•å°å¿…çœ‹ï¼å¦‚æœé€™è¶Ÿæ—…ç¨‹åªèƒ½é¸ä¸€å€‹è¡¨æ¼”ï¼Œå°±æ˜¯é€™å€‹ã€‚<br><br>ã€è€é³¥èªªæ•…äº‹ã€‘<br>ç‚ºä»€éº¼é’æ£®äººå°ã€Œç¥­å…¸ã€é€™éº¼ç˜‹ç‹‚ï¼Ÿå› ç‚ºé€™è£¡çš„å†¬å¤©å¤ªé•·ã€å¤ªå†·ã€å¤ªé»‘äº†ã€‚ç¡é­”ç¥­ (Nebuta) çš„åŸæ„æ˜¯è¶•èµ°å¤æ—¥è¾²å¿™æ™‚æœŸçš„ç¡é­”èˆ‡ç½å„ï¼Œä½†æˆ‘èªç‚ºï¼Œé€™æ›´æ˜¯å–šé†’äººå€‘éˆé­‚çš„å„€å¼ã€‚åœ¨é™¸å¥§ç¥­å…¸å±‹ï¼Œæ‚¨å°‡è½åˆ°æ’¼å‹•å¿ƒè‡Ÿçš„å¤ªé¼“è²ï¼Œèˆ‡ã€ŒRassera!ã€çš„å¶å–Šã€‚é€™ä¸åªæ˜¯ä¸€å ´ç§€ï¼Œé€™æ˜¯é’æ£®äººåœ¨å®£å‘Šï¼šã€Œæˆ‘å€‘ç†¬éäº†å†¬å¤©ï¼Œæˆ‘å€‘é‚„æ´»è‘—ï¼ã€", 
                        location: "Michinoku Matsuriya" 
                    }
                ]
            },
            {
                day: 6, date: "02.07", week: "SAT",
                heroTitle: "è¸è‘—é›ªèŠ±æ»¿è¼‰è€Œæ­¸",
                heroImg: "https://i.imgur.com/edlDbD7.jpg", 
                fallbackImg: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=800",
                weather: { icon: "fa-spinner fa-spin", temp: "Loading..." },
                events: [
                    { time: "08:00", title: "æœ€å¾Œäº«å—ï¼šæ—©é¤/æº«æ³‰", tag: "Relax", desc: "æ¨è–¦å…ƒæ¹¯ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘é›¢åˆ¥å‰çš„æœ€å¾Œä¸€æ³¡ã€‚æ¨è–¦å»é£¯åº—åœ’å€å…¥å£è™•çš„ã€Œå…ƒæ¹¯ã€ã€‚", location: "Aomoriya Motoyu" },
                    { time: "10:00", title: "ç§»å‹•ï¼šå‰å¾€é’æ£®æ©Ÿå ´", tag: "Drive", desc: "æº–æ™‚å‡ºç™¼ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘æœ€å¾Œä¸€æ¬¡æé†’ï¼šå†¬å­£è¶•é£›æ©Ÿï¼Œå¯§å¯æ—©åˆ°ä¸‰å°æ™‚ï¼Œä¸å¯æ™šåˆ°ä¸€åˆ†é˜ã€‚", transport_info: { type: "è‡ªé§•", time_estimate: "2.5å°æ™‚" }, from: "Hoshino Resorts Aomoriya", to: "Aomori Airport" },
                    { time: "12:00", title: "æ©Ÿå ´å‘¨é‚Šï¼šåˆé¤/åŠ æ²¹", tag: "Food", desc: "åŠ æ»¿æ²¹ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘é€²æ©Ÿå ´å‰æœ€å¾Œä¸€é …ä»»å‹™ï¼šåŠ æ»¿æ²¹ã€‚", location: "Aomori Airport Area" },
                    { time: "12:30", title: "é’æ£®æ©Ÿå ´é‚„è»Š", tag: "Transport", desc: "æª¢æŸ¥è»Šæ³ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘é‚„è»Šæ™‚ï¼Œå·¥ä½œäººå“¡æœƒæª¢æŸ¥å¤–è§€ã€‚", location: "Aomori Airport Car Rental" },
                    { time: "13:00", title: "æ©Ÿå ´å ±åˆ° (AOJ)", tag: "Transport", desc: "è¾¦ç†ç™»æ©Ÿã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘é’æ£®æ©Ÿå ´å°è€Œç¾ã€‚", location: "Aomori Airport" },
                    { time: "13:30", title: "æœ€å¾Œæ¡è²·", tag: "Shopping", desc: "æ©Ÿå ´ 2F å…ç¨…åº—ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘é€™è£¡æ˜¯æœ€å¾Œè¡åˆºå€ï¼å¿…è²·æ•´é¡†è˜‹æœã€Patissier's è˜‹æœæ´¾ã€æºå‚ç‡’è‚‰é†¬ã€‚", location: "Aomori Airport Duty Free" },
                    { time: "15:30", title: "æ­æ©Ÿè¿”å°", tag: "Flight", desc: "BR 121ã€‚", detail: "ã€å°éŠç­†è¨˜ã€‘é£›æ©Ÿèµ·é£›æ™‚ï¼Œè«‹å¾€ä¸‹çœ‹ï¼Œé‚£ç‰‡ç™½é›ªè¦†è“‹çš„å¤§åœ°ã€å…«ç”²ç”°å±±çš„è¼ªå»“ã€é™¸å¥§ç£çš„æ·±è—ï¼Œå°‡æ˜¯æ‚¨é€™è¶Ÿæ—…ç¨‹æœ€ç¾çš„å¥é»ã€‚è¾›è‹¦äº†ï¼", reservation_info: { type: "Flight", number: "BR121", departure: "15:30" }, location: "Aomori Airport" }
                ]
            }
        ];

        const timeSensitiveMessages = {
            work: [
                "æ¯å¤©éƒ½åœ¨è™•ç†çªç™¼ç‹€æ³ï¼Œé€™æ¬¡å”¯ä¸€çš„çªç™¼ç‹€æ³ï¼Œåªæœ‰ã€Œé£Ÿç‰©å¤ªå¥½åƒã€ã€‚",
                "é‚£äº›è¡¨æ ¼ã€å ±å‘Šã€SOP éƒ½ç•™åœ¨å°ç£ï¼Œè¡Œæç®±åªè£å¾—ä¸‹æœŸå¾…ã€‚",
                "ç¸½æ˜¯ç‚ºäº†åˆ¥äººå¿™å¾—åœ˜åœ˜è½‰ï¼ŒDay 5 çš„æš–çˆé¦¬è»Šæ˜¯å°ˆé–€ç‚ºä½ å€‘æ…¢ä¸‹ä¾†çš„ã€‚",
                "ä¸ç®¡æ˜¯éˆ´è²ã€å‘¼å«å™¨é‚„æ˜¯é›»è©±è²ï¼Œéƒ½æ¯”ä¸ä¸Šå¼˜å‰é›ªåœ°è£¡çš„å¯‚éœå¥½è½ã€‚",
                "æ¯å¤©éƒ½è¦ã€Œä¿æŒå†·éœã€ï¼Œä½†åœ¨é’æ£®çš„è˜‹æœæ´¾é¢å‰ï¼Œå…è¨±ä½ æ¿€å‹•ä¸€é»ã€‚",
                "é€™æ¬¡æ—…è¡Œæ²’æœ‰ã€Œé•·å®˜ã€ä¹Ÿæ²’æœ‰ã€Œå®¶å±¬/å®¶é•·ã€ï¼Œåªæœ‰é€™ç¾¤æ‡‚ä½ çš„æ—…ä¼´ã€‚",
                "æŠŠã€Œè§£æ±ºå•é¡Œã€çš„èƒ½åŠ›å…ˆé—œæ‰ï¼Œæˆ‘å€‘å»å¤å·å¸‚å ´åªè² è²¬ã€Œè§£æ±ºæµ·é®®ä¸¼ã€ã€‚",
                "æ¯å¤©éƒ½åœ¨è·Ÿæ™‚é–“è³½è·‘ï¼Œä½†åœ¨æš–çˆåˆ—è»Šä¸Šï¼Œæ™‚é–“æ˜¯è¢«ç‚­ç«æ…¢æ…¢çƒ¤ç†±çš„ã€‚",
                "è¾›è‹¦äº†ï¼Œé€™è¶Ÿæ—…è¡Œå°±æ˜¯ä½ å€‘æœ€å¥½çš„ç¸¾æ•ˆçé‡‘ã€‚",
                "é‚£äº›è®“ä½ ç†æ™ºæ–·ç·šçš„ç¬é–“éƒ½éå»äº†ï¼Œç¾åœ¨é€£ç·šçš„æ˜¯é’æ£®çš„ WiFiã€‚",
                "æ¯å¤©éƒ½è¦æ­¦è£è‡ªå·±ï¼Œé€™æ¬¡å» UNIQLO è²·ä»¶æ¯›èŒ¸èŒ¸çš„å¤–å¥—ï¼ŒæŠŠè‡ªå·±è£¹å¾—è»Ÿè»Ÿçš„å§ã€‚",
                "æš«æ™‚æŠŠã€Œè²¬ä»»æ„Ÿã€èª¿æˆé£›èˆªæ¨¡å¼ï¼Œæº–å‚™å‡ºç™¼ï¼Ÿ",
                "é€ƒé›¢é‚£äº›ä¸è¬›ç†çš„äººäº‹ç‰©ï¼Œå»è¦‹è¦‹åªæœƒé»é ­åƒè‰çš„é¦¬å…’å§ã€‚",
                "åœ¨è·å ´ä¸Šçœ‹äº†å¤ªå¤šç„¡å¥ˆï¼Œå»çœ‹çœ‹å¥ˆè‰¯ç¾æ™ºçš„ä½œå“ï¼Œæ‰¾å›ç´”çœŸçš„çœ¼ç¥ã€‚",
                "ä¸Šç­çš„ç©ºæ°£å¤ªæ‚¶äº†ï¼Œå¥½æƒ³å¿«é»èåˆ°çƒ¤é­·é­šçš„é¦™æ°£ã€‚",
                "è®“å¼˜å‰åŸçš„ç™½è‰²é›ªæ™¯ï¼Œè¦†è“‹æ‰è…¦ä¸­é‚£äº›é›œäº‚çš„å¾…è¾¦äº‹é …ã€‚",
                "ç•¶ä½ è¦ºå¾—é€™é€±å¾ˆæ¼«é•·æ™‚ï¼Œæƒ³æƒ³å‡½é¤¨æœå¸‚çš„æµ·è†½æ­£åœ¨æ…¢æ…¢è®Šç”œã€‚",
                "å’–å•¡å·²ç¶“æä¸äº†ç¥äº†å—ï¼Ÿé‚£ä½ éœ€è¦çš„æ˜¯å¥§å…¥ç€¨æºªæµçš„å†·å†½ç©ºæ°£ã€‚",
                "é‚£äº›é›£æçš„å…¬äº‹ï¼Œä¸Ÿé€²æ´¥è¼•æµ·å³½è£¡æ‡‰è©²æœƒæ²‰ä¸‹å»å§ï¼Ÿ",
                "æŠŠéåº¦ä½¿ç”¨çš„è…¦å®¹é‡æ¸…ç©ºï¼Œç•™çµ¦è—¤ç”°ç´€å¿µåº­åœ’çš„ç¾æ™¯ã€‚",
                "å³ä½¿ä»Šå¤©é‡åˆ°é³¥äº‹ï¼Œæƒ³è‘—ã€Œæˆ‘è¦å»é’æ£®äº†ã€ï¼Œå¿ƒæƒ…ä¹Ÿæœƒè®Šå¥½ã€‚",
                "ä»Šå¤©çš„åŠªåŠ›ï¼Œéƒ½æ˜¯ç‚ºäº†é‚£å¤©åœ¨é›ªåœ°è£¡èƒ½ç„¡æ†‚ç„¡æ…®åœ°æ¼«æ­¥ã€‚",
                "å¢¨é¡æº–å‚™å¥½äº†å—ï¼Ÿæˆ‘å€‘è¦å»é¢å°æ¯”ç¾å¯¦æ›´åˆºçœ¼ã€æ›´ç‡¦çˆ›çš„é›ªç™½ã€‚",
                "ç¸½æ˜¯æ“”å¿ƒé€™å€‹ã€æ“”å¿ƒé‚£å€‹ï¼Œé€™æ¬¡å”¯ä¸€è¦æ“”å¿ƒçš„æ˜¯ã€Œä¸æƒ³å›å»æ€éº¼è¾¦ã€ã€‚",
                "è·é›¢å‡ºç™¼åˆè¿‘äº†ä¸€å¤©ï¼Œä½ çš„å¿ƒæ˜¯ä¸æ˜¯å·²ç¶“å·å·æºœå»æ©Ÿå ´äº†ï¼Ÿ",
                "å†æ’ä¸€ä¸‹ï¼Œé‚£äº›ç…©äººçš„äº‹ï¼Œéå¹¾å¤©éƒ½æœƒè®Šæˆé™é çš„æ•…äº‹ã€‚"
            ],
            evening: [
                "æ¯å¤©éƒ½åœ¨è¬›è©±å®‰æ’«åˆ¥äººï¼Œå»é‡‘æ£®ç´…ç£šå€‰åº«æ™‚ï¼Œæˆ‘å€‘è©¦è‘—å®‰éœåœ°çœ‹è‘—å¤•é™½å°±å¥½ã€‚",
                "ä½ çš„è€å¿ƒé¤˜é¡å·²ä¸è¶³ï¼Ÿæ²’é—œä¿‚ï¼Œå‡½é¤¨çš„ç™¾è¬å¤œæ™¯æœƒå¹«ä½ å……å€¼ã€‚",
                "ç¸½æ˜¯æŠŠåˆ¥äººçš„éœ€æ±‚æ“ºç¬¬ä¸€ï¼Œé€™æ¬¡ï¼Œè«‹æŠŠã€Œæˆ‘æƒ³åƒé€™å€‹ã€å¤§è²èªªå‡ºä¾†ã€‚",
                "æƒ³åƒä¸€ä¸‹ï¼Œå¹¸é‹å°ä¸‘æ¼¢å ¡çš„é†¬æ±æ»´ä¸‹ä¾†çš„ç†±åº¦ï¼Œæ˜¯ä¸æ˜¯é¤“äº†ï¼Ÿ",
                "æ‰‹æŒ‡æ•²éµç›¤/å¯«å­—å¤ªä¹…äº†ï¼Œå®ƒå€‘ç¾åœ¨åªæƒ³æ¡è‘—æš–æš–çš„æ¸…é…’æ¯ã€‚",
                "ä½ çš„çœ¼ç›çœ‹å¤ªå¤šè¢å¹•äº†ï¼Œå‡½é¤¨çš„å¤œæ™¯æ˜¯æœ€å¥½çš„çœ¼è—¥æ°´ã€‚",
                "åœ¨ Dormy Inn çš„å¤œé³´æ‹‰éºµé¢å‰ï¼Œæ¸›è‚¥ä»€éº¼çš„éƒ½æ˜å¤©å†èªªã€‚",
                "ä½ çš„èƒƒæ˜¯ä¸æ˜¯åœ¨æŠ—è­°éƒ½äº‚åƒï¼Ÿæº–å‚™å¥½ç”¨é„‰åœŸæ–™ç†ä¾†å®‰æ’«å®ƒã€‚",
                "æœŸå¾…ä¸€ä¸‹ï¼Œåœ¨å”å‰è¨¶å¾·è¿·è·¯æ™‚ï¼Œé‚£ç¨®è¢«å•†å“åŒ…åœçš„ç„¡è…¦å¿«æ¨‚ã€‚",
                "é¤“äº†å—ï¼Ÿå¤å·å¸‚å ´çš„ã€ŒNokke Donã€ï¼Œæƒ³å¥½è¦è“‹å¹¾å±¤ç”Ÿé­šç‰‡äº†å—ï¼Ÿ",
                "è®“é™¸å¥§ç¥­å…¸å±‹çš„é¼“è²ï¼Œéœ‡ç¢ä½ å¿ƒè£¡çš„ç…©æ‚¶ã€‚",
                "åœ¨å‡½é¤¨å±±çœ‹å¤œæ™¯æ™‚ï¼Œè¨±å€‹é¡˜å§ï¼Œé—œæ–¼è‡ªå·±ï¼Œä¸æ˜¯é—œæ–¼å·¥ä½œã€‚",
                "æ¯å¤©æ™šä¸Šå›åˆ°é£¯åº—ï¼Œéƒ½è¦å–ä¸€æ¯ï¼Œæ…¶ç¥æˆ‘å€‘åˆå¾æœäº†ä¸€å¤©ã€‚",
                "é‡åˆ°å¥½åƒçš„ä¸€å®šè¦åˆ†ä¸€å£ï¼Œé‡åˆ°é›·çš„ä¹Ÿè¦ä¸€äººä¸€å£ï¼ˆæœ‰é›£åŒç•¶ï¼‰ã€‚",
                "å˜¿ï¼Œä»Šå¤©éå¾—é‚„å¥½å—ï¼Ÿå‡½é¤¨çš„é¢¨åœ¨ç­‰ä½ ã€‚",
                "å¦‚æœåœ¨å”å‰è¨¶å¾·å¤±å¿ƒç˜‹ï¼Œè¨˜å¾—æé†’å°æ–¹ï¼šã€Œè¡Œæç®±é‚„å¡å¾—ä¸‹å—ï¼Ÿã€",
                "ç‚ºäº†é‚£ä¸€å£è˜‹æœæ´¾çš„é…¥è„†ï¼Œä»Šå¤©çš„åˆé¤éš¨ä¾¿åƒä¹Ÿæ²’é—œä¿‚ã€‚",
                "è²·ä¼´æ‰‹ç¦®çš„æ™‚å€™ï¼Œè¨˜å¾—å…ˆè²·çµ¦è‡ªå·±ï¼Œå†è²·çµ¦åˆ¥äººã€‚"
            ],
            rest: [
                "ç¸½æ˜¯è½åˆ¥äººçš„ç…©æƒ±ï¼Œé€™æ¬¡æ›è½è½æ´¥è¼•æµ·å³½çš„æµ·æµªè²å§ã€‚",
                "çŸ¥é“ä½ è‚©è†€å¾ˆé‡ï¼Œæ‰€ä»¥æˆ‘å€‘å®‰æ’äº†æº«æ³‰ï¼ŒæŠŠé‚£äº›è²¬ä»»éƒ½æ´—æ‰ã€‚",
                "å¹³å¸¸ç…§é¡§å¤§å®¶ï¼Œé€™æ¬¡è®“æ˜Ÿé‡é›†åœ˜çš„æœå‹™äººå“¡ä¾†å¯µå£ä½ ã€‚",
                "è„«ä¸‹åˆ¶æœçš„ä½ ï¼Œéƒ½åªæ˜¯æ¸´æœ›è¢«å¤§è‡ªç„¶æ“æŠ±çš„å­©å­ã€‚",
                "ä»Šå¤©å¦‚æœè¦ºå¾—å¾ˆç´¯ï¼Œæƒ³è‘— æ˜Ÿé‡é’æ£®å±‹ï¼Œæ·±å‘¼å¸ä¸€æ¬¡ã€‚",
                "é–‰ä¸Šçœ¼ç›ï¼Œæƒ³åƒä¸€ä¸‹é›¶ä¸‹äº”åº¦çš„ç©ºæ°£å¸é€²è‚ºè£¡ï¼Œé‚£ç¨®ä¹¾æ·¨çš„æ„Ÿè¦ºã€‚",
                "è½èªªæ´¥è¼•éµé“çš„æš–çˆå¾ˆæº«æš–ï¼Œå°±åƒæˆ‘å€‘èšåœ¨ä¸€èµ·çš„æº«åº¦ã€‚",
                "æƒ³åƒè…³è¸©åœ¨åšåšçš„æ–°é›ªä¸Šï¼Œã€Œå™—æ»‹ã€ä¸€è²ï¼Œé‚£æ˜¯ç™‚ç™’çš„è²éŸ³ã€‚",
                "é’æ£®è˜‹æœå’¬ä¸‹å»æ¸…è„†çš„è²éŸ³ï¼Œæœƒè®“ä½ å¿˜è¨˜æ‰€æœ‰çš„å™ªéŸ³ã€‚",
                "è®“æ˜Ÿé‡é’æ£®å±‹çš„éœ²å¤©æº«æ³‰ï¼Œè’¸ç™¼æ‰ä½ ç´¯ç©ä¸€æ•´å¹´çš„ç–²æ†Šã€‚",
                "æƒ³åƒå¤§æ­£æµªæ¼«å–«èŒ¶å®¤çš„é™½å…‰ç‘åœ¨è‡‰ä¸Šï¼Œé‚£å¤©ä¸‹åˆæˆ‘å€‘ä»€éº¼éƒ½ä¸åšã€‚",
                "ç•¶æ–°å¹¹ç·šç©¿ééš§é“ï¼Œçœ¼å‰è±ç„¶é–‹æœ—çš„é‚£ä¸€åˆ»ï¼Œå¿ƒæƒ…ä¹Ÿæœƒè·Ÿè‘—æ‰“é–‹ã€‚",
                "è®“å¼˜å‰çš„ç²‰é›ªï¼Œè¼•è¼•è½åœ¨ä½ çš„ç«æ¯›ä¸Šï¼Œé‚£æ˜¯å†¬å¤©çš„è¦ªå»ã€‚",
                "æƒ³åƒä¸€ä¸‹ï¼Œè‡ªé§•åœ¨é›ªç‰†ä¸­é–“ï¼Œå…¨ä¸–ç•Œåªå‰©ä¸‹æˆ‘å€‘é€™å°è»Šã€‚",
                "æœ€å¾Œä¸€å¤©åœ¨æ©Ÿå ´çš„éœœæ·‡æ·‹ï¼Œæ˜¯é€™è¶Ÿæ—…ç¨‹æœ€ç”œç¾çš„å¥é»ã€‚",
                "é›–ç„¶å¤§å®¶éƒ½å¾ˆæœƒç…§é¡§äººï¼Œä½†é€™æ¬¡æˆ‘å€‘è¦äº’ç›¸ç…§é¡§ï¼Œæˆ–è€…ä¸€èµ·æ“ºçˆ›ã€‚",
                "å¦‚æœèª°åœ¨å¼˜å‰åŸæ»‘å€’äº†ï¼Œå…ˆæ‹ç…§å†æ‰¶èµ·ä¾†ã€‚",
                "é€™æ¬¡ç§Ÿçš„è»Šå°±æ˜¯æˆ‘å€‘çš„ç§»å‹•åŸå ¡ï¼Œè£¡é¢åªè£ç¬‘è²ã€‚",
                "å›ç¨‹æ™‚ï¼Œä¸å‡†å“­å–ªè‘—è‡‰ï¼Œè¦ç¬‘è‘—èªªã€Œä¸‹æ¬¡å†å»å“ªè£¡ã€ã€‚",
                "ç´„å¥½äº†ï¼Œè¦æŠŠé€™å¹¾å¤©çš„å¿«æ¨‚ï¼Œå„²å­˜æˆå›å°ç£å¾Œçš„èƒ½é‡åŒ…ã€‚",
                "å°±ç®—è¿·è·¯äº†ï¼Œåªè¦ä¸‰å€‹äººåœ¨ä¸€èµ·ï¼Œé‚£è£¡å°±æ˜¯æ™¯é»ã€‚",
                "ä½ çš„é›ªé´æº–å‚™å¥½äº†å—ï¼Ÿå®ƒè¿«ä¸åŠå¾…è¦åœ¨é’æ£®ç•™ä¸‹è…³å°ã€‚",
                "ç”Ÿæ´»å¶çˆ¾éœ€è¦æš«åœï¼Œæˆ‘å€‘æ­£åœ¨å‰å¾€æŒ‰æš«åœéµçš„è·¯ä¸Šã€‚",
                "æª¢æŸ¥ä¸€ä¸‹ï¼Œå¥½å¥‡å¿ƒå¸¶äº†å—ï¼Ÿé‚£æ˜¯æ¯”è­·ç…§æ›´é‡è¦çš„æ±è¥¿ã€‚",
                "è­·ç…§æª¢æŸ¥éäº†å—ï¼Ÿé‚£æ˜¯é€šå¾€è‡ªç”±çš„å…¥å ´åˆ¸ã€‚",
                "æƒ³åƒä¸€ä¸‹ï¼Œæ­¤åˆ»çš„å¼˜å‰åŸï¼Œé›ªæ­£éœéœåœ°è½ä¸‹ï¼Œç­‰å¾…è‘—ä½ çš„åˆ°ä¾†ã€‚",
                "è¡Œæç®±æ‹¿å‡ºä¾†äº†å—ï¼ŸæŠŠå®ƒæ”¤é–‹åœ¨åœ°ä¸Šï¼Œå°±æ˜¯ä¸€ç¨®å„€å¼æ„Ÿã€‚",
                "æ—¥å¹£æ›å¥½äº†å—ï¼Ÿé‚£äº›ç¡¬å¹£åˆ°æ™‚å€™éƒ½æœƒè®Šæˆæ‰­è›‹å’Œé£²æ–™ã€‚",
                "ä¿æš–åšå¥½äº†å—ï¼Ÿå¿ƒå¾ˆç†±ï¼Œä½†èº«é«”é‚„æ˜¯è¦é¡§å–”ã€‚",
                "æ‰‹æ©Ÿè¨˜æ†¶é«”æ¸…ç©ºäº†å—ï¼Ÿåˆ¥è®“å®¹é‡é™åˆ¶äº†ä½ çš„å›æ†¶ã€‚",
                "é§•ç…§è­¯æœ¬åœ¨çš®å¤¾è£¡äº†å—ï¼Ÿé‚£æ˜¯æˆ‘å€‘é¦³é¨é’æ£®çš„é‘°åŒ™ã€‚",
                "æ­Œå–®æ•´ç†å¥½äº†å—ï¼Ÿé‚£æ˜¯å…¬è·¯æ—…è¡Œçš„éˆé­‚ã€‚",
                "æ¯å¤©çœ‹è‘—å€’æ•¸æ•¸å­—è®Šå°‘ï¼Œå˜´è§’æ˜¯ä¸æ˜¯æœƒä¸è‡ªè¦ºä¸Šæšï¼Ÿ",
                "è®“æœŸå¾…æ„Ÿåƒé›ªçƒä¸€æ¨£ï¼Œè¶Šæ»¾è¶Šå¤§å§ã€‚",
                "è¨˜å¾—å¸¶ä¸Šé¢è†œ/ä¿æ¿•å“ï¼Œåœ¨é£¯åº—æ•·è‡‰èŠå¤©çš„æ™‚å…‰å¾ˆçè²´ã€‚",
                "å€’æ•¸è¨ˆæ™‚ä¸­...æ·±å‘¼å¸ï¼Œèåˆ°æ—¥æœ¬ç©ºæ°£çš„å‘³é“äº†å—ï¼Ÿ",
                "æ‰€æœ‰çš„ç­‰å¾…ï¼Œéƒ½æ˜¯ç‚ºäº†ç›¸é‡æ™‚çš„é‚£ä¸€åˆ»ç¾å¥½ã€‚",
                "æŠŠå¿ƒæ¸…ç©ºï¼Œæº–å‚™è£æ»¿é’æ£®çš„è—å¤©èˆ‡ç™½é›ªã€‚",
                "æº–å‚™å¥½äº†å—ï¼Ÿå»æ“æŠ±é‚£å€‹ã€Œåªå±¬æ–¼ä½ è‡ªå·±ã€çš„å‡æœŸã€‚"
            ]
        };

        let db;
        let auth;
        let expensesRef;
        let notesRef; 
        let todosRef;
        let currentRate = 0.22;
        let currentIdx = 0;
        let currentUser = 'YK';
        let expenses = [];
        let localNotes = {}; 
        let todos = [];
        let currentEventId = null; 
        let currentFilterUser = null; 
        let currentNavLink = null;
        let isAnimating = false;
        
        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyCbHhcAo25W6yDPNT05bDkxkRIrwfUM2o4",
            authDomain: "aomori2026-17310.firebaseapp.com",
            projectId: "aomori2026-17310",
            storageBucket: "aomori2026-17310.firebasestorage.app",
            messagingSenderId: "645422415004",
            appId: "1:645422415004:web:b8017ec6dd040d1dae4159",
            measurementId: "G-2J6NCTHZ6B"
        };

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'aomori2026-17310';
        
        // --- SNOW ANIMATION LOGIC ---
        function createSnow() {
            const container = document.getElementById('snow-container');
            const snowflakeCount = 40; // å¢åŠ é›ªèŠ±æ•¸é‡
            
            for (let i = 0; i < snowflakeCount; i++) {
                const snowflake = document.createElement('div');
                snowflake.classList.add('snowflake');
                snowflake.innerHTML = 'â„';
                
                // éš¨æ©Ÿä½ç½®ã€å¤§å°å’Œå‹•ç•«æŒçºŒæ™‚é–“
                const startLeft = Math.random() * 100;
                const animDuration = Math.random() * 5 + 5; // 5-10s
                const animDelay = Math.random() * 5;
                const size = Math.random() * 0.4 + 0.2; // Modified: Smaller snowflakes (0.2-0.6rem)
                const opacity = Math.random() * 0.6 + 0.2;

                snowflake.style.left = startLeft + '%';
                snowflake.style.animationDuration = animDuration + 's';
                snowflake.style.animationDelay = animDelay + 's';
                snowflake.style.fontSize = size + 'rem';
                snowflake.style.opacity = opacity;

                container.appendChild(snowflake);
            }
        }

        // --- FIRESTORE SUBSCRIPTION FUNCTIONS ---
        const subscribeToExpenses = () => {
            const q = query(expensesRef);
            const expenseListEl = document.getElementById('expense-list');

            if (expenseListEl) {
                // Initial loading state
                expenseListEl.innerHTML = `
                    <div class="loading-overlay" style="position: static; margin-top: 20px; min-height: 100px;">
                        <i class="fa-solid fa-spinner fa-spin" style="margin-right: 10px;"></i> æ­£åœ¨è¼‰å…¥æ”¯å‡º...
                    </div>
                `;
            }

            onSnapshot(q, (snapshot) => {
                expenses = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                // Sort by timestamp descending (newest first)
                expenses.sort((a, b) => (b.timestamp?.toMillis() || 0) - (a.timestamp?.toMillis() || 0));
                renderExpenses();
                updateExpenseDashboard();
            }, (error) => {
                console.error("Error subscribing to expenses:", error);
                if (expenseListEl) expenseListEl.innerHTML = '<div style="text-align:center; padding:20px; color:var(--accent-red);">è¼‰å…¥æ”¯å‡ºè³‡æ–™å¤±æ•—ã€‚</div>';
            });
        };

        const subscribeToNotes = () => {
            const q = query(notesRef);
            onSnapshot(q, (snapshot) => {
                snapshot.docs.forEach(doc => { localNotes[doc.id] = doc.data().text; });
                
                // Re-render modal content if it is currently open and corresponds to a modified note
                if(currentEventId) {
                    const descEl = document.getElementById('m-desc');
                    const noteInModal = localNotes[currentEventId];
                    if(descEl && noteInModal) {
                        descEl.innerHTML = noteInModal; 
                    } else if (descEl) {
                        // Fallback to original data if note was deleted/empty
                        const day = tripData[currentIdx];
                        const event = day.events.find((_, i) => `d${currentIdx}_e${i}` === currentEventId);
                        if(event) descEl.innerHTML = event.detail || event.desc;
                    }
                }
            }, (error) => {
                console.error("Error subscribing to notes:", error);
            });
        };

        const subscribeToTodos = () => {
            const q = query(todosRef); 
            onSnapshot(q, (snapshot) => {
                todos = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                todos.sort((a, b) => (b.timestamp?.toMillis() || 0) - (a.timestamp?.toMillis() || 0));
                renderTodos();
            }, (error) => {
                console.error("Error subscribing to todos:", error);
            });
        };
        
        // --- CORE LOGIC FUNCTIONS ---
        function renderTodos() {
            const list = document.getElementById('todo-list-ul');
            if(list) {
                const todoHtml = todos.map(t => `<li class="todo-item">
                        <i class="fa-regular ${t.completed ? 'fa-square-check checked' : 'fa-square'} todo-check" onclick="window.toggleTodo('${t.id}', ${t.completed})"></i>
                        <span class="todo-text ${t.completed ? 'checked' : ''}">${t.text}</span>
                        <i class="fa-solid fa-trash todo-del" onclick="window.deleteTodo('${t.id}')"></i>
                    </li>
                `).join('');
                list.innerHTML = todoHtml || '<div style="text-align:center; padding:10px; color:#AAA;">æ²’æœ‰å¾…è¾¦äº‹é …äº†ï¼ŒçœŸæ£’ï¼</div>';
            }
        }
        
        function getMapUrl(data) {
             const base = `https://www.google.com/maps/embed/v1/`;
             
             // Priority 1: Explicit location string provided in data.location (Search)
             if (data.location) {
                 return `${base}search?key=${GOOGLE_MAPS_API_KEY}&q=${encodeURIComponent(data.location)}`;
             }

             // Priority 2: Route (from -> to)
             if (data.from && data.to) {
                 return `${base}directions?key=${GOOGLE_MAPS_API_KEY}&origin=${encodeURIComponent(data.from)}&destination=${encodeURIComponent(data.to)}&mode=driving`;
             } 
             
             // Priority 3: Fallback to title (Search)
             if (data.title) {
                 return `${base}search?key=${GOOGLE_MAPS_API_KEY}&q=${encodeURIComponent(data.title)}`;
             }
             return null;
        }

        function createInfoItem(icon, label, value) {
            if (!value) return '';
            return `<div class="info-item"><div class="info-label"><i class="fa-solid ${icon}"></i><span>${label}</span></div><div class="info-value">${value}</div></div>`;
        }

        function centerDateNav(idx) {
            const nav = document.getElementById('date-nav');
            const activeEl = nav.children[idx];
            if (activeEl) {
                const navWidth = nav.clientWidth;
                const elLeft = activeEl.offsetLeft;
                const elWidth = activeEl.clientWidth;
                
                // Calculate center position
                const targetLeft = elLeft - (navWidth / 2) + (elWidth / 2);
                
                nav.scrollTo({
                    left: targetLeft,
                    behavior: 'smooth'
                });
            }
        }

        function renderTrip(direction = 0) {
            const nav = document.getElementById('date-nav');
            nav.innerHTML = tripData.map((d, i) => `<div class="d-item ${i === currentIdx ? 'active' : ''}" onclick="window.switchDay(${i})">
                    <div class="d-week">${d.week}</div>
                    <div class="d-num">${d.date.split('.')[1]}</div>
                    <div class="d-weather">
                        <i class="fa-solid ${d.weather.icon}"></i>
                        <span>${d.weather.temp}</span>
                    </div>
                </div>
            `).join('');

            // Focus Centering
            setTimeout(() => centerDateNav(currentIdx), 100);

            const day = tripData[currentIdx];
            const container = document.getElementById('timeline-container');
            
            let alertHtml = '';
            if (day.alert) {
                alertHtml = `<div class="alert-banner"><i class="fa-solid fa-triangle-exclamation" style="color:#D9333F; margin-top:3px;"></i><div style="margin-left:10px;"><div style="color:var(--accent-main); font-weight:500;">ä»Šæ—¥å®‰å…¨è­¦ç¤º</div><span class="alert-highlight">${day.alert}</span></div></div>`;
            }

            const imgUrl = day.heroImg || day.fallbackImg;

            // Generate Daily Map URL
            const dailyLocations = day.events.filter(e => e.location).map(e => e.location);
            let dailyMapUrl = '';
            if (dailyLocations.length > 0) {
                if (dailyLocations.length === 1) {
                    dailyMapUrl = `https://www.google.com/maps/embed/v1/search?key=${GOOGLE_MAPS_API_KEY}&q=${encodeURIComponent(dailyLocations[0])}`;
                } else {
                    const origin = encodeURIComponent(dailyLocations[0]);
                    const destination = encodeURIComponent(dailyLocations[dailyLocations.length - 1]);
                    const waypoints = dailyLocations.slice(1, -1).map(l => encodeURIComponent(l)).join('|');
                    
                    dailyMapUrl = `https://www.google.com/maps/embed/v1/directions?key=${GOOGLE_MAPS_API_KEY}&origin=${origin}&destination=${destination}&waypoints=${waypoints}&mode=driving`;
                }
            }

            const safeStringify = (obj) => {
                return encodeURIComponent(JSON.stringify(obj)).replace(/'/g, "%27");
            };

            let html = `
                <div class="hero-card">
                    <img src="${imgUrl}" class="hero-img" onerror="this.onerror=null;this.src='${day.fallbackImg}';">
                    <div class="hero-overlay">
                        <div class="hero-title">${day.heroTitle}</div>
                    </div>
                </div>
                ${alertHtml}
            `;

            if (dailyMapUrl) {
                html += `
                    <div class="map-overview-card" style="margin-bottom: 30px;">
                        <div style="font-size: 0.8rem; color: #888; margin-bottom: 10px; display:flex; align-items:center; gap:6px;">
                            <i class="fa-solid fa-route" style="color:var(--accent-gold);"></i>
                            <span>æœ¬æ—¥è·¯ç·šé è¦½ Route Preview</span>
                        </div>
                        <iframe class="map-iframe" style="height: 200px;" src="${dailyMapUrl}" allowfullscreen loading="lazy"></iframe>
                    </div>
                `;
            }

            html += `<div class="timeline-block">`;

            html += day.events.map((ev, i) => {
                const data = safeStringify(ev); 
                const delay = i * 0.1;
                let icon = 'fa-circle';
                if (ev.tag === 'Transport' || ev.tag === 'Drive' || ev.tag === 'Flight') icon = 'fa-car-side';
                if (ev.tag === 'Hotel') icon = 'fa-bed';
                if (ev.tag === 'Shopping') icon = 'fa-bag-shopping';
                if (ev.tag === 'Food') icon = 'fa-utensils';
                if (ev.tag.match(/Sightseeing|Nature|Art|Experience|æ™¯é»/)) icon = 'fa-map-pin';
                if (ev.tag.match(/Activity|Relax|Culture|é«”é©—/)) icon = 'fa-person-skiing';
                if (ev.tag === 'Flight') icon = 'fa-plane';
                if (ev.tag === 'Arrival') icon = 'fa-plane-arrival'; 
                
                const cardClass = (ev.tag === 'Transport' || ev.tag === 'Drive' || ev.tag === 'Flight') ? 'transport-card' : '';

                return `<div class="event-node visible" style="transition-delay: ${delay}s">
                        <div class="time-dot"></div>
                        <div class="event-card ${cardClass}" onclick="window.openDetail('${data}', ${currentIdx}, ${i})">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <span class="event-tag">${ev.tag}</span>
                                <span style="font-family: var(--font-serif); font-weight: 700; color: var(--accent-red); font-size: 1.1rem;">${ev.time}</span>
                            </div>
                            <div class="event-title">${ev.title}</div>
                            <div style="font-size:0.7rem; color:#888; margin-top:5px; display:flex; align-items:center; gap:8px;">
                                <i class="fa-solid ${icon}"></i> 
                                <span>${ev.desc}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            html += `</div>`;

            // Spring Animation Logic
            // Clean previous animation classes
            container.className = "container";
            
            if (direction === 0) {
                // Initial load, no slide
                container.innerHTML = html;
            } else {
                // Direction 1 (Swipe Right/Prev): Content comes from LEFT
                // Direction -1 (Swipe Left/Next): Content comes from RIGHT
                
                // Set content
                container.innerHTML = html;
                
                if (direction === 1) {
                    container.classList.add('slide-in-from-left');
                } else if (direction === -1) {
                    container.classList.add('slide-in-from-right');
                }
            }
        }

        function checkActiveEvent() {
            const now = new Date();
            let activeDayIndex = -1;
            
            tripData.forEach((day, idx) => {
                const year = now.getFullYear();
                const tripDate = new Date(`${year}-${day.date.replace('.', '-')}`);
                const currentDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());

                if (tripDate.toDateString() === currentDate.toDateString()) {
                    activeDayIndex = idx;
                }
            });
            
            if (activeDayIndex === -1) return;

            const currentDayEvents = tripData[activeDayIndex].events;
            const currentHour = now.getHours();
            const currentMin = now.getMinutes();
            const currentTimeVal = currentHour * 60 + currentMin;

            document.querySelectorAll('.active-event').forEach(el => el.classList.remove('active-event'));
            document.querySelectorAll('.active-label').forEach(el => el.remove());

            if (currentIdx === activeDayIndex) {
                 currentDayEvents.forEach((ev, idx) => {
                    const [h, m] = ev.time.split(':').map(Number);
                    const eventTimeVal = h * 60 + m;
                    
                    let nextEventTimeVal = 9999;
                    if (idx < currentDayEvents.length - 1) {
                        const [nh, nm] = currentDayEvents[idx+1].time.split(':').map(Number);
                        nextEventTimeVal = nh * 60 + nm;
                    } else {
                        nextEventTimeVal = eventTimeVal + 90;
                    }

                    if (currentTimeVal >= eventTimeVal && currentTimeVal < nextEventTimeVal) {
                        const card = document.querySelectorAll('.event-node')[idx];
                        if(card) {
                            card.classList.add('active-event');
                            const tag = card.querySelector('.event-tag');
                            if(tag && !card.querySelector('.active-label')) {
                                tag.innerHTML += `<span class="active-label">LIVE</span>`;
                            }
                            if (!window.hasScrolledToLive) {
                                card.scrollIntoView({behavior: "smooth", block: "center"});
                                window.hasScrolledToLive = true;
                            }
                        }
                    }
                 });
            }
        }

        function switchView(view, btn) {
            document.querySelectorAll('.view-section').forEach(el => {
                el.classList.add('hidden');
                el.style.display = 'none';
            });

            const target = document.getElementById('view-' + view);
            if(target) {
                target.classList.remove('hidden');
                target.style.display = 'block';
            }

            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            if(btn) {
                btn.classList.add('active');
            } else {
                const map = {'trip':0, 'wallet':1, 'trans':2, 'info':3};
                const navs = document.querySelectorAll('.nav-btn');
                if(navs[map[view]]) navs[map[view]].classList.add('active');
            }
            
            if(view === 'wallet') { 
                renderExpenses(); 
                updateExpenseDashboard(); 
            }
            if(view === 'info') {
                renderFullTripMap();
            }
            
            window.scrollTo(0,0);
        }

        function switchDay(i) {
            // Animation Lock
            if (isAnimating) return;

            const tripView = document.getElementById('view-trip');
            const isHidden = tripView.classList.contains('hidden') || tripView.style.display === 'none';

            // Guard: If clicking the same day AND the trip view is visible, do nothing.
            // If hidden, we proceed because we need to show the trip view.
            if(i === currentIdx && !isHidden) return;
            
            // Calculate direction for animation
            // i > currentIdx: Going forward (Next Day) -> Content comes from Right (-1)
            // i < currentIdx: Going backward (Prev Day) -> Content comes from Left (1)
            const direction = i > currentIdx ? -1 : 1;

            currentIdx = i;
            
            if (isHidden) {
                switchView('trip'); 
                // Force render with no slide animation (0) to ensure content is up-to-date
                renderTrip(0); 
                checkActiveEvent();
            } else {
                // Lock animation for short duration to prevent cutoff
                isAnimating = true;
                renderTrip(direction);
                checkActiveEvent();
                setTimeout(() => { isAnimating = false; }, 350); // Matches CSS transition duration
            }
        }

        // --- GESTURE SETUP ---
        function setupGestures() {
            const tripView = document.getElementById('view-trip');
            let startX = 0;
            let startY = 0;
            let currentTranslate = 0;
            let isDragging = false;
            let isHorizontalDrag = false;

            tripView.addEventListener('touchstart', (e) => {
                if (isAnimating) return; // Block swipe if animating
                
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
                isDragging = true;
                isHorizontalDrag = false;
                
                // Remove transition during drag for direct 1:1 movement
                const container = document.getElementById('timeline-container');
                container.style.transition = 'none';
            }, { passive: true });

            tripView.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                
                const currentX = e.touches[0].clientX;
                const currentY = e.touches[0].clientY;
                const diffX = currentX - startX;
                const diffY = currentY - startY;

                // Determine intent (Horizontal swipe vs Vertical scroll)
                if (!isHorizontalDrag) {
                    if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 10) {
                        isHorizontalDrag = true;
                    } else if (Math.abs(diffY) > Math.abs(diffX) && Math.abs(diffY) > 10) {
                        // User is scrolling vertically, stop tracking horizontal swipe
                        isDragging = false;
                        return; 
                    }
                }

                if (isHorizontalDrag) {
                    // Prevent default scrolling behavior handled by CSS overscroll-behavior-x, 
                    // but we apply transform logic here
                    
                    // Rubber Banding Logic (Resistance at edges)
                    if ((currentIdx === 0 && diffX > 0) || (currentIdx === tripData.length - 1 && diffX < 0)) {
                        currentTranslate = diffX * 0.3; // High resistance
                    } else {
                        currentTranslate = diffX;
                    }

                    const container = document.getElementById('timeline-container');
                    container.style.transform = `translateX(${currentTranslate}px)`;
                }
            }, { passive: true });

            tripView.addEventListener('touchend', (e) => {
                if (!isDragging || !isHorizontalDrag) {
                    // Restore transition even if not dragged
                    document.getElementById('timeline-container').style.transition = '';
                    return;
                }
                
                isDragging = false;
                const container = document.getElementById('timeline-container');
                
                // Restore transition for the snap animation
                // Modified: Faster snap back (0.35s)
                container.style.transition = 'transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.35s ease';

                const threshold = window.innerWidth * 0.25; // Swipe 25% of screen to trigger
                
                if (Math.abs(currentTranslate) > threshold) {
                    if (currentTranslate > 0 && currentIdx > 0) {
                        // Swiped Right -> Go to Prev Day
                        switchDay(currentIdx - 1);
                    } else if (currentTranslate < 0 && currentIdx < tripData.length - 1) {
                        // Swiped Left -> Go to Next Day
                        switchDay(currentIdx + 1);
                    } else {
                        // Edge case (Rubber banding snap back)
                        container.style.transform = 'translateX(0)';
                    }
                } else {
                    // Not enough distance, snap back
                    container.style.transform = 'translateX(0)';
                }
                
                currentTranslate = 0;
            });
        }

        function updateExpenseDashboard() {
            const totals = { 'YK': 0, 'YY': 0, 'YS': 0 };
            expenses.forEach(e => {
                if (totals[e.user] !== undefined) totals[e.user] += e.price;
            });
            
            const ykEl = document.getElementById('dash-yk');
            if(ykEl) ykEl.innerText = "Â¥" + totals['YK'].toLocaleString();
            
            const yyEl = document.getElementById('dash-yy');
            if(yyEl) yyEl.innerText = "Â¥" + totals['YY'].toLocaleString();
            
            const ysEl = document.getElementById('dash-ys');
            if(ysEl) ysEl.innerText = "Â¥" + totals['YS'].toLocaleString();
        }

        function renderExpenses() {
            let filteredList = expenses;
            if (currentFilterUser) {
                filteredList = expenses.filter(e => e.user === currentFilterUser);
            }

            let total = 0;
            filteredList.forEach(e => { total += e.price; });
            
            const totalJpyEl = document.getElementById('total-jpy');
            if(totalJpyEl) totalJpyEl.innerText = "Â¥" + total.toLocaleString();
            
            const totalTwdEl = document.getElementById('total-twd');
            if(totalTwdEl) totalTwdEl.innerText = (total * currentRate).toFixed(0).toLocaleString();

            const html = filteredList.map(e => {
                const dateObj = e.timestamp ? e.timestamp.toDate() : new Date();
                const timeString = dateObj.getHours().toString().padStart(2,'0') + ":" + dateObj.getMinutes().toString().padStart(2,'0');
                const dateString = (dateObj.getMonth()+1) + "/" + dateObj.getDate();
                return `<div class="expense-item"><div class="exp-meta"><div class="exp-user">${e.user}</div><div><div style="font-weight:500;">${e.item}</div><div style="font-size:0.75rem; color:#999;">${dateString} ${timeString}</div></div></div><div class="serif">Â¥${e.price.toLocaleString()}</div></div>`;
            }).join('');
            
            const listEl = document.getElementById('expense-list');
            if(listEl) listEl.innerHTML = html.length ? html : '<div style="text-align:center; padding:20px; color:#999;">ç„¡è³‡æ–™</div>';
        }

        function renderFullTripMap() {
            const mapIframe = document.getElementById('trip-map-overview-iframe');
            if(mapIframe) {
                const centerLat = 40.7;
                const centerLng = 140.7;
                const zoom = 8;
                const viewUrl = `https://www.google.com/maps/embed/v1/view?key=${GOOGLE_MAPS_API_KEY}&center=${centerLat},${centerLng}&zoom=${zoom}`;
                mapIframe.src = viewUrl;
            }
        }

        async function setupFirebase() { 
            try {
                const envConfig = typeof __firebase_config !== 'undefined' ? __firebase_config : '{}';
                const configToUse = (firebaseConfig.apiKey && firebaseConfig.apiKey !== "") ? firebaseConfig : JSON.parse(envConfig);

                if (!configToUse.apiKey) {
                    console.warn("Firebase config missing. Running in offline/demo mode.");
                    renderTrip();
                    setupGestures();
                    return;
                }

                const app = initializeApp(configToUse);
                db = getFirestore(app);
                auth = getAuth(app);
                
                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

                if (initialAuthToken) {
                    try {
                        await signInWithCustomToken(auth, initialAuthToken);
                        console.log("Signed in with custom token successfully.");
                    } catch (e) {
                        console.warn("Custom token sign-in failed. Falling back to anonymous.", e);
                        await signInAnonymously(auth);
                    }
                } else {
                    await signInAnonymously(auth);
                }

                const userId = auth.currentUser?.uid || crypto.randomUUID(); 
                
                expensesRef = collection(db, `artifacts/${appId}/public/data/expenses`);
                notesRef = collection(db, `artifacts/${appId}/public/data/notes`);
                todosRef = collection(db, `artifacts/${appId}/public/data/todos`);
                
                subscribeToExpenses();
                subscribeToNotes();
                subscribeToTodos();

            } catch (error) {
                console.error("Firebase Initialization Error:", error);
                renderTrip();
                setupGestures();
            }
        }

        function startDynamicText() {
            const textElement = document.getElementById('dynamic-intro-text');
            const hour = new Date().getHours();
            let key = 'rest'; 
            if (hour >= 8 && hour <= 17) key = 'work';
            else if (hour >= 18 && hour <= 23) key = 'evening';

            const messages = timeSensitiveMessages[key];
            const msg = messages[Math.floor(Math.random() * messages.length)];
            textElement.innerText = msg;
            textElement.style.opacity = 1;
        }

        function getIconClass(wmoCode) {
            if (wmoCode === 0) return "fa-sun";
            if (wmoCode >= 1 && wmoCode <= 3) return "fa-cloud-sun";
            if (wmoCode === 45 || wmoCode === 48) return "fa-smog";
            if (wmoCode >= 51 && wmoCode <= 55) return "fa-cloud-rain";
            if (wmoCode >= 61 && wmoCode <= 65) return "fa-cloud-showers-heavy";
            if (wmoCode >= 71 && wmoCode <= 77) return "fa-snowflake";
            if (wmoCode >= 80 && wmoCode <= 82) return "fa-cloud-rain";
            if (wmoCode >= 95 && wmoCode <= 99) return "fa-bolt";
            return "fa-cloud";
        }

        function getMonday(d) {
            d = new Date(d);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); 
            return new Date(d.setDate(diff));
        }

        async function fetchWeather() {
            try {
                const today = new Date();
                const monday = getMonday(today);
                const saturday = new Date(monday);
                saturday.setDate(monday.getDate() + 5);

                const formatDate = (date) => date.toISOString().split('T')[0];
                const startStr = formatDate(monday);
                const endStr = formatDate(saturday);

                const urlHakodate = `https://api.open-meteo.com/v1/forecast?latitude=41.7687&longitude=140.7290&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo&start_date=${startStr}&end_date=${endStr}`;
                const urlAomori = `https://api.open-meteo.com/v1/forecast?latitude=40.8244&longitude=140.7400&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo&start_date=${startStr}&end_date=${endStr}`;

                const [resHak, resAom] = await Promise.all([
                    fetch(urlHakodate).then(r => r.json()),
                    fetch(urlAomori).then(r => r.json())
                ]);

                if (!resHak.daily || !resAom.daily) throw new Error("Weather API data incomplete");

                tripData.forEach((day, index) => {
                    let source = (index === 0) ? resHak : resAom;
                    let i = index; 
                    
                    if(source.daily.temperature_2m_max[i] !== undefined) {
                        const max = Math.round(source.daily.temperature_2m_max[i]);
                        const min = Math.round(source.daily.temperature_2m_min[i]);
                        const code = source.daily.weather_code[i];
                        
                        day.weather = {
                            icon: getIconClass(code),
                            temp: `${min}Â° / ${max}Â°`
                        };
                    }
                });

                if(currentIdx !== -1) renderTrip();
                
                // Re-render nav to update weather icons
                const nav = document.getElementById('date-nav');
                if(nav) nav.innerHTML = tripData.map((d, i) => `<div class="d-item ${i === currentIdx ? 'active' : ''}" onclick="window.switchDay(${i})">
                        <div class="d-week">${d.week}</div>
                        <div class="d-num">${d.date.split('.')[1]}</div>
                        <div class="d-weather">
                            <i class="fa-solid ${d.weather.icon}"></i>
                            <span>${d.weather.temp}</span>
                        </div>
                    </div>
                `).join('');

            } catch (e) {
                console.error("Weather Fetch Error:", e);
            }
        }

        function enterApp() {
            document.getElementById('intro-screen').style.transform = 'translateY(-100%)';
            renderTrip();
            setupGestures(); // Init gestures after app enter
            fetchRate();
            fetchWeather(); 
            renderFullTripMap();
            window.hasScrolledToLive = false;
            checkActiveEvent();
            setInterval(checkActiveEvent, 60000); 
        }

        function filterExpenses(user) {
            currentFilterUser = user;
            document.querySelectorAll('.dashboard-item').forEach(el => el.classList.remove('active'));
            if (user) {
                const index = ['YK', 'YY', 'YS'].indexOf(user);
                if(index !== -1) document.querySelector(`.dashboard-item:nth-child(${index + 1})`).classList.add('active');
                document.getElementById('reset-filter-btn').classList.remove('hidden');
            } else {
                document.getElementById('reset-filter-btn').classList.add('hidden');
            }
            renderExpenses();
        }

        function addTodo() {
            const input = document.getElementById('new-todo-text');
            const text = input.value.trim();
            if (!text || !todosRef) return;
            try {
                addDoc(todosRef, { text: text, completed: false, timestamp: serverTimestamp() });
                input.value = '';
            } catch (e) { console.error("Error adding todo:", e); }
        }

        function toggleTodo(id, currentStatus) {
            if (!todosRef) return;
            try { updateDoc(doc(todosRef, id), { completed: !currentStatus }); } catch (e) { console.error("Error toggling todo:", e); }
        }

        function deleteTodo(id) {
            if (!todosRef) return;
            try { deleteDoc(doc(todosRef, id)); } catch (e) { console.error("Error deleting todo:", e); }
        }
        
        function switchWidget(type) {
            document.querySelectorAll('.w-tab').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + type).classList.add('active');
            
            if (type === 'converter') {
                document.getElementById('currency-converter').classList.remove('hidden');
                document.getElementById('todo-widget').classList.add('hidden');
            } else {
                document.getElementById('currency-converter').classList.add('hidden');
                document.getElementById('todo-widget').classList.remove('hidden');
            }
        }

        function addExpense() {
            const item = document.getElementById('ex-item').value.trim();
            const price = parseInt(document.getElementById('ex-price').value);
            if(!item || isNaN(price) || price <= 0) return;
            if (!expensesRef) return;
            try {
                addDoc(expensesRef, { user: currentUser, item, price, timestamp: serverTimestamp(), rate: currentRate });
                document.getElementById('ex-item').value = '';
                document.getElementById('ex-price').value = '';
                document.getElementById('preview-twd').innerText = "â‰ˆ TWD 0";
            } catch (error) { console.error("Error adding expense:", error); }
        }
        
        function toggleEditNote() {
            const descEl = document.getElementById('m-desc');
            const editEl = document.getElementById('m-note-edit');
            const inputEl = document.getElementById('m-note-input');
            
            if (editEl.classList.contains('hidden')) {
                inputEl.value = descEl.innerText.trim();
                descEl.classList.add('hidden');
                editEl.classList.remove('hidden');
            } else {
                editEl.classList.add('hidden');
                descEl.classList.remove('hidden');
            }
        }

        function saveNote() {
            const newText = document.getElementById('m-note-input').value;
            if (!currentEventId || !notesRef) return;
            
            const descEl = document.getElementById('m-desc');
            if(descEl) descEl.innerHTML = newText.replace(/\n/g, '<br>'); 
            
            document.getElementById('m-note-edit').classList.add('hidden');
            if(descEl) descEl.classList.remove('hidden');
            
            try { setDoc(doc(notesRef, currentEventId), { text: newText.replace(/\n/g, '<br>'), updatedAt: serverTimestamp() }); } catch (error) { console.error("Error saving note:", error); }
        }

        function translateNow() {
            const input = document.getElementById('trans-input').value.trim();
            const outputBox = document.getElementById('trans-output-box');
            if (!input) return;
            document.getElementById('trans-zh').innerText = input;
            document.getElementById('trans-jp-result').innerHTML = "<i class='fa-solid fa-spinner fa-spin'></i> æ­£åœ¨ç¿»è­¯...";
            outputBox.classList.remove('hidden');
            
            setTimeout(() => {
                document.getElementById('trans-jp-result').innerHTML = "ç¿»è­¯æœå‹™ä¸²æ¥ä¸­...è«‹æš«æ™‚ä½¿ç”¨å­—å¡ã€‚"; 
                showFs("ç¿»è­¯æœå‹™ä¸²æ¥ä¸­...è«‹æš«æ™‚ä½¿ç”¨å­—å¡ã€‚", input);
            }, 1000);
        }

        function calcFromJpy(val) {
            const jpy = parseFloat(val);
            if(isNaN(jpy) || jpy === 0) { document.getElementById('calc-twd').value = ""; return; }
            const twd = Math.round(jpy * currentRate);
            document.getElementById('calc-twd').value = twd;
        }

        function calcFromTwd(val) {
            const twd = parseFloat(val);
            if(isNaN(twd) || twd === 0) { document.getElementById('calc-jpy').value = ""; return; }
            const jpy = Math.round(twd / currentRate);
            document.getElementById('calc-jpy').value = jpy;
        }
        
        function fetchRate() {
            fetch('https://api.exchangerate-api.com/v4/latest/JPY')
                .then(response => response.json())
                .then(data => {
                    if(data && data.rates && data.rates.TWD) {
                        currentRate = data.rates.TWD;
                        const rateEl = document.getElementById('current-rate');
                        if(rateEl) rateEl.innerText = "1 JPY = " + currentRate.toFixed(4) + " TWD";
                        renderExpenses();
                        calculatePreview(document.getElementById('ex-price').value);
                    }
                })
                .catch(err => { 
                    const rateEl = document.getElementById('current-rate');
                    if(rateEl) rateEl.innerText = "é›¢ç·šåŒ¯ç‡: " + currentRate.toFixed(4); 
                });
        }
        
        function selectUser(user, btn) {
            currentUser = user;
            document.querySelectorAll('.user-btn').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');
        }

        function calculatePreview(val) {
            const jpy = parseInt(val);
            if(isNaN(jpy) || jpy === 0) { document.getElementById('preview-twd').innerText = "â‰ˆ TWD 0"; return; }
            const twd = Math.round(jpy * currentRate);
            document.getElementById('preview-twd').innerText = "â‰ˆ TWD " + twd.toLocaleString();
        }
        
        function openExternalMap() {
            const mTitle = document.getElementById('m-title');
            const currentTitle = mTitle ? mTitle.innerText : '';
            if(currentTitle) {
                window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(currentTitle)}`, '_blank');
            }
        }

        function openNavigation() {
            if(currentNavLink) {
                window.open(currentNavLink, '_blank');
            }
        }
        
        function copyMapCode() {
            const mcEl = document.getElementById('m-mapcode');
            const code = mcEl ? mcEl.innerText : '';
            if (!code) return;
            
            const textArea = document.createElement('textarea');
            textArea.value = code;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                console.log('MapCode copied:', code);
            } catch (err) {
                 console.error('Failed to copy MapCode:', err);
            }
            document.body.removeChild(textArea);
        }

        function showFs(jp, cn) {
            document.getElementById('fs-jp').innerText = jp;
            document.getElementById('fs-cn').innerText = cn;
            document.getElementById('fs-text-modal').classList.add('active');
        }

        function closeFs() {
            document.getElementById('fs-text-modal').classList.remove('active');
        }

        function closeModal() {
            document.getElementById('detail-modal').classList.remove('active');
            document.querySelector('.modal-overlay').classList.remove('active');
            currentEventId = null;
        }

        function openDetail(dataStr, dayIdx, eventIdx) {
            const data = JSON.parse(decodeURIComponent(dataStr));
            
            currentEventId = `d${dayIdx}_e${eventIdx}`;
            
            const mTitle = document.getElementById('m-title');
            if(mTitle) mTitle.innerText = data.title;
            
            let displayNote = data.detail || data.desc;
            if(localNotes[currentEventId]) displayNote = localNotes[currentEventId];
            
            const mDesc = document.getElementById('m-desc');
            if(mDesc) mDesc.innerHTML = displayNote; 
            
            const mNoteEdit = document.getElementById('m-note-edit');
            if(mNoteEdit) mNoteEdit.classList.add('hidden');
            if(mDesc) mDesc.classList.remove('hidden');

            const mTag = document.getElementById('m-tag');
            if(mTag) mTag.innerText = data.tag;
            
            const mImg = document.getElementById('m-img');
            if(mImg) {
                mImg.src = data.img || 'https://placehold.co/800x600?text=No+Preview';
                if(!data.img) mImg.style.display = 'none';
                else mImg.style.display = 'block';
            }

            const infoGroup = document.getElementById('m-detail-info');
            let infoHtml = '';
            const headerHtml = `<h3 class="serif" style="font-size: 1.2rem; margin-bottom: 15px; color: var(--accent-main);">é è¨‚ / äº¤é€šè³‡è¨Š</h3>`;

            if (data.reservation_info) {
                const res = data.reservation_info;
                infoGroup.classList.remove('hidden');
                infoHtml += createInfoItem('fa-hashtag', 'é è¨‚ç·¨è™Ÿ', res.number);
                infoHtml += createInfoItem('fa-user', 'é è¨‚äºº', res.name);
                infoHtml += createInfoItem('fa-calendar-check', 'å…¥ä½/æ™‚é–“', res.check_in || res.departure);
                infoHtml += createInfoItem('fa-users', 'äººæ•¸', res.guests);
            } 
            
            if (data.transport_info) {
                const trans = data.transport_info;
                infoGroup.classList.remove('hidden');
                infoHtml += createInfoItem('fa-train-subway', 'é¡å‹', trans.type);
                infoHtml += createInfoItem('fa-clock', 'å‡ºç™¼', trans.departure);
                infoHtml += createInfoItem('fa-clock-rotate-left', 'é è¨ˆæ™‚é•·', trans.time_estimate);
                infoHtml += createInfoItem('fa-road', 'å‚™è¨»', trans.note);
            } 
            
            if (!data.reservation_info && !data.transport_info) {
                 infoGroup.classList.add('hidden');
            }
            infoGroup.innerHTML = headerHtml + infoHtml;


            const mapSec = document.getElementById('m-map-section');
            if (data.nav && data.nav.mapcode) {
                mapSec.classList.remove('hidden');
                const mcEl = document.getElementById('m-mapcode');
                if(mcEl) mcEl.innerText = data.nav.mapcode;
            } else {
                mapSec.classList.add('hidden');
            }
            
            currentNavLink = data.navLink;
            const btnNavigate = document.getElementById('btn-navigate');
            if(currentNavLink) {
                btnNavigate.classList.remove('hidden');
            } else {
                btnNavigate.classList.add('hidden');
            }

            const gmapPreview = document.getElementById('m-gmap-preview');
            const gmapIframe = document.getElementById('m-gmap-iframe');
            
            const mapUrl = getMapUrl(data);
            
            if (mapUrl) {
                gmapPreview.classList.remove('hidden');
                gmapIframe.src = mapUrl;
            } else {
                gmapPreview.classList.add('hidden');
            }

            document.getElementById('detail-modal').classList.add('active');
            document.querySelector('.modal-overlay').classList.add('active');
        }

        window.enterApp = enterApp;
        window.switchView = switchView;
        window.switchDay = switchDay;
        window.filterExpenses = filterExpenses;
        window.switchWidget = switchWidget;
        window.calcFromJpy = calcFromJpy;
        window.calcFromTwd = calcFromTwd;
        window.selectUser = selectUser; 
        window.calculatePreview = calculatePreview; 
        window.addExpense = addExpense;
        window.addTodo = addTodo;
        window.toggleTodo = toggleTodo;
        window.deleteTodo = deleteTodo;
        window.translateNow = translateNow;
        window.showFs = showFs;
        window.closeFs = closeFs;
        window.toggleEditNote = toggleEditNote;
        window.saveNote = saveNote;
        window.openDetail = openDetail;
        window.openExternalMap = openExternalMap;
        window.openNavigation = openNavigation;
        window.copyMapCode = copyMapCode;
        window.closeModal = closeModal;
        window.renderTrip = renderTrip; 
        window.checkActiveEvent = checkActiveEvent; 
        window.updateExpenseDashboard = updateExpenseDashboard; 

        window.onload = function() {
            createSnow(); // Start Snow Animation
            setupFirebase();
            const start = new Date("2026-02-02").getTime();
            const now = new Date().getTime();
            const days = Math.ceil((start - now) / (1000 * 60 * 60 * 24));
            
            const daysLeftEl = document.getElementById('days-left');
            if(daysLeftEl) daysLeftEl.innerText = days > 0 ? days : 0;
            
            const headerDaysEl = document.getElementById('header-days');
            if(headerDaysEl) headerDaysEl.innerText = days > 0 ? days : 0;
            
            const tripView = document.getElementById('view-trip');
            if(tripView) tripView.style.display = 'block'; 
            
            setTimeout(startDynamicText, 1000);
        };
        
    </script>
</body>
</html>
